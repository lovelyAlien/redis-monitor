/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@emotion/css","react","@grafana/ui","@grafana/runtime","lodash","rxjs","prismjs","redux","react-dom","react-redux"],((e,t,r,n,a,i,o,s,l,c,u)=>(()=>{var d,p,h,m,f={8331:(e,t,r)=>{"use strict";var n=r(8531),a=(r(1269),r(7781),r(4629));r(5959),r(2007);function i(e){return"function"==typeof e}var o,s=((o=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),o.prototype.constructor=o,o);function l(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var c=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,o;if(!this.closed){this.closed=!0;var l=this._parentage;if(l)if(this._parentage=null,Array.isArray(l))try{for(var c=a.__values(l),u=c.next();!u.done;u=c.next())u.value.remove(this)}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else l.remove(this);var p=this.initialTeardown;if(i(p))try{p()}catch(e){o=e instanceof s?e.errors:[e]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var m=a.__values(h),f=m.next();!f.done;f=m.next()){var g=f.value;try{d(g)}catch(e){o=null!=o?o:[],e instanceof s?o=a.__spreadArray(a.__spreadArray([],a.__read(o)),a.__read(e.errors)):o.push(e)}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}}if(o)throw new s(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)d(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&l(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&l(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function u(e){return e instanceof c||e&&"closed"in e&&i(e.remove)&&i(e.add)&&i(e.unsubscribe)}function d(e){i(e)?e():e.unsubscribe()}c.EMPTY;var p=void 0,h=!1;function m(e){!function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];setTimeout.apply(void 0,a.__spreadArray([e,t],a.__read(r)))}((function(){throw e}))}function f(){}var g=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,u(t)&&t.add(r)):r.destination=w,r}return a.__extends(t,e),t.create=function(e,t,r){return new x(e,t,r)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(c),b=Function.prototype.bind;function v(e,t){return b.call(e,t)}var y=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){O(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){O(e)}else O(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){O(e)}},e}(),x=function(e){function t(t,r,n){var a,o,s=e.call(this)||this;return i(t)||!t?a={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&h?((o=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},a={next:t.next&&v(t.next,o),error:t.error&&v(t.error,o),complete:t.complete&&v(t.complete,o)}):a=t,s.destination=new y(a),s}return a.__extends(t,e),t}(g);function O(e){m(e)}var w={closed:!0,next:f,error:function(e){throw e},complete:f},S="function"==typeof Symbol&&Symbol.observable||"@@observable";function _(e){return e}!function(){function e(e){e&&(this._subscribe=e)}e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,a,o,s,l=this,c=(n=e)&&n instanceof g||function(e){return e&&i(e.next)&&i(e.error)&&i(e.complete)}(n)&&u(n)?e:new x(e,t,r);return o=(a=l).operator,s=a.source,c.add(o?o.call(c,s):s?l._subscribe(c):l._trySubscribe(c)),c},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=P(t))((function(t,n){var a=new x({next:function(t){try{e(t)}catch(e){n(e),a.unsubscribe()}},error:n,complete:t});r.subscribe(a)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[S]=function(){return this},e.prototype.pipe=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(0===(e=t).length?_:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)})(this)},e.prototype.toPromise=function(e){var t=this;return new(e=P(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)}}();function P(e){var t;return null!==(t=null!=e?e:p)&&void 0!==t?t:Promise}"function"==typeof Symbol&&Symbol.iterator&&Symbol.iterator;!function(e){function t(t,r,n,a,i,o){var s=e.call(this,t)||this;return s.onFinalize=i,s.shouldUnsubscribe=o,s._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}a.__extends(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}(g);Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;n.DataSourceWithBackend},2039:e=>{"use strict";e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0,a=void 0,i=void 0,o=[];return function(){var l=function(e){return"function"==typeof e?e():e}(t),c=(new Date).getTime(),u=!n||c-n>l;n=c;for(var d=arguments.length,p=Array(d),h=0;h<d;h++)p[h]=arguments[h];if(u&&r.leading)return r.accumulate?Promise.resolve(e.call(this,[p])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(p)));if(a?clearTimeout(i):a=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}(),o.push(p),i=setTimeout(s.bind(this),l),r.accumulate){var m=o.length-1;return a.promise.then((function(e){return e[m]}))}return a.promise};function s(){var t=a;clearTimeout(i),Promise.resolve(r.accumulate?e.call(this,o):e.apply(this,o[o.length-1])).then(t.resolve,t.reject),o=[],a=null}}},6643:function(e){e.exports=function(){var e=[],t=[],r={},n={},a={};function i(e){return"string"==typeof e?new RegExp("^"+e+"$","i"):e}function o(e,t){return e===t?t:e===e.toLowerCase()?t.toLowerCase():e===e.toUpperCase()?t.toUpperCase():e[0]===e[0].toUpperCase()?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():t.toLowerCase()}function s(e,t){return e.replace(t[0],(function(r,n){var a,i,s=(a=t[1],i=arguments,a.replace(/\$(\d{1,2})/g,(function(e,t){return i[t]||""})));return o(""===r?e[n-1]:r,s)}))}function l(e,t,n){if(!e.length||r.hasOwnProperty(e))return t;for(var a=n.length;a--;){var i=n[a];if(i[0].test(t))return s(t,i)}return t}function c(e,t,r){return function(n){var a=n.toLowerCase();return t.hasOwnProperty(a)?o(n,a):e.hasOwnProperty(a)?o(n,e[a]):l(a,n,r)}}function u(e,t,r,n){return function(n){var a=n.toLowerCase();return!!t.hasOwnProperty(a)||!e.hasOwnProperty(a)&&l(a,a,r)===a}}function d(e,t,r){return(r?t+" ":"")+(1===t?d.singular(e):d.plural(e))}return d.plural=c(a,n,e),d.isPlural=u(a,n,e),d.singular=c(n,a,t),d.isSingular=u(n,a,t),d.addPluralRule=function(t,r){e.push([i(t),r])},d.addSingularRule=function(e,r){t.push([i(e),r])},d.addUncountableRule=function(e){"string"!=typeof e?(d.addPluralRule(e,"$0"),d.addSingularRule(e,"$0")):r[e.toLowerCase()]=!0},d.addIrregularRule=function(e,t){t=t.toLowerCase(),e=e.toLowerCase(),a[e]=t,n[t]=e},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach((function(e){return d.addIrregularRule(e[0],e[1])})),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach((function(e){return d.addPluralRule(e[0],e[1])})),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach((function(e){return d.addSingularRule(e[0],e[1])})),["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","species","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[eÃ©]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(d.addUncountableRule),d}()},2341:(e,t,r)=>{e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=r(2))&&n.__esModule?n:{default:n};t.default=a.default,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function a(e){return e&&e.__esModule?e:{default:e}}t.default=c;var i=r(3),o=a(r(4)),s=r(14),l=a(r(15));function c(e){var t=e.activeClassName,r=void 0===t?"":t,a=e.activeIndex,o=void 0===a?-1:a,c=e.activeStyle,u=e.autoEscape,d=e.caseSensitive,p=void 0!==d&&d,h=e.className,m=e.findChunks,f=e.highlightClassName,g=void 0===f?"":f,b=e.highlightStyle,v=void 0===b?{}:b,y=e.highlightTag,x=void 0===y?"mark":y,O=e.sanitize,w=e.searchWords,S=e.textToHighlight,_=e.unhighlightTag,P=void 0===_?"span":_,E=e.unhighlightClassName,T=void 0===E?"":E,C=e.unhighlightStyle,I=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["activeClassName","activeIndex","activeStyle","autoEscape","caseSensitive","className","findChunks","highlightClassName","highlightStyle","highlightTag","sanitize","searchWords","textToHighlight","unhighlightTag","unhighlightClassName","unhighlightStyle"]),j=(0,i.findAll)({autoEscape:u,caseSensitive:p,findChunks:m,sanitize:O,searchWords:w,textToHighlight:S}),$=x,D=-1,k="",R=void 0,A=(0,l.default)((function(e){var t={};for(var r in e)t[r.toLowerCase()]=e[r];return t}));return(0,s.createElement)("span",n({className:h},I,{children:j.map((function(e,t){var n=S.substr(e.start,e.end-e.start);if(e.highlight){D++;var a;a="object"==typeof g?p?g[n]:(g=A(g))[n.toLowerCase()]:g;var i=D===+o;k=a+" "+(i?r:""),R=!0===i&&null!=c?Object.assign({},v,c):v;var l={children:n,className:k,key:t,style:R};return"string"!=typeof $&&(l.highlightIndex=D),(0,s.createElement)($,l)}return(0,s.createElement)(P,{children:n,className:T,key:t,style:C})}))}))}c.propTypes={activeClassName:o.default.string,activeIndex:o.default.number,activeStyle:o.default.object,autoEscape:o.default.bool,className:o.default.string,findChunks:o.default.func,highlightClassName:o.default.oneOfType([o.default.object,o.default.string]),highlightStyle:o.default.object,highlightTag:o.default.oneOfType([o.default.node,o.default.func,o.default.string]),sanitize:o.default.func,searchWords:o.default.arrayOf(o.default.oneOfType([o.default.string,o.default.instanceOf(RegExp)])).isRequired,textToHighlight:o.default.string.isRequired,unhighlightTag:o.default.oneOfType([o.default.node,o.default.func,o.default.string]),unhighlightClassName:o.default.string,unhighlightStyle:o.default.object},e.exports=t.default},function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);Object.defineProperty(t,"combineChunks",{enumerable:!0,get:function(){return n.combineChunks}}),Object.defineProperty(t,"fillInChunks",{enumerable:!0,get:function(){return n.fillInChunks}}),Object.defineProperty(t,"findAll",{enumerable:!0,get:function(){return n.findAll}}),Object.defineProperty(t,"findChunks",{enumerable:!0,get:function(){return n.findChunks}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=function(e){var t=e.autoEscape,i=e.caseSensitive,o=void 0!==i&&i,s=e.findChunks,l=void 0===s?n:s,c=e.sanitize,u=e.searchWords,d=e.textToHighlight;return a({chunksToHighlight:r({chunks:l({autoEscape:t,caseSensitive:o,sanitize:c,searchWords:u,textToHighlight:d})}),totalLength:d?d.length:0})};var r=t.combineChunks=function(e){var t=e.chunks;return t.sort((function(e,t){return e.start-t.start})).reduce((function(e,t){if(0===e.length)return[t];var r=e.pop();if(t.start<=r.end){var n=Math.max(r.end,t.end);e.push({start:r.start,end:n})}else e.push(r,t);return e}),[])},n=function(e){var t=e.autoEscape,r=e.caseSensitive,n=e.sanitize,a=void 0===n?i:n,o=e.searchWords,s=e.textToHighlight;return s=a(s),o.filter((function(e){return e})).reduce((function(e,n){n=a(n),t&&(n=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"));for(var i=new RegExp(n,r?"g":"gi"),o=void 0;o=i.exec(s);){var l=o.index,c=i.lastIndex;c>l&&e.push({start:l,end:c}),o.index==i.lastIndex&&i.lastIndex++}return e}),[])};t.findChunks=n;var a=t.fillInChunks=function(e){var t=e.chunksToHighlight,r=e.totalLength,n=[],a=function(e,t,r){t-e>0&&n.push({start:e,end:t,highlight:r})};if(0===t.length)a(0,r,!1);else{var i=0;t.forEach((function(e){a(i,e.start,!1),a(e.start,e.end,!0),i=e.end})),a(i,r,!1)}return n};function i(e){return e}}])},function(e,t,r){(function(t){if("production"!==t.env.NODE_ENV){var n="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;e.exports=r(6)((function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}),!0)}else e.exports=r(13)()}).call(t,r(5))},function(e,t){var r,n,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],u=!1,d=-1;function p(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&h())}function h(){if(!u){var e=s(p);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||u||s(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=f,a.addListener=f,a.once=f,a.off=f,a.removeListener=f,a.removeAllListeners=f,a.emit=f,a.prependListener=f,a.prependOnceListener=f,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){(function(t){"use strict";var n=r(7),a=r(8),i=r(9),o=r(10),s=r(11),l=r(12);e.exports=function(e,r){var c="function"==typeof Symbol&&Symbol.iterator,u="<<anonymous>>",d={array:m("array"),bool:m("boolean"),func:m("function"),number:m("number"),object:m("object"),string:m("string"),symbol:m("symbol"),any:h(n.thatReturnsNull),arrayOf:function(e){return h((function(t,r,n,a,i){if("function"!=typeof e)return new p("Property `"+i+"` of component `"+n+"` has invalid PropType notation inside arrayOf.");var o=t[r];if(!Array.isArray(o))return new p("Invalid "+a+" `"+i+"` of type `"+g(o)+"` supplied to `"+n+"`, expected an array.");for(var l=0;l<o.length;l++){var c=e(o,l,n,a,i+"["+l+"]",s);if(c instanceof Error)return c}return null}))},element:h((function(t,r,n,a,i){var o=t[r];return e(o)?null:new p("Invalid "+a+" `"+i+"` of type `"+g(o)+"` supplied to `"+n+"`, expected a single ReactElement.")})),instanceOf:function(e){return h((function(t,r,n,a,i){if(!(t[r]instanceof e)){var o=e.name||u;return new p("Invalid "+a+" `"+i+"` of type `"+((s=t[r]).constructor&&s.constructor.name?s.constructor.name:u)+"` supplied to `"+n+"`, expected instance of `"+o+"`.")}var s;return null}))},node:h((function(e,t,r,n,a){return f(e[t])?null:new p("Invalid "+n+" `"+a+"` supplied to `"+r+"`, expected a ReactNode.")})),objectOf:function(e){return h((function(t,r,n,a,i){if("function"!=typeof e)return new p("Property `"+i+"` of component `"+n+"` has invalid PropType notation inside objectOf.");var o=t[r],l=g(o);if("object"!==l)return new p("Invalid "+a+" `"+i+"` of type `"+l+"` supplied to `"+n+"`, expected an object.");for(var c in o)if(o.hasOwnProperty(c)){var u=e(o,c,n,a,i+"."+c,s);if(u instanceof Error)return u}return null}))},oneOf:function(e){return Array.isArray(e)?h((function(t,r,n,a,i){for(var o=t[r],s=0;s<e.length;s++)if(l=o,c=e[s],l===c?0!==l||1/l==1/c:l!=l&&c!=c)return null;var l,c;return new p("Invalid "+a+" `"+i+"` of value `"+o+"` supplied to `"+n+"`, expected one of "+JSON.stringify(e)+".")})):("production"!==t.env.NODE_ENV&&i(!1,"Invalid argument supplied to oneOf, expected an instance of array."),n.thatReturnsNull)},oneOfType:function(e){if(!Array.isArray(e))return"production"!==t.env.NODE_ENV&&i(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),n.thatReturnsNull;for(var r=0;r<e.length;r++){var a=e[r];if("function"!=typeof a)return i(!1,"Invalid argument supplied to oneOfType. Expected an array of check functions, but received %s at index %s.",v(a),r),n.thatReturnsNull}return h((function(t,r,n,a,i){for(var o=0;o<e.length;o++)if(null==(0,e[o])(t,r,n,a,i,s))return null;return new p("Invalid "+a+" `"+i+"` supplied to `"+n+"`.")}))},shape:function(e){return h((function(t,r,n,a,i){var o=t[r],l=g(o);if("object"!==l)return new p("Invalid "+a+" `"+i+"` of type `"+l+"` supplied to `"+n+"`, expected `object`.");for(var c in e){var u=e[c];if(u){var d=u(o,c,n,a,i+"."+c,s);if(d)return d}}return null}))},exact:function(e){return h((function(t,r,n,a,i){var l=t[r],c=g(l);if("object"!==c)return new p("Invalid "+a+" `"+i+"` of type `"+c+"` supplied to `"+n+"`, expected `object`.");var u=o({},t[r],e);for(var d in u){var h=e[d];if(!h)return new p("Invalid "+a+" `"+i+"` key `"+d+"` supplied to `"+n+"`.\nBad object: "+JSON.stringify(t[r],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var m=h(l,d,n,a,i+"."+d,s);if(m)return m}return null}))}};function p(e){this.message=e,this.stack=""}function h(e){if("production"!==t.env.NODE_ENV)var n={},o=0;function l(l,c,d,h,m,f,g){if(h=h||u,f=f||d,g!==s)if(r)a(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==t.env.NODE_ENV&&"undefined"!=typeof console){var b=h+":"+d;!n[b]&&o<3&&(i(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",f,h),n[b]=!0,o++)}return null==c[d]?l?null===c[d]?new p("The "+m+" `"+f+"` is marked as required in `"+h+"`, but its value is `null`."):new p("The "+m+" `"+f+"` is marked as required in `"+h+"`, but its value is `undefined`."):null:e(c,d,h,m,f)}var c=l.bind(null,!1);return c.isRequired=l.bind(null,!0),c}function m(e){return h((function(t,r,n,a,i,o){var s=t[r];return g(s)!==e?new p("Invalid "+a+" `"+i+"` of type `"+b(s)+"` supplied to `"+n+"`, expected `"+e+"`."):null}))}function f(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(f);if(null===t||e(t))return!0;var r=function(e){var t=e&&(c&&e[c]||e["@@iterator"]);if("function"==typeof t)return t}(t);if(!r)return!1;var n,a=r.call(t);if(r!==t.entries){for(;!(n=a.next()).done;)if(!f(n.value))return!1}else for(;!(n=a.next()).done;){var i=n.value;if(i&&!f(i[1]))return!1}return!0;default:return!1}}function g(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol}(t,e)?"symbol":t}function b(e){if(null==e)return""+e;var t=g(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function v(e){var t=b(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return p.prototype=Error.prototype,d.checkPropTypes=l,d.PropTypes=d,d}}).call(t,r(5))},function(e,t){"use strict";function r(e){return function(){return e}}var n=function(){};n.thatReturns=r,n.thatReturnsFalse=r(!1),n.thatReturnsTrue=r(!0),n.thatReturnsNull=r(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},function(e,t,r){(function(t){"use strict";var r=function(e){};"production"!==t.env.NODE_ENV&&(r=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),e.exports=function(e,t,n,a,i,o,s,l){if(r(t),!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,a,i,o,s,l],d=0;(c=new Error(t.replace(/%s/g,(function(){return u[d++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}}).call(t,r(5))},function(e,t,r){(function(t){"use strict";var n=r(7);if("production"!==t.env.NODE_ENV){var a=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var a=0,i="Warning: "+e.replace(/%s/g,(function(){return r[a++]}));"undefined"!=typeof console&&console.error(i);try{throw new Error(i)}catch(e){}};n=function(e,t){if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];a.apply(void 0,[t].concat(n))}}}e.exports=n}).call(t,r(5))},function(e,t){"use strict";var r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,o,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var c in i=Object(arguments[l]))n.call(i,c)&&(s[c]=i[c]);if(r){o=r(i);for(var u=0;u<o.length;u++)a.call(i,o[u])&&(s[o[u]]=i[o[u]])}}return s}},function(e,t){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,r){(function(t){"use strict";if("production"!==t.env.NODE_ENV)var n=r(8),a=r(9),i=r(11),o={};e.exports=function(e,r,s,l,c){if("production"!==t.env.NODE_ENV)for(var u in e)if(e.hasOwnProperty(u)){var d;try{n("function"==typeof e[u],"%s: %s type `%s` is invalid; it must be a function, usually from the `prop-types` package, but received `%s`.",l||"React class",s,u,typeof e[u]),d=e[u](r,u,l,s,null,i)}catch(e){d=e}if(a(!d||d instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",l||"React class",s,u,typeof d),d instanceof Error&&!(d.message in o)){o[d.message]=!0;var p=c?c():"";a(!1,"Failed %s type: %s%s",s,d.message,null!=p?p:"")}}}}).call(t,r(5))},function(e,t,r){"use strict";var n=r(7),a=r(8),i=r(11);e.exports=function(){function e(e,t,r,n,o,s){s!==i&&a(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return r.checkPropTypes=n,r.PropTypes=r,r}},function(e,t){e.exports=r(5959)},function(e,t){"use strict";var r=function(e,t){return e===t};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,n=void 0,a=[],i=void 0,o=!1,s=function(e,r){return t(e,a[r])};return function(){for(var t=arguments.length,r=Array(t),l=0;l<t;l++)r[l]=arguments[l];return o&&n===this&&r.length===a.length&&r.every(s)?i:(o=!0,n=this,a=r,i=e.apply(this,r))}}}])},2192:(e,t,r)=>{"use strict";var n=r(5959),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,i={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:u,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},2540:(e,t,r)=>{"use strict";e.exports=r(2192)},9524:(e,t,r)=>{const n=Symbol("SemVer ANY");class a{static get ANY(){return n}constructor(e,t){if(t=i(t),e instanceof a){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?o[s.COMPARATORLOOSE]:o[s.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=i(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=a;const i=r(7095),{safeRe:o,t:s}=r(6850),l=r(3811),c=r(9796),u=r(7944),d=r(8395)},8395:(e,t,r)=>{const n=/\s+/g;class a{constructor(e,t){if(t=o(t),e instanceof a)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new a(e.raw,t);if(e instanceof s)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(n," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!b(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&v(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+e,r=i.get(t);if(r)return r;const n=this.options.loose,a=n?u[d.HYPHENRANGELOOSE]:u[d.HYPHENRANGE];e=e.replace(a,j(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[d.COMPARATORTRIM],p),l("comparator trim",e),e=e.replace(u[d.TILDETRIM],h),l("tilde trim",e),e=e.replace(u[d.CARETTRIM],m),l("caret trim",e);let o=e.split(" ").map((e=>x(e,this.options))).join(" ").split(/\s+/).map((e=>I(e,this.options)));n&&(o=o.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(u[d.COMPARATORLOOSE]))))),l("range list",o);const c=new Map,v=o.map((e=>new s(e,this.options)));for(const e of v){if(b(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const y=[...c.values()];return i.set(t,y),y}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Range is required");return this.set.some((r=>y(r,t)&&e.set.some((e=>y(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if($(this.set[t],e,this.options))return!0;return!1}}e.exports=a;const i=new(r(1158)),o=r(7095),s=r(9524),l=r(9796),c=r(7944),{safeRe:u,t:d,comparatorTrimReplace:p,tildeTrimReplace:h,caretTrimReplace:m}=r(6850),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=r(9630),b=e=>"<0.0.0-0"===e.value,v=e=>""===e.value,y=(e,t)=>{let r=!0;const n=e.slice();let a=n.pop();for(;r&&n.length;)r=n.every((e=>a.intersects(e,t))),a=n.pop();return r},x=(e,t)=>(l("comp",e,t),e=_(e,t),l("caret",e),e=w(e,t),l("tildes",e),e=E(e,t),l("xrange",e),e=C(e,t),l("stars",e),e),O=e=>!e||"x"===e.toLowerCase()||"*"===e,w=(e,t)=>e.trim().split(/\s+/).map((e=>S(e,t))).join(" "),S=(e,t)=>{const r=t.loose?u[d.TILDELOOSE]:u[d.TILDE];return e.replace(r,((t,r,n,a,i)=>{let o;return l("tilde",e,t,r,n,a,i),O(r)?o="":O(n)?o=`>=${r}.0.0 <${+r+1}.0.0-0`:O(a)?o=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:i?(l("replaceTilde pr",i),o=`>=${r}.${n}.${a}-${i} <${r}.${+n+1}.0-0`):o=`>=${r}.${n}.${a} <${r}.${+n+1}.0-0`,l("tilde return",o),o}))},_=(e,t)=>e.trim().split(/\s+/).map((e=>P(e,t))).join(" "),P=(e,t)=>{l("caret",e,t);const r=t.loose?u[d.CARETLOOSE]:u[d.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,((t,r,a,i,o)=>{let s;return l("caret",e,t,r,a,i,o),O(r)?s="":O(a)?s=`>=${r}.0.0${n} <${+r+1}.0.0-0`:O(i)?s="0"===r?`>=${r}.${a}.0${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.0${n} <${+r+1}.0.0-0`:o?(l("replaceCaret pr",o),s="0"===r?"0"===a?`>=${r}.${a}.${i}-${o} <${r}.${a}.${+i+1}-0`:`>=${r}.${a}.${i}-${o} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${i}-${o} <${+r+1}.0.0-0`):(l("no pr"),s="0"===r?"0"===a?`>=${r}.${a}.${i}${n} <${r}.${a}.${+i+1}-0`:`>=${r}.${a}.${i}${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${i} <${+r+1}.0.0-0`),l("caret return",s),s}))},E=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>T(e,t))).join(" ")),T=(e,t)=>{e=e.trim();const r=t.loose?u[d.XRANGELOOSE]:u[d.XRANGE];return e.replace(r,((r,n,a,i,o,s)=>{l("xRange",e,r,n,a,i,o,s);const c=O(a),u=c||O(i),d=u||O(o),p=d;return"="===n&&p&&(n=""),s=t.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&p?(u&&(i=0),o=0,">"===n?(n=">=",u?(a=+a+1,i=0,o=0):(i=+i+1,o=0)):"<="===n&&(n="<",u?a=+a+1:i=+i+1),"<"===n&&(s="-0"),r=`${n+a}.${i}.${o}${s}`):u?r=`>=${a}.0.0${s} <${+a+1}.0.0-0`:d&&(r=`>=${a}.${i}.0${s} <${a}.${+i+1}.0-0`),l("xRange return",r),r}))},C=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[d.STAR],"")),I=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),j=e=>(t,r,n,a,i,o,s,l,c,u,d,p)=>`${r=O(n)?"":O(a)?`>=${n}.0.0${e?"-0":""}`:O(i)?`>=${n}.${a}.0${e?"-0":""}`:o?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=O(c)?"":O(u)?`<${+c+1}.0.0-0`:O(d)?`<${c}.${+u+1}.0-0`:p?`<=${c}.${u}.${d}-${p}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),$=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==s.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},7944:(e,t,r)=>{const n=r(9796),{MAX_LENGTH:a,MAX_SAFE_INTEGER:i}=r(9630),{safeRe:o,t:s}=r(6850),l=r(7095),{compareIdentifiers:c}=r(4031);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw new TypeError(`version is longer than ${a} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?o[s.LOOSE]:o[s.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],a=e.prerelease[t];if(n("prerelease compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return c(r,a)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const r=this.build[t],a=e.build[t];if(n("build compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return c(r,a)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},7994:(e,t,r)=>{const n=r(5860);e.exports=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},3811:(e,t,r)=>{const n=r(6909),a=r(7659),i=r(144),o=r(2077),s=r(599),l=r(7092);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,c);case"!=":return a(e,r,c);case">":return i(e,r,c);case">=":return o(e,r,c);case"<":return s(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},5334:(e,t,r)=>{const n=r(7944),a=r(5860),{safeRe:i,t:o}=r(6850);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const n=t.includePrerelease?i[o.COERCERTLFULL]:i[o.COERCERTL];let a;for(;(a=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&a.index+a[0].length===r.index+r[0].length||(r=a),n.lastIndex=a.index+a[1].length+a[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?i[o.COERCEFULL]:i[o.COERCE]);if(null===r)return null;const s=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return a(`${s}.${l}.${c}${u}${d}`,t)}},2801:(e,t,r)=>{const n=r(7944);e.exports=(e,t,r)=>{const a=new n(e,r),i=new n(t,r);return a.compare(i)||a.compareBuild(i)}},7023:(e,t,r)=>{const n=r(5380);e.exports=(e,t)=>n(e,t,!0)},5380:(e,t,r)=>{const n=r(7944);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},660:(e,t,r)=>{const n=r(5860);e.exports=(e,t)=>{const r=n(e,null,!0),a=n(t,null,!0),i=r.compare(a);if(0===i)return null;const o=i>0,s=o?r:a,l=o?a:r,c=!!s.prerelease.length;if(l.prerelease.length&&!c)return l.patch||l.minor?s.patch?"patch":s.minor?"minor":"major":"major";const u=c?"pre":"";return r.major!==a.major?u+"major":r.minor!==a.minor?u+"minor":r.patch!==a.patch?u+"patch":"prerelease"}},6909:(e,t,r)=>{const n=r(5380);e.exports=(e,t,r)=>0===n(e,t,r)},144:(e,t,r)=>{const n=r(5380);e.exports=(e,t,r)=>n(e,t,r)>0},2077:(e,t,r)=>{const n=r(5380);e.exports=(e,t,r)=>n(e,t,r)>=0},5955:(e,t,r)=>{const n=r(7944);e.exports=(e,t,r,a,i)=>{"string"==typeof r&&(i=a,a=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,a,i).version}catch(e){return null}}},599:(e,t,r)=>{const n=r(5380);e.exports=(e,t,r)=>n(e,t,r)<0},7092:(e,t,r)=>{const n=r(5380);e.exports=(e,t,r)=>n(e,t,r)<=0},2966:(e,t,r)=>{const n=r(7944);e.exports=(e,t)=>new n(e,t).major},5986:(e,t,r)=>{const n=r(7944);e.exports=(e,t)=>new n(e,t).minor},7659:(e,t,r)=>{const n=r(5380);e.exports=(e,t,r)=>0!==n(e,t,r)},5860:(e,t,r)=>{const n=r(7944);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},1617:(e,t,r)=>{const n=r(7944);e.exports=(e,t)=>new n(e,t).patch},9613:(e,t,r)=>{const n=r(5860);e.exports=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},2862:(e,t,r)=>{const n=r(5380);e.exports=(e,t,r)=>n(t,e,r)},6033:(e,t,r)=>{const n=r(2801);e.exports=(e,t)=>e.sort(((e,r)=>n(r,e,t)))},1722:(e,t,r)=>{const n=r(8395);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},603:(e,t,r)=>{const n=r(2801);e.exports=(e,t)=>e.sort(((e,r)=>n(e,r,t)))},7645:(e,t,r)=>{const n=r(5860);e.exports=(e,t)=>{const r=n(e,t);return r?r.version:null}},8449:(e,t,r)=>{const n=r(6850),a=r(9630),i=r(7944),o=r(4031),s=r(5860),l=r(7645),c=r(7994),u=r(5955),d=r(660),p=r(2966),h=r(5986),m=r(1617),f=r(9613),g=r(5380),b=r(2862),v=r(7023),y=r(2801),x=r(603),O=r(6033),w=r(144),S=r(599),_=r(6909),P=r(7659),E=r(2077),T=r(7092),C=r(3811),I=r(5334),j=r(9524),$=r(8395),D=r(1722),k=r(651),R=r(7840),A=r(7930),N=r(3489),L=r(7494),M=r(5463),F=r(7871),B=r(4266),q=r(1112),Q=r(1465),V=r(9252);e.exports={parse:s,valid:l,clean:c,inc:u,diff:d,major:p,minor:h,patch:m,prerelease:f,compare:g,rcompare:b,compareLoose:v,compareBuild:y,sort:x,rsort:O,gt:w,lt:S,eq:_,neq:P,gte:E,lte:T,cmp:C,coerce:I,Comparator:j,Range:$,satisfies:D,toComparators:k,maxSatisfying:R,minSatisfying:A,minVersion:N,validRange:L,outside:M,gtr:F,ltr:B,intersects:q,simplifyRange:Q,subset:V,SemVer:i,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:o.compareIdentifiers,rcompareIdentifiers:o.rcompareIdentifiers}},9630:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},9796:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},4031:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const n=t.test(e),a=t.test(r);return n&&a&&(e=+e,r=+r),e===r?0:n&&!a?-1:a&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},1158:e=>{e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},7095:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},6850:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:i}=r(9630),o=r(9796),s=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.t={};let d=0;const p="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[p,a]],m=(e,t,r)=>{const n=(e=>{for(const[t,r]of h)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),a=d++;o(e,a,t),u[e]=a,c[a]=t,s[a]=new RegExp(t,r?"g":void 0),l[a]=new RegExp(n,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),m("FULL",`^${c[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),m("LOOSE",`^${c[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),m("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[u.COERCE],!0),m("COERCERTLFULL",c[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},9368:(e,t,r)=>{e.exports=r(8449)},7871:(e,t,r)=>{const n=r(5463);e.exports=(e,t,r)=>n(e,t,">",r)},1112:(e,t,r)=>{const n=r(8395);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},4266:(e,t,r)=>{const n=r(5463);e.exports=(e,t,r)=>n(e,t,"<",r)},7840:(e,t,r)=>{const n=r(7944),a=r(8395);e.exports=(e,t,r)=>{let i=null,o=null,s=null;try{s=new a(t,r)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(i&&-1!==o.compare(e)||(i=e,o=new n(i,r)))})),i}},7930:(e,t,r)=>{const n=r(7944),a=r(8395);e.exports=(e,t,r)=>{let i=null,o=null,s=null;try{s=new a(t,r)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(i&&1!==o.compare(e)||(i=e,o=new n(i,r)))})),i}},3489:(e,t,r)=>{const n=r(7944),a=r(8395),i=r(144);e.exports=(e,t)=>{e=new a(e,t);let r=new n("0.0.0");if(e.test(r))return r;if(r=new n("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const a=e.set[t];let o=null;a.forEach((e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":o&&!i(t,o)||(o=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!o||r&&!i(r,o)||(r=o)}return r&&e.test(r)?r:null}},5463:(e,t,r)=>{const n=r(7944),a=r(9524),{ANY:i}=a,o=r(8395),s=r(1722),l=r(144),c=r(599),u=r(7092),d=r(2077);e.exports=(e,t,r,p)=>{let h,m,f,g,b;switch(e=new n(e,p),t=new o(t,p),r){case">":h=l,m=u,f=c,g=">",b=">=";break;case"<":h=c,m=d,f=l,g="<",b="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,p))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let o=null,s=null;if(n.forEach((e=>{e.semver===i&&(e=new a(">=0.0.0")),o=o||e,s=s||e,h(e.semver,o.semver,p)?o=e:f(e.semver,s.semver,p)&&(s=e)})),o.operator===g||o.operator===b)return!1;if((!s.operator||s.operator===g)&&m(e,s.semver))return!1;if(s.operator===b&&f(e,s.semver))return!1}return!0}},1465:(e,t,r)=>{const n=r(1722),a=r(5380);e.exports=(e,t,r)=>{const i=[];let o=null,s=null;const l=e.sort(((e,t)=>a(e,t,r)));for(const e of l)n(e,t,r)?(s=e,o||(o=e)):(s&&i.push([o,s]),s=null,o=null);o&&i.push([o,null]);const c=[];for(const[e,t]of i)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},9252:(e,t,r)=>{const n=r(8395),a=r(9524),{ANY:i}=a,o=r(1722),s=r(5380),l=[new a(">=0.0.0-0")],c=[new a(">=0.0.0")],u=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===i){if(1===t.length&&t[0].semver===i)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===i){if(r.includePrerelease)return!0;t=c}const n=new Set;let a,u,h,m,f,g,b;for(const t of e)">"===t.operator||">="===t.operator?a=d(a,t,r):"<"===t.operator||"<="===t.operator?u=p(u,t,r):n.add(t.semver);if(n.size>1)return null;if(a&&u){if(h=s(a.semver,u.semver,r),h>0)return null;if(0===h&&(">="!==a.operator||"<="!==u.operator))return null}for(const e of n){if(a&&!o(e,String(a),r))return null;if(u&&!o(e,String(u),r))return null;for(const n of t)if(!o(e,String(n),r))return!1;return!0}let v=!(!u||r.includePrerelease||!u.semver.prerelease.length)&&u.semver,y=!(!a||r.includePrerelease||!a.semver.prerelease.length)&&a.semver;v&&1===v.prerelease.length&&"<"===u.operator&&0===v.prerelease[0]&&(v=!1);for(const e of t){if(b=b||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,a)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),">"===e.operator||">="===e.operator){if(m=d(a,e,r),m===e&&m!==a)return!1}else if(">="===a.operator&&!o(a.semver,String(e),r))return!1;if(u)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),"<"===e.operator||"<="===e.operator){if(f=p(u,e,r),f===e&&f!==u)return!1}else if("<="===u.operator&&!o(u.semver,String(e),r))return!1;if(!e.operator&&(u||a)&&0!==h)return!1}return!(a&&g&&!u&&0!==h||u&&b&&!a&&0!==h||y||v)},d=(e,t,r)=>{if(!e)return t;const n=s(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},p=(e,t,r)=>{if(!e)return t;const n=s(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let a=!1;e:for(const n of e.set){for(const e of t.set){const t=u(n,e,r);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},651:(e,t,r)=>{const n=r(8395);e.exports=(e,t)=>new n(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},7494:(e,t,r)=>{const n=r(8395);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},6089:e=>{"use strict";e.exports=t},7781:t=>{"use strict";t.exports=e},8531:e=>{"use strict";e.exports=a},2007:e=>{"use strict";e.exports=n},3241:e=>{"use strict";e.exports=i},8146:e=>{"use strict";e.exports=s},5959:e=>{"use strict";e.exports=r},8398:e=>{"use strict";e.exports=c},200:e=>{"use strict";e.exports=u},7694:e=>{"use strict";e.exports=l},1269:e=>{"use strict";e.exports=o},4629:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>R,__assign:()=>i,__asyncDelegator:()=>P,__asyncGenerator:()=>_,__asyncValues:()=>E,__await:()=>S,__awaiter:()=>m,__classPrivateFieldGet:()=>$,__classPrivateFieldIn:()=>k,__classPrivateFieldSet:()=>D,__createBinding:()=>g,__decorate:()=>s,__disposeResources:()=>N,__esDecorate:()=>c,__exportStar:()=>b,__extends:()=>a,__generator:()=>f,__importDefault:()=>j,__importStar:()=>I,__makeTemplateObject:()=>T,__metadata:()=>h,__param:()=>l,__propKey:()=>d,__read:()=>y,__rest:()=>o,__runInitializers:()=>u,__setFunctionName:()=>p,__spread:()=>x,__spreadArray:()=>w,__spreadArrays:()=>O,__values:()=>v,default:()=>L});var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)};function o(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}function s(e,t,r,n){var a,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}function l(e,t){return function(r,n){t(r,n,e)}}function c(e,t,r,n,a,i){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,l=n.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?n.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),p=!1,h=r.length-1;h>=0;h--){var m={};for(var f in n)m[f]="access"===f?{}:n[f];for(var f in n.access)m.access[f]=n.access[f];m.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(e||null))};var g=(0,r[h])("accessor"===l?{get:d.get,set:d.set}:d[c],m);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(s=o(g.get))&&(d.get=s),(s=o(g.set))&&(d.set=s),(s=o(g.init))&&a.unshift(s)}else(s=o(g))&&("field"===l?a.unshift(s):d[c]=s)}u&&Object.defineProperty(u,n.name,d),p=!0}function u(e,t,r){for(var n=arguments.length>2,a=0;a<t.length;a++)r=n?t[a].call(e,r):t[a].call(e);return n?r:void 0}function d(e){return"symbol"==typeof e?e:"".concat(e)}function p(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function h(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function m(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))}function f(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var g=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function b(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||g(t,e,r)}function v(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return o}function x(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function O(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)n[a]=i[o];return n}function w(e,t,r){if(r||2===arguments.length)for(var n,a=0,i=t.length;a<i;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function S(e){return this instanceof S?(this.v=e,this):new S(e)}function _(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){a[e]&&(n[e]=function(t){return new Promise((function(r,n){i.push([e,t,r,n])>1||s(e,t)}))},t&&(n[e]=t(n[e])))}function s(e,t){try{(r=a[e](t)).value instanceof S?Promise.resolve(r.value.v).then(l,c):u(i[0][2],r)}catch(e){u(i[0][3],e)}var r}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}function P(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,a){t[n]=e[n]?function(t){return(r=!r)?{value:S(e[n](t)),done:!1}:a?a(t):t}:a}}function E(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=v(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,a){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,a,(t=e[r](t)).done,t.value)}))}}}function T(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var C=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&g(t,e,r);return C(t,e),t}function j(e){return e&&e.__esModule?e:{default:e}}function $(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function D(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r}function k(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function R(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var n,a;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(a=n)}if("function"!=typeof n)throw new TypeError("Object not disposable.");a&&(n=function(){try{a.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var A="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function N(e){function t(t){e.error=e.hasError?new A(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,n=0;return function a(){for(;r=e.stack.pop();)try{if(!r.async&&1===n)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(a,(function(e){return t(e),a()}))}else n|=1}catch(e){t(e)}if(1===n)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}const L={__extends:a,__assign:i,__rest:o,__decorate:s,__param:l,__metadata:h,__awaiter:m,__generator:f,__createBinding:g,__exportStar:b,__values:v,__read:y,__spread:x,__spreadArrays:O,__spreadArray:w,__await:S,__asyncGenerator:_,__asyncDelegator:P,__asyncValues:E,__makeTemplateObject:T,__importStar:I,__importDefault:j,__classPrivateFieldGet:$,__classPrivateFieldSet:D,__classPrivateFieldIn:k,__addDisposableResource:R,__disposeResources:N}}},g={};function b(e){var t=g[e];if(void 0!==t)return t.exports;var r=g[e]={id:e,exports:{}};return f[e].call(r.exports,r,r.exports,b),r.exports}b.m=f,b.amdO={},b.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return b.d(t,{a:t}),t},p=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,b.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);b.r(r);var n={};d=d||[null,p({}),p([]),p(p)];for(var a=2&t&&e;"object"==typeof a&&!~d.indexOf(a);a=p(a))Object.getOwnPropertyNames(a).forEach((t=>n[t]=()=>e[t]));return n.default=()=>e,b.d(r,n),r},b.d=(e,t)=>{for(var r in t)b.o(t,r)&&!b.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},b.f={},b.e=e=>Promise.all(Object.keys(b.f).reduce(((t,r)=>(b.f[r](e,t),t)),[])),b.u=e=>e+".js",b.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),b.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),h={},m="grafana-amazonprometheus-datasource:",b.l=(e,t,r,n)=>{if(h[e])h[e].push(t);else{var a,i;if(void 0!==r)for(var o=document.getElementsByTagName("script"),s=0;s<o.length;s++){var l=o[s];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==m+r){a=l;break}}a||(i=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,b.nc&&a.setAttribute("nonce",b.nc),a.setAttribute("data-webpack",m+r),a.src=e),h[e]=[t];var c=(t,r)=>{a.onerror=a.onload=null,clearTimeout(u);var n=h[e];if(delete h[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(r))),t)return t(r)},u=setTimeout(c.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=c.bind(null,a.onerror),a.onload=c.bind(null,a.onload),i&&document.head.appendChild(a)}},b.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},b.p="public/plugins/grafana-amazonprometheus-datasource/",(()=>{b.b=document.baseURI||self.location.href;var e={4231:0};b.f.j=(t,r)=>{var n=b.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var a=new Promise(((r,a)=>n=e[t]=[r,a]));r.push(n[2]=a);var i=b.p+b.u(t),o=new Error;b.l(i,(r=>{if(b.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var a=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",o.name="ChunkLoadError",o.type=a,o.request=i,n[1](o)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,a,[i,o,s]=r,l=0;if(i.some((t=>0!==e[t]))){for(n in o)b.o(o,n)&&(b.m[n]=o[n]);s&&s(b)}for(t&&t(r);l<i.length;l++)a=i[l],b.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkgrafana_amazonprometheus_datasource=self.webpackChunkgrafana_amazonprometheus_datasource||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),b.nc=void 0;var v={};return(()=>{"use strict";b.r(v),b.d(v,{plugin:()=>XE});var e=b(7781),t=b(3241),r=b(1269);function n(e){return"function"==typeof e}function a(e){return function(t){if(function(e){return n(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var i,o=b(4629),s=((i=function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}((function(e){Error.call(e),e.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),i.prototype.constructor=i,i);function l(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var c=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,r,a,i;if(!this.closed){this.closed=!0;var l=this._parentage;if(l)if(this._parentage=null,Array.isArray(l))try{for(var c=(0,o.__values)(l),d=c.next();!d.done;d=c.next())d.value.remove(this)}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else l.remove(this);var p=this.initialTeardown;if(n(p))try{p()}catch(e){i=e instanceof s?e.errors:[e]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var m=(0,o.__values)(h),f=m.next();!f.done;f=m.next()){var g=f.value;try{u(g)}catch(e){i=null!=i?i:[],e instanceof s?i=(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(i)),(0,o.__read)(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(a=m.return)&&a.call(m)}finally{if(r)throw r.error}}}if(i)throw new s(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)u(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&l(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&l(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();function u(e){n(e)?e():e.unsubscribe()}c.EMPTY;var d={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=d.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,(0,o.__spreadArray)([e,t],(0,o.__read)(r))):setTimeout.apply(void 0,(0,o.__spreadArray)([e,t],(0,o.__read)(r)))},clearTimeout:function(e){var t=d.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function p(){}var h=m("C",void 0,void 0);function m(e,t,r){return{kind:e,value:t,error:r}}var f=function(e){function t(t){var r,a=e.call(this)||this;return a.isStopped=!1,t?(a.destination=t,((r=t)instanceof c||r&&"closed"in r&&n(r.remove)&&n(r.add)&&n(r.unsubscribe))&&t.add(a)):a.destination=w,a}return(0,o.__extends)(t,e),t.create=function(e,t,r){return new y(e,t,r)},t.prototype.next=function(e){this.isStopped?O(function(e){return m("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?O(m("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?O(h,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(c);Function.prototype.bind;var g=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){x(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){x(e)}else x(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){x(e)}},e}(),y=function(e){function t(t,r,a){var i,o=e.call(this)||this;return i=n(t)||!t?{next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=a?a:void 0}:t,o.destination=new g(i),o}return(0,o.__extends)(t,e),t}(f);function x(e){!function(e){d.setTimeout((function(){throw e}))}(e)}function O(e,t){var r=null;r&&d.setTimeout((function(){return r(e,t)}))}var w={closed:!0,next:p,error:function(e){throw e},complete:p};function S(e,t,r,n,a){return new _(e,t,r,n,a)}var _=function(e){function t(t,r,n,a,i,o){var s=e.call(this,t)||this;return s.onFinalize=i,s.shouldUnsubscribe=o,s._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return(0,o.__extends)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(f);function P(e,t){return a((function(r,n){var a=0;r.subscribe(S(n,(function(r){n.next(e.call(t,r,a++))})))}))}function E(e){return e}function T(e,t,r){var i=n(e)||t||r?{next:e,error:t,complete:r}:e;return i?a((function(e,t){var r;null===(r=i.subscribe)||void 0===r||r.call(i);var n=!0;e.subscribe(S(t,(function(e){var r;null===(r=i.next)||void 0===r||r.call(i,e),t.next(e)}),(function(){var e;n=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()}),(function(e){var r;n=!1,null===(r=i.error)||void 0===r||r.call(i,e),t.error(e)}),(function(){var e,t;n&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)})))})):E}var C=b(9368),I=b.n(C),j=b(8531);const $=1024;let D=0;class k{constructor(e,t){this.from=e,this.to=t}}class R{constructor(e={}){this.id=D++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=L.match(e)),t=>{let r=e(t);return void 0===r?null:[this,r]}}}R.closedBy=new R({deserialize:e=>e.split(" ")}),R.openedBy=new R({deserialize:e=>e.split(" ")}),R.group=new R({deserialize:e=>e.split(" ")}),R.isolate=new R({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),R.contextHash=new R({perNode:!0}),R.lookAhead=new R({perNode:!0}),R.mounted=new R({perNode:!0});class A{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[R.mounted.id]}}const N=Object.create(null);class L{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):N,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new L(e.name||"",t,e.id,r);if(e.props)for(let r of e.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(R.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return e=>{for(let r=e.prop(R.group),n=-1;n<(r?r.length:0);n++){let a=t[n<0?e.name:r[n]];if(a)return a}}}}L.none=new L("",Object.create(null),0,8);class M{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let t of e){let e=t(r);e&&(n||(n=Object.assign({},r.props)),n[e[0].id]=e[1])}t.push(n?new L(r.name,n,r.id,r.flags):r)}return new M(t)}}const F=new WeakMap,B=new WeakMap;var q;!function(e){e[e.ExcludeBuffers=1]="ExcludeBuffers",e[e.IncludeAnonymous=2]="IncludeAnonymous",e[e.IgnoreMounts=4]="IgnoreMounts",e[e.IgnoreOverlays=8]="IgnoreOverlays"}(q||(q={}));class Q{constructor(e,t,r,n,a){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,a&&a.length){this.props=Object.create(null);for(let[e,t]of a)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=A.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let r=e.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new te(this.topNode,e)}cursorAt(e,t=0,r=0){let n=F.get(this)||this.topNode,a=new te(n);return a.moveTo(e,t),F.set(this,a._tree),a}get topNode(){return new H(this,0,0,null)}resolve(e,t=0){let r=U(F.get(this)||this.topNode,e,t,!1);return F.set(this,r),r}resolveInner(e,t=0){let r=U(B.get(this)||this.topNode,e,t,!0);return B.set(this,r),r}resolveStack(e,t=0){return function(e,t,r){let n=e.resolveInner(t,r),a=null;for(let e=n instanceof H?n:n.context.parent;e;e=e.parent)if(e.index<0){let i=e.parent;(a||(a=[n])).push(i.resolve(t,r)),e=i}else{let i=A.get(e.tree);if(i&&i.overlay&&i.overlay[0].from<=t&&i.overlay[i.overlay.length-1].to>=t){let o=new H(i.tree,i.overlay[0].from+e.from,-1,e);(a||(a=[n])).push(U(o,t,r,!1))}}return a?Z(a):n}(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:a=this.length}=e,i=e.mode||0,o=(i&q.IncludeAnonymous)>0;for(let e=this.cursor(i|q.IncludeAnonymous);;){let i=!1;if(e.from<=a&&e.to>=n&&(!o&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;i=!0}for(;i&&r&&(o||!e.type.isAnonymous)&&r(e),!e.nextSibling();){if(!e.parent())return;i=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:ie(L.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,r)=>new Q(this.type,e,t,r,this.propValues)),e.makeTree||((e,t,r)=>new Q(L.none,e,t,r)))}static build(e){return function(e){var t;let{buffer:r,nodeSet:n,maxBufferLength:a=$,reused:i=[],minRepeatType:o=n.types.length}=e,s=Array.isArray(r)?new V(r,r.length):r,l=n.types,c=0,u=0;function d(e,t,r,g,b,v){let{id:y,start:x,end:O,size:w}=s,S=u,_=c;for(;w<0;){if(s.next(),-1==w){let t=i[y];return r.push(t),void g.push(x-e)}if(-3==w)return void(c=y);if(-4==w)return void(u=y);throw new RangeError(`Unrecognized record size: ${w}`)}let P,E,T=l[y],C=x-e;if(O-x<=a&&(E=function(e,t){let r=s.fork(),n=0,i=0,l=0,c=r.end-a,u={size:0,start:0,skip:0};e:for(let a=r.pos-e;r.pos>a;){let e=r.size;if(r.id==t&&e>=0){u.size=n,u.start=i,u.skip=l,l+=4,n+=4,r.next();continue}let s=r.pos-e;if(e<0||s<a||r.start<c)break;let d=r.id>=o?4:0,p=r.start;for(r.next();r.pos>s;){if(r.size<0){if(-3!=r.size)break e;d+=4}else r.id>=o&&(d+=4);r.next()}i=p,n+=e,l+=d}return(t<0||n==e)&&(u.size=n,u.start=i,u.skip=l),u.size>4?u:void 0}(s.pos-t,b))){let t=new Uint16Array(E.size-E.skip),r=s.pos-E.size,a=t.length;for(;s.pos>r;)a=f(E.start,t,a);P=new W(t,O-E.start,n),C=E.start-e}else{let e=s.pos-w;s.next();let t=[],r=[],n=y>=o?y:-1,i=0,l=O;for(;s.pos>e;)n>=0&&s.id==n&&s.size>=0?(s.end<=l-a&&(h(t,r,x,i,s.end,l,n,S,_),i=t.length,l=s.end),s.next()):v>2500?p(x,e,t,r):d(x,e,t,r,n,v+1);if(n>=0&&i>0&&i<t.length&&h(t,r,x,i,x,l,n,S,_),t.reverse(),r.reverse(),n>-1&&i>0){let e=function(e,t){return(r,n,a)=>{let i,o,s=0,l=r.length-1;if(l>=0&&(i=r[l])instanceof Q){if(!l&&i.type==e&&i.length==a)return i;(o=i.prop(R.lookAhead))&&(s=n[l]+i.length+o)}return m(e,r,n,a,s,t)}}(T,_);P=ie(T,t,r,0,t.length,0,O-x,e,e)}else P=m(T,t,r,O-x,S-O,_)}r.push(P),g.push(C)}function p(e,t,r,i){let o=[],l=0,c=-1;for(;s.pos>t;){let{id:e,start:t,end:r,size:n}=s;if(n>4)s.next();else{if(c>-1&&t<c)break;c<0&&(c=r-a),o.push(e,t,r),l++,s.next()}}if(l){let t=new Uint16Array(4*l),a=o[o.length-2];for(let e=o.length-3,r=0;e>=0;e-=3)t[r++]=o[e],t[r++]=o[e+1]-a,t[r++]=o[e+2]-a,t[r++]=r;r.push(new W(t,o[2]-a,n)),i.push(a-e)}}function h(e,t,r,a,i,o,s,l,c){let u=[],d=[];for(;e.length>a;)u.push(e.pop()),d.push(t.pop()+r-i);e.push(m(n.types[s],u,d,o-i,l-o,c)),t.push(i-r)}function m(e,t,r,n,a,i,o){if(i){let e=[R.contextHash,i];o=o?[e].concat(o):[e]}if(a>25){let e=[R.lookAhead,a];o=o?[e].concat(o):[e]}return new Q(e,t,r,n,o)}function f(e,t,r){let{id:n,start:a,end:i,size:l}=s;if(s.next(),l>=0&&n<o){let o=r;if(l>4){let n=s.pos-(l-4);for(;s.pos>n;)r=f(e,t,r)}t[--r]=o,t[--r]=i-e,t[--r]=a-e,t[--r]=n}else-3==l?c=n:-4==l&&(u=n);return r}let g=[],b=[];for(;s.pos>0;)d(e.start||0,e.bufferStart||0,g,b,-1,0);let v=null!==(t=e.length)&&void 0!==t?t:g.length?b[0]+g[0].length:0;return new Q(l[e.topID],g.reverse(),b.reverse(),v)}(e)}}Q.empty=new Q(L.none,[],[],0);class V{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new V(this.buffer,this.index)}}class W{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return L.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],a=n.name;if(/\W/.test(a)&&!n.isError&&(a=JSON.stringify(a)),r==(e+=4))return a;let i=[];for(;e<r;)i.push(this.childString(e)),e=this.buffer[e+3];return a+"("+i.join(",")+")"}findChild(e,t,r,n,a){let{buffer:i}=this,o=-1;for(let s=e;s!=t&&!(z(a,n,i[s+1],i[s+2])&&(o=s,r>0));s=i[s+3]);return o}slice(e,t,r){let n=this.buffer,a=new Uint16Array(t-e),i=0;for(let o=e,s=0;o<t;){a[s++]=n[o++],a[s++]=n[o++]-r;let t=a[s++]=n[o++]-r;a[s++]=n[o++]-e,i=Math.max(i,t)}return new W(a,i,this.set)}}function z(e,t,r,n){switch(e){case-2:return r<t;case-1:return n>=t&&r<t;case 0:return r<t&&n>t;case 1:return r<=t&&n>t;case 2:return n>t;case 4:return!0}}function U(e,t,r,n){for(var a;e.from==e.to||(r<1?e.from>=t:e.from>t)||(r>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof H&&e.index<0?null:e.parent;if(!t)return e;e=t}let i=n?0:q.IgnoreOverlays;if(n)for(let n=e,o=n.parent;o;n=o,o=n.parent)n instanceof H&&n.index<0&&(null===(a=o.enter(t,r,i))||void 0===a?void 0:a.from)!=n.from&&(e=o);for(;;){let n=e.enter(t,r,i);if(!n)return e;e=n}}class G{cursor(e=0){return new te(this,e)}getChild(e,t=null,r=null){let n=X(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return X(this,e,t,r)}resolve(e,t=0){return U(this,e,t,!1)}resolveInner(e,t=0){return U(this,e,t,!0)}matchContext(e){return Y(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(r=t,t=e.prevSibling):t=e}return r}get node(){return this}get next(){return this.parent}}class H extends G{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,a=0){for(let i=this;;){for(let{children:o,positions:s}=i._tree,l=t>0?o.length:-1;e!=l;e+=t){let l=o[e],c=s[e]+i.from;if(z(n,r,c,c+l.length))if(l instanceof W){if(a&q.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,t,r-c,n);if(o>-1)return new J(new K(i,l,e,c),null,o)}else if(a&q.IncludeAnonymous||!l.type.isAnonymous||re(l)){let o;if(!(a&q.IgnoreMounts)&&(o=A.get(l))&&!o.overlay)return new H(o.tree,c,e,i);let s=new H(l,c,e,i);return a&q.IncludeAnonymous||!s.type.isAnonymous?s:s.nextChild(t<0?l.children.length-1:0,t,r,n)}}if(a&q.IncludeAnonymous||!i.type.isAnonymous)return null;if(e=i.index>=0?i.index+t:t<0?-1:i._parent._tree.children.length,i=i._parent,!i)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let n;if(!(r&q.IgnoreOverlays)&&(n=A.get(this._tree))&&n.overlay){let r=e-this.from;for(let{from:e,to:a}of n.overlay)if((t>0?e<=r:e<r)&&(t<0?a>=r:a>r))return new H(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function X(e,t,r,n){let a=e.cursor(),i=[];if(!a.firstChild())return i;if(null!=r)for(let e=!1;!e;)if(e=a.type.is(r),!a.nextSibling())return i;for(;;){if(null!=n&&a.type.is(n))return i;if(a.type.is(t)&&i.push(a.node),!a.nextSibling())return null==n?i:[]}}function Y(e,t,r=t.length-1){for(let n=e;r>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[r]&&t[r]!=n.name)return!1;r--}}return!0}class K{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class J extends G{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,a=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return a<0?null:new J(this.context,this,a)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&q.ExcludeBuffers)return null;let{buffer:n}=this.context,a=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return a<0?null:new J(this.context,this,a)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new J(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new J(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,a=r.buffer[this.index+3];if(a>n){let i=r.buffer[this.index+1];e.push(r.slice(n,a,i)),t.push(0)}return new Q(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function Z(e){if(!e.length)return null;let t=0,r=e[0];for(let n=1;n<e.length;n++){let a=e[n];(a.from>r.from||a.to<r.to)&&(r=a,t=n)}let n=r instanceof H&&r.index<0?null:r.parent,a=e.slice();return n?a[t]=n:a.splice(t,1),new ee(a,r)}class ee{constructor(e,t){this.heads=e,this.node=t}get next(){return Z(this.heads)}}class te{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof H)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof H?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,a=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return!(a<0)&&(this.stack.push(this.index),this.yieldBuf(a))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?!(r&q.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&q.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&q.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let e=r<0?0:this.stack[r]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(e)}return r<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;({index:t,_parent:r}=r))if(t>-1)for(let n=t+e,a=e<0?-1:r._tree.children.length;n!=a;n+=e){let e=r._tree.children[n];if(this.mode&q.IncludeAnonymous||e instanceof W||!e.type.isAnonymous||re(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,a=this.stack.length;a>=0;){for(let i=e;i;i=i._parent)if(i.index==n){if(n==this.index)return i;t=i,r=a+1;break e}n=this.stack[--a]}for(let e=r;e<this.stack.length;e++)t=new J(this.buffer,t,this.stack[e]);return this.bufferNode=new J(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return Y(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,a=this.stack.length-1;n>=0;a--){if(a<0)return Y(this._tree,e,n);let i=r[t.buffer[this.stack[a]]];if(!i.isAnonymous){if(e[n]&&e[n]!=i.name)return!1;n--}}return!0}}function re(e){return e.children.some((e=>e instanceof W||!e.type.isAnonymous||re(e)))}const ne=new WeakMap;function ae(e,t){if(!e.isAnonymous||t instanceof W||t.type!=e)return 1;let r=ne.get(t);if(null==r){r=1;for(let n of t.children){if(n.type!=e||!(n instanceof Q)){r=1;break}r+=ae(e,n)}ne.set(t,r)}return r}function ie(e,t,r,n,a,i,o,s,l){let c=0;for(let r=n;r<a;r++)c+=ae(e,t[r]);let u=Math.ceil(1.5*c/8),d=[],p=[];return function t(r,n,a,o,s){for(let c=a;c<o;){let a=c,h=n[c],m=ae(e,r[c]);for(c++;c<o;c++){let t=ae(e,r[c]);if(m+t>=u)break;m+=t}if(c==a+1){if(m>u){let e=r[a];t(e.children,e.positions,0,e.children.length,n[a]+s);continue}d.push(r[a])}else{let t=n[c-1]+r[c-1].length-h;d.push(ie(e,r,n,a,c,h,t,null,l))}p.push(h+s-i)}}(t,r,n,a,0),(s||l)(d,p,o)}class oe{startParse(e,t,r){return"string"==typeof e&&(e=new se(e)),r=r?r.length?r.map((e=>new k(e.from,e.to))):[new k(0,0)]:[new k(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let e=n.advance();if(e)return e}}}class se{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new R({perNode:!0});class le{constructor(e,t,r,n,a,i,o,s,l,c=0,u){this.p=e,this.stack=t,this.state=r,this.reducePos=n,this.pos=a,this.score=i,this.buffer=o,this.bufferBase=s,this.curContext=l,this.lookAhead=c,this.parent=u}toString(){return`[${this.stack.filter(((e,t)=>t%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,r=0){let n=e.parser.context;return new le(e,[],t,r,r,0,[],0,n?new ce(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let r=e>>19,n=65535&e,{parser:a}=this.p,i=a.dynamicPrecedence(n);if(i&&(this.score+=i),0==r)return this.pushState(a.getGoto(this.state,n,!0),this.reducePos),n<a.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,4,!0),void this.reduceContext(n,this.reducePos);let o=this.stack.length-3*(r-1)-(262144&e?6:0),s=o?this.stack[o-2]:this.p.ranges[0].from,l=this.reducePos-s;l>=2e3&&!(null===(t=this.p.parser.nodeSet.types[n])||void 0===t?void 0:t.isAnonymous)&&(s==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=l):this.p.lastBigReductionSize<l&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=s,this.p.lastBigReductionSize=l));let c=o?this.stack[o-1]:0,u=this.bufferBase+this.buffer.length-c;if(n<a.minRepeatTerm||131072&e){let e=a.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,s,e,u+4,!0)}if(262144&e)this.state=this.stack[o];else{let e=this.stack[o-3];this.state=a.getGoto(e,n,!0)}for(;this.stack.length>o;)this.stack.pop();this.reduceContext(n,s)}storeNode(e,t,r,n=4,a=!1){if(0==e&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let e=this,n=this.buffer.length;if(0==n&&e.parent&&(n=e.bufferBase-e.parent.bufferBase,e=e.parent),n>0&&0==e.buffer[n-4]&&e.buffer[n-1]>-1){if(t==r)return;if(e.buffer[n-2]>=t)return void(e.buffer[n-2]=r)}}if(a&&this.pos!=r){let a=this.buffer.length;if(a>0&&0!=this.buffer[a-4])for(;a>0&&this.buffer[a-2]>r;)this.buffer[a]=this.buffer[a-4],this.buffer[a+1]=this.buffer[a-3],this.buffer[a+2]=this.buffer[a-2],this.buffer[a+3]=this.buffer[a-1],a-=4,n>4&&(n-=4);this.buffer[a]=e,this.buffer[a+1]=t,this.buffer[a+2]=r,this.buffer[a+3]=n}else this.buffer.push(e,t,r,n)}shift(e,t,r,n){if(131072&e)this.pushState(65535&e,this.pos);else if(262144&e)this.pos=n,this.shiftContext(t,r),t<=this.p.parser.maxNode&&this.buffer.push(t,r,n,4);else{let a=e,{parser:i}=this.p;(n>this.pos||t<=i.maxNode)&&(this.pos=n,i.stateFlag(a,1)||(this.reducePos=n)),this.pushState(a,r),this.shiftContext(t,r),t<=i.maxNode&&this.buffer.push(t,r,n,4)}}apply(e,t,r,n){65536&e?this.reduce(e):this.shift(e,t,r,n)}useNode(e,t){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(t,n),this.buffer.push(r,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let r=e.buffer.slice(t),n=e.bufferBase+t;for(;e&&n==e.bufferBase;)e=e.parent;return new le(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,r?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new ue(this);;){let r=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==r)return!1;if(!(65536&r))return!0;t.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let r=[];for(let n,a=0;a<t.length;a+=2)(n=t[a+1])!=this.state&&this.p.parser.hasAction(n,e)&&r.push(t[a],n);if(this.stack.length<120)for(let e=0;r.length<8&&e<t.length;e+=2){let n=t[e+1];r.some(((e,t)=>1&t&&e==n))||r.push(t[e],n)}t=r}let r=[];for(let e=0;e<t.length&&r.length<4;e+=2){let n=t[e+1];if(n==this.state)continue;let a=this.split();a.pushState(n,this.pos),a.storeNode(0,a.pos,a.pos,4,!0),a.shiftContext(t[e],this.pos),a.reducePos=this.pos,a.score-=200,r.push(a)}return r}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if(!(65536&t))return!1;if(!e.validAction(this.state,t)){let r=t>>19,n=65535&t,a=this.stack.length-3*r;if(a<0||e.getGoto(this.stack[a],n,!1)<0){let e=this.findForcedReduction();if(null==e)return!1;t=e}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],r=(n,a)=>{if(!t.includes(n))return t.push(n),e.allActions(n,(t=>{if(393216&t);else if(65536&t){let r=(t>>19)-a;if(r>1){let n=65535&t,a=this.stack.length-3*r;if(a>=0&&e.getGoto(this.stack[a],n,!1)>=0)return r<<19|65536|n}}else{let e=r(t,a+1);if(null!=e)return e}}))};return r(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new ce(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class ce{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class ue{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,r=e>>19;0==r?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(r-1);let n=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=n}}class de{constructor(e,t,r){this.stack=e,this.pos=t,this.index=r,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new de(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new de(this.stack,this.pos,this.index)}}function pe(e,t=Uint16Array){if("string"!=typeof e)return e;let r=null;for(let n=0,a=0;n<e.length;){let i=0;for(;;){let t=e.charCodeAt(n++),r=!1;if(126==t){i=65535;break}t>=92&&t--,t>=34&&t--;let a=t-32;if(a>=46&&(a-=46,r=!0),i+=a,r)break;i*=46}r?r[a++]=i:r=new t(i)}return r}class he{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const me=new he;class fe{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=me,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let r=this.range,n=this.rangeIndex,a=this.pos+e;for(;a<r.from;){if(!n)return null;let e=this.ranges[--n];a-=r.from-e.to,r=e}for(;t<0?a>r.to:a>=r.to;){if(n==this.ranges.length-1)return null;let e=this.ranges[++n];a+=e.from-r.to,r=e}return a}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t,r,n=this.chunkOff+e;if(n>=0&&n<this.chunk.length)t=this.pos+e,r=this.chunk.charCodeAt(n);else{let n=this.resolveOffset(e,1);if(null==n)return-1;if(t=n,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)r=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,n=this.range;for(;n.to<=t;)n=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>n.to&&(this.chunk2=this.chunk2.slice(0,n.to-t)),r=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),r}acceptToken(e,t=0){let r=t?this.resolveOffset(t,-1):this.pos;if(null==r||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=me,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let r="";for(let n of this.ranges){if(n.from>=t)break;n.to>e&&(r+=this.input.read(Math.max(n.from,e),Math.min(n.to,t)))}return r}}class ge{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:r}=t.p;!function(e,t,r,n,a,i){let o=0,s=1<<n,{dialect:l}=r.p.parser;e:for(;s&e[o];){let r=e[o+1];for(let n=o+3;n<r;n+=2)if((e[n+1]&s)>0){let r=e[n];if(l.allows(r)&&(-1==t.token.value||t.token.value==r||ve(r,t.token.value,a,i))){t.acceptToken(r);break}}let n=t.next,c=0,u=e[o+2];if(!(t.next<0&&u>c&&65535==e[r+3*u-3])){for(;c<u;){let a=c+u>>1,i=r+a+(a<<1),s=e[i],l=e[i+1]||65536;if(n<s)u=a;else{if(!(n>=l)){o=e[i+2],t.advance();continue e}c=a+1}}break}o=e[r+3*u-1]}}(this.data,e,t,this.id,r.data,r.tokenPrecTable)}}function be(e,t,r){for(let n,a=t;65535!=(n=e[a]);a++)if(n==r)return a-t;return-1}function ve(e,t,r,n){let a=be(r,n,t);return a<0||be(r,n,e)<a}ge.prototype.contextual=ge.prototype.fallback=ge.prototype.extend=!1,ge.prototype.fallback=ge.prototype.extend=!1;const ye="undefined"!=typeof process&&process.env&&/\bparse\b/.test(process.env.LOG);let xe=null;function Oe(e,t,r){let n=e.cursor(q.IncludeAnonymous);for(n.moveTo(t);;)if(!(r<0?n.childBefore(t):n.childAfter(t)))for(;;){if((r<0?n.to<t:n.from>t)&&!n.type.isError)return r<0?Math.max(0,Math.min(n.to-1,t-25)):Math.min(e.length,Math.max(n.from+1,t+25));if(r<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return r<0?0:e.length}}class we{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?Oe(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?Oe(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let r=this.trees[t],n=this.index[t];if(n==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let a=r.children[n],i=this.start[t]+r.positions[n];if(i>e)return this.nextStart=i,null;if(a instanceof Q){if(i==e){if(i<this.safeFrom)return null;let e=i+a.length;if(e<=this.safeTo){let t=a.prop(R.lookAhead);if(!t||e+t<this.fragment.to)return a}}this.index[t]++,i+a.length>=Math.max(this.safeFrom,e)&&(this.trees.push(a),this.start.push(i),this.index.push(0))}else this.index[t]++,this.nextStart=i+a.length}}}class Se{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map((e=>new he))}getActions(e){let t=0,r=null,{parser:n}=e.p,{tokenizers:a}=n,i=n.stateSlot(e.state,3),o=e.curContext?e.curContext.hash:0,s=0;for(let n=0;n<a.length;n++){if(!(1<<n&i))continue;let l=a[n],c=this.tokens[n];if((!r||l.fallback)&&((l.contextual||c.start!=e.pos||c.mask!=i||c.context!=o)&&(this.updateCachedToken(c,l,e),c.mask=i,c.context=o),c.lookAhead>c.end+25&&(s=Math.max(c.lookAhead,s)),0!=c.value)){let n=t;if(c.extended>-1&&(t=this.addActions(e,c.extended,c.end,t)),t=this.addActions(e,c.value,c.end,t),!l.extend&&(r=c,t>n))break}}for(;this.actions.length>t;)this.actions.pop();return s&&e.setLookAhead(s),r||e.pos!=this.stream.end||(r=new he,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,t=this.addActions(e,r.value,r.end,t)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new he,{pos:r,p:n}=e;return t.start=r,t.end=Math.min(r+1,n.stream.end),t.value=r==n.stream.end?n.parser.eofTerm:0,t}updateCachedToken(e,t,r){let n=this.stream.clipPos(r.pos);if(t.token(this.stream.reset(n,e),r),e.value>-1){let{parser:t}=r.p;for(let n=0;n<t.specialized.length;n++)if(t.specialized[n]==e.value){let a=t.specializers[n](this.stream.read(e.start,e.end),r);if(a>=0&&r.p.parser.dialect.allows(a>>1)){1&a?e.extended=a>>1:e.value=a>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,t,r,n){for(let t=0;t<n;t+=3)if(this.actions[t]==e)return n;return this.actions[n++]=e,this.actions[n++]=t,this.actions[n++]=r,n}addActions(e,t,r,n){let{state:a}=e,{parser:i}=e.p,{data:o}=i;for(let e=0;e<2;e++)for(let s=i.stateSlot(a,e?2:1);;s+=3){if(65535==o[s]){if(1!=o[s+1]){0==n&&2==o[s+1]&&(n=this.putAction(Ce(o,s+2),t,r,n));break}s=Ce(o,s+2)}o[s]==t&&(n=this.putAction(Ce(o,s+1),t,r,n))}return n}}class _e{constructor(e,t,r,n){this.parser=e,this.input=t,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new fe(t,n),this.tokens=new Se(e,this.stream),this.topTerm=e.top[1];let{from:a}=n[0];this.stacks=[le.start(this,e.top[0],a)],this.fragments=r.length&&this.stream.end-a>4*e.bufferLength?new we(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,r=this.stacks,n=this.minStackPos,a=this.stacks=[];if(this.bigReductionCount>300&&1==r.length){let[e]=r;for(;e.forceReduce()&&e.stack.length&&e.stack[e.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let i=0;i<r.length;i++){let o=r[i];for(;;){if(this.tokens.mainToken=null,o.pos>n)a.push(o);else{if(this.advanceStack(o,a,r))continue;{e||(e=[],t=[]),e.push(o);let r=this.tokens.getMainToken(o);t.push(r.value,r.end)}}break}}if(!a.length){let t=e&&function(e){let t=null;for(let r of e){let e=r.p.stoppedAt;(r.pos==r.p.stream.end||null!=e&&r.pos>e)&&r.p.parser.stateFlag(r.state,2)&&(!t||t.score<r.score)&&(t=r)}return t}(e);if(t)return ye&&console.log("Finish with "+this.stackID(t)),this.stackToTree(t);if(this.parser.strict)throw ye&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+n);this.recovering||(this.recovering=5)}if(this.recovering&&e){let r=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,a);if(r)return ye&&console.log("Force-finish "+this.stackID(r)),this.stackToTree(r.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(a.length>e)for(a.sort(((e,t)=>t.score-e.score));a.length>e;)a.pop();a.some((e=>e.reducePos>n))&&this.recovering--}else if(a.length>1){e:for(let e=0;e<a.length-1;e++){let t=a[e];for(let r=e+1;r<a.length;r++){let n=a[r];if(t.sameState(n)||t.buffer.length>500&&n.buffer.length>500){if(!((t.score-n.score||t.buffer.length-n.buffer.length)>0)){a.splice(e--,1);continue e}a.splice(r--,1)}}}a.length>12&&a.splice(12,a.length-12)}this.minStackPos=a[0].pos;for(let e=1;e<a.length;e++)a[e].pos<this.minStackPos&&(this.minStackPos=a[e].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,r){let n=e.pos,{parser:a}=this,i=ye?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,r=t?e.curContext.hash:0;for(let o=this.fragments.nodeAt(n);o;){let n=this.parser.nodeSet.types[o.type.id]==o.type?a.getGoto(e.state,o.type.id):-1;if(n>-1&&o.length&&(!t||(o.prop(R.contextHash)||0)==r))return e.useNode(o,n),ye&&console.log(i+this.stackID(e)+` (via reuse of ${a.getName(o.type.id)})`),!0;if(!(o instanceof Q)||0==o.children.length||o.positions[0]>0)break;let s=o.children[0];if(!(s instanceof Q&&0==o.positions[0]))break;o=s}}let o=a.stateSlot(e.state,4);if(o>0)return e.reduce(o),ye&&console.log(i+this.stackID(e)+` (via always-reduce ${a.getName(65535&o)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let s=this.tokens.getActions(e);for(let o=0;o<s.length;){let l=s[o++],c=s[o++],u=s[o++],d=o==s.length||!r,p=d?e:e.split(),h=this.tokens.mainToken;if(p.apply(l,c,h?h.start:p.pos,u),ye&&console.log(i+this.stackID(p)+` (via ${65536&l?`reduce of ${a.getName(65535&l)}`:"shift"} for ${a.getName(c)} @ ${n}${p==e?"":", split"})`),d)return!0;p.pos>n?t.push(p):r.push(p)}return!1}advanceFully(e,t){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return Pe(e,t),!0}}runRecovery(e,t,r){let n=null,a=!1;for(let i=0;i<e.length;i++){let o=e[i],s=t[i<<1],l=t[1+(i<<1)],c=ye?this.stackID(o)+" -> ":"";if(o.deadEnd){if(a)continue;if(a=!0,o.restart(),ye&&console.log(c+this.stackID(o)+" (restarted)"),this.advanceFully(o,r))continue}let u=o.split(),d=c;for(let e=0;u.forceReduce()&&e<10&&(ye&&console.log(d+this.stackID(u)+" (via force-reduce)"),!this.advanceFully(u,r));e++)ye&&(d=this.stackID(u)+" -> ");for(let e of o.recoverByInsert(s))ye&&console.log(c+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,r);this.stream.end>o.pos?(l==o.pos&&(l++,s=0),o.recoverByDelete(s,l),ye&&console.log(c+this.stackID(o)+` (via recover-delete ${this.parser.getName(s)})`),Pe(o,r)):(!n||n.score<o.score)&&(n=o)}return n}stackToTree(e){return e.close(),Q.build({buffer:de.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(xe||(xe=new WeakMap)).get(e);return t||xe.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function Pe(e,t){for(let r=0;r<t.length;r++){let n=t[r];if(n.pos==e.pos&&n.sameState(e))return void(t[r].score<e.score&&(t[r]=e))}t.push(e)}class Ee{constructor(e,t,r){this.source=e,this.flags=t,this.disabled=r}allows(e){return!this.disabled||0==this.disabled[e]}}class Te extends oe{constructor(e){if(super(),this.wrappers=[],14!=e.version)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let r=0;r<e.repeatNodeCount;r++)t.push("");let r=Object.keys(e.topRules).map((t=>e.topRules[t][1])),n=[];for(let e=0;e<t.length;e++)n.push([]);function a(e,t,r){n[e].push([t,t.deserialize(String(r))])}if(e.nodeProps)for(let t of e.nodeProps){let e=t[0];"string"==typeof e&&(e=R[e]);for(let r=1;r<t.length;){let n=t[r++];if(n>=0)a(n,e,t[r++]);else{let i=t[r+-n];for(let o=-n;o>0;o--)a(t[r++],e,i);r++}}}this.nodeSet=new M(t.map(((t,a)=>L.define({name:a>=this.minRepeatTerm?void 0:t,id:a,props:n[a],top:r.indexOf(a)>-1,error:0==a,skipped:e.skippedNodes&&e.skippedNodes.indexOf(a)>-1})))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=$;let i=pe(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let e=0;e<this.specializerSpecs.length;e++)this.specialized[e]=this.specializerSpecs[e].term;this.specializers=this.specializerSpecs.map(Ie),this.states=pe(e.states,Uint32Array),this.data=pe(e.stateData),this.goto=pe(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map((e=>"number"==typeof e?new ge(i,e):e)),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,r){let n=new _e(this,e,t,r);for(let a of this.wrappers)n=a(n,e,t,r);return n}getGoto(e,t,r=!1){let n=this.goto;if(t>=n[0])return-1;for(let a=n[t+1];;){let t=n[a++],i=1&t,o=n[a++];if(i&&r)return o;for(let r=a+(t>>1);a<r;a++)if(n[a]==e)return o;if(i)return-1}}hasAction(e,t){let r=this.data;for(let n=0;n<2;n++)for(let a,i=this.stateSlot(e,n?2:1);;i+=3){if(65535==(a=r[i])){if(1!=r[i+1]){if(2==r[i+1])return Ce(r,i+2);break}a=r[i=Ce(r,i+2)]}if(a==t||0==a)return Ce(r,i+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,(e=>e==t||null))}allActions(e,t){let r=this.stateSlot(e,4),n=r?t(r):void 0;for(let r=this.stateSlot(e,1);null==n;r+=3){if(65535==this.data[r]){if(1!=this.data[r+1])break;r=Ce(this.data,r+2)}n=t(Ce(this.data,r+1))}return n}nextStates(e){let t=[];for(let r=this.stateSlot(e,1);;r+=3){if(65535==this.data[r]){if(1!=this.data[r+1])break;r=Ce(this.data,r+2)}if(!(1&this.data[r+2])){let e=this.data[r+1];t.some(((t,r)=>1&r&&t==e))||t.push(this.data[r],e)}}return t}configure(e){let t=Object.assign(Object.create(Te.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=r}return e.tokenizers&&(t.tokenizers=this.tokenizers.map((t=>{let r=e.tokenizers.find((e=>e.from==t));return r?r.to:t}))),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map(((r,n)=>{let a=e.specializers.find((e=>e.from==r.external));if(!a)return r;let i=Object.assign(Object.assign({},r),{external:a.to});return t.specializers[n]=Ie(i),i}))),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),r=t.map((()=>!1));if(e)for(let n of e.split(" ")){let e=t.indexOf(n);e>=0&&(r[e]=!0)}let n=null;for(let e=0;e<t.length;e++)if(!r[e])for(let r,a=this.dialects[t[e]];65535!=(r=this.data[a++]);)(n||(n=new Uint8Array(this.maxTerm+1)))[r]=1;return new Ee(e,r,n)}static deserialize(e){return new Te(e)}}function Ce(e,t){return e[t]|e[t+1]<<16}function Ie(e){if(e.external){let t=e.extend?1:0;return(r,n)=>e.external(r,n)<<1|t}return e.get}let je=0;class $e{constructor(e,t,r){this.set=e,this.base=t,this.modified=r,this.id=je++}static define(e){if(null==e?void 0:e.base)throw new Error("Can not derive from a modified tag");let t=new $e([],null,[]);if(t.set.push(t),e)for(let r of e.set)t.set.push(r);return t}static defineModifier(){let e=new ke;return t=>t.modified.indexOf(e)>-1?t:ke.get(t.base||t,t.modified.concat(e).sort(((e,t)=>e.id-t.id)))}}let De=0;class ke{constructor(){this.instances=[],this.id=De++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find((r=>{return r.base==e&&(n=t,a=r.modified,n.length==a.length&&n.every(((e,t)=>e==a[t])));var n,a}));if(r)return r;let n=[],a=new $e(n,e,t);for(let e of t)e.instances.push(a);let i=function(e){let t=[[]];for(let r=0;r<e.length;r++)for(let n=0,a=t.length;n<a;n++)t.push(t[n].concat(e[r]));return t.sort(((e,t)=>t.length-e.length))}(t);for(let t of e.set)if(!t.modified.length)for(let e of i)n.push(ke.get(t,e));return a}}const Re=new R;class Ae{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Ae.empty=new Ae([],2,null);const Ne=$e.define,Le=Ne(),Me=Ne(),Fe=Ne(Me),Be=Ne(Me),qe=Ne(),Qe=Ne(qe),Ve=Ne(qe),We=Ne(),ze=Ne(We),Ue=Ne(),Ge=Ne(),He=Ne(),Xe=Ne(He),Ye=Ne(),Ke={comment:Le,lineComment:Ne(Le),blockComment:Ne(Le),docComment:Ne(Le),name:Me,variableName:Ne(Me),typeName:Fe,tagName:Ne(Fe),propertyName:Be,attributeName:Ne(Be),className:Ne(Me),labelName:Ne(Me),namespace:Ne(Me),macroName:Ne(Me),literal:qe,string:Qe,docString:Ne(Qe),character:Ne(Qe),attributeValue:Ne(Qe),number:Ve,integer:Ne(Ve),float:Ne(Ve),bool:Ne(qe),regexp:Ne(qe),escape:Ne(qe),color:Ne(qe),url:Ne(qe),keyword:Ue,self:Ne(Ue),null:Ne(Ue),atom:Ne(Ue),unit:Ne(Ue),modifier:Ne(Ue),operatorKeyword:Ne(Ue),controlKeyword:Ne(Ue),definitionKeyword:Ne(Ue),moduleKeyword:Ne(Ue),operator:Ge,derefOperator:Ne(Ge),arithmeticOperator:Ne(Ge),logicOperator:Ne(Ge),bitwiseOperator:Ne(Ge),compareOperator:Ne(Ge),updateOperator:Ne(Ge),definitionOperator:Ne(Ge),typeOperator:Ne(Ge),controlOperator:Ne(Ge),punctuation:He,separator:Ne(He),bracket:Xe,angleBracket:Ne(Xe),squareBracket:Ne(Xe),paren:Ne(Xe),brace:Ne(Xe),content:We,heading:ze,heading1:Ne(ze),heading2:Ne(ze),heading3:Ne(ze),heading4:Ne(ze),heading5:Ne(ze),heading6:Ne(ze),contentSeparator:Ne(We),list:Ne(We),quote:Ne(We),emphasis:Ne(We),strong:Ne(We),link:Ne(We),monospace:Ne(We),strikethrough:Ne(We),inserted:Ne(),deleted:Ne(),changed:Ne(),invalid:Ne(),meta:Ye,documentMeta:Ne(Ye),annotation:Ne(Ye),processingInstruction:Ne(Ye),definition:$e.defineModifier(),constant:$e.defineModifier(),function:$e.defineModifier(),standard:$e.defineModifier(),local:$e.defineModifier(),special:$e.defineModifier()},Je=(function(e){let t=Object.create(null);for(let r of e)if(Array.isArray(r.tag))for(let e of r.tag)t[e.id]=r.class;else t[r.tag.id]=r.class;let{scope:r,all:n=null}={}}([{tag:Ke.link,class:"tok-link"},{tag:Ke.heading,class:"tok-heading"},{tag:Ke.emphasis,class:"tok-emphasis"},{tag:Ke.strong,class:"tok-strong"},{tag:Ke.keyword,class:"tok-keyword"},{tag:Ke.atom,class:"tok-atom"},{tag:Ke.bool,class:"tok-bool"},{tag:Ke.url,class:"tok-url"},{tag:Ke.labelName,class:"tok-labelName"},{tag:Ke.inserted,class:"tok-inserted"},{tag:Ke.deleted,class:"tok-deleted"},{tag:Ke.literal,class:"tok-literal"},{tag:Ke.string,class:"tok-string"},{tag:Ke.number,class:"tok-number"},{tag:[Ke.regexp,Ke.escape,Ke.special(Ke.string)],class:"tok-string2"},{tag:Ke.variableName,class:"tok-variableName"},{tag:Ke.local(Ke.variableName),class:"tok-variableName tok-local"},{tag:Ke.definition(Ke.variableName),class:"tok-variableName tok-definition"},{tag:Ke.special(Ke.variableName),class:"tok-variableName2"},{tag:Ke.definition(Ke.propertyName),class:"tok-propertyName tok-definition"},{tag:Ke.typeName,class:"tok-typeName"},{tag:Ke.namespace,class:"tok-namespace"},{tag:Ke.className,class:"tok-className"},{tag:Ke.macroName,class:"tok-macroName"},{tag:Ke.propertyName,class:"tok-propertyName"},{tag:Ke.operator,class:"tok-operator"},{tag:Ke.comment,class:"tok-comment"},{tag:Ke.meta,class:"tok-meta"},{tag:Ke.invalid,class:"tok-invalid"},{tag:Ke.punctuation,class:"tok-punctuation"}]),{inf:153,nan:154,bool:1,ignoring:2,on:3,group_left:4,group_right:5,offset:6}),Ze=(e,t)=>Je[e.toLowerCase()]||-1,et={avg:8,atan2:7,bottomk:9,count:10,count_values:11,group:12,max:13,min:14,quantile:15,stddev:16,stdvar:17,sum:18,topk:19,by:20,without:21,and:22,or:23,unless:24,start:25,end:26},tt=(e,t)=>et[e.toLowerCase()]||-1,rt=function(e){let t=Object.create(null);for(let r in e){let n=e[r];Array.isArray(n)||(n=[n]);for(let e of r.split(" "))if(e){let r=[],a=2,i=e;for(let t=0;;){if("..."==i&&t>0&&t+3==e.length){a=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(i);if(!n)throw new RangeError("Invalid path: "+e);if(r.push("*"==n[0]?"":'"'==n[0][0]?JSON.parse(n[0]):n[0]),t+=n[0].length,t==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){a=0;break}if("/"!=o)throw new RangeError("Invalid path: "+e);i=e.slice(t)}let o=r.length-1,s=r[o];if(!s)throw new RangeError("Invalid path: "+e);let l=new Ae(n,a,o>0?r.slice(0,o):null);t[s]=l.sort(t[s])}}return Re.add(t)}({LineComment:Ke.comment,LabelName:Ke.labelName,StringLiteral:Ke.string,NumberLiteral:Ke.number,Duration:Ke.number,Identifier:Ke.variableName,"Abs Absent AbsentOverTime Acos Acosh Asin Asinh Atan Atanh AvgOverTime Ceil Changes Clamp ClampMax ClampMin Cos Cosh CountOverTime DaysInMonth DayOfMonth DayOfWeek DayOfYear Deg Delta Deriv Exp Floor HistogramAvg HistogramCount HistogramFraction HistogramQuantile HistogramSum HoltWinters Hour Idelta Increase Irate LabelReplace LabelJoin LastOverTime Ln Log10 Log2 MaxOverTime MinOverTime Minute Month Pi PredictLinear PresentOverTime QuantileOverTime Rad Rate Resets Round Scalar Sgn Sin Sinh Sort SortDesc SortByLabel SortByLabelDesc Sqrt StddevOverTime StdvarOverTime SumOverTime Tan Tanh Time Timestamp Vector Year":Ke.function(Ke.variableName),"Avg Bottomk Count Count_values Group Max Min Quantile Stddev Stdvar Sum Topk":Ke.operatorKeyword,"By Without Bool On Ignoring GroupLeft GroupRight Offset Start End":Ke.modifier,"And Unless Or":Ke.logicOperator,"Sub Add Mul Mod Div Atan2 Eql Neq Lte Lss Gte Gtr EqlRegex EqlSingle NeqRegex Pow At":Ke.operator,UnaryOp:Ke.arithmeticOperator,"( )":Ke.paren,"[ ]":Ke.squareBracket,"{ }":Ke.brace,"â ":Ke.invalid}),nt={__proto__:null,absent_over_time:325,absent:327,abs:329,acos:331,acosh:333,asin:335,asinh:337,atan:339,atanh:341,avg_over_time:343,ceil:345,changes:347,clamp:349,clamp_max:351,clamp_min:353,cos:355,cosh:357,count_over_time:359,days_in_month:361,day_of_month:363,day_of_week:365,day_of_year:367,deg:369,delta:371,deriv:373,exp:375,floor:377,histogram_count:379,histogram_fraction:381,histogram_quantile:383,histogram_stddev:385,histogram_stdvar:387,histogram_sum:389,histogram_avg:391,holt_winters:393,hour:395,idelta:397,increase:399,irate:401,label_replace:403,label_join:405,last_over_time:407,ln:409,log10:411,log2:413,mad_over_time:415,max_over_time:417,min_over_time:419,minute:421,month:423,pi:425,predict_linear:427,present_over_time:429,quantile_over_time:431,rad:433,rate:435,resets:437,round:439,scalar:441,sgn:443,sin:445,sinh:447,sort:449,sort_desc:451,sort_by_label:453,sort_by_label_desc:455,sqrt:457,stddev_over_time:459,stdvar_over_time:461,sum_over_time:463,tan:465,tanh:467,timestamp:469,time:471,vector:473,year:475},at=Te.deserialize({version:14,states:"8fOYQPOOO'kQPOOOOQO'#Cz'#CzO'pQPO'#CyQ'{QQOOOOQO'#Da'#DaO'vQPO'#D`OOQO'#FT'#FTO)YQPO'#FZOYQPO'#FVOYQPO'#FYO/tQSO'#F]O/|QQO'#F[OOQO'#F['#F[OOQO'#Fo'#FoOOQO'#Db'#DbOOQO'#Dd'#DdOOQO'#De'#DeOOQO'#Df'#DfOOQO'#Dg'#DgOOQO'#Dh'#DhOOQO'#Di'#DiOOQO'#Dj'#DjOOQO'#Dk'#DkOOQO'#Dl'#DlOOQO'#Dm'#DmOOQO'#Dn'#DnOOQO'#Do'#DoOOQO'#Dp'#DpOOQO'#Dq'#DqOOQO'#Dr'#DrOOQO'#Ds'#DsOOQO'#Dt'#DtOOQO'#Du'#DuOOQO'#Dv'#DvOOQO'#Dw'#DwOOQO'#Dx'#DxOOQO'#Dy'#DyOOQO'#Dz'#DzOOQO'#D{'#D{OOQO'#D|'#D|OOQO'#D}'#D}OOQO'#EO'#EOOOQO'#EP'#EPOOQO'#EQ'#EQOOQO'#ER'#EROOQO'#ES'#ESOOQO'#ET'#ETOOQO'#EU'#EUOOQO'#EV'#EVOOQO'#EW'#EWOOQO'#EX'#EXOOQO'#EY'#EYOOQO'#EZ'#EZOOQO'#E['#E[OOQO'#E]'#E]OOQO'#E^'#E^OOQO'#E_'#E_OOQO'#E`'#E`OOQO'#Ea'#EaOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsOOQO'#Et'#EtOOQO'#Eu'#EuOOQO'#Ev'#EvOOQO'#Ew'#EwOOQO'#Ex'#ExOOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO'#E|'#E|OOQO'#E}'#E}OOQO'#FO'#FOOOQO'#FP'#FPOOQO'#FQ'#FQQOQPOOO1gQPO'#C{O1lQPO'#DOO'vQPO,59eO1sQQO,59eO3aQPO,59kO3aQPO,59kO3aQPO,59kO3aQPO,59kO3aQPO,59kO9{QQO,5;mO:QQQO,5;pO:YQPO,5;}OOQO,59z,59zOOQO,5;o,5;oO:qQQO,5;qO:xQQO,5;tO<`QPO'#F^OOQO,5;w,5;wO<nQPO,5;wOOQO,5;v,5;vO<vQSO'#C|OOQO,59g,59gOOQO,59j,59jO=OQQO,59jOOQO1G/P1G/POOQO'#DR'#DRO1gQPO'#DSOOQO'#Fs'#FsO=YQPO'#FsOYQPO1G/VOYQPO1G/VOYQPO1G/VOYQPO1G/VOYQPO1G/VOCqQSO1G1XOOQO1G1[1G1[OCyQQO1G1[ODOQPO'#FTOOQO'#Fe'#FeOOQO1G1i1G1iODZQPO1G1iOOQO1G1]1G1]OOQO'#F_'#F_OD`QPO,5;xODeQSO1G1cODmQPO1G1cOOQO1G1c1G1cOOQO,59h,59hODuQPO,59hOYQPO'#FhOD}QPO1G/UOOQO1G/U1G/UOEVQPO,59nOOQO,5<_,5<_OLxQQO7+$qOMYQQO7+$qONnQQO7+$qO! UQQO7+$qO!!mQQO7+$qOOQO7+&s7+&sO!#WQQO7+&yOOQO7+&v7+&vO!#`QPO7+'TOOQO1G1d1G1dOOQO,5<T,5<TOOQO7+&}7+&}O!#eQSO7+&}OOQO-E9g-E9gO!#mQSO1G/SO!#uQPO1G/SOOQO1G/S1G/SO!#}QQO,5<SOOQO-E9f-E9fOOQO7+$p7+$pO!$XQPO1G/YOOQO<<Je<<JeO!*jQPO<<JeOOQO<<Jo<<JoOOQO<<Ji<<JiP!*oQSO'#FiOOQO,5<R,5<ROOQO7+$n7+$nO!*tQSO7+$nOOQO-E9e-E9eOOQO7+$t7+$tOOQOAN@PAN@POOQO<<HY<<HYP!*|QSO'#Fg",stateData:"!+R~O$bOSkOS~OWQOXQOYQOZQO[QO]QO^QO_QO`QOaQObQOcQO!V[O#z^O$_VO$`VO$dXO$h_O$i`O$jaO$kbO$lcO$mdO$neO$ofO$pgO$qhO$riO$sjO$tkO$ulO$vmO$wnO$xoO$ypO$zqO${rO$|sO$}tO%OuO%PvO%QwO%RxO%SyO%TzO%U{O%V|O%W}O%X!OO%Y!PO%Z!QO%[!RO%]!SO%^!TO%_!UO%`!VO%a!WO%b!XO%c!YO%d!ZO%e![O%f!]O%g!^O%h!_O%i!`O%j!aO%k!bO%l!cO%m!dO%n!eO%o!fO%p!gO%q!hO%r!iO%s!jO%t!kO%u!lO%v!mO%w!nO%x!oO%y!pO%z!qO%{!rO%|!sO%}!tO&O!uO&P!vO&Q!wO&R!xO&S!yO&T!zO&U!{O&V!|O&YWO&ZWO&[VO&^ZO~O!V!}O~Od#OOe#OO$d#PO~OU#YOV#SOf#VOg#WOh#VOt#SOw#SOx#SOy#SOz#TO{#TO|#UO}#UO!O#UO!P#UO!Q#UO!R#UO$W#ZO&W#XO~O$_#]O$`#]O&[#]OW#}XX#}XY#}XZ#}X[#}X]#}X^#}X_#}X`#}Xa#}Xb#}Xc#}X!V#}X#z#}X$_#}X$`#}X$d#}X$h#}X$i#}X$j#}X$k#}X$l#}X$m#}X$n#}X$o#}X$p#}X$q#}X$r#}X$s#}X$t#}X$u#}X$v#}X$w#}X$x#}X$y#}X$z#}X${#}X$|#}X$}#}X%O#}X%P#}X%Q#}X%R#}X%S#}X%T#}X%U#}X%V#}X%W#}X%X#}X%Y#}X%Z#}X%[#}X%]#}X%^#}X%_#}X%`#}X%a#}X%b#}X%c#}X%d#}X%e#}X%f#}X%g#}X%h#}X%i#}X%j#}X%k#}X%l#}X%m#}X%n#}X%o#}X%p#}X%q#}X%r#}X%s#}X%t#}X%u#}X%v#}X%w#}X%x#}X%y#}X%z#}X%{#}X%|#}X%}#}X&O#}X&P#}X&Q#}X&R#}X&S#}X&T#}X&U#}X&V#}X&Y#}X&Z#}X&[#}X&^#}X~Oq#`O&_#aO~O&^ZOU$OXV$OXf$OXg$OXh$OXt$OXw$OXx$OXy$OXz$OX{$OX|$OX}$OX!O$OX!P$OX!Q$OX!R$OX$W$OX$^$OX&W$OX$f$OX$e$OX~O$d#dO~O$f#fO~PYOd#OOe#OOUmaVmafmagmahmatmawmaxmaymazma{ma|ma}ma!Oma!Pma!Qma!Rma$Wma$^ma&Wma$fma$ema~OP#iOQ#jOR#jOW$gPX$gPY$gPZ$gP[$gP]$gP^$gP_$gP`$gPa$gPb$gPc$gP!V$gP#z$gP$_$gP$`$gP$d$gP$h$gP$i$gP$j$gP$k$gP$l$gP$m$gP$n$gP$o$gP$p$gP$q$gP$r$gP$s$gP$t$gP$u$gP$v$gP$w$gP$x$gP$y$gP$z$gP${$gP$|$gP$}$gP%O$gP%P$gP%Q$gP%R$gP%S$gP%T$gP%U$gP%V$gP%W$gP%X$gP%Y$gP%Z$gP%[$gP%]$gP%^$gP%_$gP%`$gP%a$gP%b$gP%c$gP%d$gP%e$gP%f$gP%g$gP%h$gP%i$gP%j$gP%k$gP%l$gP%m$gP%n$gP%o$gP%p$gP%q$gP%r$gP%s$gP%t$gP%u$gP%v$gP%w$gP%x$gP%y$gP%z$gP%{$gP%|$gP%}$gP&O$gP&P$gP&Q$gP&R$gP&S$gP&T$gP&U$gP&V$gP&Y$gP&Z$gP&[$gP&^$gP~O#v#rO~O{#tO#v#sO~Oi#vOj#vO$_VO$`VO&Y#uO&Z#uO&[VO~O$f#yO~P'{Ot#SOU#|aV#|af#|ag#|ah#|aw#|ax#|ay#|az#|a{#|a|#|a}#|a!O#|a!P#|a!Q#|a!R#|a$W#|a$^#|a&W#|a$f#|a$e#|a~O!R#zO$S#zO$T#zO$U#zO~O$e#|O&_$OO~Oq$QO$f$PO~O$e$RO$f$TO~P'{OQ#jOR#jOW$gXX$gXY$gXZ$gX[$gX]$gX^$gX_$gX`$gXa$gXb$gXc$gX!V$gX#z$gX$_$gX$`$gX$d$gX$h$gX$i$gX$j$gX$k$gX$l$gX$m$gX$n$gX$o$gX$p$gX$q$gX$r$gX$s$gX$t$gX$u$gX$v$gX$w$gX$x$gX$y$gX$z$gX${$gX$|$gX$}$gX%O$gX%P$gX%Q$gX%R$gX%S$gX%T$gX%U$gX%V$gX%W$gX%X$gX%Y$gX%Z$gX%[$gX%]$gX%^$gX%_$gX%`$gX%a$gX%b$gX%c$gX%d$gX%e$gX%f$gX%g$gX%h$gX%i$gX%j$gX%k$gX%l$gX%m$gX%n$gX%o$gX%p$gX%q$gX%r$gX%s$gX%t$gX%u$gX%v$gX%w$gX%x$gX%y$gX%z$gX%{$gX%|$gX%}$gX&O$gX&P$gX&Q$gX&R$gX&S$gX&T$gX&U$gX&V$gX&Y$gX&Z$gX&[$gX&^$gX~O&X$]O&]$^O~O#v$_O~O$_#]O$`#]O&[#]O~O$d$`O~O#z$aO~Oq#`O&_$cO~O$e$dO&_$cO~O$e$fO$f$hO~O$e$RO$f$kO~OS$lOT$lOWvaXvaYvaZva[va]va^va_va`vaavabvacva!Vva#zva$_va$`va$dva$hva$iva$jva$kva$lva$mva$nva$ova$pva$qva$rva$sva$tva$uva$vva$wva$xva$yva$zva${va$|va$}va%Ova%Pva%Qva%Rva%Sva%Tva%Uva%Vva%Wva%Xva%Yva%Zva%[va%]va%^va%_va%`va%ava%bva%cva%dva%eva%fva%gva%hva%iva%jva%kva%lva%mva%nva%ova%pva%qva%rva%sva%tva%uva%vva%wva%xva%yva%zva%{va%|va%}va&Ova&Pva&Qva&Rva&Sva&Tva&Uva&Vva&Yva&Zva&[va&^va~Ot#SOUsqfsqgsqhsqzsq{sq|sq}sq!Osq!Psq!Qsq!Rsq$Wsq$^sq&Wsq$fsq$esq~OVsqwsqxsqysq~PKnOV#SOw#SOx#SOy#SO~PKnOV#SOt#SOw#SOx#SOy#SOz#TO{#TOUsqfsqgsqhsq$Wsq$^sq&Wsq$fsq$esq~O|sq}sq!Osq!Psq!Qsq!Rsq~PMjO|#UO}#UO!O#UO!P#UO!Q#UO!R#UO~PMjOV#SOf#VOh#VOt#SOw#SOx#SOy#SOz#TO{#TO|#UO}#UO!O#UO!P#UO!Q#UO!R#UO~OUsqgsq$Wsq$^sq&Wsq$fsq$esq~P! lO#v$nO&X$mO~O$f$oO~Oq#`O&_$pO~Oq$rO$f$sO~O$e$tO$f$sO~O$e$[a$f$[a~P'{O$d#dOWviXviYviZvi[vi]vi^vi_vi`viavibvicvi!Vvi#zvi$_vi$`vi$hvi$ivi$jvi$kvi$lvi$mvi$nvi$ovi$pvi$qvi$rvi$svi$tvi$uvi$vvi$wvi$xvi$yvi$zvi${vi$|vi$}vi%Ovi%Pvi%Qvi%Rvi%Svi%Tvi%Uvi%Vvi%Wvi%Xvi%Yvi%Zvi%[vi%]vi%^vi%_vi%`vi%avi%bvi%cvi%dvi%evi%fvi%gvi%hvi%ivi%jvi%kvi%lvi%mvi%nvi%ovi%pvi%qvi%rvi%svi%tvi%uvi%vvi%wvi%xvi%yvi%zvi%{vi%|vi%}vi&Ovi&Pvi&Qvi&Rvi&Svi&Tvi&Uvi&Vvi&Yvi&Zvi&[vi&^vi~O&X$wO~Oq#`O~Oq$rO$f$xO~Oq$rO~O",goto:")R$hPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$i$u%R%XP%b$iP%k%rPPPPPPPPPPP$i%|&YP&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y&Y$iP&f$i$iP$i$i&u$i'R'b'jPPP$iP'mP'p'v'|PPPPP(SPPP(re^OXY#P#m#n#o#p#q$ReROXY#P#m#n#o#p#q$RQ#QRR#h#RQ#e#OQ$U#jR$v$lQ#RRQ#[UR#h#QZ#l#S#T#U#V#WY#k#S#T#U#V#WR$V#leUOXY#P#m#n#o#p#q$ReTOXY#P#m#n#o#p#q$Rd^OXY#P#m#n#o#p#q$RR#w#ZeYOXY#P#m#n#o#p#q$Rd]OXY#P#m#n#o#p#q$RR#c[Q#bZV$b#|$d$qR#{#`R#x#ZQ$g$QR$u$gQ$S#gR$j$SQ#}#bR$e#}QSOQ#^XQ#_YQ#g#PQ$W#mQ$X#nQ$Y#oQ$Z#pQ$[#qR$i$RQ#m#SQ#n#TQ#o#UQ#p#VR#q#W",nodeNames:"â  Bool Ignoring On GroupLeft GroupRight Offset Atan2 Avg Bottomk Count CountValues Group Max Min Quantile Stddev Stdvar Sum Topk By Without And Or Unless Start End LineComment PromQL AggregateExpr AggregateOp AggregateModifier GroupingLabels LabelName FunctionCallBody BinaryExpr Pow BoolModifier MatchingModifierClause Mul Div Mod Add Sub Eql Gte Gtr Lte Lss Neq FunctionCall FunctionIdentifier AbsentOverTime Identifier Absent Abs Acos Acosh Asin Asinh Atan Atanh AvgOverTime Ceil Changes Clamp ClampMax ClampMin Cos Cosh CountOverTime DaysInMonth DayOfMonth DayOfWeek DayOfYear Deg Delta Deriv Exp Floor HistogramCount HistogramFraction HistogramQuantile HistogramStdDev HistogramStdVar HistogramSum HistogramAvg HoltWinters Hour Idelta Increase Irate LabelReplace LabelJoin LastOverTime Ln Log10 Log2 MadOverTime MaxOverTime MinOverTime Minute Month Pi PredictLinear PresentOverTime QuantileOverTime Rad Rate Resets Round Scalar Sgn Sin Sinh Sort SortDesc SortByLabel SortByLabelDesc Sqrt StddevOverTime StdvarOverTime SumOverTime Tan Tanh Timestamp Time Vector Year MatrixSelector Duration NumberLiteral OffsetExpr ParenExpr StringLiteral SubqueryExpr UnaryExpr UnaryOp VectorSelector LabelMatchers LabelMatcher MatchOp EqlSingle EqlRegex NeqRegex StepInvariantExpr At AtModifierPreprocessors MetricName",maxTerm:245,nodeProps:[["group",-12,29,35,50,129,131,132,133,134,135,136,138,145,"Expr"]],propSources:[rt],skippedNodes:[0,27],repeatNodeCount:3,tokenData:"3s~RwX^#lpq#lqr$ars$tst&luv'Twx'Yxy({yz)Qz{)V{|)[|})c}!O)h!O!P)o!P!Q*o!Q!R*t!R![+l![!]0W!^!_1S!_!`1a!`!a1v!b!c2T!c!}2Y!}#O2p#P#Q2u#Q#R2z#R#S2Y#S#T3P#T#o2Y#o#p3i#q#r3n#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~#qY$b~X^#lpq#l#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~$dQ!_!`$j#r#s$o~$oO!R~~$tO$U~~$yW#z~OY$tZr$trs%cs#O$t#O#P%h#P;'S$t;'S;=`&f<%lO$t~%hO#z~~%kRO;'S$t;'S;=`%t;=`O$t~%yX#z~OY$tZr$trs%cs#O$t#O#P%h#P;'S$t;'S;=`&f;=`<%l$t<%lO$t~&iP;=`<%l$t~&qSk~OY&lZ;'S&l;'S;=`&}<%lO&l~'QP;=`<%l&l~'YOy~~'_W#z~OY'YZw'Ywx%cx#O'Y#O#P'w#P;'S'Y;'S;=`(u<%lO'Y~'zRO;'S'Y;'S;=`(T;=`O'Y~(YX#z~OY'YZw'Ywx%cx#O'Y#O#P'w#P;'S'Y;'S;=`(u;=`<%l'Y<%lO'Y~(xP;=`<%l'Y~)QO$d~~)VO$f~~)[Ow~R)cO&ZPzQ~)hO$e~R)oO&YP{QP)rP!Q![)uP)zR&[P!Q![)u!g!h*T#X#Y*TP*WR{|*a}!O*a!Q![*gP*dP!Q![*gP*lP&[P!Q![*g~*tOx~R*yZ&[P!O!P)u!Q![+l!g!h*T#W#X,a#X#Y*T#[#],x#a#b-^#g#h.Q#k#l.c#l#m/l#m#n.}R+qY&[P!O!P)u!Q![+l!g!h*T#W#X,a#X#Y*T#[#],x#a#b-^#g#h.Q#k#l.c#m#n.}Q,fP#vQ!Q![,iQ,lS!Q![,i#[#],x#a#b-^#g#h.QQ,}P#vQ!Q![-QQ-TR!Q![-Q#a#b-^#g#h.QQ-cQ#vQ!Q![-i#g#h-{Q-lR!Q![-i#a#b-u#g#h.QQ-xP#g#h-{Q.QO#vQQ.VP#vQ!Q![.YQ.]Q!Q![.Y#a#b-uQ.hP#vQ!Q![.kQ.nT!Q![.k#W#X,a#[#],x#a#b-^#g#h.QQ/SP#vQ!Q![/VQ/YU!Q![/V#W#X,a#[#],x#a#b-^#g#h.Q#k#l.cP/oR!Q![/x!c!i/x#T#Z/xP/}R&[P!Q![/x!c!i/x#T#Z/xV0_T&]S!VR!Q![0n![!]0n!c!}0n#R#S0n#T#o0nR0sT!VR!Q![0n![!]0n!c!}0n#R#S0n#T#o0n~1XP!Q~!_!`1[~1aO!P~~1fQ$SP!_!`1l#r#s1qQ1qO|Q~1vO$T~~1{P!O~!_!`2O~2TO}~~2YO$W~V2aT!VRqS!Q![2Y![!]0n!c!}2Y#R#S2Y#T#o2Y~2uO&W~~2zO&X~~3POt~~3STO#S3P#S#T%c#T;'S3P;'S;=`3c<%lO3P~3fP;=`<%l3P~3nO&^~~3sO&_~",tokenizers:[0,1,2],topRules:{PromQL:[0,28],MetricName:[1,148]},specialized:[{term:53,get:(e,t)=>Ze(e)<<1,external:Ze},{term:53,get:(e,t)=>tt(e)<<1|1,external:tt,extend:!0},{term:53,get:e=>nt[e]||-1}],tokenPrec:0}),it=131,ot=134,st=138,lt=140,ct=[{label:"sum",insertText:"sum",documentation:"Calculate sum over dimensions"},{label:"min",insertText:"min",documentation:"Select minimum over dimensions"},{label:"max",insertText:"max",documentation:"Select maximum over dimensions"},{label:"avg",insertText:"avg",documentation:"Calculate the average over dimensions"},{label:"group",insertText:"group",documentation:"All values in the resulting vector are 1"},{label:"stddev",insertText:"stddev",documentation:"Calculate population standard deviation over dimensions"},{label:"stdvar",insertText:"stdvar",documentation:"Calculate population standard variance over dimensions"},{label:"count",insertText:"count",documentation:"Count number of elements in the vector"},{label:"count_values",insertText:"count_values",documentation:"Count number of elements with the same value"},{label:"bottomk",insertText:"bottomk",documentation:"Smallest k elements by sample value"},{label:"topk",insertText:"topk",documentation:"Largest k elements by sample value"},{label:"quantile",insertText:"quantile",documentation:"Calculate Ï-quantile (0 â¤ Ï â¤ 1) over dimensions"},{label:"acos",insertText:"acos",detail:"acos(v instant-vector)",documentation:"calculates the arccosine of all elements in v"},{label:"acosh",insertText:"acosh",detail:"acosh(v instant-vector)",documentation:"calculates the inverse hyperbolic cosine of all elements in v"},{label:"asin",insertText:"asin",detail:"asin(v instant-vector)",documentation:"calculates the arcsine of all elements in v"},{label:"asinh",insertText:"asinh",detail:"asinh(v instant-vector)",documentation:"calculates the inverse hyperbolic sine of all elements in v"},{label:"atan",insertText:"atan",detail:"atan(v instant-vector)",documentation:"calculates the arctangent of all elements in v"},{label:"atanh",insertText:"atanh",detail:"atanh(v instant-vector)",documentation:"calculates the inverse hyperbolic tangent of all elements in v"},{label:"cos",insertText:"cos",detail:"cos(v instant-vector)",documentation:"calculates the cosine of all elements in v"},{label:"cosh",insertText:"cosh",detail:"cosh(v instant-vector)",documentation:"calculates the hyperbolic cosine of all elements in v"},{label:"sin",insertText:"sin",detail:"sin(v instant-vector)",documentation:"calculates the sine of all elements in v"},{label:"sinh",insertText:"sinh",detail:"sinh(v instant-vector)",documentation:"calculates the hyperbolic sine of all elements in v"},{label:"tan",insertText:"tan",detail:"tan(v instant-vector)",documentation:"calculates the tangent of all elements in v"},{label:"tanh",insertText:"tanh",detail:"tanh(v instant-vector)",documentation:"calculates the hyperbolic tangent of all elements in v"},{insertText:"abs",label:"abs",detail:"abs(v instant-vector)",documentation:"Returns the input vector with all sample values converted to their absolute value."},{insertText:"absent",label:"absent",detail:"absent(v instant-vector)",documentation:"Returns an empty vector if the vector passed to it has any elements and a 1-element vector with the value 1 if the vector passed to it has no elements. This is useful for alerting on when no time series exist for a given metric name and label combination."},{insertText:"absent_over_time",label:"absent_over_time",detail:"absent(v range-vector)",documentation:"Returns an empty vector if the range vector passed to it has any elements and a 1-element vector with the value 1 if the range vector passed to it has no elements."},{insertText:"ceil",label:"ceil",detail:"ceil(v instant-vector)",documentation:"Rounds the sample values of all elements in `v` up to the nearest integer."},{insertText:"changes",label:"changes",detail:"changes(v range-vector)",documentation:"For each input time series, `changes(v range-vector)` returns the number of times its value has changed within the provided time range as an instant vector."},{insertText:"clamp",label:"clamp",detail:"clamp(v instant-vector, min scalar, max scalar)",documentation:"Clamps the sample values of all elements in `v` to have a lower limit of `min` and an upper limit of `max`."},{insertText:"clamp_max",label:"clamp_max",detail:"clamp_max(v instant-vector, max scalar)",documentation:"Clamps the sample values of all elements in `v` to have an upper limit of `max`."},{insertText:"clamp_min",label:"clamp_min",detail:"clamp_min(v instant-vector, min scalar)",documentation:"Clamps the sample values of all elements in `v` to have a lower limit of `min`."},{insertText:"count_scalar",label:"count_scalar",detail:"count_scalar(v instant-vector)",documentation:"Returns the number of elements in a time series vector as a scalar. This is in contrast to the `count()` aggregation operator, which always returns a vector (an empty one if the input vector is empty) and allows grouping by labels via a `by` clause."},{insertText:"deg",label:"deg",detail:"deg(v instant-vector)",documentation:"Converts radians to degrees for all elements in v"},{insertText:"day_of_month",label:"day_of_month",detail:"day_of_month(v=vector(time()) instant-vector)",documentation:"Returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31."},{insertText:"day_of_week",label:"day_of_week",detail:"day_of_week(v=vector(time()) instant-vector)",documentation:"Returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc."},{insertText:"day_of_year",label:"day_of_year",detail:"day_of_year(v=vector(time()) instant-vector)",documentation:"Returns the day of the year for each of the given times in UTC. Returned values are from 1 to 365 for non-leap years, and 1 to 366 in leap years."},{insertText:"days_in_month",label:"days_in_month",detail:"days_in_month(v=vector(time()) instant-vector)",documentation:"Returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31."},{insertText:"delta",label:"delta",detail:"delta(v range-vector)",documentation:"Calculates the difference between the first and last value of each time series element in a range vector `v`, returning an instant vector with the given deltas and equivalent labels. The delta is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if the sample values are all integers."},{insertText:"deriv",label:"deriv",detail:"deriv(v range-vector)",documentation:"Calculates the per-second derivative of the time series in a range vector `v`, using simple linear regression."},{insertText:"drop_common_labels",label:"drop_common_labels",detail:"drop_common_labels(instant-vector)",documentation:"Drops all labels that have the same name and value across all series in the input vector."},{insertText:"exp",label:"exp",detail:"exp(v instant-vector)",documentation:"Calculates the exponential function for all elements in `v`.\nSpecial cases are:\n* `Exp(+Inf) = +Inf` \n* `Exp(NaN) = NaN`"},{insertText:"floor",label:"floor",detail:"floor(v instant-vector)",documentation:"Rounds the sample values of all elements in `v` down to the nearest integer."},{insertText:"histogram_quantile",label:"histogram_quantile",detail:"histogram_quantile(Ï float, b instant-vector)",documentation:"Calculates the Ï-quantile (0 â¤ Ï â¤ 1) from the buckets `b` of a histogram. The samples in `b` are the counts of observations in each bucket. Each sample must have a label `le` where the label value denotes the inclusive upper bound of the bucket. (Samples without such a label are silently ignored.) The histogram metric type automatically provides time series with the `_bucket` suffix and the appropriate labels."},{insertText:"holt_winters",label:"holt_winters",detail:"holt_winters(v range-vector, sf scalar, tf scalar)",documentation:"Produces a smoothed value for time series based on the range in `v`. The lower the smoothing factor `sf`, the more importance is given to old data. The higher the trend factor `tf`, the more trends in the data is considered. Both `sf` and `tf` must be between 0 and 1."},{insertText:"hour",label:"hour",detail:"hour(v=vector(time()) instant-vector)",documentation:"Returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23."},{insertText:"idelta",label:"idelta",detail:"idelta(v range-vector)",documentation:"Calculates the difference between the last two samples in the range vector `v`, returning an instant vector with the given deltas and equivalent labels."},{insertText:"increase",label:"increase",detail:"increase(v range-vector)",documentation:"Calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments."},{insertText:"irate",label:"irate",detail:"irate(v range-vector)",documentation:"Calculates the per-second instant rate of increase of the time series in the range vector. This is based on the last two data points. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for."},{insertText:"label_join",label:"label_join",detail:"label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)",documentation:"For each timeseries in `v`, joins all the values of all the `src_labels` using `separator` and returns the timeseries with the label `dst_label` containing the joined value. There can be any number of `src_labels` in this function."},{insertText:"label_replace",label:"label_replace",detail:"label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)",documentation:"For each timeseries in `v`, `label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)`  matches the regular expression `regex` against the label `src_label`.  If it matches, then the timeseries is returned with the label `dst_label` replaced by the expansion of `replacement`. `$1` is replaced with the first matching subgroup, `$2` with the second etc. If the regular expression doesn't match then the timeseries is returned unchanged."},{insertText:"ln",label:"ln",detail:"ln(v instant-vector)",documentation:"Calculates the natural logarithm for all elements in `v`.\nSpecial cases are:\n * `ln(+Inf) = +Inf`\n * `ln(0) = -Inf`\n * `ln(x < 0) = NaN`\n * `ln(NaN) = NaN`"},{insertText:"log2",label:"log2",detail:"log2(v instant-vector)",documentation:"Calculates the binary logarithm for all elements in `v`. The special cases are equivalent to those in `ln`."},{insertText:"log10",label:"log10",detail:"log10(v instant-vector)",documentation:"Calculates the decimal logarithm for all elements in `v`. The special cases are equivalent to those in `ln`."},{insertText:"minute",label:"minute",detail:"minute(v=vector(time()) instant-vector)",documentation:"Returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59."},{insertText:"month",label:"month",detail:"month(v=vector(time()) instant-vector)",documentation:"Returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc."},{insertText:"pi",label:"pi",detail:"pi()",documentation:"Returns pi"},{insertText:"predict_linear",label:"predict_linear",detail:"predict_linear(v range-vector, t scalar)",documentation:"Predicts the value of time series `t` seconds from now, based on the range vector `v`, using simple linear regression."},{insertText:"rad",label:"rad",detail:"rad(v instant-vector)",documentation:"Converts degrees to radians for all elements in v"},{insertText:"rate",label:"rate",detail:"rate(v range-vector)",documentation:"Calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range's time period."},{insertText:"resets",label:"resets",detail:"resets(v range-vector)",documentation:"For each input time series, `resets(v range-vector)` returns the number of counter resets within the provided time range as an instant vector. Any decrease in the value between two consecutive samples is interpreted as a counter reset."},{insertText:"round",label:"round",detail:"round(v instant-vector, to_nearest=1 scalar)",documentation:"Rounds the sample values of all elements in `v` to the nearest integer. Ties are resolved by rounding up. The optional `to_nearest` argument allows specifying the nearest multiple to which the sample values should be rounded. This multiple may also be a fraction."},{insertText:"scalar",label:"scalar",detail:"scalar(v instant-vector)",documentation:"Given a single-element input vector, `scalar(v instant-vector)` returns the sample value of that single element as a scalar. If the input vector does not have exactly one element, `scalar` will return `NaN`."},{insertText:"sgn",label:"sgn",detail:"sgn(v instant-vector)",documentation:"Returns a vector with all sample values converted to their sign, defined as this: 1 if v is positive, -1 if v is negative and 0 if v is equal to zero."},{insertText:"sort",label:"sort",detail:"sort(v instant-vector)",documentation:"Returns vector elements sorted by their sample values, in ascending order."},{insertText:"sort_desc",label:"sort_desc",detail:"sort_desc(v instant-vector)",documentation:"Returns vector elements sorted by their sample values, in descending order."},{insertText:"sqrt",label:"sqrt",detail:"sqrt(v instant-vector)",documentation:"Calculates the square root of all elements in `v`."},{insertText:"time",label:"time",detail:"time()",documentation:"Returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated."},{insertText:"timestamp",label:"timestamp",detail:"timestamp(v instant-vector)",documentation:"Returns the timestamp of each of the samples of the given vector as the number of seconds since January 1, 1970 UTC."},{insertText:"vector",label:"vector",detail:"vector(s scalar)",documentation:"Returns the scalar `s` as a vector with no labels."},{insertText:"year",label:"year",detail:"year(v=vector(time()) instant-vector)",documentation:"Returns the year for each of the given times in UTC."},{insertText:"avg_over_time",label:"avg_over_time",detail:"avg_over_time(range-vector)",documentation:"The average value of all points in the specified interval."},{insertText:"min_over_time",label:"min_over_time",detail:"min_over_time(range-vector)",documentation:"The minimum value of all points in the specified interval."},{insertText:"max_over_time",label:"max_over_time",detail:"max_over_time(range-vector)",documentation:"The maximum value of all points in the specified interval."},{insertText:"sum_over_time",label:"sum_over_time",detail:"sum_over_time(range-vector)",documentation:"The sum of all values in the specified interval."},{insertText:"count_over_time",label:"count_over_time",detail:"count_over_time(range-vector)",documentation:"The count of all values in the specified interval."},{insertText:"quantile_over_time",label:"quantile_over_time",detail:"quantile_over_time(scalar, range-vector)",documentation:"The Ï-quantile (0 â¤ Ï â¤ 1) of the values in the specified interval."},{insertText:"stddev_over_time",label:"stddev_over_time",detail:"stddev_over_time(range-vector)",documentation:"The population standard deviation of the values in the specified interval."},{insertText:"stdvar_over_time",label:"stdvar_over_time",detail:"stdvar_over_time(range-vector)",documentation:"The population standard variance of the values in the specified interval."},{insertText:"last_over_time",label:"last_over_time",detail:"last_over_time(range-vector)",documentation:"The most recent point value in specified interval."},{insertText:"present_over_time",label:"present_over_time",detail:"present_over_time(range-vector)",documentation:"The value 1 for any series in the specified interval."},{insertText:"histogram_avg",label:"histogram_avg",detail:"histogram_avg(v instant-vector)",documentation:"Returns the arithmetic average of observed values stored in a native histogram. Samples that are not native histograms are ignored and do not show up in the returned vector."},{insertText:"histogram_count",label:"histogram_count",detail:"histogram_count(v instant-vector)",documentation:"Returns the count of observations stored in a native histogram."},{insertText:"histogram_sum",label:"histogram_sum",detail:"histogram_sum(v instant-vector)",documentation:"Returns the sum of observations stored in a native histogram."},{insertText:"histogram_fraction",label:"histogram_fraction",detail:"histogram_fraction(lower scalar, upper scalar, v instant-vector)",documentation:"Returns the estimated fraction of observations between the provided lower and upper values."},{insertText:"histogram_stddev",label:"histogram_stddev",detail:"histogram_stddev(v instant-vector)",documentation:"Returns the estimated standard deviation of observations in a native histogram, based on the geometric mean of the buckets where the observations lie."},{insertText:"histogram_stdvar",label:"histogram_stdvar",detail:"histogram_stdvar(v instant-vector)",documentation:"Returns the estimated standard variance of observations in a native histogram."}];ct.map((e=>e.label));const ut={comment:{pattern:/#.*/},"context-aggregation":{pattern:/((by|without)\s*)\([^)]*\)/,lookbehind:!0,inside:{"label-key":{pattern:/[^(),\s][^,)]*[^),\s]*/,alias:"attr-name"},punctuation:/[()]/}},"context-labels":{pattern:/\{[^}]*(?=}?)/,greedy:!0,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name",greedy:!0},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},function:new RegExp(`\\b(?:${ct.map((e=>e.label)).join("|")})(?=\\s*\\()`,"i"),"context-range":[{pattern:/\[[^\]]*(?=])/,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}},{pattern:/(offset\s+)\w+/,lookbehind:!0,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}}],idList:{pattern:/\d+(\|\d+)+/,alias:"number"},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp(`/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|\\b(?:${["by","group_left","group_right","ignoring","on","offset","without"].join("|")})\\b`,"i"),punctuation:/[{};()`,.]/};var dt=b(6643),pt=b.n(dt),ht=b(2540),mt=b(5959),ft=b.t(mt,2),gt=b.n(mt),bt=b(2007);function vt({onChange:t,index:r,operationId:n,value:a,query:i,datasource:o}){const[s,l]=(0,mt.useState)({});return(0,ht.jsx)(bt.Select,{inputId:Ft(n,r),autoFocus:""===a||void 0,openMenuOnFocus:!0,onOpenMenu:async()=>{l({isLoading:!0});const e=await async function(e,t){let r=e.labels;"prometheus"===t.type&&(r=[{label:"__name__",op:"=",value:e.metric},...e.labels]);const n=Or.renderLabels(r),a=await t.languageProvider.fetchLabelsWithMatch(n);return Object.keys(a).map((e=>({label:e,value:e})))}(i,o);l({options:e,isLoading:void 0})},isLoading:s.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:s.options,value:(0,e.toOption)(a),onChange:e=>t(r,e.value)})}var yt=(e=>(e.Aggregations="Aggregations",e.RangeFunctions="Range functions",e.Functions="Functions",e.BinaryOps="Binary operations",e.Trigonometric="Trigonometric",e.Time="Time Functions",e))(yt||{}),xt=(e=>(e.Abs="abs",e.Absent="absent",e.AbsentOverTime="absent_over_time",e.Acos="acos",e.Acosh="acosh",e.Asin="asin",e.Asinh="asinh",e.Atan="atan",e.Atanh="atanh",e.Avg="avg",e.AvgOverTime="avg_over_time",e.BottomK="bottomk",e.Ceil="ceil",e.Changes="changes",e.Clamp="clamp",e.ClampMax="clamp_max",e.ClampMin="clamp_min",e.Cos="cos",e.Cosh="cosh",e.Count="count",e.CountOverTime="count_over_time",e.CountScalar="count_scalar",e.CountValues="count_values",e.DayOfMonth="day_of_month",e.DayOfWeek="day_of_week",e.DayOfYear="day_of_year",e.DaysInMonth="days_in_month",e.Deg="deg",e.Delta="delta",e.Deriv="deriv",e.DropCommonLabels="drop_common_labels",e.Exp="exp",e.Floor="floor",e.Group="group",e.HistogramQuantile="histogram_quantile",e.HistogramAvg="histogram_avg",e.HistogramCount="histogram_count",e.HistogramSum="histogram_sum",e.HistogramFraction="histogram_fraction",e.HistogramStddev="histogram_stddev",e.HistogramStdvar="histogram_stdvar",e.HoltWinters="holt_winters",e.Hour="hour",e.Idelta="idelta",e.Increase="increase",e.Irate="irate",e.LabelJoin="label_join",e.LabelReplace="label_replace",e.Last="last",e.LastOverTime="last_over_time",e.Ln="ln",e.Log10="log10",e.Log2="log2",e.Max="max",e.MaxOverTime="max_over_time",e.Min="min",e.MinOverTime="min_over_time",e.Minute="minute",e.Month="month",e.Pi="pi",e.PredictLinear="predict_linear",e.Present="present",e.PresentOverTime="present_over_time",e.Quantile="quantile",e.QuantileOverTime="quantile_over_time",e.Rad="rad",e.Rate="rate",e.Resets="resets",e.Round="round",e.Scalar="scalar",e.Sgn="sgn",e.Sin="sin",e.Sinh="sinh",e.Sort="sort",e.SortDesc="sort_desc",e.Sqrt="sqrt",e.Stddev="stddev",e.StddevOverTime="stddev_over_time",e.Sum="sum",e.SumOverTime="sum_over_time",e.Tan="tan",e.Tanh="tanh",e.Time="time",e.Timestamp="timestamp",e.TopK="topk",e.Vector="vector",e.Year="year",e.Addition="__addition",e.Subtraction="__subtraction",e.MultiplyBy="__multiply_by",e.DivideBy="__divide_by",e.Modulo="__modulo",e.Exponent="__exponent",e.NestedQuery="__nested_query",e.EqualTo="__equal_to",e.NotEqualTo="__not_equal_to",e.GreaterThan="__greater_than",e.LessThan="__less_than",e.GreaterOrEqual="__greater_or_equal",e.LessOrEqual="__less_or_equal",e))(xt||{}),Ot=(e=>(e.Rate="rate",e.Histogram="histogram",e.Binary="binary",e))(Ot||{}),wt=Object.defineProperty,St=Object.defineProperties,_t=Object.getOwnPropertyDescriptors,Pt=Object.getOwnPropertySymbols,Et=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,Ct=(e,t,r)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,It=(e,t)=>{for(var r in t||(t={}))Et.call(t,r)&&Ct(e,r,t[r]);if(Pt)for(var r of Pt(t))Tt.call(t,r)&&Ct(e,r,t[r]);return e},jt=(e,t)=>St(e,_t(t));function $t(e,t,r){const n=Nt(e,t),a=e.id+"(";return r&&n.push(r),a+n.join(", ")+")"}function Dt(e,t,r){const n=Nt(e,t),a=e.id+"(";return r&&n.unshift(r),a+n.join(", ")+")"}function kt(e,t,r,n){var a,i;if(t.params.length<2)throw`Cannot render a function with params of length [${t.params.length}]`;let o=null!=(i=(null!=(a=e.params)?a:[])[0])?i:"5m";const s=Nt(jt(It({},e),{params:e.params.slice(1)}),jt(It({},t),{params:t.params.slice(1),defaultParams:t.defaultParams.slice(1)})),l=e.id+"(";return r&&(n?s.push(`${r}[${o}]`):s.unshift(`${r}[${o}]`)),l+s.join(", ")+")"}function Rt(e,t,r){return kt(e,t,r,!1)}function At(e,t,r){return kt(e,t,r,!0)}function Nt(e,t,r){var n;return(null!=(n=e.params)?n:[]).map(((e,r)=>"string"===t.params[r].type?'"'+e+'"':e))}function Lt(e,t){const r={id:e.id,params:e.defaultParams};return jt(It({},t),{operations:[...t.operations,r]})}function Mt(e){return(0,t.capitalize)(e.replace(/_/g," "))}function Ft(e,t){return`operations.${e}.param.${t}`}function Bt(e=!1){const t=[{label:"$__interval",value:"$__interval"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"1h",value:"1h"},{label:"24h",value:"24h"}];return e&&t.unshift({label:"$__rate_interval",value:"$__rate_interval"}),{name:"Range",type:"string",options:t}}function qt(e,t={}){var r,n;return[It({id:e,name:Mt(e),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],alternativesKey:"plain aggregations",category:yt.Aggregations,renderer:$t,paramChangedHandler:(n=`__${e}_by`,function(e,t,r){return t.params.length===r.params.length?jt(It({},t),{id:n}):t}),explainHandler:Wt(e,""),addOperationHandler:Lt},t),It({id:`__${e}_by`,name:`${Mt(e)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:vt}],defaultParams:[""],alternativesKey:"aggregations by",category:yt.Aggregations,renderer:(r=e,function(e,t,n){return`${r} by(${e.params.join(", ")}) (${n})`}),paramChangedHandler:Ut(e),explainHandler:Wt(e,"by"),addOperationHandler:Lt,hideFromList:!0},t),It({id:`__${e}_without`,name:`${Mt(e)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:vt}],defaultParams:[""],alternativesKey:"aggregations by",category:yt.Aggregations,renderer:Vt(e),paramChangedHandler:Ut(e),explainHandler:Wt(e,"without"),addOperationHandler:Lt,hideFromList:!0},t)]}function Qt(e,t,r={}){const n=qt(e,r);return n[0].params.unshift(...t.params),n[1].params.unshift(...t.params),n[2].params.unshift(...t.params),n[0].defaultParams=t.defaultParams,n[1].defaultParams=[...t.defaultParams,""],n[2].defaultParams=[...t.defaultParams,""],n[1].renderer=zt(e),n[2].renderer=zt(e),n}function Vt(e){return function(t,r,n){return`${e} without(${t.params.join(", ")}) (${n})`}}function Wt(e,t){return function(r){const n=r.params.map((e=>`\`${e}\``)).join(" and "),a=pt()("label",r.params.length);switch(t){case"by":return`Calculates ${e} over dimensions while preserving ${a} ${n}.`;case"without":return`Calculates ${e} over the dimensions ${n}. All other labels are preserved.`;default:return`Calculates ${e} over the dimensions.`}}}function zt(e){return function(t,r,n){const a=r.params.findIndex((e=>e.restParam)),i=t.params.slice(0,a),o=t.params.slice(a);return`${e} by(${o.join(", ")}) (${i.map(((e,t)=>"string"===r.params[t].type?`"${e}"`:e)).join(", ")}, ${n})`}}function Ut(e){return function(t,r,n){return r.params.length<n.params.length?jt(It({},r),{id:e}):r}}const Gt=[{id:xt.Addition,name:"Add scalar",sign:"+"},{id:xt.Subtraction,name:"Subtract scalar",sign:"-"},{id:xt.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:xt.DivideBy,name:"Divide by scalar",sign:"/"},{id:xt.Modulo,name:"Modulo by scalar",sign:"%"},{id:xt.Exponent,name:"Exponent",sign:"^"},{id:xt.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:xt.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:xt.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:xt.LessThan,name:"Less than",sign:"<",comparison:!0},{id:xt.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:xt.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],Ht=Gt.reduce(((e,t)=>(e[t.sign]={id:t.id,comparison:t.comparison},e)),{}),Xt=Gt.map((e=>{const t=[{name:"Value",type:"number"}];let r=[2];return e.comparison&&(t.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),r=[2,!1]),{id:e.id,name:e.name,params:t,defaultParams:r,alternativesKey:"binary scalar operations",category:yt.BinaryOps,renderer:Yt(e.sign),addOperationHandler:Lt}}));function Yt(e){return function(t,r,n){let a=t.params[0],i="";return 2===t.params.length&&(i=t.params[1]?" bool":""),`${n} ${e}${i} ${a}`}}var Kt=Object.defineProperty,Jt=Object.defineProperties,Zt=Object.getOwnPropertyDescriptors,er=Object.getOwnPropertySymbols,tr=Object.prototype.hasOwnProperty,rr=Object.prototype.propertyIsEnumerable,nr=(e,t,r)=>t in e?Kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ar=(e,t)=>{for(var r in t||(t={}))tr.call(t,r)&&nr(e,r,t[r]);if(er)for(var r of er(t))rr.call(t,r)&&nr(e,r,t[r]);return e},ir=(e,t)=>Jt(e,Zt(t));function or(e){var t,r,n,a,i,o;return ir(ar({},e),{id:e.id,name:null!=(t=e.name)?t:Mt(e.id),params:null!=(r=e.params)?r:[],defaultParams:null!=(n=e.defaultParams)?n:[],category:null!=(a=e.category)?a:yt.Functions,renderer:null!=(i=e.renderer)?i:e.params?Dt:$t,addOperationHandler:null!=(o=e.addOperationHandler)?o:Lt})}function sr(e,t=!1){return{id:e,name:Mt(e),params:[Bt(t)],defaultParams:[t?"$__rate_interval":"$__interval"],alternativesKey:"range function",category:yt.RangeFunctions,renderer:cr,addOperationHandler:ur,changeTypeHandler:lr}}function lr(e,t){return("$__rate_interval"===e.params[0]&&"$__rate_interval"!==t.defaultParams[0]||"$__interval"===e.params[0]&&"$__interval"!==t.defaultParams[0])&&(e.params=t.defaultParams),e}function cr(e,t,r){var n,a;let i=null!=(a=(null!=(n=e.params)?n:[])[0])?a:"5m";return`${t.id}(${r}[${i}])`}function ur(e,t,r){const n={id:e.id,params:e.defaultParams};return t.operations.length>0&&r.getOperationDef(t.operations[0].id).addOperationHandler===ur?ir(ar({},t),{operations:[n,...t.operations.slice(1)]}):ir(ar({},t),{operations:[n,...t.operations]})}function dr(e,t){var r;return ir(ar({},t),{binaryQueries:[...null!=(r=t.binaryQueries)?r:[],{operator:"/",query:t}]})}function pr(e,t,r){var n,a;const i=null!=(n=e.params[0])?n:"",o=`"${null!=(a=e.params[1])?a:""}"`;return`${e.id}(${r}, "${i}", ${o}, "${e.params.slice(2).join(o)}")`}function hr(e,t){var r;let n=null!=(r=null==t?void 0:t.documentation)?r:"no docs";return"string"!=typeof e.params[1]&&(n+=" ð¨ð¨ð¨ The `separator` must be a string."),n}function mr(e,t){const r={id:e.id,params:e.defaultParams};return ir(ar({},t),{operations:[...t.operations,r]})}function fr(e){return{id:e,name:Mt(e),params:[Bt()],defaultParams:["$__interval"],alternativesKey:"overtime function",category:yt.RangeFunctions,renderer:gr,addOperationHandler:ur}}function gr(e,t,r){var n,a;let i=null!=(a=(null!=(n=e.params)?n:[])[0])?a:"$__interval";return`${t.id}(${r}[${i}])`}var br=Object.defineProperty,vr=(e,t,r)=>(((e,t,r)=>{t in e?br(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);class yr{constructor(t){vr(this,"operationsRegistry"),vr(this,"categories",[]),this.operationsRegistry=new e.Registry(t)}setOperationCategories(e){this.categories=e}getOperationsForCategory(e){return this.operationsRegistry.list().filter((t=>t.category===e&&!t.hideFromList))}getAlternativeOperations(e){return this.operationsRegistry.list().filter((t=>t.alternativesKey&&t.alternativesKey===e))}getCategories(){return this.categories}getOperationDef(e){return this.operationsRegistry.getIfExists(e)}renderOperations(e,t){for(const r of t){const t=this.operationsRegistry.getIfExists(r.id);if(!t)throw new Error(`Could not find operation ${r.id} in the registry`);e=t.renderer(r,t,e)}return e}renderBinaryQueries(e,t){if(t)for(const r of t)e=`${this.renderBinaryQuery(e,r)}`;return e}renderBinaryQuery(e,t){let r=e+` ${t.operator} `;return t.vectorMatches&&(r+=`${t.vectorMatchesType}(${t.vectorMatches}) `),r+this.renderQuery(t.query,!0)}renderLabels(e){if(0===e.length)return"";let t="{";for(const r of e)"{"!==t&&(t+=", "),t+=`${r.label}${r.op}"${r.value}"`;return t+"}"}renderQuery(e,t){var r,n,a;let i=`${null!=(r=e.metric)?r:""}${this.renderLabels(e.labels)}`;return i=this.renderOperations(i,e.operations),!t&&this.hasBinaryOp(e)&&Boolean(null==(n=e.binaryQueries)?void 0:n.length)&&(i=`(${i})`),i=this.renderBinaryQueries(i,e.binaryQueries),t&&(this.hasBinaryOp(e)||Boolean(null==(a=e.binaryQueries)?void 0:a.length))&&(i=`(${i})`),i}hasBinaryOp(e){return void 0!==e.operations.find((e=>{const t=this.getOperationDef(e.id);return(null==t?void 0:t.category)===yt.BinaryOps}))}}class xr extends yr{constructor(){super((()=>{const e=[{id:xt.HistogramQuantile,name:"Histogram quantile",params:[{name:"Quantile",type:"number",options:[.99,.95,.9,.75,.5,.25]}],defaultParams:[.9],category:yt.Functions,renderer:$t,addOperationHandler:Lt},or({id:xt.HistogramAvg}),or({id:xt.HistogramCount}),or({id:xt.HistogramSum}),{id:xt.HistogramFraction,name:"Histogram fraction",params:[{name:"Lower scalar",type:"number"},{name:"Upper scalar",type:"number"}],defaultParams:[0,.2],category:yt.Functions,renderer:$t,addOperationHandler:Lt},or({id:xt.HistogramStddev}),or({id:xt.HistogramStdvar}),{id:xt.LabelReplace,name:"Label replace",params:[{name:"Destination label",type:"string"},{name:"Replacement",type:"string"},{name:"Source label",type:"string"},{name:"Regex",type:"string"}],category:yt.Functions,defaultParams:["","$1","","(.*)"],renderer:Dt,addOperationHandler:Lt},{id:xt.Ln,name:"Ln",params:[],defaultParams:[],category:yt.Functions,renderer:$t,addOperationHandler:Lt},sr(xt.Changes),sr(xt.Rate,!0),sr(xt.Irate),sr(xt.Increase,!0),sr(xt.Idelta),sr(xt.Delta),or({id:xt.HoltWinters,params:[Bt(),{name:"Smoothing Factor",type:"number"},{name:"Trend Factor",type:"number"}],defaultParams:["$__interval",.5,.5],alternativesKey:"range function",category:yt.RangeFunctions,renderer:Rt,addOperationHandler:ur,changeTypeHandler:lr}),or({id:xt.PredictLinear,params:[Bt(),{name:"Seconds from now",type:"number"}],defaultParams:["$__interval",60],alternativesKey:"range function",category:yt.RangeFunctions,renderer:Rt,addOperationHandler:ur,changeTypeHandler:lr}),or({id:xt.QuantileOverTime,params:[Bt(),{name:"Quantile",type:"number"}],defaultParams:["$__interval",.5],alternativesKey:"overtime function",category:yt.RangeFunctions,renderer:At,addOperationHandler:ur,changeTypeHandler:lr}),...Xt,{id:xt.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:yt.BinaryOps,renderer:(e,t,r)=>r,addOperationHandler:dr},or({id:xt.Abs}),or({id:xt.Absent}),or({id:xt.Acos,category:yt.Trigonometric}),or({id:xt.Acosh,category:yt.Trigonometric}),or({id:xt.Asin,category:yt.Trigonometric}),or({id:xt.Asinh,category:yt.Trigonometric}),or({id:xt.Atan,category:yt.Trigonometric}),or({id:xt.Atanh,category:yt.Trigonometric}),or({id:xt.Ceil}),or({id:xt.Clamp,name:"Clamp",params:[{name:"Minimum Scalar",type:"number"},{name:"Maximum Scalar",type:"number"}],defaultParams:[1,1]}),or({id:xt.ClampMax,params:[{name:"Maximum Scalar",type:"number"}],defaultParams:[1]}),or({id:xt.ClampMin,params:[{name:"Minimum Scalar",type:"number"}],defaultParams:[1]}),or({id:xt.Cos,category:yt.Trigonometric}),or({id:xt.Cosh,category:yt.Trigonometric}),or({id:xt.DayOfMonth,category:yt.Time}),or({id:xt.DayOfWeek,category:yt.Time}),or({id:xt.DayOfYear,category:yt.Time}),or({id:xt.DaysInMonth,category:yt.Time}),or({id:xt.Deg}),sr(xt.Deriv),or({id:xt.Exp}),or({id:xt.Floor}),or({id:xt.Hour}),or({id:xt.LabelJoin,params:[{name:"Destination Label",type:"string",editor:vt},{name:"Separator",type:"string"},{name:"Source Label",type:"string",restParam:!0,optional:!0,editor:vt}],defaultParams:["",",",""],renderer:pr,explainHandler:hr,addOperationHandler:mr}),or({id:xt.Log10}),or({id:xt.Log2}),or({id:xt.Minute}),or({id:xt.Month}),or({id:xt.Pi,renderer:e=>`${e.id}()`}),or({id:xt.Rad}),sr(xt.Resets),or({id:xt.Round,category:yt.Functions,params:[{name:"To Nearest",type:"number"}],defaultParams:[1]}),or({id:xt.Scalar}),or({id:xt.Sgn}),or({id:xt.Sin,category:yt.Trigonometric}),or({id:xt.Sinh,category:yt.Trigonometric}),or({id:xt.Sort}),or({id:xt.SortDesc}),or({id:xt.Sqrt}),or({id:xt.Stddev}),or({id:xt.Tan,category:yt.Trigonometric}),or({id:xt.Tanh,category:yt.Trigonometric}),or({id:xt.Time,renderer:e=>`${e.id}()`}),or({id:xt.Timestamp}),or({id:xt.Vector,params:[{name:"Value",type:"number"}],defaultParams:[1],renderer:e=>`${e.id}(${e.params[0]})`}),or({id:xt.Year}),...qt(xt.Sum),...qt(xt.Avg),...qt(xt.Min),...qt(xt.Max),...qt(xt.Count),...qt(xt.Group),...Qt(xt.TopK,{params:[{name:"K-value",type:"number"}],defaultParams:[5]}),...Qt(xt.BottomK,{params:[{name:"K-value",type:"number"}],defaultParams:[5]}),...Qt(xt.CountValues,{params:[{name:"Identifier",type:"string"}],defaultParams:["count"]}),...Qt(xt.Quantile,{params:[{name:"Value",type:"number"}],defaultParams:[1]}),fr(xt.SumOverTime),fr(xt.AvgOverTime),fr(xt.MinOverTime),fr(xt.MaxOverTime),fr(xt.CountOverTime),fr(xt.LastOverTime),fr(xt.PresentOverTime),fr(xt.AbsentOverTime),fr(xt.StddevOverTime)];for(const t of e){const e=ct.find((e=>e.insertText===t.id));e&&(t.documentation=e.documentation)}return e})),this.setOperationCategories([yt.Aggregations,yt.RangeFunctions,yt.Functions,yt.BinaryOps,yt.Trigonometric,yt.Time])}getQueryPatterns(){return[{name:"Rate then sum",type:Ot.Rate,operations:[{id:"rate",params:["$__rate_interval"]},{id:"sum",params:[]}]},{name:"Rate then sum by(label) then avg",type:Ot.Rate,operations:[{id:"rate",params:["$__rate_interval"]},{id:"__sum_by",params:[""]},{id:"avg",params:[]}]},{name:"Histogram quantile on rate",type:Ot.Histogram,operations:[{id:"rate",params:["$__rate_interval"]},{id:"__sum_by",params:["le"]},{id:"histogram_quantile",params:[.95]}]},{name:"Histogram quantile on increase",type:Ot.Histogram,operations:[{id:"increase",params:["$__rate_interval"]},{id:"__max_by",params:["le"]},{id:"histogram_quantile",params:[.95]}]},{name:"Binary Query",type:Ot.Binary,operations:[{id:"rate",params:["$__rate_interval"]},{id:"sum",params:[]}],binaryQueries:[{operator:"/",query:{metric:"",labels:[],operations:[{id:"rate",params:["$__rate_interval"]},{id:"sum",params:[]}]}}]}]}}const Or=new xr;function wr(e){return e.firstChild?wr(e.firstChild):e}function Sr(e,t){var r;return{text:Er(e,t),from:t.from,to:t.to,parentType:null==(r=t.parent)?void 0:r.name}}const _r=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g,Pr=[(e,t)=>`$${e}`,(e,t)=>`[[${e}${t?`:${t}`:""}]]`,(e,t)=>`\${${e}${t?`:${t}`:""}}`];function Er(e,t){return t?function(e){return e.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,((e,t,r,n)=>Pr[parseInt(t,10)](r,n)))}(e.substring(t.from,t.to)):""}function Tr(e,t,r,n){const a=[parseFloat(Er(t,r))];return e.comparison&&a.push(n),{id:e.id,params:a}}function Cr(e,t,r){if(t.type.id===r)return[Er(e,t)];const n=[];let a=0,i=t.childAfter(a);for(;i;)n.push(...Cr(e,i,r)),a=i.to,i=t.childAfter(a);return n}const Ir=e=>e.split(" ").map((e=>`${e}.*`)).join("");function jr(e){const t=function(e){return e.replace(_r,((e,t,r,n,a,i,o)=>{const s=n||o;let l=t,c="0";return r&&(l=r,c="1"),a&&(l=a,c="2"),`__V_${c}__`+l+"__V__"+(s?"__F__"+s+"__F__":"")}))}(e),r=at.parse(t).topNode,n={query:{metric:"",labels:[],operations:[]},errors:[]};try{$r(t,r,n)}catch(e){console.error(e),e instanceof Error&&n.errors.push({text:e.message})}return 0===(a=n.query).labels.length&&0===a.operations.length&&!a.metric&&(n.errors=[]),function(e){const t={query:{metric:"",labels:[],operations:[]},errors:[]};e=(e=(e=(e=(e=(e=e.replace(/\$__interval/g,"1s")).replace(/\$__interval_ms/g,"1000")).replace(/\$__rate_interval/g,"1s")).replace(/\$__range_ms/g,"1000")).replace(/\$__range_s/g,"1")).replace(/\$__range/g,"1s");const r=at.parse(e).topNode;try{$r(e,r,t)}catch(e){return!1}return 0===t.errors.length}(e)&&(n.errors=[]),n;var a}function $r(e,t,r){const n=r.query;switch(t.type.id){case 53:n.metric=Er(e,t);break;case lt:{n.labels.push(function(e,t){return{label:Er(e,t.getChild(33)),op:Er(e,t.getChild(141)),value:Er(e,t.getChild(ot)).replace(/^["'`]|["'`]$/g,"")}}(e,t));const a=t.getChild(0);a&&r.errors.push(Sr(e,a));break}case 50:!function(e,t,r){const n=r.query,a=Er(e,t.getChild(51)),i=t.getChild(34),o=[];let s="";if(Dr.includes(a)||a.endsWith("_over_time")){let r=Er(e,t).match(/\[(.+)\]/);(null==r?void 0:r[1])&&(s=r[1],o.push(r[1]))}const l={id:a,params:o};if(n.operations.unshift(l),i){if(Er(e,i)==="(["+s+"])")return;kr(e,i,r,l)}}(e,t,r);break;case 29:!function(e,t,r){const n=r.query;let a=Er(e,t.getChild(30));const i=t.getChild(31),o=[];i&&(i.getChild("By")&&a&&(a=`__${a}_by`),i.getChild(21)&&(a=`__${a}_without`),o.push(...Cr(e,i,33)));const s=t.getChild(34),l={id:a,params:[]};n.operations.unshift(l),kr(e,s,r,l),l.params.push(...o)}(e,t,r);break;case 35:!function(e,t,r){var n;const a=r.query,i=t.firstChild,o=Er(e,i.nextSibling),s=function(e,t){if(t){if(t.getChild("Bool"))return{isBool:!0,isMatcher:!1};{let r="";const n=t.getChild(32);return n&&(r=Cr(e,n,33).join(", ")),{isMatcher:!0,isBool:!1,matches:r,matchType:t.getChild(3)?"on":"ignoring"}}}}(e,null!=(n=t.getChild(37))?n:t.getChild(38)),l=t.lastChild,c=Ht[o],u=i.type.id===it,d=l.type.id===it,p=35===l.type.id;if(u||$r(e,i,r),d)a.operations.push(Tr(c,e,l,!!(null==s?void 0:s.isBool)));else if(p){const t=wr(l);(null==t?void 0:t.type.id)===it&&a.operations.push(Tr(c,e,t,!!(null==s?void 0:s.isBool))),$r(e,l,r)}else{a.binaryQueries=a.binaryQueries||[];const t={operator:o,query:{metric:"",labels:[],operations:[]}};(null==s?void 0:s.isMatcher)&&(t.vectorMatchesType=s.matchType,t.vectorMatches=s.matches),a.binaryQueries.push(t),$r(e,l,{query:t.query,errors:r.errors})}}(e,t,r);break;case 0:if(function(e){var t,r;return(null==(r=null==(t=e.prevSibling)?void 0:t.firstChild)?void 0:r.type.id)===st}(t))break;r.errors.push(Sr(e,t));break;default:{133===t.type.id&&r.errors.push(Sr(e,t));let n=t.firstChild;for(;n;)$r(e,n,r),n=n.nextSibling}}}const Dr=["changes","rate","irate","increase","delta"];function kr(e,t,r,n){if(t)switch(t.type.id){case 34:{let a=t.firstChild;for(;a;){let t;t=35===a.type.id?a:a.getChild(35),t&&r.errors.push({text:"Query parsing is ambiguous.",from:t.from,to:t.to}),kr(e,a,r,n),a=a.nextSibling}break}case it:n.params.push(parseFloat(Er(e,t)));break;case ot:n.params.push(Er(e,t).replace(/"/g,""));break;default:$r(e,t,r)}}function Rr(e,t,r,n="="){if(!t||!r)throw new Error("Need label to add to query.");const a=function(e){const t=at.parse(e),r=[];return t.iterate({enter:({to:t,from:n,type:a})=>{if(a.id===st){const a=jr(e.substring(n,t));return r.push({query:a.query,from:n,to:t}),!1}}}),r}(e);if(!a.length)return e;const i=function(e,t,r){return{label:e,op:r,value:t===1/0?"+Inf":t.toString()}}(t,r,n);return function(e,t,r){const n=new xr;let a="",i=0;for(let o=0;o<t.length;o++){const s=t[o],l=o===t.length-1,c=e.substring(i,s.from),u=l?e.substring(s.to):"";Ar(s.query.labels,r)||s.query.labels.push(r),a+=c+n.renderQuery(s.query)+u,i=s.to}return a}(e,a,i)}function Ar(e,t){return e.find((e=>e.label===t.label&&e.value===t.value))}var Nr=b(6089),Lr=Object.getOwnPropertySymbols,Mr=Object.prototype.hasOwnProperty,Fr=Object.prototype.propertyIsEnumerable;const Br=e=>{var t=e,{children:r}=t,n=((e,t)=>{var r={};for(var n in e)Mr.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Lr)for(var n of Lr(e))t.indexOf(n)<0&&Fr.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);const a=(0,bt.useStyles2)((0,mt.useCallback)((e=>qr(e,n)),[n]));return gt().createElement("div",{className:a.root},r)},qr=(e,t)=>{var r,n,a;return{root:(0,Nr.css)({display:"flex",flexDirection:null!=(r=t.direction)?r:"row",flexWrap:null==(n=t.wrap)||n?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(a=t.gap)?a:2),flexGrow:t.flexGrow})}},Qr=({children:e})=>gt().createElement(Br,{gap:.5,direction:"column"},e),Vr=({children:e})=>{const t=(0,bt.useStyles2)(Wr);return gt().createElement("div",{className:t.root},gt().createElement(Br,{gap:2},e))},Wr=e=>({root:(0,Nr.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})}),zr=({v:e=0,h:t=0,layout:r="block"})=>{const n=(0,bt.useStyles2)((0,mt.useCallback)((n=>Ur(n,{v:e,h:t,layout:r})),[e,t,r]));return gt().createElement("span",{className:(0,Nr.cx)(n.wrapper)})},Ur=(e,t)=>{var r,n;return{wrapper:(0,Nr.css)([{paddingRight:e.spacing(null!=(r=t.h)?r:0),paddingBottom:e.spacing(null!=(n=t.v)?n:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}};var Gr=Object.defineProperty,Hr=Object.getOwnPropertySymbols,Xr=Object.prototype.hasOwnProperty,Yr=Object.prototype.propertyIsEnumerable,Kr=(e,t,r)=>t in e?Gr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Jr=e=>{var t;const r=e,{label:n,optional:a,tooltip:i,tooltipInteractive:o,children:s,width:l}=r,c=((e,t)=>{var r={};for(var n in e)Xr.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Hr)for(var n of Hr(e))t.indexOf(n)<0&&Yr.call(e,n)&&(r[n]=e[n]);return r})(r,["label","optional","tooltip","tooltipInteractive","children","width"]),u=(0,bt.useStyles2)((0,mt.useCallback)((e=>Zr(e,l)),[l])),d=(null==c?void 0:c.htmlFor)||(null==(t=bt.ReactUtils)?void 0:t.getChildId(s)),p=gt().createElement(gt().Fragment,null,gt().createElement("label",{className:u.label,htmlFor:d},n,a&&gt().createElement("span",{className:u.optional}," - optional"),i&&gt().createElement(bt.Tooltip,{placement:"top",content:i,theme:"info",interactive:o},gt().createElement(bt.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:u.icon}))),gt().createElement(zr,{v:.5}));return gt().createElement("div",{className:u.root},gt().createElement(bt.Field,((e,t)=>{for(var r in t||(t={}))Xr.call(t,r)&&Kr(e,r,t[r]);if(Hr)for(var r of Hr(t))Yr.call(t,r)&&Kr(e,r,t[r]);return e})({className:u.field,label:p},c),s))},Zr=(e,t)=>({root:(0,Nr.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,Nr.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,Nr.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,Nr.css)({marginBottom:0}),icon:(0,Nr.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});var en=Object.defineProperty,tn=Object.getOwnPropertySymbols,rn=Object.prototype.hasOwnProperty,nn=Object.prototype.propertyIsEnumerable,an=(e,t,r)=>t in e?en(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const on=e=>{const t=sn();return gt().createElement("div",{className:t.switch},gt().createElement(bt.Switch,((e,t)=>{for(var r in t||(t={}))rn.call(t,r)&&an(e,r,t[r]);if(tn)for(var r of tn(t))nn.call(t,r)&&an(e,r,t[r]);return e})({},e)))},sn=()=>({switch:(0,Nr.css)({display:"flex",alignItems:"center",minHeight:30})});var ln=b(8146),cn=b.n(ln);function un(){return un=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},un.apply(null,arguments)}function dn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pn(e,t){return pn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pn(e,t)}var hn=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function mn(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!((n=e[r])===(a=t[r])||hn(n)&&hn(a)))return!1;var n,a;return!0}const fn=function(e,t){var r;void 0===t&&(t=mn);var n,a=[],i=!1;return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return i&&r===this&&t(o,a)||(n=e.apply(this,o),i=!0,r=this,a=o),n}};var gn="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function bn(e){cancelAnimationFrame(e.id)}var vn=-1;function yn(e){if(void 0===e&&(e=!1),-1===vn||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),vn=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return vn}var xn=null;function On(e){if(void 0===e&&(e=!1),null===xn||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var n=document.createElement("div"),a=n.style;return a.width="100px",a.height="100px",t.appendChild(n),document.body.appendChild(t),t.scrollLeft>0?xn="positive-descending":(t.scrollLeft=1,xn=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),xn}return xn}var wn=function(e,t){return e};function Sn(e){var t,r=e.getItemOffset,n=e.getEstimatedTotalSize,a=e.getItemSize,i=e.getOffsetForIndexAndAlignment,o=e.getStartIndexForOffset,s=e.getStopIndexForStartIndex,l=e.initInstanceProps,c=e.shouldResetStyleCacheOnItemSizeChange,u=e.validateProps;return t=function(e){function t(t){var n;return(n=e.call(this,t)||this)._instanceProps=l(n.props,dn(n)),n._outerRef=void 0,n._resetIsScrollingTimeoutId=null,n.state={instance:dn(n),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof n.props.initialScrollOffset?n.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},n._callOnItemsRendered=void 0,n._callOnItemsRendered=fn((function(e,t,r,a){return n.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:r,visibleStopIndex:a})})),n._callOnScroll=void 0,n._callOnScroll=fn((function(e,t,r){return n.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:r})})),n._getItemStyle=void 0,n._getItemStyle=function(e){var t,i=n.props,o=i.direction,s=i.itemSize,l=i.layout,u=n._getItemStyleCache(c&&s,c&&l,c&&o);if(u.hasOwnProperty(e))t=u[e];else{var d=r(n.props,e,n._instanceProps),p=a(n.props,e,n._instanceProps),h="horizontal"===o||"horizontal"===l,m="rtl"===o,f=h?d:0;u[e]=t={position:"absolute",left:m?void 0:f,right:m?f:void 0,top:h?0:d,height:h?"100%":p,width:h?p:"100%"}}return t},n._getItemStyleCache=void 0,n._getItemStyleCache=fn((function(e,t,r){return{}})),n._onScrollHorizontal=function(e){var t=e.currentTarget,r=t.clientWidth,a=t.scrollLeft,i=t.scrollWidth;n.setState((function(e){if(e.scrollOffset===a)return null;var t=n.props.direction,o=a;if("rtl"===t)switch(On()){case"negative":o=-a;break;case"positive-descending":o=i-r-a}return o=Math.max(0,Math.min(o,i-r)),{isScrolling:!0,scrollDirection:e.scrollOffset<o?"forward":"backward",scrollOffset:o,scrollUpdateWasRequested:!1}}),n._resetIsScrollingDebounced)},n._onScrollVertical=function(e){var t=e.currentTarget,r=t.clientHeight,a=t.scrollHeight,i=t.scrollTop;n.setState((function(e){if(e.scrollOffset===i)return null;var t=Math.max(0,Math.min(i,a-r));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),n._resetIsScrollingDebounced)},n._outerRefSetter=function(e){var t=n.props.outerRef;n._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},n._resetIsScrollingDebounced=function(){null!==n._resetIsScrollingTimeoutId&&bn(n._resetIsScrollingTimeoutId),n._resetIsScrollingTimeoutId=function(e,t){var r=gn(),n={id:requestAnimationFrame((function a(){gn()-r>=t?e.call(null):n.id=requestAnimationFrame(a)}))};return n}(n._resetIsScrolling,150)},n._resetIsScrolling=function(){n._resetIsScrollingTimeoutId=null,n.setState({isScrolling:!1},(function(){n._getItemStyleCache(-1,null)}))},n}(function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,pn(e,t)})(t,e),t.getDerivedStateFromProps=function(e,t){return _n(e,t),u(e),null};var d=t.prototype;return d.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},d.scrollToItem=function(e,t){void 0===t&&(t="auto");var r=this.props,n=r.itemCount,a=r.layout,o=this.state.scrollOffset;e=Math.max(0,Math.min(e,n-1));var s=0;if(this._outerRef){var l=this._outerRef;s="vertical"===a?l.scrollWidth>l.clientWidth?yn():0:l.scrollHeight>l.clientHeight?yn():0}this.scrollTo(i(this.props,e,t,o,this._instanceProps,s))},d.componentDidMount=function(){var e=this.props,t=e.direction,r=e.initialScrollOffset,n=e.layout;if("number"==typeof r&&null!=this._outerRef){var a=this._outerRef;"horizontal"===t||"horizontal"===n?a.scrollLeft=r:a.scrollTop=r}this._callPropsCallbacks()},d.componentDidUpdate=function(){var e=this.props,t=e.direction,r=e.layout,n=this.state,a=n.scrollOffset;if(n.scrollUpdateWasRequested&&null!=this._outerRef){var i=this._outerRef;if("horizontal"===t||"horizontal"===r)if("rtl"===t)switch(On()){case"negative":i.scrollLeft=-a;break;case"positive-ascending":i.scrollLeft=a;break;default:var o=i.clientWidth,s=i.scrollWidth;i.scrollLeft=s-o-a}else i.scrollLeft=a;else i.scrollTop=a}this._callPropsCallbacks()},d.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&bn(this._resetIsScrollingTimeoutId)},d.render=function(){var e=this.props,t=e.children,r=e.className,a=e.direction,i=e.height,o=e.innerRef,s=e.innerElementType,l=e.innerTagName,c=e.itemCount,u=e.itemData,d=e.itemKey,p=void 0===d?wn:d,h=e.layout,m=e.outerElementType,f=e.outerTagName,g=e.style,b=e.useIsScrolling,v=e.width,y=this.state.isScrolling,x="horizontal"===a||"horizontal"===h,O=x?this._onScrollHorizontal:this._onScrollVertical,w=this._getRangeToRender(),S=w[0],_=w[1],P=[];if(c>0)for(var E=S;E<=_;E++)P.push((0,mt.createElement)(t,{data:u,key:p(E,u),index:E,isScrolling:b?y:void 0,style:this._getItemStyle(E)}));var T=n(this.props,this._instanceProps);return(0,mt.createElement)(m||f||"div",{className:r,onScroll:O,ref:this._outerRefSetter,style:un({position:"relative",height:i,width:v,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:a},g)},(0,mt.createElement)(s||l||"div",{children:P,ref:o,style:{height:x?"100%":T,pointerEvents:y?"none":void 0,width:x?T:"100%"}}))},d._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],r=e[1],n=e[2],a=e[3];this._callOnItemsRendered(t,r,n,a)}if("function"==typeof this.props.onScroll){var i=this.state,o=i.scrollDirection,s=i.scrollOffset,l=i.scrollUpdateWasRequested;this._callOnScroll(o,s,l)}},d._getRangeToRender=function(){var e=this.props,t=e.itemCount,r=e.overscanCount,n=this.state,a=n.isScrolling,i=n.scrollDirection,l=n.scrollOffset;if(0===t)return[0,0,0,0];var c=o(this.props,l,this._instanceProps),u=s(this.props,c,l,this._instanceProps),d=a&&"backward"!==i?1:Math.max(1,r),p=a&&"forward"!==i?1:Math.max(1,r);return[Math.max(0,c-d),Math.max(0,Math.min(t-1,u+p)),c,u]},t}(mt.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var _n=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},Pn=Sn({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,r,n,a,i){var o=e.direction,s=e.height,l=e.itemCount,c=e.itemSize,u=e.layout,d=e.width,p="horizontal"===o||"horizontal"===u?d:s,h=Math.max(0,l*c-p),m=Math.min(h,t*c),f=Math.max(0,t*c-p+c+i);switch("smart"===r&&(r=n>=f-p&&n<=m+p?"auto":"center"),r){case"start":return m;case"end":return f;case"center":var g=Math.round(f+(m-f)/2);return g<Math.ceil(p/2)?0:g>h+Math.floor(p/2)?h:g;default:return n>=f&&n<=m?n:n<f?f:m}},getStartIndexForOffset:function(e,t){var r=e.itemCount,n=e.itemSize;return Math.max(0,Math.min(r-1,Math.floor(t/n)))},getStopIndexForStartIndex:function(e,t,r){var n=e.direction,a=e.height,i=e.itemCount,o=e.itemSize,s=e.layout,l=e.width,c=t*o,u="horizontal"===n||"horizontal"===s?l:a,d=Math.ceil((u+r-c)/o);return Math.max(0,Math.min(i-1,t+d-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}});const En={RadioButton:{container:"data-testid radio-button"},Breadcrumbs:{breadcrumb:e=>`data-testid ${e} breadcrumb`},TimePicker:{openButton:"data-testid TimePicker Open Button",overlayContent:"data-testid TimePicker Overlay Content",fromField:"data-testid Time Range from field",toField:"data-testid Time Range to field",applyTimeRange:"data-testid TimePicker submit button",copyTimeRange:"data-testid TimePicker copy button",pasteTimeRange:"data-testid TimePicker paste button",calendar:{label:"data-testid Time Range calendar",openButton:"data-testid Open time range calendar",closeButton:"data-testid Close time range Calendar"},absoluteTimeRangeTitle:"data-testid-absolute-time-range-narrow"},DataSourcePermissions:{form:()=>'form[name="addPermission"]',roleType:"Role to add new permission to",rolePicker:"Built-in role picker",permissionLevel:"Permission Level"},DateTimePicker:{input:"data-testid date-time-input"},DataSource:{TestData:{QueryTab:{scenarioSelectContainer:"Test Data Query scenario select container",scenarioSelect:"Test Data Query scenario select",max:"TestData max",min:"TestData min",noise:"TestData noise",seriesCount:"TestData series count",spread:"TestData spread",startValue:"TestData start value",drop:"TestData drop values"}},DataSourceHttpSettings:{urlInput:"data-testid Datasource HTTP settings url"},Jaeger:{traceIDInput:"Trace ID"},Prometheus:{configPage:{connectionSettings:"Data source connection URL",manageAlerts:"prometheus-alerts-manager",scrapeInterval:"data-testid scrape interval",queryTimeout:"data-testid query timeout",defaultEditor:"data-testid default editor",disableMetricLookup:"disable-metric-lookup",prometheusType:"data-testid prometheus type",prometheusVersion:"data-testid prometheus version",cacheLevel:"data-testid cache level",incrementalQuerying:"prometheus-incremental-querying",queryOverlapWindow:"data-testid query overlap window",disableRecordingRules:"disable-recording-rules",customQueryParameters:"data-testid custom query parameters",httpMethod:"data-testid http method",exemplarsAddButton:"data-testid Add exemplar config button",internalLinkSwitch:"data-testid Internal link switch",codeModeMetricNamesSuggestionLimit:"data-testid code mode metric names suggestion limit"},queryEditor:{explain:"data-testid prometheus explain switch wrapper",editorToggle:"data-testid QueryEditorModeToggle",options:"data-testid prometheus options",legend:"data-testid prometheus legend wrapper",format:"data-testid prometheus format",step:"prometheus-step",type:"data-testid prometheus type",exemplars:"prometheus-exemplars",builder:{metricSelect:"data-testid metric select",hints:"data-testid prometheus hints",metricsExplorer:"data-testid metrics explorer",queryAdvisor:"data-testid query advisor"},code:{queryField:"data-testid prometheus query field",metricsCountInfo:"data-testid metrics count disclaimer",metricsBrowser:{openButton:"data-testid open metrics browser",selectMetric:"data-testid select a metric",seriesLimit:"data-testid series limit",metricList:"data-testid metric list",labelNamesFilter:"data-testid label names filter",labelValuesFilter:"data-testid label values filter",useQuery:"data-testid use query",useAsRateQuery:"data-testid use as rate query",validateSelector:"data-testid validate selector",clear:"data-testid clear"}}},exemplarMarker:"data-testid Exemplar marker",variableQueryEditor:{queryType:"data-testid query type",labelnames:{metricRegex:"data-testid label names metric regex"},labelValues:{labelSelect:"data-testid label values label select"},metricNames:{metricRegex:"data-testid metric names metric regex"},varQueryResult:"data-testid variable query result",seriesQuery:"data-testid prometheus series query",classicQuery:"data-testid prometheus classic query"},annotations:{minStep:"prometheus-annotation-min-step",title:"data-testid prometheus annotation title",tags:"data-testid prometheus annotation tags",text:"data-testid prometheus annotation text",seriesValueAsTimestamp:"data-testid prometheus annotation series value as timestamp"}}},Menu:{MenuComponent:e=>`${e} menu`,MenuGroup:e=>`${e} menu group`,MenuItem:e=>`${e} menu item`,SubMenu:{container:"data-testid SubMenu container",icon:"data-testid SubMenu icon"}},Panels:{Panel:{title:e=>`data-testid Panel header ${e}`,content:"data-testid panel content",headerItems:e=>`data-testid Panel header item ${e}`,menuItems:e=>`data-testid Panel menu item ${e}`,menu:e=>`data-testid Panel menu ${e}`,containerByTitle:e=>`${e} panel`,headerCornerInfo:e=>`Panel header ${e}`,status:e=>`data-testid Panel status ${e}`,loadingBar:()=>"Panel loading bar",HoverWidget:{container:"data-testid hover-header-container",dragIcon:"data-testid drag-icon"},PanelDataErrorMessage:"data-testid Panel data error message"},Visualization:{Graph:{container:"Graph container",VisualizationTab:{legendSection:"Legend section"},Legend:{legendItemAlias:e=>`gpl alias ${e}`,showLegendSwitch:"gpl show legend"},xAxis:{labels:()=>"div.flot-x-axis > div.flot-tick-label"}},BarGauge:{value:"Bar gauge value",valueV2:"data-testid Bar gauge value"},PieChart:{svgSlice:"data testid Pie Chart Slice"},Text:{container:()=>".markdown-html"},Table:{header:"table header",footer:"table-footer",body:"data-testid table body"}}},VizLegend:{seriesName:e=>`data-testid VizLegend series ${e}`},Drawer:{General:{title:e=>`Drawer title ${e}`,expand:"Drawer expand",contract:"Drawer contract",close:"data-testid Drawer close",rcContentWrapper:()=>".rc-drawer-content-wrapper",subtitle:"data-testid drawer subtitle"},DashboardSaveDrawer:{saveButton:"data-testid Save dashboard drawer button",saveAsButton:"data-testid Save as dashboard drawer button",saveAsTitleInput:"Save dashboard title field"}},PanelEditor:{General:{content:"data-testid Panel editor content"},OptionsPane:{content:"data-testid Panel editor option pane content",select:"Panel editor option pane select",fieldLabel:e=>`${e} field property editor`,fieldInput:e=>`data-testid Panel editor option pane field input ${e}`},DataPane:{content:"data-testid Panel editor data pane content"},applyButton:"data-testid Apply changes and go back to dashboard",toggleVizPicker:"data-testid toggle-viz-picker",toggleVizOptions:"data-testid toggle-viz-options",toggleTableView:"data-testid toggle-table-view",showZoomField:"Map controls Show zoom control field property editor",showAttributionField:"Map controls Show attribution field property editor",showScaleField:"Map controls Show scale field property editor",showMeasureField:"Map controls Show measure tools field property editor",showDebugField:"Map controls Show debug field property editor",measureButton:"show measure tools"},PanelInspector:{Data:{content:"Panel inspector Data content"},Stats:{content:"Panel inspector Stats content"},Json:{content:"data-testid Panel inspector Json content"},Query:{content:"Panel inspector Query content",refreshButton:"Panel inspector Query refresh button",jsonObjectKeys:()=>".json-formatter-key"}},Tab:{title:e=>`data-testid Tab ${e}`,active:()=>'[class*="-activeTabStyle"]'},RefreshPicker:{runButton:"RefreshPicker run button",intervalButton:"RefreshPicker interval button",runButtonV2:"data-testid RefreshPicker run button",intervalButtonV2:"data-testid RefreshPicker interval button"},QueryTab:{content:"Query editor tab content",queryInspectorButton:"Query inspector button",queryHistoryButton:"data-testid query-history-button",addQuery:"data-testid query-tab-add-query",queryGroupTopSection:"data-testid query group top section",addExpression:"data-testid query-tab-add-expression"},QueryHistory:{queryText:"Query text"},QueryEditorRows:{rows:"Query editor row"},QueryEditorRow:{actionButton:e=>`data-testid ${e}`,title:e=>`Query editor row title ${e}`,container:e=>`Query editor row ${e}`},AlertTab:{content:"data-testid Alert editor tab content"},AlertRules:{groupToggle:"data-testid group-collapse-toggle",toggle:"data-testid collapse-toggle",expandedContent:"data-testid expanded-content",previewButton:"data-testid alert-rule preview-button",ruleNameField:"data-testid alert-rule name-field",newFolderButton:"data-testid alert-rule new-folder-button",newFolderNameField:"data-testid alert-rule name-folder-name-field",newFolderNameCreateButton:"data-testid alert-rule name-folder-name-create-button",newEvaluationGroupButton:"data-testid alert-rule new-evaluation-group-button",newEvaluationGroupName:"data-testid alert-rule new-evaluation-group-name",newEvaluationGroupInterval:"data-testid alert-rule new-evaluation-group-interval",newEvaluationGroupCreate:"data-testid alert-rule new-evaluation-group-create-button"},Alert:{alert:e=>`Alert ${e}`,alertV2:e=>`data-testid Alert ${e}`},TransformTab:{content:"data-testid Transform editor tab content",newTransform:e=>`data-testid New transform ${e}`,transformationEditor:e=>`data-testid Transformation editor ${e}`,transformationEditorDebugger:e=>`data-testid Transformation editor debugger ${e}`},Transforms:{card:e=>`data-testid New transform ${e}`,disableTransformationButton:"data-testid Disable transformation button",Reduce:{modeLabel:"data-testid Transform mode label",calculationsLabel:"data-testid Transform calculations label"},SpatialOperations:{actionLabel:"root Action field property editor",locationLabel:"root Location Mode field property editor",location:{autoOption:"Auto location option",coords:{option:"Coords location option",latitudeFieldLabel:"root Latitude field field property editor",longitudeFieldLabel:"root Longitude field field property editor"},geohash:{option:"Geohash location option",geohashFieldLabel:"root Geohash field field property editor"},lookup:{option:"Lookup location option",lookupFieldLabel:"root Lookup field field property editor",gazetteerFieldLabel:"root Gazetteer field property editor"}}},searchInput:"data-testid search transformations",noTransformationsMessage:"data-testid no transformations message",addTransformationButton:"data-testid add transformation button",removeAllTransformationsButton:"data-testid remove all transformations button"},NavBar:{Configuration:{button:"Configuration"},Toggle:{button:"data-testid Toggle menu"},Reporting:{button:"Reporting"}},NavMenu:{Menu:"data-testid navigation mega-menu",item:"data-testid Nav menu item"},NavToolbar:{container:"data-testid Nav toolbar",shareDashboard:"data-testid Share dashboard",markAsFavorite:"data-testid Mark as favorite",editDashboard:{editButton:"data-testid Edit dashboard button",saveButton:"data-testid Save dashboard button",exitButton:"data-testid Exit edit mode button",settingsButton:"data-testid Dashboard settings",addRowButton:"data-testid Add row button",addLibraryPanelButton:"data-testid Add a panel from the panel library button",addVisualizationButton:"data-testid Add new visualization menu item",pastePanelButton:"data-testid Paste panel button",discardChangesButton:"data-testid Discard changes button",discardLibraryPanelButton:"data-testid Discard library panel button",unlinkLibraryPanelButton:"data-testid Unlink library panel button",saveLibraryPanelButton:"data-testid Save library panel button",backToDashboardButton:"data-testid Back to dashboard button"}},PageToolbar:{container:()=>".page-toolbar",item:e=>`${e}`,itemButton:e=>`data-testid ${e}`},QueryEditorToolbarItem:{button:e=>`QueryEditor toolbar item button ${e}`},BackButton:{backArrow:"data-testid Go Back"},OptionsGroup:{group:e=>e?`data-testid Options group ${e}`:"data-testid Options group",toggle:e=>e?`data-testid Options group ${e} toggle`:"data-testid Options group toggle"},PluginVisualization:{item:e=>`Plugin visualization item ${e}`,current:()=>'[class*="-currentVisualizationItem"]'},Select:{option:"data-testid Select option",input:()=>'input[id*="time-options-input"]',singleValue:()=>'div[class*="-singleValue"]'},FieldConfigEditor:{content:"Field config editor content"},OverridesConfigEditor:{content:"Field overrides editor content"},FolderPicker:{container:"Folder picker select container",containerV2:"data-testid Folder picker select container",input:"data-testid folder-picker-input"},ReadonlyFolderPicker:{container:"data-testid Readonly folder picker select container"},DataSourcePicker:{container:"data-testid Data source picker select container",input:()=>'input[id="data-source-picker"]',inputV2:"data-testid Select a data source",dataSourceList:"data-testid Data source list dropdown",advancedModal:{dataSourceList:"data-testid Data source list",builtInDataSourceList:"data-testid Built in data source list"}},TimeZonePicker:{container:"Time zone picker select container",containerV2:"data-testid Time zone picker select container",changeTimeSettingsButton:"data-testid Time zone picker Change time settings button"},WeekStartPicker:{container:"Choose starting day of the week",containerV2:"data-testid Choose starting day of the week",placeholder:"Choose starting day of the week"},TraceViewer:{spanBar:"data-testid SpanBar--wrapper"},QueryField:{container:"data-testid Query field"},QueryBuilder:{queryPatterns:"data-testid Query patterns",labelSelect:"data-testid Select label",inputSelect:"data-testid Select label-input",valueSelect:"data-testid Select value",matchOperatorSelect:"data-testid Select match operator"},ValuePicker:{button:e=>`data-testid Value picker button ${e}`,select:e=>`data-testid Value picker select ${e}`},Search:{section:"Search section",sectionV2:"data-testid Search section",items:"Search items",itemsV2:"data-testid Search items",cards:"data-testid Search cards",collapseFolder:e=>`data-testid Collapse folder ${e}`,expandFolder:e=>`data-testid Expand folder ${e}`,dashboardItem:e=>`${En.Search.dashboardItems} ${e}`,dashboardCard:e=>`data-testid Search card ${e}`,folderHeader:e=>`data-testid Folder header ${e}`,folderContent:e=>`data-testid Folder content ${e}`,dashboardItems:"data-testid Dashboard search item"},DashboardLinks:{container:"data-testid Dashboard link container",dropDown:"data-testid Dashboard link dropdown",link:"data-testid Dashboard link"},LoadingIndicator:{icon:"data-testid Loading indicator"},CallToActionCard:{button:e=>`Call to action button ${e}`,buttonV2:e=>`data-testid Call to action button ${e}`},DataLinksContextMenu:{singleLink:"data-testid Data link"},CodeEditor:{container:"data-testid Code editor container"},ReactMonacoEditor:{editorLazy:"data-testid ReactMonacoEditor editorLazy"},DashboardImportPage:{textarea:"data-testid-import-dashboard-textarea",submit:"data-testid-load-dashboard"},ImportDashboardForm:{name:"data-testid-import-dashboard-title",submit:"data-testid-import-dashboard-submit"},PanelAlertTabContent:{content:"data-testid Unified alert editor tab content"},VisualizationPreview:{card:e=>`data-testid suggestion-${e}`},ColorSwatch:{name:"data-testid-colorswatch"},DashboardRow:{title:e=>`data-testid dashboard-row-title-${e}`},UserProfile:{profileSaveButton:"data-testid-user-profile-save",preferencesSaveButton:"data-testid-shared-prefs-save",orgsTable:"data-testid-user-orgs-table",sessionsTable:"data-testid-user-sessions-table",extensionPointTabs:"data-testid-extension-point-tabs",extensionPointTab:e=>`data-testid-extension-point-tab-${e}`},FileUpload:{inputField:"data-testid-file-upload-input-field",fileNameSpan:"data-testid-file-upload-file-name"},DebugOverlay:{wrapper:"debug-overlay"},OrgRolePicker:{input:"Role"},AnalyticsToolbarButton:{button:"Dashboard insights"},Variables:{variableOption:"data-testid variable-option",variableLinkWrapper:"data-testid variable-link-wrapper"},Annotations:{annotationsTypeInput:"data-testid annotations-type-input",annotationsChoosePanelInput:"data-testid choose-panels-input",editor:{testButton:"data-testid annotations-test-button",resultContainer:"data-testid annotations-query-result-container"}},Tooltip:{container:"data-testid tooltip"},ReturnToPrevious:{buttonGroup:"data-testid dismissable button group",backButton:"data-testid back",dismissButton:"data-testid dismiss"},SQLQueryEditor:{selectColumn:"data-testid select-column",selectAggregation:"data-testid select-aggregation",selectAlias:"data-testid select-alias",filterConjunction:"data-testid filter-conjunction",filterField:"data-testid filter-field",filterOperator:"data-testid filter-operator",headerTableSelector:"data-testid header-table-selector",headerFilterSwitch:"data-testid header-filter-switch",headerGroupSwitch:"data-testid header-group-switch",headerOrderSwitch:"data-testid header-order-switch",headerPreviewSwitch:"data-testid header-preview-switch"},EntityNotFound:{container:"data-testid entity-not-found"}},Tn={pages:{Login:{url:"/login",username:"data-testid Username input field",password:"data-testid Password input field",submit:"data-testid Login button",skip:"data-testid Skip change password button"},Home:{url:"/"},DataSource:{name:"data-testid Data source settings page name input field",delete:"Data source settings page Delete button",readOnly:"data-testid Data source settings page read only message",saveAndTest:"data-testid Data source settings page Save and Test button",alert:"data-testid Data source settings page Alert"},DataSources:{url:"/datasources",dataSources:e=>`Data source list item ${e}`},EditDataSource:{url:e=>`/datasources/edit/${e}`,settings:"Datasource settings page basic settings"},AddDataSource:{url:"/datasources/new",dataSourcePlugins:e=>`Data source plugin item ${e}`,dataSourcePluginsV2:e=>`Add new data source ${e}`},ConfirmModal:{delete:"data-testid Confirm Modal Danger Button"},AddDashboard:{url:"/dashboard/new",itemButton:e=>`data-testid ${e}`,addNewPanel:"data-testid Add new panel",addNewRow:"data-testid Add new row",addNewPanelLibrary:"data-testid Add new panel from panel library"},Dashboard:{url:e=>`/d/${e}`,DashNav:{nav:"Dashboard navigation",navV2:"data-testid Dashboard navigation",publicDashboardTag:"data-testid public dashboard tag",shareButton:"data-testid share-button",scrollContainer:"data-testid Dashboard canvas scroll container",newShareButton:{container:"data-testid new share button",shareLink:"data-testid new share link-button",arrowMenu:"data-testid new share button arrow menu",menu:{container:"data-testid new share button menu",shareInternally:"data-testid new share button share internally",shareExternally:"data-testid new share button share externally",shareSnapshot:"data-testid new share button share snapshot"}},NewExportButton:{container:"data-testid new export button",arrowMenu:"data-testid new export button arrow menu",Menu:{container:"data-testid new export button menu",exportAsJson:"data-testid new export button export as json"}},playlistControls:{prev:"data-testid playlist previous dashboard button",stop:"data-testid playlist stop dashboard button",next:"data-testid playlist next dashboard button"}},Controls:"data-testid dashboard controls",SubMenu:{submenu:"Dashboard submenu",submenuItem:"data-testid template variable",submenuItemLabels:e=>`data-testid Dashboard template variables submenu Label ${e}`,submenuItemValueDropDownValueLinkTexts:e=>`data-testid Dashboard template variables Variable Value DropDown value link text ${e}`,submenuItemValueDropDownDropDown:"Variable options",submenuItemValueDropDownOptionTexts:e=>`data-testid Dashboard template variables Variable Value DropDown option text ${e}`,Annotations:{annotationsWrapper:"data-testid annotation-wrapper",annotationLabel:e=>`data-testid Dashboard annotations submenu Label ${e}`,annotationToggle:e=>`data-testid Dashboard annotations submenu Toggle ${e}`}},Settings:{Actions:{close:"data-testid dashboard-settings-close"},General:{deleteDashBoard:"data-testid Dashboard settings page delete dashboard button",sectionItems:e=>`Dashboard settings section item ${e}`,saveDashBoard:"Dashboard settings aside actions Save button",saveAsDashBoard:"Dashboard settings aside actions Save As button",timezone:"Time zone picker select container",title:"General"},Annotations:{List:{addAnnotationCTA:En.CallToActionCard.button("Add annotation query"),addAnnotationCTAV2:En.CallToActionCard.buttonV2("Add annotation query"),annotations:"data-testid list-annotations"},Settings:{name:"data-testid Annotations settings name input"},NewAnnotation:{panelFilterSelect:"data-testid annotations-panel-filter",showInLabel:"data-testid show-in-label",previewInDashboard:"data-testid annotations-preview",delete:"data-testid annotations-delete",apply:"data-testid annotations-apply",enable:"data-testid annotation-enable",hide:"data-testid annotation-hide"}},Variables:{List:{addVariableCTA:En.CallToActionCard.button("Add variable"),addVariableCTAV2:En.CallToActionCard.buttonV2("Add variable"),newButton:"Variable editor New variable button",table:"Variable editor Table",tableRowNameFields:e=>`Variable editor Table Name field ${e}`,tableRowDefinitionFields:e=>`Variable editor Table Definition field ${e}`,tableRowArrowUpButtons:e=>`Variable editor Table ArrowUp button ${e}`,tableRowArrowDownButtons:e=>`Variable editor Table ArrowDown button ${e}`,tableRowDuplicateButtons:e=>`Variable editor Table Duplicate button ${e}`,tableRowRemoveButtons:e=>`Variable editor Table Remove button ${e}`},Edit:{General:{headerLink:"Variable editor Header link",modeLabelNew:"Variable editor Header mode New",modeLabelEdit:"Variable editor Header mode Edit",generalNameInput:"Variable editor Form Name field",generalNameInputV2:"data-testid Variable editor Form Name field",generalTypeSelect:"Variable editor Form Type select",generalTypeSelectV2:"data-testid Variable editor Form Type select",generalLabelInput:"Variable editor Form Label field",generalLabelInputV2:"data-testid Variable editor Form Label field",generalHideSelect:"Variable editor Form Hide select",generalHideSelectV2:"data-testid Variable editor Form Hide select",selectionOptionsMultiSwitch:"data-testid Variable editor Form Multi switch",selectionOptionsIncludeAllSwitch:"data-testid Variable editor Form IncludeAll switch",selectionOptionsCustomAllInput:"data-testid Variable editor Form IncludeAll field",previewOfValuesOption:"data-testid Variable editor Preview of Values option",submitButton:"data-testid Variable editor Run Query button",applyButton:"data-testid Variable editor Apply button"},QueryVariable:{queryOptionsDataSourceSelect:En.DataSourcePicker.inputV2,queryOptionsRefreshSelect:"Variable editor Form Query Refresh select",queryOptionsRefreshSelectV2:"data-testid Variable editor Form Query Refresh select",queryOptionsRegExInput:"Variable editor Form Query RegEx field",queryOptionsRegExInputV2:"data-testid Variable editor Form Query RegEx field",queryOptionsSortSelect:"Variable editor Form Query Sort select",queryOptionsSortSelectV2:"data-testid Variable editor Form Query Sort select",queryOptionsQueryInput:"data-testid Variable editor Form Default Variable Query Editor textarea",valueGroupsTagsEnabledSwitch:"Variable editor Form Query UseTags switch",valueGroupsTagsTagsQueryInput:"Variable editor Form Query TagsQuery field",valueGroupsTagsTagsValuesQueryInput:"Variable editor Form Query TagsValuesQuery field"},ConstantVariable:{constantOptionsQueryInput:"Variable editor Form Constant Query field",constantOptionsQueryInputV2:"data-testid Variable editor Form Constant Query field"},DatasourceVariable:{datasourceSelect:"data-testid datasource variable datasource type"},TextBoxVariable:{textBoxOptionsQueryInput:"Variable editor Form TextBox Query field",textBoxOptionsQueryInputV2:"data-testid Variable editor Form TextBox Query field"},CustomVariable:{customValueInput:"data-testid custom-variable-input"},IntervalVariable:{intervalsValueInput:"data-testid interval variable intervals input",autoEnabledCheckbox:"data-testid interval variable auto value checkbox",stepCountIntervalSelect:"data-testid interval variable step count input",minIntervalInput:"data-testid interval variable mininum interval input"},GroupByVariable:{dataSourceSelect:En.DataSourcePicker.inputV2,infoText:"data-testid group by variable info text",modeToggle:"data-testid group by variable mode toggle"},AdHocFiltersVariable:{datasourceSelect:En.DataSourcePicker.inputV2,infoText:"data-testid ad-hoc filters variable info text",modeToggle:"data-testid ad-hoc filters variable mode toggle"}}}},Annotations:{marker:"data-testid annotation-marker"},Rows:{Repeated:{ConfigSection:{warningMessage:"data-testid Repeated rows warning message"}}}},Dashboards:{url:"/dashboards",dashboards:e=>`Dashboard search item ${e}`},SaveDashboardAsModal:{newName:"Save dashboard title field",save:"Save dashboard button"},SaveDashboardModal:{save:"Dashboard settings Save Dashboard Modal Save button",saveVariables:"Dashboard settings Save Dashboard Modal Save variables checkbox",saveTimerange:"Dashboard settings Save Dashboard Modal Save timerange checkbox",saveRefresh:"Dashboard settings Save Dashboard Modal Save refresh checkbox"},SharePanelModal:{linkToRenderedImage:"Link to rendered image"},ShareDashboardModal:{PublicDashboard:{WillBePublicCheckbox:"data-testid public dashboard will be public checkbox",LimitedDSCheckbox:"data-testid public dashboard limited datasources checkbox",CostIncreaseCheckbox:"data-testid public dashboard cost may increase checkbox",PauseSwitch:"data-testid public dashboard pause switch",EnableAnnotationsSwitch:"data-testid public dashboard on off switch for annotations",CreateButton:"data-testid public dashboard create button",DeleteButton:"data-testid public dashboard delete button",CopyUrlInput:"data-testid public dashboard copy url input",CopyUrlButton:"data-testid public dashboard copy url button",SettingsDropdown:"data-testid public dashboard settings dropdown",TemplateVariablesWarningAlert:"data-testid public dashboard disabled template variables alert",UnsupportedDataSourcesWarningAlert:"data-testid public dashboard unsupported data sources alert",NoUpsertPermissionsWarningAlert:"data-testid public dashboard no upsert permissions alert",EnableTimeRangeSwitch:"data-testid public dashboard on off switch for time range",EmailSharingConfiguration:{Container:"data-testid email sharing config container",ShareType:"data-testid public dashboard share type",EmailSharingInput:"data-testid public dashboard email sharing input",EmailSharingInviteButton:"data-testid public dashboard email sharing invite button",EmailSharingList:"data-testid public dashboard email sharing list",DeleteEmail:"data-testid public dashboard delete email button",ReshareLink:"data-testid public dashboard reshare link button"}},SnapshotScene:{url:e=>`/dashboard/snapshot/${e}`,PublishSnapshot:"data-testid publish snapshot button",CopyUrlButton:"data-testid snapshot copy url button",CopyUrlInput:"data-testid snapshot copy url input"}},ShareDashboardDrawer:{ShareExternally:{container:"data-testid share externally drawer container",copyUrlButton:"data-testid share externally copy url button",shareTypeSelect:"data-testid share externally share type select"},ShareSnapshot:{container:"data-testid share snapshot drawer container"}},ExportDashboardDrawer:{ExportAsJson:{container:"data-testid export as Json drawer container",codeEditor:"data-testid export as Json code editor",exportExternallyToggle:"data-testid export externally toggle type select",saveToFileButton:"data-testid save to file button",copyToClipboardButton:"data-testid copy to clipboard button",cancelButton:"data-testid cancel button"}},PublicDashboard:{page:"public-dashboard-page",NotAvailable:{container:"public-dashboard-not-available",title:"public-dashboard-title",pausedDescription:"public-dashboard-paused-description"},footer:"public-dashboard-footer"},PublicDashboardScene:{loadingPage:"public-dashboard-scene-loading-page",page:"public-dashboard-scene-page",controls:"public-dashboard-controls"},RequestViewAccess:{form:"request-view-access-form",recipientInput:"request-view-access-recipient-input",submitButton:"request-view-access-submit-button"},PublicDashboardConfirmAccess:{submitButton:"data-testid confirm-access-submit-button"},Explore:{url:"/explore",General:{container:"data-testid Explore",graph:"Explore Graph",table:"Explore Table",scrollView:"data-testid explorer scroll view"},QueryHistory:{container:"data-testid QueryHistory"}},SoloPanel:{url:e=>`/d-solo/${e}`},PluginsList:{page:"Plugins list page",list:"Plugins list",listItem:"Plugins list item",signatureErrorNotice:"data-testid Unsigned plugins notice"},PluginPage:{page:"Plugin page",signatureInfo:"data-testid Plugin signature info",disabledInfo:"data-testid Plugin disabled info"},PlaylistForm:{name:"Playlist name",interval:"Playlist interval",itemDelete:"data-testid playlist-form-delete-item"},BrowseDashboards:{table:{body:"data-testid browse-dashboards-table",row:e=>`data-testid browse dashboards row ${e}`,checkbox:e=>`data-testid ${e} checkbox`},NewFolderForm:{form:"data-testid new folder form",nameInput:"data-testid new-folder-name-input",createButton:"data-testid new-folder-create-button"}},Search:{url:"/?search=openn",FolderView:{url:"/?search=open&layout=folders"}},PublicDashboards:{ListItem:{linkButton:"public-dashboard-link-button",configButton:"public-dashboard-configuration-button",trashcanButton:"public-dashboard-remove-button",pauseSwitch:"data-testid public dashboard pause switch"}},UserListPage:{tabs:{allUsers:"data-testid all-users-tab",orgUsers:"data-testid org-users-tab",anonUserDevices:"data-testid anon-user-devices-tab",publicDashboardsUsers:"data-testid public-dashboards-users-tab",users:"data-testid users-tab"},org:{url:"/org/users"},admin:{url:"/admin/users"},publicDashboards:{container:"data-testid public-dashboards-users-list"},UserListAdminPage:{container:"data-testid user-list-admin-page"},UsersListPage:{container:"data-testid users-list-page"},UserAnonListPage:{container:"data-testid user-anon-list-page"},UsersListPublicDashboardsPage:{container:"data-testid users-list-public-dashboards-page",DashboardsListModal:{listItem:e=>`data-testid dashboards-list-item-${e}`}}},ProfilePage:{url:"/profile"}},components:En};var Cn=Object.defineProperty,In=Object.defineProperties,jn=Object.getOwnPropertyDescriptors,$n=Object.getOwnPropertySymbols,Dn=Object.prototype.hasOwnProperty,kn=Object.prototype.propertyIsEnumerable,Rn=(e,t,r)=>t in e?Cn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,An=(e,t)=>{for(var r in t||(t={}))Dn.call(t,r)&&Rn(e,r,t[r]);if($n)for(var r of $n(t))kn.call(t,r)&&Rn(e,r,t[r]);return e},Nn=(e,t)=>In(e,jn(t)),Ln=(e,t,r)=>(Rn(e,"symbol"!=typeof t?t+"":t,r),r);const Mn="{}",Fn="__name__",Bn="40000",qn="none";function Qn(e){let t="";const r=[];for(const n of e)if((n.name===Fn||n.selected)&&n.values&&n.values.length>0){const e=n.values.filter((e=>e.selected)).map((e=>e.name));e.length>1?r.push(`${n.name}=~"${e.map(os).join("|")}"`):1===e.length&&(n.name===Fn?t=e[0]:r.push(`${n.name}="${is(e[0])}"`))}return[t,"{",r.join(","),"}"].join("")}const Vn=(0,bt.stylesFactory)((e=>({wrapper:(0,Nr.css)({backgroundColor:e.colors.background.secondary,padding:e.spacing(1),width:"100%"}),list:(0,Nr.css)({marginTop:e.spacing(1),display:"flex",flexWrap:"wrap",maxHeight:"200px",overflow:"auto",alignContent:"flex-start"}),section:(0,Nr.css)({"& + &":{margin:`${e.spacing(2)} 0`},position:"relative"}),selector:(0,Nr.css)({fontFamily:e.typography.fontFamilyMonospace,marginBottom:e.spacing(1)}),status:(0,Nr.css)({padding:e.spacing(.5),color:e.colors.text.secondary,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",width:"50%",right:0,textAlign:"right",opacity:0,[e.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 100ms linear"}}),statusShowing:(0,Nr.css)({opacity:1}),error:(0,Nr.css)({color:e.colors.error.main}),valueList:(0,Nr.css)({marginRight:e.spacing(1),resize:"horizontal"}),valueListWrapper:(0,Nr.css)({borderLeft:`1px solid ${e.colors.border.medium}`,margin:`${e.spacing(1)} 0`,padding:`${e.spacing(1)} 0 ${e.spacing(1)} ${e.spacing(1)}`}),valueListArea:(0,Nr.css)({display:"flex",flexWrap:"wrap",marginTop:e.spacing(1)}),valueTitle:(0,Nr.css)({marginLeft:`-${e.spacing(.5)}`,marginBottom:e.spacing(1)}),validationStatus:(0,Nr.css)({padding:e.spacing(.5),marginBottom:e.spacing(1),color:e.colors.text.maxContrast,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})})));class Wn extends mt.Component{constructor(){super(...arguments),Ln(this,"valueListsRef",mt.createRef()),Ln(this,"state",{labels:[],labelSearchTerm:"",metricSearchTerm:"",status:"Ready",error:"",validationStatus:"",valueSearchTerm:""}),Ln(this,"onChangeLabelSearch",(e=>{this.setState({labelSearchTerm:e.target.value})})),Ln(this,"onChangeMetricSearch",(e=>{this.setState({metricSearchTerm:e.target.value})})),Ln(this,"onChangeSeriesLimit",(e=>{this.setState({seriesLimit:e.target.value.trim()})})),Ln(this,"onChangeValueSearch",(e=>{this.setState({valueSearchTerm:e.target.value})})),Ln(this,"onClickRunQuery",(()=>{const e=Qn(this.state.labels);this.props.onChange(e)})),Ln(this,"onClickRunRateQuery",(()=>{const e=`rate(${Qn(this.state.labels)}[$__rate_interval])`;this.props.onChange(e)})),Ln(this,"onClickClear",(()=>{this.setState((e=>({labels:e.labels.map((e=>Nn(An({},e),{values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0}))),labelSearchTerm:"",metricSearchTerm:"",status:"",error:"",validationStatus:"",valueSearchTerm:""}))),this.props.deleteLastUsedLabels(),this.fetchValues(Fn,Mn)})),Ln(this,"onClickLabel",((e,t,r)=>{const n=this.state.labels.find((t=>t.name===e));if(!n)return;const a=!n.selected;let i={selected:a};if(n.values&&!a){const e=n.values.map((e=>Nn(An({},e),{selected:!1})));i=Nn(An({},i),{facets:0,values:e})}this.setState({labelSearchTerm:""}),this.updateLabelState(e,i,"",(()=>this.doFacettingForLabel(e)))})),Ln(this,"onClickValue",((e,t,r)=>{const n=this.state.labels.find((t=>t.name===e));if(!n||!n.values)return;this.setState({labelSearchTerm:""});const a=n.values.map((e=>Nn(An({},e),{selected:e.name===t?!e.selected:e.selected})));this.updateLabelState(e,{values:a},"",(()=>this.doFacetting(e)))})),Ln(this,"onClickMetric",((e,t,r)=>{const n=this.state.labels.find((t=>t.name===e));if(!n||!n.values)return;this.setState({metricSearchTerm:""});const a=n.values.map((e=>Nn(An({},e),{selected:e.name===t||e.selected?!e.selected:e.selected}))),i=a.some((e=>e.selected));this.updateLabelState(e,{selected:i,values:a},"",(()=>this.doFacetting(e)))})),Ln(this,"onClickValidate",(()=>{const e=Qn(this.state.labels);this.validateSelector(e)})),Ln(this,"doFacetting",(e=>{const t=Qn(this.state.labels);if(t===Mn){const e=this.state.labels.map((e=>Nn(An({},e),{facets:0,values:void 0,hidden:!1})));this.setState({labels:e},(()=>{this.state.labels.forEach((e=>(e.selected||e.name===Fn)&&this.fetchValues(e.name,t)))}))}else this.fetchSeries(t,e)}))}updateLabelState(e,t,r="",n){this.setState((n=>{const a=n.labels.map((r=>r.name===e?An(An({},r),t):r)),i=r?"":n.error;return{labels:a,status:r,error:i,validationStatus:""}}),n)}componentDidMount(){const{languageProvider:e,lastUsedLabels:t}=this.props;if(e){const r=t;e.start(this.props.timeRange).then((()=>{let t=e.getLabelKeys();this.fetchValues(Fn,Mn);const n=t.map(((e,t,n)=>({name:e,selected:r.includes(e),loading:!1})));this.setState({labels:n},(()=>{this.state.labels.forEach((e=>{e.selected&&this.fetchValues(e.name,Mn)}))}))}))}}doFacettingForLabel(e){const t=this.state.labels.find((t=>t.name===e));if(!t)return;const r=this.state.labels.filter((e=>e.selected)).map((e=>e.name));this.props.storeLastUsedLabels(r),t.selected?t.values||this.fetchValues(e,Qn(this.state.labels)):this.doFacetting()}async fetchValues(e,t){const{languageProvider:r}=this.props;this.updateLabelState(e,{loading:!0},`Fetching values for ${e}`);try{let n=await r.getLabelValues(e);if(t!==Qn(this.state.labels))return void this.updateLabelState(e,{loading:!1});const a=[],{metricsMetadata:i}=r;for(const t of n){const r={name:t};if(e===Fn&&i){const e=i[t];e&&(r.details=`(${e.type}) ${e.help}`)}a.push(r)}this.updateLabelState(e,{values:a,loading:!1})}catch(e){console.error(e)}}async fetchSeries(e,t){const{languageProvider:r}=this.props;t&&this.updateLabelState(t,{loading:!0},`Facetting labels for ${e}`);try{const n=await r.fetchSeriesLabels(e,!0,this.state.seriesLimit);if(e!==Qn(this.state.labels))return void(t&&this.updateLabelState(t,{loading:!1}));if(0===Object.keys(n).length)return void this.setState({error:`Empty results, no matching label for ${e}`});const a=function(e,t,r){return e.map((e=>{var n;const a=t[e.name];if(a){let t;if(e.name===r&&e.values)t=e.values;else{const r=new Set((null==(n=e.values)?void 0:n.filter((e=>e.selected)).map((e=>e.name)))||[]);t=a.map((e=>({name:e,selected:r.has(e)})))}return Nn(An({},e),{loading:!1,values:t,hidden:!a,facets:t.length})}return Nn(An({},e),{loading:!1,hidden:!a,values:void 0,facets:0})}))}(this.state.labels,n,t);this.setState({labels:a,error:""}),t&&this.updateLabelState(t,{loading:!1})}catch(e){console.error(e)}}async validateSelector(e){const{languageProvider:t}=this.props;this.setState({validationStatus:`Validating selector ${e}`,error:""});const r=await t.fetchSeries(e);this.setState({validationStatus:`Selector is valid (${r.length} series found)`})}render(){var e,t,r;const{theme:n}=this.props,{labels:a,labelSearchTerm:i,metricSearchTerm:o,status:s,error:l,validationStatus:c,valueSearchTerm:u}=this.state,d=Vn(n);if(0===a.length)return(0,ht.jsx)("div",{className:d.wrapper,children:(0,ht.jsx)(bt.LoadingPlaceholder,{text:"Loading labels..."})});let p=a.find((e=>e.name===Fn));p&&o&&(p=Nn(An({},p),{values:null==(e=p.values)?void 0:e.filter((e=>e.selected||e.name.includes(o)))}));let h=a.filter((e=>!e.hidden&&e.name!==Fn));i&&(h=h.filter((e=>e.selected||e.name.includes(i))));let m=h.filter((e=>e.selected&&e.values));u&&(m=m.map((e=>{var t;return Nn(An({},e),{values:null==(t=e.values)?void 0:t.filter((e=>e.selected||e.name.includes(u)))})})));const f=Qn(this.state.labels),g=f===Mn,b=(null==(t=null==p?void 0:p.values)?void 0:t.length)||0;return(0,ht.jsxs)("div",{className:d.wrapper,children:[(0,ht.jsxs)(bt.Stack,{gap:3,children:[(0,ht.jsx)("div",{children:(0,ht.jsxs)("div",{className:d.section,children:[(0,ht.jsx)(bt.Label,{description:"Once a metric is selected only possible labels are shown. Labels are limited by the series limit below.",children:"1. Select a metric"}),(0,ht.jsx)("div",{children:(0,ht.jsx)(bt.Input,{onChange:this.onChangeMetricSearch,"aria-label":"Filter expression for metric",value:o,"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.selectMetric})}),(0,ht.jsx)(bt.Label,{description:"Set to 'none' to remove limit and show all labels for a selected metric. Removing the limit may cause performance issues.",children:"Series limit"}),(0,ht.jsx)("div",{children:(0,ht.jsx)(bt.Input,{onChange:this.onChangeSeriesLimit,"aria-label":"Limit results from series endpoint",value:null!=(r=this.state.seriesLimit)?r:Bn,"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.seriesLimit})}),(0,ht.jsx)("div",{role:"list",className:d.valueListWrapper,"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.metricList,children:(0,ht.jsx)(Pn,{height:Math.min(450,25*b),itemCount:b,itemSize:25,itemKey:e=>p.values[e].name,width:300,className:d.valueList,children:({index:e,style:t})=>{var r;const n=null==(r=null==p?void 0:p.values)?void 0:r[e];return n?(0,ht.jsx)("div",{style:t,children:(0,ht.jsx)(bt.BrowserLabel,{name:p.name,value:null==n?void 0:n.name,title:n.details,active:null==n?void 0:n.selected,onClick:this.onClickMetric,searchTerm:o})}):null}})})]})}),(0,ht.jsxs)("div",{children:[(0,ht.jsxs)("div",{className:d.section,children:[(0,ht.jsx)(bt.Label,{description:"Once label values are selected, only possible label combinations are shown.",children:"2. Select labels to search in"}),(0,ht.jsx)("div",{children:(0,ht.jsx)(bt.Input,{onChange:this.onChangeLabelSearch,"aria-label":"Filter expression for label",value:i,"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.labelNamesFilter})}),(0,ht.jsx)("div",{className:d.list,style:{height:120},children:h.map((e=>(0,ht.jsx)(bt.BrowserLabel,{name:e.name,loading:e.loading,active:e.selected,hidden:e.hidden,facets:e.facets,onClick:this.onClickLabel,searchTerm:i},e.name)))})]}),(0,ht.jsxs)("div",{className:d.section,children:[(0,ht.jsx)(bt.Label,{description:"Use the search field to find values across selected labels.",children:"3. Select (multiple) values for your labels"}),(0,ht.jsx)("div",{children:(0,ht.jsx)(bt.Input,{onChange:this.onChangeValueSearch,"aria-label":"Filter expression for label values",value:u,"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.labelValuesFilter})}),(0,ht.jsx)("div",{className:d.valueListArea,ref:this.valueListsRef,children:m.map((e=>{var t,r,n;return(0,ht.jsxs)("div",{role:"list","aria-label":`Values for ${e.name}`,className:d.valueListWrapper,children:[(0,ht.jsx)("div",{className:d.valueTitle,children:(0,ht.jsx)(bt.BrowserLabel,{name:e.name,loading:e.loading,active:e.selected,hidden:e.hidden,facets:e.facets||(null==(t=e.values)?void 0:t.length),onClick:this.onClickLabel})}),(0,ht.jsx)(Pn,{height:Math.min(200,25*((null==(r=e.values)?void 0:r.length)||0)),itemCount:(null==(n=e.values)?void 0:n.length)||0,itemSize:28,itemKey:t=>e.values[t].name,width:200,className:d.valueList,children:({index:t,style:r})=>{var n;const a=null==(n=e.values)?void 0:n[t];return a?(0,ht.jsx)("div",{style:r,children:(0,ht.jsx)(bt.BrowserLabel,{name:e.name,value:null==a?void 0:a.name,active:null==a?void 0:a.selected,onClick:this.onClickValue,searchTerm:u})}):null}})]},e.name)}))})]})]})]}),(0,ht.jsxs)("div",{className:d.section,children:[(0,ht.jsx)(bt.Label,{children:"4. Resulting selector"}),(0,ht.jsx)("div",{"aria-label":"selector",className:d.selector,children:f}),c&&(0,ht.jsx)("div",{className:d.validationStatus,children:c}),(0,ht.jsxs)(bt.Stack,{children:[(0,ht.jsx)(bt.Button,{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.useQuery,"aria-label":"Use selector for query button",disabled:g,onClick:this.onClickRunQuery,children:"Use query"}),(0,ht.jsx)(bt.Button,{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.useAsRateQuery,"aria-label":"Use selector as metrics button",variant:"secondary",disabled:g,onClick:this.onClickRunRateQuery,children:"Use as rate query"}),(0,ht.jsx)(bt.Button,{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.validateSelector,"aria-label":"Validate submit button",variant:"secondary",disabled:g,onClick:this.onClickValidate,children:"Validate selector"}),(0,ht.jsx)(bt.Button,{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.clear,"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear,children:"Clear"}),(0,ht.jsx)("div",{className:(0,Nr.cx)(d.status,(s||l)&&d.statusShowing),children:(0,ht.jsx)("span",{className:l?d.error:"",children:l||s})})]})]})]})}}const zn=(0,bt.withTheme2)(Wn);var Un=(e=>(e.Low="Low",e.Medium="Medium",e.High="High",e.None="None",e))(Un||{}),Gn=(e=>(e.Cortex="Cortex",e.Mimir="Mimir",e.Prometheus="Prometheus",e.Thanos="Thanos",e))(Gn||{}),Hn=(e=>(e.Auto="__auto",e.Verbose="__verbose",e.Custom="__custom",e))(Hn||{}),Xn=(e=>(e[e.LabelNames=0]="LabelNames",e[e.LabelValues=1]="LabelValues",e[e.MetricNames=2]="MetricNames",e[e.VarQueryResult=3]="VarQueryResult",e[e.SeriesQuery=4]="SeriesQuery",e[e.ClassicQuery=5]="ClassicQuery",e))(Xn||{}),Yn=Object.defineProperty,Kn=Object.defineProperties,Jn=Object.getOwnPropertyDescriptors,Zn=Object.getOwnPropertySymbols,ea=Object.prototype.hasOwnProperty,ta=Object.prototype.propertyIsEnumerable,ra=(e,t,r)=>t in e?Yn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,na=(e,t)=>{for(var r in t||(t={}))ea.call(t,r)&&ra(e,r,t[r]);if(Zn)for(var r of Zn(t))ta.call(t,r)&&ra(e,r,t[r]);return e},aa=(e,t)=>Kn(e,Jn(t)),ia=(e,t,r)=>(ra(e,"symbol"!=typeof t?t+"":t,r),r);const oa=["job","instance"],sa=1e4,la=e=>({headers:{"X-Grafana-Cache":`private, max-age=${e}`}});function ca(e,t){if(!t[e])return;const{type:r,help:n}=t[e];return`${r.toUpperCase()}: ${n}`}function ua(e,t){if(t[e])return t[e].help}function da(e,t){if(t[e])return t[e].type}const pa=/(="|!="|=~"|!~"|\{|\[|\(|\+|-|\/|\*|%|\^|\band\b|\bor\b|\bunless\b|==|>=|!=|<=|>|<|=|~|,)/;class ha extends e.LanguageProvider{constructor(r,n){super(),ia(this,"histogramMetrics"),ia(this,"timeRange"),ia(this,"metrics"),ia(this,"metricsMetadata"),ia(this,"datasource"),ia(this,"labelKeys",[]),ia(this,"request",(async(e,t,r={},n)=>{try{return(await this.datasource.metadataRequest(e,r,n)).data.data}catch(e){(function(e){return"object"==typeof e&&null!==e&&"cancelled"in e&&!0===e.cancelled})(e)||console.error(e)}return t})),ia(this,"start",(async t=>(this.timeRange=null!=t?t:(0,e.getDefaultTimeRange)(),this.datasource.lookupsDisabled?[]:(this.metrics=await this.fetchLabelValues("__name__")||[],this.histogramMetrics=es(this.metrics).sort(),Promise.all([this.loadMetricsMetadata(),this.fetchLabels()]))))),ia(this,"fetchLabelValues",(async e=>{const t=this.datasource.getAdjustedInterval(this.timeRange),r=`/api/v1/label/${this.datasource.interpolateString(e)}/values`,n=await this.request(r,[],t,this.getDefaultCacheHeaders());return null!=n?n:[]})),ia(this,"fetchLabels",(async(e,t)=>{e&&(this.timeRange=e);let r="/api/v1/labels";const n=this.datasource.getAdjustedInterval(this.timeRange);this.labelFetchTs=Date.now().valueOf();const a=new URLSearchParams(na({},n));null==t||t.forEach((e=>{const t=jr(e.expr);""!==t.query.metric&&(a.append("match[]",t.query.metric),t.query.binaryQueries&&t.query.binaryQueries.forEach((e=>{a.append("match[]",e.query.metric)})))})),"GET"===this.datasource.httpMethod&&(r+=`?${a.toString()}`);const i=await this.request(r,[],a,this.getDefaultCacheHeaders());return Array.isArray(i)&&(this.labelKeys=i.slice().sort()),[]})),ia(this,"getSeriesValues",(async(e,t)=>{var r;return this.datasource.hasLabelsMatchAPISupport()?await this.fetchSeriesValuesWithMatch(e,t):null!=(r=(await this.getSeries(t))[e])?r:[]})),ia(this,"fetchSeriesValuesWithMatch",(async(e,t,r,n=this.timeRange)=>{const a=e?this.datasource.interpolateString(e):null,i=t?this.datasource.interpolateString(t):null,o=this.datasource.getAdjustedInterval(n),s=na(na({},o),i&&{"match[]":i});let l=na(na({},this.getDefaultCacheHeaders()),r&&{requestId:r});Object.keys(l).length||(l=void 0);const c=await this.request(`/api/v1/label/${a}/values`,[],s,l);return null!=c?c:[]})),ia(this,"getSeriesLabels",(async(e,t)=>{let r,n;this.datasource.hasLabelsMatchAPISupport()?(t.push({name:"__name__",value:"",op:"!="}),n=await this.fetchSeriesLabelsMatch(e),r=Object.keys(n)):(n=await this.getSeries(e),r=Object.keys(n));const a=new Set(t.map((e=>e.name)));return r.filter((e=>!a.has(e)))})),ia(this,"fetchLabelsWithMatch",(async(e,t)=>this.datasource.hasLabelsMatchAPISupport()?this.fetchSeriesLabelsMatch(e,t):this.fetchSeriesLabels(e,t,qn))),ia(this,"fetchSeriesLabels",(async(e,t,r)=>{const n=this.datasource.interpolateString(e),a=this.datasource.getAdjustedInterval(this.timeRange);let i=aa(na({},a),{"match[]":n});"none"!==r&&(i=aa(na({},i),{limit:null!=r?r:Bn}));const o=await this.request("/api/v1/series",[],i,this.getDefaultCacheHeaders()),{values:s}=function(e,t=!1){const r={};e.forEach((e=>{const n=e,{__name__:a}=n,i=Zo(n,["__name__"]);t&&(r.__name__=r.__name__||new Set,r.__name__.has(a)||r.__name__.add(a)),Object.keys(i).forEach((e=>{r[e]||(r[e]=new Set),r[e].has(i[e])||r[e].add(i[e])}))}));const n={};return ns(Object.keys(r)).forEach((e=>{n[e]=ns(Array.from(r[e]))})),{values:n,keys:Object.keys(n)}}(o,t);return s})),ia(this,"fetchSeriesLabelsMatch",(async(e,t)=>{const r=this.datasource.interpolateString(e),n=this.datasource.getAdjustedInterval(this.timeRange),a=aa(na({},n),{"match[]":r});return(await this.request("/api/v1/labels",[],a,this.getDefaultCacheHeaders())).reduce(((e,t)=>aa(na({},e),{[t]:""})),{})})),ia(this,"fetchSeries",(async e=>{const t=this.datasource.getTimeRangeParams(this.timeRange),r=aa(na({},t),{"match[]":e});return await this.request("/api/v1/series",{},r,this.getDefaultCacheHeaders())})),ia(this,"fetchDefaultSeries",(0,t.once)((async()=>{const e=await Promise.all(oa.map((e=>this.fetchLabelValues(e))));return oa.reduce(((t,r,n)=>aa(na({},t),{[r]:e[n]})),{})}))),this.datasource=r,this.histogramMetrics=[],this.timeRange=(0,e.getDefaultTimeRange)(),this.metrics=[],Object.assign(this,n)}getDefaultCacheHeaders(){if(this.datasource.cacheLevel!==Un.None)return la(60*this.datasource.getCacheDurationInMinutes())}cleanText(e){return e.split(pa).pop().trimLeft().replace(/"$/,"").replace(/^"/,"")}get syntax(){return ut}async loadMetricsMetadata(){const e=la(86400*this.datasource.getDaysToCacheMetadata());this.metricsMetadata=function(e){if(!e)return e;const t={},r={};for(const n in e){const a=e[n][0];t[n]=a,"histogram"===a.type&&(r[`${n}_bucket`]={type:"counter",help:`Cumulative counters for the observation buckets (${a.help})`},r[`${n}_count`]={type:"counter",help:`Count of events that have been observed for the histogram metric (${a.help})`},r[`${n}_sum`]={type:"counter",help:`Total sum of all observed values for the histogram metric (${a.help})`}),"summary"===a.type&&(r[`${n}_count`]={type:"counter",help:`Count of events that have been observed for the base metric (${a.help})`},r[`${n}_sum`]={type:"counter",help:`Total sum of all observed values for the base metric (${a.help})`})}return Jo(Jo(Jo({},t),r),{ALERTS:{type:"counter",help:"Time series showing pending and firing alerts. The sample value is set to 1 as long as the alert is in the indicated active (pending or firing) state."}})}(await this.request("/api/v1/metadata",{},{},na({showErrorAlert:!1},e)))}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(e){return function(e){return{refId:e.refId,expr:cs(e),range:!0}}(e)}exportToAbstractQuery(t){const r=t.expr;if(!r||0===r.length)return{refId:t.refId,labelMatchers:[]};const n=cn().tokenize(r,ut),a=function(e){const t=[];for(const r of e)if(r instanceof ln.Token&&"context-labels"===r.type){let e="",n="",a="";const i=Array.isArray(r.content)?r.content:[r.content];for(let r of i)if("string"==typeof r){let e;e=r,"="!==e&&"!="!==e&&"=~"!==e&&"!~"!==e||(a=e)}else if(r instanceof ln.Token)switch(r.type){case"label-key":e=us(r);break;case"label-value":n=us(r),n=n.substring(1,n.length-1);const i=ss[a];i&&t.push({name:e,operator:i,value:n})}}return t}(n),i=function(e,t){let r="";for(const e of t)if("string"==typeof e){r=e;break}return r}(0,n);return i&&i.length>0&&a.push({name:"__name__",operator:e.AbstractLabelOperator.Equal,value:i}),{refId:t.refId,labelMatchers:a}}async getSeries(e,t){if(this.datasource.lookupsDisabled)return{};try{return"{}"===e?await this.fetchDefaultSeries():await this.fetchSeriesLabels(e,t,qn)}catch(e){return console.error(e),{}}}async getLabelValues(e){return await this.fetchLabelValues(e)}}var ma=b(2039),fa=b.n(ma),ga=b(2341),ba=b.n(ga);const va=({children:e})=>gt().createElement(Br,{gap:1},e);var ya=b(7694),xa=Symbol.for("immer-nothing"),Oa=Symbol.for("immer-draftable"),wa=Symbol.for("immer-state");function Sa(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var _a=Object.getPrototypeOf;function Pa(e){return!!e&&!!e[wa]}function Ea(e){return!!e&&(Ca(e)||Array.isArray(e)||!!e[Oa]||!!e.constructor?.[Oa]||ka(e)||Ra(e))}var Ta=Object.prototype.constructor.toString();function Ca(e){if(!e||"object"!=typeof e)return!1;const t=_a(e);if(null===t)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===Ta}function Ia(e,t){0===ja(e)?Reflect.ownKeys(e).forEach((r=>{t(r,e[r],e)})):e.forEach(((r,n)=>t(n,r,e)))}function ja(e){const t=e[wa];return t?t.type_:Array.isArray(e)?1:ka(e)?2:Ra(e)?3:0}function $a(e,t){return 2===ja(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Da(e,t,r){const n=ja(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function ka(e){return e instanceof Map}function Ra(e){return e instanceof Set}function Aa(e){return e.copy_||e.base_}function Na(e,t){if(ka(e))return new Map(e);if(Ra(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=Ca(e);if(!0===t||"class_only"===t&&!r){const t=Object.getOwnPropertyDescriptors(e);delete t[wa];let r=Reflect.ownKeys(t);for(let n=0;n<r.length;n++){const a=r[n],i=t[a];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(_a(e),t)}{const t=_a(e);if(null!==t&&r)return{...e};const n=Object.create(t);return Object.assign(n,e)}}function La(e,t=!1){return Fa(e)||Pa(e)||!Ea(e)||(ja(e)>1&&(e.set=e.add=e.clear=e.delete=Ma),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>La(t,!0)))),e}function Ma(){Sa(2)}function Fa(e){return Object.isFrozen(e)}var Ba,qa={};function Qa(e){const t=qa[e];return t||Sa(0),t}function Va(){return Ba}function Wa(e,t){t&&(Qa("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function za(e){Ua(e),e.drafts_.forEach(Ha),e.drafts_=null}function Ua(e){e===Ba&&(Ba=e.parent_)}function Ga(e){return Ba={drafts_:[],parent_:Ba,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Ha(e){const t=e[wa];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function Xa(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return void 0!==e&&e!==r?(r[wa].modified_&&(za(t),Sa(4)),Ea(e)&&(e=Ya(t,e),t.parent_||Ja(t,e)),t.patches_&&Qa("Patches").generateReplacementPatches_(r[wa].base_,e,t.patches_,t.inversePatches_)):e=Ya(t,r,[]),za(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==xa?e:void 0}function Ya(e,t,r){if(Fa(t))return t;const n=t[wa];if(!n)return Ia(t,((a,i)=>Ka(e,n,t,a,i,r))),t;if(n.scope_!==e)return t;if(!n.modified_)return Ja(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const t=n.copy_;let a=t,i=!1;3===n.type_&&(a=new Set(t),t.clear(),i=!0),Ia(a,((a,o)=>Ka(e,n,t,a,o,r,i))),Ja(e,t,!1),r&&e.patches_&&Qa("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function Ka(e,t,r,n,a,i,o){if(Pa(a)){const o=Ya(e,a,i&&t&&3!==t.type_&&!$a(t.assigned_,n)?i.concat(n):void 0);if(Da(r,n,o),!Pa(o))return;e.canAutoFreeze_=!1}else o&&r.add(a);if(Ea(a)&&!Fa(a)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ya(e,a),t&&t.scope_.parent_||"symbol"==typeof n||!Object.prototype.propertyIsEnumerable.call(r,n)||Ja(e,a)}}function Ja(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&La(t,r)}var Za={get(e,t){if(t===wa)return e;const r=Aa(e);if(!$a(r,t))return function(e,t,r){const n=ri(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}(e,r,t);const n=r[t];return e.finalized_||!Ea(n)?n:n===ti(e.base_,t)?(ai(e),e.copy_[t]=ii(n,e)):n},has:(e,t)=>t in Aa(e),ownKeys:e=>Reflect.ownKeys(Aa(e)),set(e,t,r){const n=ri(Aa(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const n=ti(Aa(e),t),o=n?.[wa];if(o&&o.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(((a=r)===(i=n)?0!==a||1/a==1/i:a!=a&&i!=i)&&(void 0!==r||$a(e.base_,t)))return!0;ai(e),ni(e)}var a,i;return e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==ti(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,ai(e),ni(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const r=Aa(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty(){Sa(11)},getPrototypeOf:e=>_a(e.base_),setPrototypeOf(){Sa(12)}},ei={};function ti(e,t){const r=e[wa];return(r?Aa(r):e)[t]}function ri(e,t){if(!(t in e))return;let r=_a(e);for(;r;){const e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=_a(r)}}function ni(e){e.modified_||(e.modified_=!0,e.parent_&&ni(e.parent_))}function ai(e){e.copy_||(e.copy_=Na(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function ii(e,t){const r=ka(e)?Qa("MapSet").proxyMap_(e,t):Ra(e)?Qa("MapSet").proxySet_(e,t):function(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Va(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=n,i=Za;r&&(a=[n],i=ei);const{revoke:o,proxy:s}=Proxy.revocable(a,i);return n.draft_=s,n.revoke_=o,s}(e,t);return(t?t.scope_:Va()).drafts_.push(r),r}function oi(e){if(!Ea(e)||Fa(e))return e;const t=e[wa];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=Na(e,t.scope_.immer_.useStrictShallowCopy_)}else r=Na(e,!0);return Ia(r,((e,t)=>{Da(r,e,oi(t))})),t&&(t.finalized_=!1),r}Ia(Za,((e,t)=>{ei[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ei.deleteProperty=function(e,t){return ei.set.call(this,e,t,void 0)},ei.set=function(e,t,r){return Za.set.call(this,e[0],t,r,e[0])};var si=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if("function"==typeof e&&"function"!=typeof t){const r=t;t=e;const n=this;return function(e=r,...a){return n.produce(e,(e=>t.call(this,e,...a)))}}let n;if("function"!=typeof t&&Sa(6),void 0!==r&&"function"!=typeof r&&Sa(7),Ea(e)){const a=Ga(this),i=ii(e,void 0);let o=!0;try{n=t(i),o=!1}finally{o?za(a):Ua(a)}return Wa(a,r),Xa(n,a)}if(!e||"object"!=typeof e){if(n=t(e),void 0===n&&(n=e),n===xa&&(n=void 0),this.autoFreeze_&&La(n,!0),r){const t=[],a=[];Qa("Patches").generateReplacementPatches_(e,n,t,a),r(t,a)}return n}Sa(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...r)=>this.produceWithPatches(t,(t=>e(t,...r)));let r,n;return[this.produce(e,t,((e,t)=>{r=e,n=t})),r,n]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){var t;Ea(e)||Sa(8),Pa(e)&&(Pa(t=e)||Sa(10),e=oi(t));const r=Ga(this),n=ii(e,void 0);return n[wa].isManual_=!0,Ua(r),n}finishDraft(e,t){const r=e&&e[wa];r&&r.isManual_||Sa(9);const{scope_:n}=r;return Wa(n,t),Xa(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}r>-1&&(t=t.slice(r+1));const n=Qa("Patches").applyPatches_;return Pa(e)?n(e,t):this.produce(e,(e=>n(e,t)))}},li=si.produce;function ci(e,t){function r(...r){if(t){let n=t(...r);if(!n)throw new Error(xi(0));return{type:e,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:e,payload:r[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=t=>(0,ya.isAction)(t)&&t.type===e,r}function ui(e){return Ea(e)?li(e,(()=>{})):e}function di(e,t,r){if(e.has(t)){let n=e.get(t);return r.update&&(n=r.update(n,t,e),e.set(t,n)),n}if(!r.insert)throw new Error(xi(10));const n=r.insert(t,e);return e.set(t,n),n}si.produceWithPatches.bind(si),si.setAutoFreeze.bind(si),si.setUseStrictShallowCopy.bind(si),si.applyPatches.bind(si),si.createDraft.bind(si),si.finishDraft.bind(si),"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__,"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__,Symbol.species;function pi(e){const t={},r=[];let n;const a={addCase(e,r){const n="string"==typeof e?e:e.type;if(!n)throw new Error(xi(28));if(n in t)throw new Error(xi(29));return t[n]=r,a},addMatcher:(e,t)=>(r.push({matcher:e,reducer:t}),a),addDefaultCase:e=>(n=e,a)};return e(a),[t,r,n]}"undefined"!=typeof window&&window.requestAnimationFrame&&window.requestAnimationFrame;var hi=Symbol.for("rtk-slice-createasyncthunk");function mi(e,t){return`${e}/${t}`}function fi({creators:e}={}){const t=e?.asyncThunk?.[hi];return function(e){const{name:r,reducerPath:n=r}=e;if(!r)throw new Error(xi(11));const a=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},i=Object.keys(a),o={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},s={addCase(e,t){const r="string"==typeof e?e:e.type;if(!r)throw new Error(xi(12));if(r in o.sliceCaseReducersByType)throw new Error(xi(13));return o.sliceCaseReducersByType[r]=t,s},addMatcher:(e,t)=>(o.sliceMatchers.push({matcher:e,reducer:t}),s),exposeAction:(e,t)=>(o.actionCreators[e]=t,s),exposeCaseReducer:(e,t)=>(o.sliceCaseReducersByName[e]=t,s)};function l(){const[t={},r=[],n]="function"==typeof e.extraReducers?pi(e.extraReducers):[e.extraReducers],a={...t,...o.sliceCaseReducersByType};return function(e){let t,[i,s,l]=pi((e=>{for(let t in a)e.addCase(t,a[t]);for(let t of o.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of r)e.addMatcher(t.matcher,t.reducer);n&&e.addDefaultCase(n)}));if("function"==typeof e)t=()=>ui(e());else{const r=ui(e);t=()=>r}function c(e=t(),r){let n=[i[r.type],...s.filter((({matcher:e})=>e(r))).map((({reducer:e})=>e))];return 0===n.filter((e=>!!e)).length&&(n=[l]),n.reduce(((e,t)=>{if(t){if(Pa(e)){const n=t(e,r);return void 0===n?e:n}if(Ea(e))return li(e,(e=>t(e,r)));{const n=t(e,r);if(void 0===n){if(null===e)return e;throw new Error(xi(9))}return n}}return e}),e)}return c.getInitialState=t,c}(e.initialState)}i.forEach((n=>{const i=a[n],o={reducerName:n,type:mi(r,n),createNotation:"function"==typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(i)?function({type:e,reducerName:t,createNotation:r},n,a){let i,o;if("reducer"in n){if(r&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(n))throw new Error(xi(17));i=n.reducer,o=n.prepare}else i=n;a.addCase(e,i).exposeCaseReducer(t,i).exposeAction(t,o?ci(e,o):ci(e))}(o,i,s):function({type:e,reducerName:t},r,n,a){if(!a)throw new Error(xi(18));const{payloadCreator:i,fulfilled:o,pending:s,rejected:l,settled:c,options:u}=r,d=a(e,i,u);n.exposeAction(t,d),o&&n.addCase(d.fulfilled,o),s&&n.addCase(d.pending,s),l&&n.addCase(d.rejected,l),c&&n.addMatcher(d.settled,c),n.exposeCaseReducer(t,{fulfilled:o||vi,pending:s||vi,rejected:l||vi,settled:c||vi})}(o,i,s,t)}));const c=e=>e,u=new Map;let d;function p(e,t){return d||(d=l()),d(e,t)}function h(){return d||(d=l()),d.getInitialState()}function m(t,r=!1){function n(e){let n=e[t];return void 0===n&&r&&(n=h()),n}function a(t=c){const n=di(u,r,{insert:()=>new WeakMap});return di(n,t,{insert:()=>{const n={};for(const[a,i]of Object.entries(e.selectors??{}))n[a]=gi(i,t,h,r);return n}})}return{reducerPath:t,getSelectors:a,get selectors(){return a(n)},selectSlice:n}}const f={name:r,reducer:p,actions:o.actionCreators,caseReducers:o.sliceCaseReducersByName,getInitialState:h,...m(n),injectInto(e,{reducerPath:t,...r}={}){const a=t??n;return e.inject({reducerPath:a,reducer:p},r),{...f,...m(a,!0)}}};return f}}function gi(e,t,r,n){function a(a,...i){let o=t(a);return void 0===o&&n&&(o=r()),e(o,...i)}return a.unwrapped=e,a}var bi=fi();function vi(){}var{assign:yi}=Object;function xi(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}function Oi(e,t){let r=da(e,t.languageProvider.metricsMetadata);const n=ua(e,t.languageProvider.metricsMetadata);["histogram","summary"].forEach((e=>{(null==n?void 0:n.toLowerCase().includes(e))&&r!==e&&(r+=` (${e})`)}));const a=e.match(/^\w+_bucket$|^\w+_bucket{.*}$/);return"histogram"!==r||a||(r="native histogram"),{value:e,type:r,description:n}}function wi(e,t){const r=Si(e);return e.isLoading||e.filteredMetricCount===r.length||t(ko(r.length)),function(e,t,r){const n=0===r?1:r,a=1===t?0:(t-1)*n,i=a+n;return e.slice(a,i)}(r,e.pageNum,e.resultsPerPage)}function Si(e){let t=e.metrics;return e.fuzzySearchQuery&&!e.useBackend&&(t=e.fullMetaSearch?e.metaHaystackOrder.map((t=>e.metaHaystackDictionary[t])):e.nameHaystackOrder.map((t=>e.nameHaystackDictionary[t]))),e.selectedTypes.length>0&&(t=t.filter(((t,r)=>{const n=e.selectedTypes.some((e=>t.type&&e.value?t.type.includes(e.value):!t.type&&"no type"===e.value));return n}))),e.includeNullMetadata||(t=t.filter((e=>void 0!==e.type&&void 0!==e.description))),t}function _i(e){if(!e.metrics.length)return[];const t=0===e.resultsPerPage?1:e.resultsPerPage,r=Math.floor(Si(e).length/t)+1;return[...Array(r).keys()].map((e=>e+1))}Symbol.for("rtk-state-proxy-original");function Pi(e,t,r,n){switch(e){case"grafana_prom_metric_encycopedia_tracking":(0,j.reportInteraction)(e,{metric:r,hasMetadata:null==t?void 0:t.hasMetadata,totalMetricCount:null==t?void 0:t.totalMetricCount,fuzzySearchQuery:null==t?void 0:t.fuzzySearchQuery,fullMetaSearch:null==t?void 0:t.fullMetaSearch,selectedTypes:null==t?void 0:t.selectedTypes,useRegexSearch:null==t?void 0:t.useBackend,includeResultsWithoutMetadata:null==t?void 0:t.includeNullMetadata});case"grafana_prom_metric_encycopedia_disable_text_wrap_interaction":(0,j.reportInteraction)(e,{disableTextWrap:null==t?void 0:t.disableTextWrap});case"grafana_prometheus_metric_encyclopedia_open":(0,j.reportInteraction)(e,{query:n})}}const Ei=[{value:"counter",description:"A cumulative metric that represents a single monotonically increasing counter whose value can only increase or be reset to zero on restart."},{value:"gauge",description:"A metric that represents a single numerical value that can arbitrarily go up and down."},{value:"histogram",description:"A histogram samples observations (usually things like request durations or response sizes) and counts them in configurable buckets."},{value:"native histogram",description:"Native histograms are different from classic Prometheus histograms in a number of ways: Native histogram bucket boundaries are calculated by a formula that depends on the scale (resolution) of the native histogram, and are not user defined."},{value:"summary",description:"A summary samples observations (usually things like request durations and response sizes) and can calculate configurable quantiles over a sliding time window."},{value:"unknown",description:"These metrics have been given the type unknown in the metadata."},{value:"no type",description:"These metrics have no defined type in the metadata."}];function Ti(e){const{state:t,onChangeFullMetaSearch:r,onChangeIncludeNullMetadata:n,onChangeDisableTextWrap:a,onChangeUseBackend:i}=e,o=(s=(0,bt.useTheme2)(),{settingsIcon:(0,Nr.css)({color:s.colors.text.secondary}),selectItem:(0,Nr.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:"4px 0"}),selectItemLabel:(0,Nr.css)({margin:`0 0 0 ${s.spacing(1)}`,alignSelf:"center",color:s.colors.text.secondary,fontSize:"12px"})});var s;return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsxs)("div",{className:o.selectItem,children:[(0,ht.jsx)(bt.Switch,{"data-testid":bo.searchWithMetadata,value:t.fullMetaSearch,disabled:t.useBackend||!t.hasMetadata,onChange:()=>r()}),(0,ht.jsx)("div",{className:o.selectItemLabel,children:"Include description in search"})]}),(0,ht.jsxs)("div",{className:o.selectItem,children:[(0,ht.jsx)(bt.Switch,{value:t.includeNullMetadata,disabled:!t.hasMetadata,onChange:()=>n()}),(0,ht.jsx)("div",{className:o.selectItemLabel,children:"Include results with no metadata"})]}),(0,ht.jsxs)("div",{className:o.selectItem,children:[(0,ht.jsx)(bt.Switch,{value:t.disableTextWrap,onChange:()=>a()}),(0,ht.jsx)("div",{className:o.selectItemLabel,children:"Disable text wrap"})]}),(0,ht.jsxs)("div",{className:o.selectItem,children:[(0,ht.jsx)(bt.Switch,{"data-testid":bo.setUseBackend,value:t.useBackend,onChange:()=>i()}),(0,ht.jsxs)("div",{className:o.selectItemLabel,children:["Enable regex search","Â "]}),(0,ht.jsx)(bt.Tooltip,{content:"Filter metric names by regex search, using an additional call on the Prometheus API.",placement:"bottom-end",children:(0,ht.jsx)(bt.Icon,{name:"info-circle",size:"xs",className:o.settingsIcon})})]})]})}function Ci({feedbackUrl:e}){const t=(0,bt.useStyles2)(Ii);return(0,ht.jsx)(bt.Stack,{children:(0,ht.jsxs)("a",{href:e,className:t.link,title:"The metrics explorer is new, please let us know how we can improve it",target:"_blank",rel:"noreferrer noopener",children:[(0,ht.jsx)(bt.Icon,{name:"comment-alt-message"})," Give feedback"]})})}function Ii(e){return{link:(0,Nr.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,":hover":{color:e.colors.text.link},margin:"-25px 0 30px 0"})}}const ji=30;function $i(e){return(0,ht.jsx)("a",{href:e||"https://grafana.com/docs/grafana/latest/datasources/prometheus/#configure-the-data-source",target:"_blank",rel:"noopener noreferrer",children:"Visit docs for more details here."})}const Di=(e,t,r)=>!(e&&!e.match(t))||(0,ht.jsx)(bt.FieldValidationMessage,{children:r||"Value is not valid"});function ki(e){return{additionalSettings:(0,Nr.css)({marginBottom:"25px"}),secondaryGrey:(0,Nr.css)({color:e.colors.secondary.text,opacity:"65%"}),inlineError:(0,Nr.css)({margin:"0px 0px 4px 245px"}),switchField:(0,Nr.css)({alignItems:"center"}),sectionHeaderPadding:(0,Nr.css)({paddingTop:"32px"}),sectionBottomPadding:(0,Nr.css)({paddingBottom:"28px"}),subsectionText:(0,Nr.css)({fontSize:"12px"}),hrBottomSpace:(0,Nr.css)({marginBottom:"56px"}),hrTopSpace:(0,Nr.css)({marginTop:"50px"}),textUnderline:(0,Nr.css)({textDecoration:"underline"}),versionMargin:(0,Nr.css)({marginBottom:"12px"}),advancedHTTPSettingsMargin:(0,Nr.css)({margin:"24px 0 8px 0"}),advancedSettings:(0,Nr.css)({paddingTop:"32px"}),alertingTop:(0,Nr.css)({marginTop:"40px !important"}),overhaulPageHeading:(0,Nr.css)({fontWeight:400}),container:(0,Nr.css)({maxwidth:578})}}var Ri=Object.defineProperty,Ai=Object.defineProperties,Ni=Object.getOwnPropertyDescriptors,Li=Object.getOwnPropertySymbols,Mi=Object.prototype.hasOwnProperty,Fi=Object.prototype.propertyIsEnumerable,Bi=(e,t,r)=>t in e?Ri(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;function qi(e){const{metrics:t,onChange:r,onClose:n,query:a,state:i,disableTextWrap:o}=e,s=(0,bt.useTheme2)(),l=Qi(s,o);function c(e){var t,r,n,a;return i.fullMetaSearch&&e?(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("td",{children:d(null!=(t=e.type)?t:"")}),(0,ht.jsx)("td",{children:(0,ht.jsx)(ba(),{textToHighlight:null!=(r=e.description)?r:"",searchWords:i.metaHaystackMatches,autoEscape:!0,highlightClassName:l.matchHighLight})})]}):(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("td",{children:d(null!=(n=e.type)?n:"")}),(0,ht.jsx)("td",{children:null!=(a=e.description)?a:""})]})}function u(e,t,r){return(0,ht.jsxs)(ht.Fragment,{children:[e,(0,ht.jsx)("span",{className:l.tooltipSpace,children:(0,ht.jsx)(bt.Tooltip,{content:(0,ht.jsxs)(ht.Fragment,{children:["When creating a ",t,", Prometheus exposes multiple series with the type counter."," ",$i(r)]}),placement:"bottom-start",interactive:!0,children:(0,ht.jsx)(bt.Icon,{name:"info-circle",size:"xs"})})})]})}function d(e){return e?e.includes("(summary)")?u(e,"summary","https://prometheus.io/docs/concepts/metric_types/#summary"):e.includes("(histogram)")?u(e,"histogram","https://prometheus.io/docs/concepts/metric_types/#histogram"):e:""}return(0,ht.jsxs)("table",{className:l.table,children:[(0,ht.jsx)("thead",{className:l.stickyHeader,children:(0,ht.jsxs)("tr",{children:[(0,ht.jsx)("th",{className:`${l.nameWidth} ${l.tableHeaderPadding}`,children:"Name"}),i.hasMetadata&&(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("th",{className:`${l.typeWidth} ${l.tableHeaderPadding}`,children:"Type"}),(0,ht.jsx)("th",{className:`${l.descriptionWidth} ${l.tableHeaderPadding}`,children:"Description"})]}),(0,ht.jsx)("th",{className:l.selectButtonWidth,children:" "})]})}),(0,ht.jsx)("tbody",{children:(0,ht.jsxs)(ht.Fragment,{children:[t.length>0&&t.map(((e,t)=>{var o,s,u;return(0,ht.jsxs)("tr",{className:l.row,children:[(0,ht.jsx)("td",{className:l.nameOverflow,children:(0,ht.jsx)(ba(),{textToHighlight:null!=(s=null==e?void 0:e.value)?s:"",searchWords:(u=i,u.useBackend?[u.fuzzySearchQuery]:u.fullMetaSearch?u.metaHaystackMatches:u.nameHaystackMatches),autoEscape:!0,highlightClassName:l.matchHighLight})}),i.hasMetadata&&c(e),(0,ht.jsx)("td",{children:(0,ht.jsx)(bt.Button,{size:"md",variant:"secondary",onClick:()=>function(e){var t,o;e.value&&(r((t=((e,t)=>{for(var r in t||(t={}))Mi.call(t,r)&&Bi(e,r,t[r]);if(Li)for(var r of Li(t))Fi.call(t,r)&&Bi(e,r,t[r]);return e})({},a),o={metric:e.value},Ai(t,Ni(o)))),Pi("grafana_prom_metric_encycopedia_tracking",i,e.value),n())}(e),className:l.centerButton,children:"Select"})})]},null!=(o=null==e?void 0:e.value)?o:t)})),0===t.length&&!i.isLoading&&function(){let e;return i.fuzzySearchQuery||(e="There are no metrics found in the data source."),a.labels.length>0&&(e="There are no metrics found. Try to expand your label filters."),(i.fuzzySearchQuery||i.selectedTypes.length>0)&&(e="There are no metrics found. Try to expand your search and filters."),(0,ht.jsx)("tr",{className:l.noResults,children:(0,ht.jsx)("td",{colSpan:3,children:e})})}()]})})]})}const Qi=(e,t)=>({table:(0,Nr.css)({tableLayout:t?void 0:"fixed",borderRadius:e.shape.radius.default,width:"100%",whiteSpace:t?"nowrap":"normal",td:{padding:e.spacing(1)},"td,th":{minWidth:e.spacing(3),borderBottom:`1px solid ${e.colors.border.weak}`}}),row:(0,Nr.css)({label:"row",borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-child":{borderBottom:0}}),tableHeaderPadding:(0,Nr.css)({padding:"8px"}),matchHighLight:(0,Nr.css)({background:"inherit",color:e.components.textHighlight.text,backgroundColor:e.components.textHighlight.background}),nameWidth:(0,Nr.css)({width:t?void 0:"37.5%"}),nameOverflow:(0,Nr.css)({overflowWrap:t?void 0:"anywhere"}),typeWidth:(0,Nr.css)({width:t?void 0:"15%"}),descriptionWidth:(0,Nr.css)({width:t?void 0:"35%"}),selectButtonWidth:(0,Nr.css)({width:t?void 0:"12.5%"}),stickyHeader:(0,Nr.css)({position:"sticky",top:0,backgroundColor:e.colors.background.primary}),noResults:(0,Nr.css)({textAlign:"center",color:e.colors.text.secondary}),tooltipSpace:(0,Nr.css)({marginLeft:"4px"}),centerButton:(0,Nr.css)({display:"block",margin:"auto",border:"none"})}),Vi=1e3;function Wi(e){var t,r,n,a;return{isLoading:!0,metrics:[],hasMetadata:!0,metaHaystackDictionary:{},metaHaystackMatches:[],metaHaystackOrder:[],nameHaystackDictionary:{},nameHaystackOrder:[],nameHaystackMatches:[],totalMetricCount:0,filteredMetricCount:null,resultsPerPage:100,pageNum:1,fuzzySearchQuery:"",fullMetaSearch:null!=(t=null==e?void 0:e.fullMetaSearch)&&t,includeNullMetadata:null==(r=null==e?void 0:e.includeNullMetadata)||r,selectedTypes:[],useBackend:null!=(n=null==e?void 0:e.useBackend)&&n,disableTextWrap:null!=(a=null==e?void 0:e.disableTextWrap)&&a,showAdditionalSettings:!1}}const zi=new Intl.Collator("en",{numeric:!0,sensitivity:"base"}).compare,Ui=1/0,Gi=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Hi="eexxaacctt",Xi=(e,t,r)=>e.replace("A-Z",t).replace("a-z",r),Yi={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:Ui,intraChars:"[a-z\\d']",intraIns:null,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,Ui],intraSub:null,intraTrn:null,intraDel:null,intraFilt:(e,t,r)=>!0,sort:(e,t,r)=>{let{idx:n,chars:a,terms:i,interLft2:o,interLft1:s,start:l,intraIns:c,interIns:u}=e;return n.map(((e,t)=>t)).sort(((e,r)=>a[r]-a[e]||c[e]-c[r]||i[r]+o[r]+.5*s[r]-(i[e]+o[e]+.5*s[e])||u[e]-u[r]||l[e]-l[r]||zi(t[n[e]],t[n[r]])))}},Ki=(e,t)=>0==t?"":1==t?e+"??":t==Ui?e+"*?":e+`{0,${t}}?`,Ji="(?:\\b|_)";function Zi(e){e=Object.assign({},Yi,e);let{unicode:t,interLft:r,interRgt:n,intraMode:a,intraSlice:i,intraIns:o,intraSub:s,intraTrn:l,intraDel:c,intraContr:u,intraSplit:d,interSplit:p,intraBound:h,intraChars:m}=e;o??=a,s??=a,l??=a,c??=a;let f=e.letters??e.alpha;if(null!=f){let e=f.toLocaleUpperCase(),t=f.toLocaleLowerCase();p=Xi(p,e,t),d=Xi(d,e,t),h=Xi(h,e,t),m=Xi(m,e,t),u=Xi(u,e,t)}let g=t?"u":"";const b='".+?"',v=new RegExp(b,"gi"+g),y=new RegExp(`(?:\\s+|^)-(?:${m}+|${b})`,"gi"+g);let{intraRules:x}=e;null==x&&(x=e=>{let t=Yi.intraSlice,r=0,n=0,a=0,u=0;if(/[^\d]/.test(e)){let d=e.length;d<=4?d>=3&&(a=Math.min(l,1),4==d&&(r=Math.min(o,1))):(t=i,r=o,n=s,a=l,u=c)}return{intraSlice:t,intraIns:r,intraSub:n,intraTrn:a,intraDel:u}});let O=!!d,w=new RegExp(d,"g"+g),S=new RegExp(p,"g"+g),_=new RegExp("^"+p+"|"+p+"$","g"+g),P=new RegExp(u,"gi"+g);const E=e=>{let t=[];e=(e=e.replace(v,(e=>(t.push(e),Hi)))).replace(_,"").toLocaleLowerCase(),O&&(e=e.replace(w,(e=>e[0]+" "+e[1])));let r=0;return e.split(S).filter((e=>""!=e)).map((e=>e===Hi?t[r++]:e))},T=/[^\d]+|\d+/g,C=(t,i=0,s=!1)=>{let l=E(t);if(0==l.length)return[];let c,u=Array(l.length).fill("");if(l=l.map(((e,t)=>e.replace(P,(e=>(u[t]=e,""))))),1==a)c=l.map(((e,t)=>{if('"'===e[0])return Gi(e.slice(1,-1));let r="";for(let n of e.matchAll(T)){let e=n[0],{intraSlice:a,intraIns:i,intraSub:o,intraTrn:s,intraDel:l}=x(e);if(i+o+s+l==0)r+=e+u[t];else{let[n,c]=a,d=e.slice(0,n),p=e.slice(c),h=e.slice(n,c);1==i&&1==d.length&&d!=h[0]&&(d+="(?!"+d+")");let f=h.length,g=[e];if(o)for(let e=0;e<f;e++)g.push(d+h.slice(0,e)+m+h.slice(e+1)+p);if(s)for(let e=0;e<f-1;e++)h[e]!=h[e+1]&&g.push(d+h.slice(0,e)+h[e+1]+h[e]+h.slice(e+2)+p);if(l)for(let e=0;e<f;e++)g.push(d+h.slice(0,e+1)+"?"+h.slice(e+1)+p);if(i){let e=Ki(m,1);for(let t=0;t<f;t++)g.push(d+h.slice(0,t)+e+h.slice(t)+p)}r+="(?:"+g.join("|")+")"+u[t]}}return r}));else{let e=Ki(m,o);2==i&&o>0&&(e=")("+e+")("),c=l.map(((t,r)=>'"'===t[0]?Gi(t.slice(1,-1)):t.split("").map(((e,t,r)=>(1==o&&0==t&&r.length>1&&e!=r[t+1]&&(e+="(?!"+e+")"),e))).join(e)+u[r]))}let d=2==r?Ji:"",p=2==n?Ji:"",h=p+Ki(e.interChars,e.interIns)+d;return i>0?s?c=d+"("+c.join(")"+p+"|"+d+"(")+")"+p:(c="("+c.join(")("+h+")(")+")",c="(.??"+d+")"+c+"("+p+".*)"):(c=c.join(h),c=d+c+p),[new RegExp(c,"i"+g),l,u]},I=(e,t,r)=>{let[n]=C(t);if(null==n)return null;let a=[];if(null!=r)for(let t=0;t<r.length;t++){let i=r[t];n.test(e[i])&&a.push(i)}else for(let t=0;t<e.length;t++)n.test(e[t])&&a.push(t);return a};let j=!!h,$=new RegExp(p,g),D=new RegExp(h,g);const k=(t,a,i)=>{let[o,s,l]=C(i,1),[c]=C(i,2),u=s.length,d=t.length,p=Array(d).fill(0),h={idx:Array(d),start:p.slice(),chars:p.slice(),terms:p.slice(),interIns:p.slice(),intraIns:p.slice(),interLft2:p.slice(),interRgt2:p.slice(),interLft1:p.slice(),interRgt1:p.slice(),ranges:Array(d)},m=1==r||1==n,f=0;for(let i=0;i<t.length;i++){let d=a[t[i]],p=d.match(o),b=p.index+p[1].length,v=b,y=!1,x=0,O=0,w=0,S=0,_=0,P=0,E=0,T=0,C=[];for(let t=0,a=2;t<u;t++,a+=2){let i=p[a].toLocaleLowerCase(),o=s[t],c='"'==o[0]?o.slice(1,-1):o+l[t],h=c.length,f=i.length,I=i==c;if(!I&&p[a+1].length>=h){let e=p[a+1].toLocaleLowerCase().indexOf(c);e>-1&&(C.push(v,f,e,h),v+=R(p,a,e,h),i=c,f=h,I=!0,0==t&&(b=v))}if(m||I){let e=v-1,o=v+f,s=!1,l=!1;if(-1==e||$.test(d[e]))I&&x++,s=!0;else{if(2==r){y=!0;break}if(j&&D.test(d[e]+d[e+1]))I&&O++,s=!0;else if(1==r){let e=p[a+1],r=v+f;if(e.length>=h){let n,o=0,l=!1,u=new RegExp(c,"ig"+g);for(;n=u.exec(e);){o=n.index;let e=r+o,t=e-1;if(-1==t||$.test(d[t])){x++,l=!0;break}if(D.test(d[t]+d[e])){O++,l=!0;break}}l&&(s=!0,C.push(v,f,o,h),v+=R(p,a,o,h),i=c,f=h,I=!0,0==t&&(b=v))}if(!s){y=!0;break}}}if(o==d.length||$.test(d[o]))I&&w++,l=!0;else{if(2==n){y=!0;break}if(j&&D.test(d[o-1]+d[o]))I&&S++,l=!0;else if(1==n){y=!0;break}}I&&(_+=h,s&&l&&P++)}if(f>h&&(T+=f-h),t>0&&(E+=p[a-1].length),!e.intraFilt(c,i,v)){y=!0;break}t<u-1&&(v+=f+p[a+1].length)}if(!y){h.idx[f]=t[i],h.interLft2[f]=x,h.interLft1[f]=O,h.interRgt2[f]=w,h.interRgt1[f]=S,h.chars[f]=_,h.terms[f]=P,h.interIns[f]=E,h.intraIns[f]=T,h.start[f]=b;let e=d.match(c),r=e.index+e[1].length,n=C.length,a=n>0?0:1/0,o=n-4;for(let t=2;t<e.length;){let n=e[t].length;if(a<=o&&C[a]==r){let n=C[a+1],i=C[a+2],o=C[a+3],s=t,l="";for(let t=0;t<n;s++)l+=e[s],t+=e[s].length;e.splice(t,s-t,l),r+=R(e,t,i,o),a+=4}else r+=n,t++}r=e.index+e[1].length;let s=h.ranges[f]=[],l=r,u=r;for(let t=2;t<e.length;t++){let n=e[t].length;r+=n,t%2==0?u=r:n>0&&(s.push(l,u),l=u=r)}u>l&&s.push(l,u),f++}}if(f<t.length)for(let e in h)h[e]=h[e].slice(0,f);return h},R=(e,t,r,n)=>{let a=e[t]+e[t+1].slice(0,r);return e[t-1]+=a,e[t]=e[t+1].slice(r,r+n),e[t+1]=e[t+1].slice(r+n),a.length};return{search:(...t)=>((t,r,n,a=1e3,i)=>{n=n?!0===n?5:n:0;let o=null,s=null,l=[];r=r.replace(y,(e=>{let t=e.trim().slice(1);return'"'===t[0]&&(t=Gi(t.slice(1,-1))),l.push(t),""}));let c,u=E(r);if(l.length>0){if(c=new RegExp(l.join("|"),"i"+g),0==u.length){let e=[];for(let r=0;r<t.length;r++)c.test(t[r])||e.push(r);return[e,null,null]}}else if(0==u.length)return[null,null,null];if(n>0){let e=E(r);if(e.length>1){let r=e.slice().sort(((e,t)=>t.length-e.length));for(let e=0;e<r.length;e++){if(0==i?.length)return[[],null,null];i=I(t,r[e],i)}if(e.length>n)return[i,null,null];o=to(e).map((e=>e.join(" "))),s=[];let a=new Set;for(let e=0;e<o.length;e++)if(a.size<i.length){let r=i.filter((e=>!a.has(e))),n=I(t,o[e],r);for(let e=0;e<n.length;e++)a.add(n[e]);s.push(n)}else s.push([])}}null==o&&(o=[r],s=[i?.length>0?i:I(t,r)]);let d=null,p=null;if(l.length>0&&(s=s.map((e=>e.filter((e=>!c.test(t[e])))))),s.reduce(((e,t)=>e+t.length),0)<=a){d={},p=[];for(let r=0;r<s.length;r++){let n=s[r];if(null==n||0==n.length)continue;let a=o[r],i=k(n,t,a),l=e.sort(i,t,a);if(r>0)for(let e=0;e<l.length;e++)l[e]+=p.length;for(let e in i)d[e]=(d[e]??[]).concat(i[e]);p=p.concat(l)}}return[[].concat(...s),d,p]})(...t),split:E,filter:I,info:k,sort:e.sort}}const eo=(()=>{let e={A:"ÃÃÃÃÃÄ",a:"Ã¡Ã Ã£Ã¢Ã¤Ä",E:"ÃÃÃÃÄ",e:"Ã©Ã¨ÃªÃ«Ä",I:"ÃÃÃÃÄ®",i:"Ã­Ã¬Ã®Ã¯Ä¯",O:"ÃÃÃÃÃ",o:"Ã³Ã²Ã´ÃµÃ¶",U:"ÃÃÃÃÅªÅ²",u:"ÃºÃ¹Ã»Ã¼Å«Å³",C:"ÃÄÄ",c:"Ã§ÄÄ",L:"Å",l:"Å",N:"ÃÅ",n:"Ã±Å",S:"Å Å",s:"Å¡Å",Z:"Å»Å¹",z:"Å¼Åº"},t=new Map,r="";for(let n in e)e[n].split("").forEach((e=>{r+=e,t.set(e,n)}));let n=new RegExp(`[${r}]`,"g"),a=e=>t.get(e);return e=>{if("string"==typeof e)return e.replace(n,a);let t=Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r].replace(n,a);return t}})();function to(e){let t,r,n=(e=e.slice()).length,a=[e.slice()],i=new Array(n).fill(0),o=1;for(;o<n;)i[o]<o?(t=o%2&&i[o],r=e[o],e[o]=e[t],e[t]=r,++i[o],o=1,a.push(e.slice())):(i[o]=0,++o);return a}const ro=(e,t)=>t?`<mark>${e}</mark>`:e,no=(e,t)=>e+t;Zi.latinize=eo,Zi.permute=e=>to([...Array(e.length).keys()]).sort(((e,t)=>{for(let r=0;r<e.length;r++)if(e[r]!=t[r])return e[r]-t[r];return 0})).map((t=>t.map((t=>e[t])))),Zi.highlight=function(e,t,r=ro,n="",a=no){n=a(n,r(e.substring(0,t[0]),!1))??n;for(let i=0;i<t.length;i+=2){let o=t[i],s=t[i+1];n=a(n,r(e.substring(o,s),!0))??n,i<t.length-3&&(n=a(n,r(e.substring(t[i+1],t[i+2]),!1))??n)}return a(n,r(e.substring(t[t.length-1]),!1))??n};const ao=new Zi({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1}),io=(0,t.debounce)((function(e,t,r){const[n,a,i]=ao.search(e,t,0,1e5);let o=[],s=new Set;if(n&&i){const t=(e,t)=>{t&&s.add(e)};for(let r=0;r<i.length;r++){let n=i[r];Zi.highlight(e[a.idx[n]],a.ranges[n],t),o.push(e[a.idx[n]])}r([o,[...s]])}else t||r([[],[]])}),300);var oo=Object.defineProperty,so=Object.defineProperties,lo=Object.getOwnPropertyDescriptors,co=Object.getOwnPropertySymbols,uo=Object.prototype.hasOwnProperty,po=Object.prototype.propertyIsEnumerable,ho=(e,t,r)=>t in e?oo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,mo=(e,t)=>{for(var r in t||(t={}))uo.call(t,r)&&ho(e,r,t[r]);if(co)for(var r of co(t))po.call(t,r)&&ho(e,r,t[r]);return e},fo=(e,t)=>so(e,lo(t));const go=e=>{var t;const{datasource:r,isOpen:n,onClose:a,onChange:i,query:o,initialMetrics:s}=e,[l,c]=(0,mt.useReducer)(vo.reducer,Wi(o)),u=(p=(0,bt.useTheme2)(),l.disableTextWrap,{modal:(0,Nr.css)({width:"85vw",[p.breakpoints.down("md")]:{width:"100%"},[p.breakpoints.up("xl")]:{width:"60%"}}),inputWrapper:(0,Nr.css)({display:"flex",flexDirection:"row",flexWrap:"wrap"}),inputItemFirst:(0,Nr.css)({flexBasis:"40%",paddingRight:"16px",[p.breakpoints.down("md")]:{paddingRight:"0px",paddingBottom:"16px"}}),inputItem:(0,Nr.css)({flexGrow:1,flexBasis:"20%",[p.breakpoints.down("md")]:{minWidth:"100%"}}),selectWrapper:(0,Nr.css)({marginBottom:p.spacing(1)}),resultsAmount:(0,Nr.css)({color:p.colors.text.secondary,fontSize:"0.85rem",padding:"0 0 4px 0"}),resultsData:(0,Nr.css)({margin:`4px 0 ${p.spacing(2)} 0`}),resultsDataCount:(0,Nr.css)({margin:0}),resultsDataFiltered:(0,Nr.css)({color:p.colors.text.secondary,textAlign:"center",border:"solid 1px rgba(204, 204, 220, 0.25)",padding:"7px"}),resultsDataFilteredText:(0,Nr.css)({display:"inline",verticalAlign:"text-top"}),results:(0,Nr.css)({height:"calc(80vh - 310px)",overflowY:"scroll"}),resultsFooter:(0,Nr.css)({marginTop:"24px",display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",position:"sticky"}),currentlySelected:(0,Nr.css)({color:"grey",opacity:"75%",fontSize:"0.75rem"}),loadingSpinner:(0,Nr.css)({visibility:"hidden"}),visible:(0,Nr.css)({visibility:"visible"}),settingsBtn:(0,Nr.css)({float:"right"}),noBorder:(0,Nr.css)({border:"none"}),resultsPerPageLabel:(0,Nr.css)({color:p.colors.text.secondary,opacity:"75%",paddingTop:"5px",fontSize:"0.85rem",marginRight:"8px"}),resultsPerPageWrapper:(0,Nr.css)({display:"flex"})}),d=(0,mt.useCallback)((async()=>{c(yo(!0));const e=await async function(e,t,r){var n,a;let i=!0;const o=e.languageProvider.metricsMetadata;o&&0===Object.keys(o).length&&(i=!1);let s,l={},c={};return s=null==r?void 0:r.map((t=>{const r=Oi(t,e),n=`${t}Â¦${r.description}`;return l[t]=r,c[n]=r,r})),{isLoading:!1,hasMetadata:i,metrics:null!=s?s:[],metaHaystackDictionary:c,nameHaystackDictionary:l,totalMetricCount:null!=(n=null==s?void 0:s.length)?n:0,filteredMetricCount:null!=(a=null==s?void 0:s.length)?a:0}}(r,0,s);c(xo({isLoading:!1,hasMetadata:e.hasMetadata,metrics:e.metrics,metaHaystackDictionary:e.metaHaystackDictionary,nameHaystackDictionary:e.nameHaystackDictionary,totalMetricCount:e.metrics.length,filteredMetricCount:e.metrics.length}))}),[o,r,s]);var p;(0,mt.useEffect)((()=>{d()}),[d]);const h=Ei.map((e=>({value:e.value,label:e.value,description:e.description}))),m=(0,mt.useMemo)((()=>fa()((async e=>{c(yo(!0));const t=await async function(e,t,r){const n=Ir(e),a=t.map((e=>`,${e.label}="${e.value}"`)),i=`label_values({__name__=~".*${n}"${t?a.join():""}},__name__)`,o=r.metricFindQuery(i);return await o.then((e=>e.map((e=>Oi(e.text,r)))))}(e,o.labels,r);c(Oo({metrics:t,filteredMetricCount:t.length,isLoading:!1}))}),r.getDebounceTimeInMilliseconds())),[r,o]);function f(e){c(Po(e))}function g(e){c(Eo(e))}function b(e,t){l.useBackend&&""===e?d():l.useBackend?m(e):t?io(Object.keys(l.metaHaystackDictionary),e,g):io(Object.keys(l.nameHaystackDictionary),e,f)}const v=(0,ht.jsx)(Ti,{state:l,onChangeFullMetaSearch:()=>{const e=!l.fullMetaSearch;c(To(e)),i(fo(mo({},o),{fullMetaSearch:e})),b(l.fuzzySearchQuery,e)},onChangeIncludeNullMetadata:()=>{c(Co(!l.includeNullMetadata)),i(fo(mo({},o),{includeNullMetadata:!l.includeNullMetadata}))},onChangeDisableTextWrap:()=>{c($o()),i(fo(mo({},o),{disableTextWrap:!l.disableTextWrap})),Pi("grafana_prom_metric_encycopedia_disable_text_wrap_interaction",l,"")},onChangeUseBackend:()=>{const e=!l.useBackend;c(jo(e)),i(fo(mo({},o),{useBackend:e})),!1===e?d():""!==l.fuzzySearchQuery&&m(l.fuzzySearchQuery)}});return(0,ht.jsxs)(bt.Modal,{"data-testid":bo.metricModal,isOpen:n,title:"Metrics explorer",onDismiss:a,"aria-label":"Browse metrics",className:u.modal,children:[(0,ht.jsx)(Ci,{feedbackUrl:"https://forms.gle/DEMAJHoAMpe3e54CA"}),(0,ht.jsxs)("div",{className:u.inputWrapper,"data-testid":Tn.components.DataSource.Prometheus.queryEditor.builder.metricsExplorer,children:[(0,ht.jsx)("div",{className:(0,Nr.cx)(u.inputItem,u.inputItemFirst),children:(0,ht.jsx)(bt.Input,{autoFocus:!0,"data-testid":bo.searchMetric,placeholder:"Search metrics by name",value:l.fuzzySearchQuery,onInput:e=>{var t;const r=null!=(t=e.currentTarget.value)?t:"";c(_o(r)),b(r,l.fullMetaSearch)}})}),l.hasMetadata&&(0,ht.jsx)("div",{className:u.inputItem,children:(0,ht.jsx)(bt.MultiSelect,{"data-testid":bo.selectType,inputId:"my-select",options:h,value:l.selectedTypes,placeholder:"Filter by type",onChange:e=>c(Io(e))})}),(0,ht.jsx)("div",{children:(0,ht.jsx)(bt.Spinner,{className:`${u.loadingSpinner} ${l.isLoading?u.visible:""}`})}),(0,ht.jsx)("div",{className:u.inputItem,children:(0,ht.jsx)(bt.Toggletip,{"aria-label":"Additional settings",content:v,placement:"bottom-end",closeButton:!1,children:(0,ht.jsxs)(bt.ButtonGroup,{className:u.settingsBtn,children:[(0,ht.jsx)(bt.Button,{variant:"secondary",size:"md",onClick:()=>c(Do()),"data-testid":bo.showAdditionalSettings,className:u.noBorder,children:"Additional Settings"}),(0,ht.jsx)(bt.Button,{className:u.noBorder,variant:"secondary",icon:l.showAdditionalSettings?"angle-up":"angle-down"})]})})})]}),(0,ht.jsxs)("div",{className:u.resultsData,children:[o.metric&&(0,ht.jsxs)("i",{className:u.currentlySelected,children:["Currently selected: ",o.metric]}),o.labels.length>0&&(0,ht.jsxs)("div",{className:u.resultsDataFiltered,children:[(0,ht.jsx)(bt.Icon,{name:"info-circle",size:"sm"}),(0,ht.jsx)("div",{className:u.resultsDataFilteredText,children:"Â These metrics have been pre-filtered by labels chosen in the label filters."})]})]}),(0,ht.jsx)("div",{className:u.results,children:l.metrics&&(0,ht.jsx)(qi,{metrics:wi(l,c),onChange:i,onClose:a,query:o,state:l,disableTextWrap:l.disableTextWrap})}),(0,ht.jsxs)("div",{className:u.resultsFooter,children:[(0,ht.jsxs)("div",{className:u.resultsAmount,children:["Showing ",l.filteredMetricCount," of ",l.totalMetricCount," results"]}),(0,ht.jsx)(bt.Pagination,{currentPage:null!=(t=l.pageNum)?t:1,numberOfPages:_i(l).length,onNavigate:e=>{c(So(null!=e?e:1))}}),(0,ht.jsxs)("div",{className:u.resultsPerPageWrapper,children:[(0,ht.jsx)("p",{className:u.resultsPerPageLabel,children:"# Results per pageÂ "}),(0,ht.jsx)(bt.Input,{"data-testid":bo.resultsPerPage,value:(y=l.resultsPerPage,x=100,O=Vi,y<1?1:y>O?O:null!=y?y:x),placeholder:"results per page",width:10,title:"The maximum results per page is "+Vi,type:"number",onInput:e=>{const t=+e.currentTarget.value;isNaN(t)||t>=Vi||c(wo(t))}})]})]})]});var y,x,O},bo={metricModal:"metric-modal",searchMetric:"search-metric",searchWithMetadata:"search-with-metadata",selectType:"select-type",metricCard:"metric-card",useMetric:"use-metric",searchPage:"search-page",resultsPerPage:"results-per-page",setUseBackend:"set-use-backend",showAdditionalSettings:"show-additional-settings"},vo=bi({name:"metrics-modal-state",initialState:Wi(),reducers:{filterMetricsBackend:(e,t)=>{e.metrics=t.payload.metrics,e.filteredMetricCount=t.payload.filteredMetricCount,e.isLoading=t.payload.isLoading},buildMetrics:(e,t)=>{e.isLoading=t.payload.isLoading,e.metrics=t.payload.metrics,e.hasMetadata=t.payload.hasMetadata,e.metaHaystackDictionary=t.payload.metaHaystackDictionary,e.nameHaystackDictionary=t.payload.nameHaystackDictionary,e.totalMetricCount=t.payload.totalMetricCount,e.filteredMetricCount=t.payload.filteredMetricCount},setIsLoading:(e,t)=>{e.isLoading=t.payload},setFilteredMetricCount:(e,t)=>{e.filteredMetricCount=t.payload},setResultsPerPage:(e,t)=>{e.resultsPerPage=t.payload},setPageNum:(e,t)=>{e.pageNum=t.payload},setFuzzySearchQuery:(e,t)=>{e.fuzzySearchQuery=t.payload,e.pageNum=1},setNameHaystack:(e,t)=>{e.nameHaystackOrder=t.payload[0],e.nameHaystackMatches=t.payload[1]},setMetaHaystack:(e,t)=>{e.metaHaystackOrder=t.payload[0],e.metaHaystackMatches=t.payload[1]},setFullMetaSearch:(e,t)=>{e.fullMetaSearch=t.payload,e.pageNum=1},setIncludeNullMetadata:(e,t)=>{e.includeNullMetadata=t.payload,e.pageNum=1},setSelectedTypes:(e,t)=>{e.selectedTypes=t.payload,e.pageNum=1},setUseBackend:(e,t)=>{e.useBackend=t.payload,e.fullMetaSearch=!1,e.pageNum=1},setDisableTextWrap:e=>{e.disableTextWrap=!e.disableTextWrap},showAdditionalSettings:e=>{e.showAdditionalSettings=!e.showAdditionalSettings}}}),{setIsLoading:yo,buildMetrics:xo,filterMetricsBackend:Oo,setResultsPerPage:wo,setPageNum:So,setFuzzySearchQuery:_o,setNameHaystack:Po,setMetaHaystack:Eo,setFullMetaSearch:To,setIncludeNullMetadata:Co,setSelectedTypes:Io,setUseBackend:jo,setDisableTextWrap:$o,showAdditionalSettings:Do,setFilteredMetricCount:ko}=vo.actions;var Ro=Object.defineProperty,Ao=Object.defineProperties,No=Object.getOwnPropertyDescriptors,Lo=Object.getOwnPropertySymbols,Mo=Object.prototype.hasOwnProperty,Fo=Object.prototype.propertyIsEnumerable,Bo=(e,t,r)=>t in e?Ro(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,qo=(e,t)=>{for(var r in t||(t={}))Mo.call(t,r)&&Bo(e,r,t[r]);if(Lo)for(var r of Lo(t))Fo.call(t,r)&&Bo(e,r,t[r]);return e},Qo=(e,t)=>Ao(e,No(t));function Vo({datasource:t,query:r,onChange:n,onGetMetrics:a,labelsFilters:i,metricLookupDisabled:o,onBlur:s,variableEditor:l}){var c;const u=(0,bt.useStyles2)(Wo),[d,p]=(0,mt.useState)({}),h=j.config.featureToggles.prometheusMetricEncyclopedia,m=[{value:"BrowseMetrics",label:"Metrics explorer",description:"Browse and filter all metrics and metadata with a fuzzy search"}],f=(0,mt.useCallback)(((e,t)=>{var r;const n=null!=(r=e.label)?r:e.value;return!!n&&(!n.toLowerCase||t.split(" ").reduce(((e,t)=>{const r=n.toLowerCase().includes(t.toLowerCase());let a=!1;return h&&(a="Metrics explorer"===n),e&&(r||a)}),!0))}),[h]),g=(0,mt.useCallback)(((e,t)=>{var r;return e.__isNew__?e.label:(0,ht.jsx)(ba(),{searchWords:t.inputValue.split(" "),textToHighlight:null!=(r=e.label)?r:"",highlightClassName:u.highlight})}),[u.highlight]),b=()=>Promise.resolve([]),v=fa()((e=>(e=>{const r=t.metricFindQuery(((e,t)=>{const r=Ir(e);return zo(r,t)})(e,i));return r.then((e=>{const t=e.length;hs(e),t>e.length?p(Qo(qo({},d),{resultsTruncated:!0})):p(Qo(qo({},d),{resultsTruncated:!1}));const r=e.map((e=>({label:e.text,value:e.text})));return h?[...m,...r]:r}))})(e)),t.getDebounceTimeInMilliseconds()),y=e=>{const t=e.data;if("BrowseMetrics"===t.value){const r=e.isFocused?u.focus:"";return(0,ht.jsx)("div",Qo(qo({},e.innerProps),{ref:e.innerRef,className:`${u.customOptionWidth} metric-encyclopedia-open`,"data-testid":Tn.components.Select.option,onKeyDown:e=>{"Enter"===e.code&&p(Qo(qo({},d),{metricsModalOpen:!0}))},children:(0,ht.jsxs)("div",{className:`${u.customOption} ${r} metric-encyclopedia-open`,children:[(0,ht.jsxs)("div",{children:[(0,ht.jsx)("div",{className:"metric-encyclopedia-open",children:t.label}),(0,ht.jsx)("div",{className:`${u.customOptionDesc} metric-encyclopedia-open`,children:t.description})]}),(0,ht.jsxs)(bt.Button,{fill:"text",size:"sm",variant:"secondary",onClick:()=>p(Qo(qo({},d),{metricsModalOpen:!0})),className:"metric-encyclopedia-open",children:["Open",(0,ht.jsx)(bt.Icon,{name:"arrow-right"})]})]})}))}return(0,bt.SelectMenuOptions)(e)},x=({children:e,maxHeight:t,innerRef:r,innerProps:n})=>{const a=(0,bt.useTheme2)(),i=(0,bt.getSelectStyles)(a),o=!mt.isValidElement(e)&&d.resultsTruncated;return(0,ht.jsxs)("div",Qo(qo({},n),{className:`${i.menu} ${u.customMenuContainer}`,style:{maxHeight:Math.round(.9*t)},"aria-label":"Select options menu",children:[(0,ht.jsx)(bt.CustomScrollbar,{scrollRefCallback:r,autoHide:!1,autoHeightMax:"inherit",hideHorizontalTrack:!0,showScrollIndicators:!0,children:e}),o&&(0,ht.jsx)("div",{className:u.customMenuFooter,children:(0,ht.jsx)("div",{children:"Only the top 1000 metrics are displayed in the metric select. Use the metrics explorer to view all metrics."})})]}))},O=()=>{var t;return(0,ht.jsx)(bt.AsyncSelect,{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.builder.metricSelect,isClearable:Boolean(l),inputId:"prometheus-metric-select",className:u.select,value:r.metric?(0,e.toOption)(r.metric):void 0,placeholder:"Select metric",allowCustomValue:!0,formatOptionLabel:g,filterOption:f,minMenuHeight:250,onOpenMenu:async()=>{if(o)return;p({isLoading:!0});const e=await a(),t=e.map((e=>e.value)),r=e.length;e.length>1e3&&hs(e),p(h?{metrics:[...m,...e],isLoading:void 0,initialMetrics:t,resultsTruncated:r>e.length}:{metrics:e,isLoading:void 0,resultsTruncated:r>e.length})},loadOptions:o?b:v,isLoading:d.isLoading,defaultOptions:null!=(t=d.metrics)?t:Array.from(new Array(25),(()=>({value:""}))),onChange:e=>{const t=null==e?void 0:e.value;t?h&&"BrowseMetrics"===t?(Pi("grafana_prometheus_metric_encyclopedia_open",null,"",r),p(Qo(qo({},d),{metricsModalOpen:!0}))):n(Qo(qo({},r),{metric:t})):n(Qo(qo({},r),{metric:""}))},components:h?{Option:y,MenuList:x}:{MenuList:x},onBlur:s})};return(0,ht.jsxs)(ht.Fragment,{children:[h&&!t.lookupsDisabled&&d.metricsModalOpen&&(0,ht.jsx)(go,{datasource:t,isOpen:d.metricsModalOpen,onClose:()=>p(Qo(qo({},d),{metricsModalOpen:!1})),query:r,onChange:n,initialMetrics:null!=(c=d.initialMetrics)?c:[]}),l?(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Metric",labelWidth:20,tooltip:(0,ht.jsx)("div",{children:"Optional: returns a list of label values for the label name in the specified metric."}),children:O()})}):(0,ht.jsx)(va,{children:(0,ht.jsx)(Jr,{label:"Metric",children:O()})})]})}const Wo=e=>({select:(0,Nr.css)({minWidth:"125px"}),highlight:(0,Nr.css)({label:"select__match-highlight",background:"inherit",padding:"inherit",color:e.colors.warning.contrastText,backgroundColor:e.colors.warning.main}),customOption:(0,Nr.css)({padding:"8px",display:"flex",justifyContent:"space-between",cursor:"pointer",":hover":{backgroundColor:e.colors.emphasize(e.colors.background.primary,.1)}}),customOptionlabel:(0,Nr.css)({color:e.colors.text.primary}),customOptionDesc:(0,Nr.css)({color:e.colors.text.secondary,fontSize:e.typography.size.xs,opacity:"50%"}),focus:(0,Nr.css)({backgroundColor:e.colors.emphasize(e.colors.background.primary,.1)}),customOptionWidth:(0,Nr.css)({minWidth:"400px"}),customMenuFooter:(0,Nr.css)({flex:0,display:"flex",justifyContent:"space-between",padding:e.spacing(1.5),borderTop:`1px solid ${e.colors.border.weak}`,color:e.colors.text.secondary}),customMenuContainer:(0,Nr.css)({display:"flex",flexDirection:"column",background:e.colors.background.primary,boxShadow:e.shadows.z3})}),zo=(e,t)=>{const r=t?Uo(t):[];return`label_values({__name__=~".*${e}"${r?r.join(""):""}},__name__)`},Uo=e=>e.map((e=>`,${e.label}="${e.value}"`));var Go=Object.defineProperty,Ho=Object.getOwnPropertySymbols,Xo=Object.prototype.hasOwnProperty,Yo=Object.prototype.propertyIsEnumerable,Ko=(e,t,r)=>t in e?Go(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Jo=(e,t)=>{for(var r in t||(t={}))Xo.call(t,r)&&Ko(e,r,t[r]);if(Ho)for(var r of Ho(t))Yo.call(t,r)&&Ko(e,r,t[r]);return e},Zo=(e,t)=>{var r={};for(var n in e)Xo.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Ho)for(var n of Ho(e))t.indexOf(n)<0&&Yo.call(e,n)&&(r[n]=e[n]);return r};const es=e=>{const t=new Set,r=new RegExp("_bucket($|:)");for(let n=0;n<e.length;n++){const a=e[n];r.test(a)&&t.add(a)}return[...t]},ts=/\b(\w+)(!?=~?)("[^"\n]*?")(,)?(\s*)?/g;function rs(e){return t=e/1e3,Math.floor(t/60);var t}function ns(e){return e.slice(0,sa)}const as=/[*+?()|\\.\[\]{}^$]/g;function is(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function os(e){return is(e.replace(as,"\\$&"))}const ss={"=":e.AbstractLabelOperator.Equal,"!=":e.AbstractLabelOperator.NotEqual,"=~":e.AbstractLabelOperator.EqualRegEx,"!~":e.AbstractLabelOperator.NotEqualRegEx},ls=(0,t.invert)(ss);function cs(e){const t=e.labelMatchers.map((e=>{const t=ls[e.operator];return t?`${e.name}${t}"${e.value}"`:""})).filter((e=>""!==e)).join(", ");return t?`{${t}}`:""}function us(e){return"string"==typeof e.content?e.content:""}function ds(e){switch(e){case Un.Medium:return 10;case Un.High:return 60;default:return 1}}function ps(t,r){return"string"==typeof t&&(t=e.dateMath.parse(t,r)),Math.ceil(t.valueOf()/1e3)}function hs(e,t){return void 0===t&&(t=1e3),e.length=Math.min(e.length,t),e}var ms={id:"promql",extensions:[".promql"],aliases:["Prometheus","prometheus","prom","Prom","promql","Promql","promQL","PromQL"],mimetypes:[],loader:function(){return Promise.all([b.e(7963),b.e(2096)]).then(b.bind(b,7963))}};const fs=function(e){var t=(0,mt.useRef)(e);return t.current=e,t},gs={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let bs;const vs=new Uint8Array(16);function ys(){if(!bs&&(bs="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!bs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return bs(vs)}const xs=[];for(let e=0;e<256;++e)xs.push((e+256).toString(16).slice(1));const Os=function(e,t,r){if(gs.randomUUID&&!t&&!e)return gs.randomUUID();const n=(e=e||{}).random||(e.rng||ys)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return xs[e[t+0]]+xs[e[t+1]]+xs[e[t+2]]+xs[e[t+3]]+"-"+xs[e[t+4]]+xs[e[t+5]]+"-"+xs[e[t+6]]+xs[e[t+7]]+"-"+xs[e[t+8]]+xs[e[t+9]]+"-"+xs[e[t+10]]+xs[e[t+11]]+xs[e[t+12]]+xs[e[t+13]]+xs[e[t+14]]+xs[e[t+15]]}(n)};function ws(){const e=new Map;return e.set("expandSuggestionDocs",(!0).toString()),{onDidChangeValue:e=>{},onDidChangeTarget:e=>{},onWillSaveState:e=>{},get:(t,r,n)=>{var a;return null!=(a=e.get(t))?a:n},getBoolean:(t,r,n)=>{const a=e.get(t);return void 0!==a?"true"===a:n},getNumber:(t,r,n)=>{const a=e.get(t);return void 0!==a?parseInt(a,10):n},store:(t,r,n,a)=>{null==r?e.delete(t):e.set(t,r.toString())},remove:(t,r)=>{e.delete(t)},keys:(t,r)=>Array.from(e.keys()),logStorage:()=>{console.log("logStorage: not implemented")},migrate:()=>Promise.resolve(void 0),isNew:e=>!0,flush:e=>Promise.resolve(void 0)}}let Ss=null;class _s extends Error{constructor(e){super("should never happen")}}const Ps=new Zi({intraMode:1});function Es(e){var t,r;let n=e.getAllMetricNames();if(j.config.featureToggles.prometheusCodeModeMetricNamesSearch&&n.length>e.metricNamesSuggestionLimit){const{monacoSettings:a}=e;a.enableAutocompleteSuggestionsUpdate(),n=a.inputInRange?null!=(r=null==(t=Ps.filter(n,a.inputInRange))?void 0:t.slice(0,e.metricNamesSuggestionLimit).map((e=>n[e])))?r:[]:n.slice(0,e.metricNamesSuggestionLimit)}return e.metricNamesToMetrics(n).map((e=>({type:"METRIC_NAME",label:e.name,insertText:e.name,detail:`${e.name} : ${e.type}`,documentation:e.help})))}const Ts=ct.map((e=>{var t;return{type:"FUNCTION",label:e.label,insertText:null!=(t=e.insertText)?t:"",detail:e.detail,documentation:e.documentation}}));const Cs=["$__interval","$__range","$__rate_interval","1m","5m","10m","30m","1h","1d"].map((e=>({type:"DURATION",label:e,insertText:e})));function Is(e,t){const r=[...t];return void 0!==e&&r.push({name:"__name__",value:e,op:"="}),`{${r.map((e=>`${e.name}${e.op}"${is(e.value)}"`)).join(",")}}`}async function js(e,t,r,n,a){const i=await async function(e,t,r){if(void 0===e&&0===t.length)return Promise.resolve(r.getAllLabelNames());{const n=Is(e,t);return await r.getSeriesLabels(n,t)}}(e,n,a);return i.map((e=>({type:"LABEL_NAME",label:e,insertText:`${e}${t}`,triggerOnInsert:r})))}function $s(e,t){switch(e.type){case"IN_DURATION":return Promise.resolve(Cs);case"IN_FUNCTION":case"AT_ROOT":return async function(e){const t=Es(e);return[...Ts,...t]}(t);case"EMPTY":{const e=Es(t),r=function(e){return e.getHistory().slice(0,10).map((e=>({type:"HISTORY",label:e,insertText:e})))}(t);return Promise.resolve([...r,...Ts,...e])}case"IN_LABEL_SELECTOR_NO_LABEL_NAME":return async function(e,t,r){return js(e,"=",!0,t,r)}(e.metricName,e.otherLabels,t);case"IN_GROUPING":return async function(e,t,r){return js(e,"",!1,t,r)}(e.metricName,e.otherLabels,t);case"IN_LABEL_SELECTOR_WITH_LABEL_NAME":return async function(e,t,r,n,a){const i=await async function(e,t,r,n){if(void 0===e&&0===r.length)return n.getLabelValues(t);{const a=Is(e,r);return await n.getSeriesValues(t,a)}}(e,t,n,a);return i.map((e=>({type:"LABEL_VALUE",label:e,insertText:r?e:`"${e}"`})))}(e.metricName,e.labelName,e.betweenQuotes,e.otherLabels,t);default:throw new _s(e)}}function Ds(e,t){switch(t){case"parent":return e.parent;case"firstChild":return e.firstChild;case"lastChild":return e.lastChild;case"nextSibling":return e.nextSibling;default:throw new _s(t)}}function ks(e,t){let r=e;for(const[e,n]of t){if(r=Ds(r,e),null===r)return null;if(r.type.id!==n)return null}return r}function Rs(e,t){return t.slice(e.from,e.to)}function As(e,t){return e.every(((e,r)=>e===t[r]))}const Ns=[{path:[139,st],fun:function(e,t,r){const n=ks(e,[["firstChild",lt]]);if(null!==n&&!t.slice(n.to,r).includes(","))return null;const a=ks(e,[["parent",st],["firstChild",53]]),i=Ms(e,t);return null===a?{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",otherLabels:i}:{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",metricName:Rs(a,t),otherLabels:i}}},{path:[28],fun:qs},{path:[34],fun:function(e,t,r){return{type:"IN_FUNCTION"}}},{path:[ot,lt],fun:Bs},{path:[0,35,28],fun:qs},{path:[0,lt],fun:Bs},{path:[0,129],fun:function(e,t,r){return{type:"IN_DURATION"}}},{path:[32],fun:function(e,t,r){const n=ks(e,[["parent",31],["parent",29]]);if(null===n)return null;const a=n.getChild(34);if(null===a)return null;const i=Fs(a,53);return null===i?null:{type:"IN_GROUPING",metricName:Rs(i,t),otherLabels:[]}}}],Ls=new Map([[142,"="],[143,"=~"],[49,"!="],[144,"!~"]]);function Ms(e,t){return 139!==e.type.id?[]:e.getChildren(lt).map((e=>function(e,t){if(e.type.id!==lt)return null;const r=ks(e,[["firstChild",33]]);if(null===r)return null;const n=ks(r,[["nextSibling",141]]);if(null===n)return null;const a=function(e){var t;const r=e.firstChild;return null===r?null:null!=(t=Ls.get(r.type.id))?t:null}(n);if(null===a)return null;const i=ks(e,[["lastChild",ot]]);if(null===i)return null;const o=Rs(r,t),s=function(e){const t=e.slice(1,e.length-1);if(e.startsWith('"')&&e.endsWith('"'))return t.replace(/\\"/,'"');if(e.startsWith("'")&&e.endsWith("'"))return t.replace(/\\'/,"'");if(e.startsWith("`")&&e.endsWith("`"))return t;throw new Error("FIXME: invalid string literal")}(Rs(i,t));return{name:o,value:s,op:a}}(e,t))).filter(Qs)}function Fs(e,t){if(e.type.id===t)return e;const r=function(e){let t=e.firstChild;const r=[];for(;null!==t;)r.push(t),t=t.nextSibling;return r}(e);for(const e of r){const r=Fs(e,t);if(null!==r)return r}return null}function Bs(e,t,r){const n=!e.type.isError,a=ks(e,[["parent",lt]]);if(null===a)return null;const i=ks(a,[["firstChild",33]]);if(null===i)return null;const o=Rs(i,t),s=ks(a,[["parent",139]]);if(null===s)return null;const l=Ms(s,t).filter((e=>e.name!==o)),c=ks(s,[["parent",st],["firstChild",53]]);return null===c?{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",labelName:o,betweenQuotes:n,otherLabels:l}:{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",metricName:Rs(c,t),labelName:o,betweenQuotes:n,otherLabels:l}}function qs(e,t,r){return{type:"AT_ROOT"}}function Qs(e){return null!=e}function Vs(e,t){switch(e){case"DURATION":return t.languages.CompletionItemKind.Unit;case"FUNCTION":return t.languages.CompletionItemKind.Variable;case"HISTORY":return t.languages.CompletionItemKind.Snippet;case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;case"METRIC_NAME":return t.languages.CompletionItemKind.Constructor;default:throw new _s(e)}}var Ws=Object.defineProperty,zs=(e,t,r)=>(((e,t,r)=>{t in e?Ws(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);const Us="codeModeSuggestionsIncomplete";class Gs{constructor(e){zs(this,"languageProvider"),zs(this,"historyProvider"),zs(this,"getSeriesLabels"),zs(this,"getSeriesValues"),zs(this,"getAllLabelNames"),zs(this,"getLabelValues"),zs(this,"metricNamesSuggestionLimit"),zs(this,"inputInRange"),zs(this,"suggestionsIncomplete"),this.languageProvider=e.languageProvider,this.historyProvider=e.historyProvider,this.inputInRange="",this.metricNamesSuggestionLimit=this.languageProvider.datasource.metricNamesAutocompleteSuggestionLimit,this.suggestionsIncomplete=!1,this.getSeriesLabels=this.languageProvider.getSeriesLabels.bind(this.languageProvider),this.getSeriesValues=this.languageProvider.getSeriesValues.bind(this.languageProvider),this.getAllLabelNames=this.languageProvider.getLabelKeys.bind(this.languageProvider),this.getLabelValues=this.languageProvider.getLabelValues.bind(this.languageProvider)}getHistory(){return this.historyProvider.map((e=>e.query.expr)).filter(Boolean)}getAllMetricNames(){return this.languageProvider.metrics}metricNamesToMetrics(e){const{metricsMetadata:t}=this.languageProvider;return e.map((e=>{var r,n;const a=null==t?void 0:t[e];return{name:e,help:null!=(r=null==a?void 0:a.help)?r:"",type:null!=(n=null==a?void 0:a.type)?n:""}}))}enableAutocompleteSuggestionsUpdate(){this.suggestionsIncomplete=!0,dispatchEvent(new CustomEvent(Us,{detail:{limit:this.metricNamesSuggestionLimit,datasourceUid:this.languageProvider.datasource.uid}}))}setInputInRange(e){this.inputInRange=e}get monacoSettings(){return{enableAutocompleteSuggestionsUpdate:this.enableAutocompleteSuggestionsUpdate.bind(this),inputInRange:this.inputInRange,setInputInRange:this.setInputInRange.bind(this),suggestionsIncomplete:this.suggestionsIncomplete}}}function Hs(e,t){const r=[];return t.parse(e).iterate({enter:t=>{if(0===t.type.id){const n=t.node;r.push({node:n,text:e.substring(n.from,n.to)})}}}),r}function Xs(e){return null!==e}const Ys={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}},Ks={wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,comments:{lineComment:"#"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"<",close:">"}],folding:{}},Js=["sum","min","max","avg","group","stddev","stdvar","count","count_values","bottomk","topk","quantile"],Zs=[];for(let e=0,t=Js;e<t.length;e++){let r=t[e];Zs.push(r+"_over_time")}const el=["on","ignoring","group_right","group_left","by","without"],tl="("+el.reduce((function(e,t){return e+"|"+t}))+")",rl={ignoreCase:!1,defaultToken:"",tokenPostfix:".promql",keywords:Js.concat(["abs","absent","ceil","changes","clamp_max","clamp_min","day_of_month","day_of_week","days_in_month","delta","deriv","exp","floor","histogram_quantile","histogram_avg","histogram_count","histogram_sum","histogram_fraction","histogram_stddev","histogram_stdvar","holt_winters","hour","idelta","increase","irate","label_join","label_replace","ln","log2","log10","minute","month","predict_linear","rate","resets","round","scalar","sort","sort_desc","sqrt","time","timestamp","vector","year"]).concat(Zs).concat(el).concat(["offset"]),operators:["+","-","*","/","%","^","==","!=",">","<",">=","<=","and","or","unless"],vectorMatching:tl,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/@vectorMatching\s*(?=\()/,"type","@clauses"],[/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,"tag"],[/(^#.*$)/,"comment"],[/[a-zA-Z_]\w*/,{cases:{"@keywords":"type","@default":"identifier"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+[smhdwy]/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/[^\\`$]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}};var nl=Object.defineProperty,al=Object.defineProperties,il=Object.getOwnPropertyDescriptors,ol=Object.getOwnPropertySymbols,sl=Object.prototype.hasOwnProperty,ll=Object.prototype.propertyIsEnumerable,cl=(e,t,r)=>t in e?nl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ul=(e,t)=>{for(var r in t||(t={}))sl.call(t,r)&&cl(e,r,t[r]);if(ol)for(var r of ol(t))ll.call(t,r)&&cl(e,r,t[r]);return e};const dl={codeLens:!1,contextmenu:!1,fixedOverflowWidgets:!0,folding:!1,fontSize:14,lineDecorationsWidth:8,lineNumbers:"off",minimap:{enabled:!1},overviewRulerBorder:!1,overviewRulerLanes:0,padding:{top:4,bottom:5},renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0,alwaysConsumeMouseWheel:!1},scrollBeyondLastLine:!1,suggest:{showWords:!1},suggestFontSize:12,wordWrap:"on"},pl=ms.id;let hl=!1;const ml=e=>{const r=Os(),n=(0,mt.useRef)((null===Ss&&(Ss={storageService:ws()}),Ss)),a=(0,mt.useRef)(null),{languageProvider:i,history:o,onBlur:s,onRunQuery:l,initialValue:c,placeholder:u,onChange:d,datasource:p}=e,h=fs(i),m=fs(o),f=fs(l),g=fs(s),v=fs(d),y=(0,mt.useRef)(null),x=((e,t)=>({container:(0,Nr.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,display:"flex",flexDirection:"row",justifyContent:"start",alignItems:"center",height:"100%"}),placeholder:(0,Nr.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.6}})}))((0,bt.useTheme2)(),u);return(0,mt.useEffect)((()=>()=>{var e;null==(e=y.current)||e.call(y)}),[]),(0,ht.jsx)("div",{"data-testid":Tn.components.QueryField.container,className:x.container,ref:a,children:(0,ht.jsx)(bt.ReactMonacoEditor,{overrideServices:n.current,options:dl,language:"promql",value:c,beforeMount:e=>{!function(e){if(!1===hl){hl=!0;const{aliases:t,extensions:r,mimetypes:n}=ms;e.languages.register({id:pl,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(pl,rl),e.languages.setLanguageConfiguration(pl,Ks)}}(e)},onMount:(e,n)=>{var i;const o=e.createContextKey("isEditorFocused"+r,!1);e.onDidBlurEditorWidget((()=>{o.set(!1),g.current(e.getValue())})),e.onDidFocusEditorText((()=>{o.set(!0)}));const s=new Gs({historyProvider:m.current,languageProvider:h.current}),l=function(e,t){return{triggerCharacters:["{",",","[","(","=","~"," ",'"'],provideCompletionItems:(r,n)=>{var a;const i=r.getWordAtPosition(n),o=null!=i?e.Range.lift({startLineNumber:n.lineNumber,endLineNumber:n.lineNumber,startColumn:i.startColumn,endColumn:i.endColumn}):e.Range.fromPositions(n),s={column:n.column,lineNumber:n.lineNumber};if(t.monacoSettings.setInputInRange(r.getValueInRange(o)),window.getSelection){const e=null==(a=window.getSelection())?void 0:a.toString();e&&e.length>0&&(s.column=s.column-e.length)}const l=r.getOffsetAt(s),c=function(e,t){if(""===e)return{type:"EMPTY"};const r=at.parse(e),n=function(e,t){const r=e.cursorAt(t);for(;;){if(r.from===t&&r.to===t){const{node:e}=r;if(e.type.isError)return e}if(!r.next())break}return null}(r,t),a=null!=n?n.cursor():r.cursorAt(t),i=a.node,o=[a.type.id];for(;a.parent();)o.push(a.type.id);for(let r of Ns)if(As(r.path,o))return r.fun(i,e,t);return null}(r.getValue(),l);return(null!=c?$s(c,t):Promise.resolve([])).then((r=>{const n=r.length.toString().length,a=r.map(((t,r)=>({kind:Vs(t.type,e),label:t.label,insertText:t.insertText,detail:t.detail,documentation:t.documentation,sortText:r.toString().padStart(n,"0"),range:o,command:t.triggerOnInsert?{id:"editor.action.triggerSuggest",title:""}:void 0})));return{suggestions:a,incomplete:t.monacoSettings.suggestionsIncomplete}}))}}}(n,s),c=(d=ul({},l),O={provideCompletionItems:(t,r,n,a)=>{var i;return(null==(i=e.getModel())?void 0:i.id)!==t.id?{suggestions:[]}:l.provideCompletionItems(t,r,n,a)}},al(d,il(O)));var d,O;const{dispose:w}=n.languages.registerCompletionItemProvider(pl,c);y.current=w;const S=()=>{const t=a.current;if(null!==t){const r=e.getContentHeight();t.style.height=`${r+2}px`,t.style.width="100%";const n=t.clientWidth;e.layout({width:n,height:r})}};e.onDidContentSizeChange(S),S();const _=(0,t.debounce)((()=>{const t=e.getValue();v.current(t)}),h.current.datasource.getDebounceTimeInMilliseconds());if(null==(i=e.getModel())||i.onDidChangeContent((()=>{_()})),e.addCommand(n.KeyMod.Shift|n.KeyCode.Enter,(()=>{f.current(e.getValue())}),"isEditorFocused"+r),n.editor.addKeybindingRule({keybinding:n.KeyMod.CtrlCmd|n.KeyCode.KeyF,command:null}),e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.KeyK,(function(){b.g.dispatchEvent(new KeyboardEvent("keydown",{key:"k",metaKey:!0}))})),u){const t=[{range:new n.Range(1,1,1,1),options:{className:x.placeholder,isWholeLine:!0}}];let r=[];const a=()=>{const n=e.getModel();if(!n)return;const a=0===n.getValueLength()?t:[];r=n.deltaDecorations(r,a)};a(),e.onDidChangeModelContent(a),e.onDidChangeModelContent((t=>{const r=e.getModel();if(!r)return;const a=r.getValue(),i=function(e,t,r,n){if(!e)return!1;const a=Hs(t,n);if(!a.length)return!1;let i=a;if(e!==t){const t=Hs(e,n);i=a.flatMap((e=>t.filter((t=>e.text===t.text))||e))}return i.map((t=>function(e,t,r){if(1===t.length){const t=r.node.from===r.node.to,n=t&&r.node.parent?r.node.parent:r.node,a=t?e.substring(n.from,n.to):r.text;return{startLineNumber:1,startColumn:n.from+1,endLineNumber:1,endColumn:n.to+1,error:a}}let n=0,a=0;for(let e=0;e<t.length;e++){if(a=n+t[e].length,!(r.node.from>a))return{startLineNumber:e+1,startColumn:r.node.from-n+1,endLineNumber:e+1,endColumn:r.node.to-n+1,error:r.text};n+=t[e].length+1}return null}(e,r,t))).filter(Xs)}(a,p.interpolateString(a,Ys),r.getLinesContent(),at)||[],o=i.map((e=>{var t=e,{error:r}=t,a=((e,t)=>{var r={};for(var n in e)sl.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&ol)for(var n of ol(e))t.indexOf(n)<0&&ll.call(e,n)&&(r[n]=e[n]);return r})(t,["error"]);return ul({message:(r?`Error parsing "${r}"`:"Parse error")+". The query appears to be incorrect and could fail to be executed.",severity:n.MarkerSeverity.Error},a)}));n.editor.setModelMarkers(r,"owner",o)}))}}})})};var fl=Object.defineProperty,gl=Object.getOwnPropertySymbols,bl=Object.prototype.hasOwnProperty,vl=Object.prototype.propertyIsEnumerable,yl=(e,t,r)=>t in e?fl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,xl=(e,t)=>{for(var r in t||(t={}))bl.call(t,r)&&yl(e,r,t[r]);if(gl)for(var r of gl(t))vl.call(t,r)&&yl(e,r,t[r]);return e};const Ol=e=>(0,ht.jsx)(mt.Suspense,{fallback:null,children:(0,ht.jsx)(ml,xl({},e))});var wl=Object.defineProperty,Sl=Object.getOwnPropertySymbols,_l=Object.prototype.hasOwnProperty,Pl=Object.prototype.propertyIsEnumerable,El=(e,t,r)=>t in e?wl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Tl=e=>{const t=(0,mt.useRef)(null),r=e,{onRunQuery:n,onChange:a}=r,i=((e,t)=>{var r={};for(var n in e)_l.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Sl)for(var n of Sl(e))t.indexOf(n)<0&&Pl.call(e,n)&&(r[n]=e[n]);return r})(r,["onRunQuery","onChange"]);return(0,ht.jsx)(Ol,((e,t)=>{for(var r in t||(t={}))_l.call(t,r)&&El(e,r,t[r]);if(Sl)for(var r of Sl(t))Pl.call(t,r)&&El(e,r,t[r]);return e})({onChange:e=>{a(e)},onRunQuery:e=>{t.current=e,a(e),n()},onBlur:e=>{a(e)}},i))};var Cl=Object.defineProperty,Il=Object.defineProperties,jl=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,Dl=Object.prototype.hasOwnProperty,kl=Object.prototype.propertyIsEnumerable,Rl=(e,t,r)=>t in e?Cl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Al=(e,t,r)=>(Rl(e,"symbol"!=typeof t?t+"":t,r),r);class Nl extends mt.PureComponent{constructor(t){super(t),Al(this,"refreshHint",(()=>{const{datasource:t,query:r,data:n}=this.props,a=t.getInitHints(),i=a.length>0?a[0]:null;if(!n||0===n.series.length)return void this.setState({hint:i});const o=(0,e.isDataFrame)(n.series[0])?n.series.map(e.toLegacyResponseData):n.series,s=t.getQueryHints(r,o);let l=s.length>0?s[0]:null;this.setState({hint:null!=l?l:i})})),Al(this,"refreshMetrics",(async()=>{const{range:e,datasource:{languageProvider:t}}=this.props;this.languageProviderInitializationPromise=(e=>{let t=!1;return{promise:new Promise(((r,n)=>{const a={isCanceled:!0};e.then((e=>t?n(a):r(e))),e.catch((e=>n(t?a:e)))})),cancel(){t=!0}}})(t.start(e));try{const e=await this.languageProviderInitializationPromise.promise;await Promise.all(e),this.onUpdateLanguage()}catch(e){if("object"!=typeof(r=e)||null===r||!("isCanceled"in r)||!e.isCanceled)throw e}var r})),Al(this,"onChangeLabelBrowser",(e=>{this.onChangeQuery(e,!0),this.setState({labelBrowserVisible:!1})})),Al(this,"onChangeQuery",((e,t)=>{const{query:r,onChange:n,onRunQuery:a}=this.props;if(n){n((i=((e,t)=>{for(var r in t||(t={}))Dl.call(t,r)&&Rl(e,r,t[r]);if($l)for(var r of $l(t))kl.call(t,r)&&Rl(e,r,t[r]);return e})({},r),Il(i,jl({expr:e})))),t&&a&&a()}var i})),Al(this,"onClickChooserButton",(()=>{var e,t;this.setState((e=>({labelBrowserVisible:!e.labelBrowserVisible}))),(0,j.reportInteraction)("user_grafana_prometheus_metrics_browser_clicked",{editorMode:this.state.labelBrowserVisible?"metricViewClosed":"metricViewOpen",app:null!=(t=null==(e=this.props)?void 0:e.app)?t:""})})),Al(this,"onClickHintFix",(()=>{var e;const{datasource:t,query:r,onChange:n,onRunQuery:a}=this.props,{hint:i}=this.state;(null==(e=null==i?void 0:i.fix)?void 0:e.action)&&n(t.modifyQuery(r,i.fix.action)),a()})),Al(this,"onUpdateLanguage",(()=>{const{datasource:{languageProvider:e}}=this.props,{metrics:t}=e;t&&this.setState({syntaxLoaded:!0})})),this.state={labelBrowserVisible:!1,syntaxLoaded:!1,hint:null}}componentDidMount(){this.props.datasource.languageProvider&&this.refreshMetrics(),this.refreshHint()}componentWillUnmount(){this.languageProviderInitializationPromise&&this.languageProviderInitializationPromise.cancel()}componentDidUpdate(e){const{data:t,datasource:{languageProvider:r},range:n}=this.props;r!==e.datasource.languageProvider&&this.setState({syntaxLoaded:!1});const a=this.rangeChangedToRefresh(n,e.range);(r!==e.datasource.languageProvider||a)&&this.refreshMetrics(),t&&e.data&&e.data.series!==t.series&&this.refreshHint()}rangeChangedToRefresh(e,t){if(e&&t){const r=rs(e.from.valueOf())===rs(t.from.valueOf()),n=rs(e.to.valueOf())===rs(t.to.valueOf());return!(r&&n)}return!1}render(){const{datasource:t,datasource:{languageProvider:r},query:n,ExtraFieldElement:a,history:i=[],theme:o}=this.props,{labelBrowserVisible:s,syntaxLoaded:l,hint:c}=this.state,u=r.metrics.length>0,d=function(e,t,r){return e?"(Disabled)":t?r?"Metrics browser":"(No metrics found)":"Loading metrics..."}(t.lookupsDisabled,l,u),p=!(l&&u);return(0,ht.jsx)(e.LocalStorageValueProvider,{storageKey:"grafana.datasources.prometheus.browser.labels",defaultValue:[],children:(e,l,u)=>{var h;return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsxs)("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"],children:[(0,ht.jsxs)("button",{className:"gf-form-label query-keyword pointer",onClick:this.onClickChooserButton,disabled:p,type:"button","data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.openButton,children:[d,(0,ht.jsx)(bt.Icon,{name:s?"angle-down":"angle-right"})]}),(0,ht.jsx)("div",{className:"flex-grow-1 min-width-15",children:(0,ht.jsx)(Tl,{languageProvider:r,history:i,onChange:this.onChangeQuery,onRunQuery:this.props.onRunQuery,initialValue:null!=(h=n.expr)?h:"",placeholder:"Enter a PromQL queryâ¦",datasource:t})})]}),s&&(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(zn,{languageProvider:r,onChange:this.onChangeLabelBrowser,lastUsedLabels:e||[],storeLastUsedLabels:l,deleteLastUsedLabels:u,timeRange:this.props.range})}),a,c?(0,ht.jsx)("div",{className:(0,Nr.css)({flexBasis:"100%"}),children:(0,ht.jsxs)("div",{className:"text-warning",children:[c.label," ",c.fix?(0,ht.jsx)("button",{type:"button",className:(0,Nr.cx)((0,bt.clearButtonStyles)(o),"text-link","muted"),onClick:this.onClickHintFix,children:c.fix.label}):null]})}):null]})}})}}const Ll=(0,bt.withTheme2)(Nl);function Ml({title:t,stepNumber:r,markdown:n,children:a}){const i=(0,bt.useStyles2)(Fl);return(0,ht.jsxs)("div",{className:i.box,children:[void 0!==r&&(0,ht.jsx)("div",{className:i.stepNumber,children:r}),(0,ht.jsxs)("div",{className:i.boxInner,children:[t&&(0,ht.jsx)("div",{className:i.header,children:(0,ht.jsx)("span",{children:t})}),(0,ht.jsxs)("div",{className:i.body,children:[n&&(0,ht.jsx)("div",{dangerouslySetInnerHTML:{__html:(0,e.renderMarkdown)(n)}}),a]})]})]})}const Fl=e=>({box:(0,Nr.css)({background:e.colors.background.secondary,padding:e.spacing(1),borderRadius:e.shape.radius.default,position:"relative"}),boxInner:(0,Nr.css)({marginLeft:e.spacing(4)}),stepNumber:(0,Nr.css)({fontWeight:e.typography.fontWeightMedium,background:e.colors.secondary.main,width:"20px",height:"20px",borderRadius:e.shape.radius.circle,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:e.typography.bodySmall.fontSize}),header:(0,Nr.css)({paddingBottom:e.spacing(.5),display:"flex",alignItems:"center",fontFamily:e.typography.fontFamilyMonospace}),body:(0,Nr.css)({color:e.colors.text.secondary,"p:last-child":{margin:0},a:{color:e.colors.text.link,textDecoration:"underline"}})});function Bl({query:e,lang:t,className:r}){const n=(0,bt.useTheme2)(),a=ql(n),i=cn().highlight(e,t.grammar,t.name);return(0,ht.jsx)("div",{className:(0,Nr.cx)(a.editorField,"prism-syntax-highlight",r),"aria-label":"selector",dangerouslySetInnerHTML:{__html:i}})}const ql=e=>({editorField:(0,Nr.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})});function Ql({query:e,queryModeller:t,stepNumber:r,lang:n,onMouseEnter:a,onMouseLeave:i}){return(0,ht.jsx)(ht.Fragment,{children:e.operations.map(((e,o)=>{var s;const l=t.getOperationDef(e.id);if(!l)return`Operation ${e.id} not found`;const c=l.renderer(e,l,"<expr>"),u=l.explainHandler?l.explainHandler(e,l):null!=(s=l.documentation)?s:"no docs";return(0,ht.jsx)("div",{onMouseEnter:()=>null==a?void 0:a(e,o),onMouseLeave:()=>null==i?void 0:i(e,o),children:(0,ht.jsx)(Ml,{stepNumber:o+r,title:(0,ht.jsx)(Bl,{query:c,lang:n}),markdown:u})},o)}))})}const Vl="Fetch all series matching metric name and label filters.",Wl=(0,mt.memo)((({query:e})=>{const t=jr(e||"").query,r={grammar:ut,name:"promql"};return(0,ht.jsxs)(bt.Stack,{gap:.5,direction:"column",children:[(0,ht.jsx)(Ml,{stepNumber:1,title:(0,ht.jsx)(Bl,{query:`${t.metric} ${Or.renderLabels(t.labels)}`,lang:r}),children:Vl}),(0,ht.jsx)(Ql,{stepNumber:2,queryModeller:Or,query:t,lang:r})]})}));function zl(e){const{query:t,datasource:r,range:n,onRunQuery:a,onChange:i,data:o,app:s,showExplain:l}=e,c=(0,bt.useStyles2)(Ul);return(0,ht.jsxs)("div",{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.queryField,className:c.wrapper,children:[(0,ht.jsx)(Ll,{datasource:r,query:t,range:n,onRunQuery:a,onChange:i,history:[],data:o,app:s}),l&&(0,ht.jsx)(Wl,{query:t.expr})]})}Wl.displayName="PromQueryBuilderExplained";const Ul=e=>({wrapper:(0,Nr.css)({".gf-form":{marginBottom:0}})});var Gl=Object.defineProperty,Hl=Object.defineProperties,Xl=Object.getOwnPropertyDescriptors,Yl=Object.getOwnPropertySymbols,Kl=Object.prototype.hasOwnProperty,Jl=Object.prototype.propertyIsEnumerable,Zl=(e,t,r)=>t in e?Gl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ec=(e,t)=>{for(var r in t||(t={}))Kl.call(t,r)&&Zl(e,r,t[r]);if(Yl)for(var r of Yl(t))Jl.call(t,r)&&Zl(e,r,t[r]);return e},tc=(e,t)=>Hl(e,Xl(t));function rc(e){const t=e.annotation,r=e.onAnnotationChange,n={expr:t.expr,refId:t.name,interval:t.step};return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsxs)(Qr,{children:[(0,ht.jsx)(zl,tc(ec({},e),{query:n,showExplain:!1,onChange:e=>{r(tc(ec({},t),{expr:e.expr}))}})),(0,ht.jsx)(Vr,{children:(0,ht.jsx)(Jr,{label:"Min step",tooltip:(0,ht.jsxs)(ht.Fragment,{children:["An additional lower limit for the step parameter of the Prometheus query and for the"," ",(0,ht.jsx)("code",{children:"$__interval"})," and ",(0,ht.jsx)("code",{children:"$__rate_interval"})," variables."]}),children:(0,ht.jsx)(bt.AutoSizeInput,{type:"text","aria-label":"Set lower limit for the step parameter",placeholder:"auto",minWidth:10,onCommitChange:e=>{r(tc(ec({},t),{step:e.currentTarget.value}))},defaultValue:n.interval,id:Tn.components.DataSource.Prometheus.annotations.minStep})})})]}),(0,ht.jsx)(bt.Space,{v:.5}),(0,ht.jsxs)(Vr,{children:[(0,ht.jsx)(Jr,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,ht.jsx)(bt.Input,{type:"text",placeholder:"{{alertname}}",value:t.titleFormat,onChange:e=>{r(tc(ec({},t),{titleFormat:e.currentTarget.value}))},"data-testid":Tn.components.DataSource.Prometheus.annotations.title})}),(0,ht.jsx)(Jr,{label:"Tags",children:(0,ht.jsx)(bt.Input,{type:"text",placeholder:"label1,label2",value:t.tagKeys,onChange:e=>{r(tc(ec({},t),{tagKeys:e.currentTarget.value}))},"data-testid":Tn.components.DataSource.Prometheus.annotations.tags})}),(0,ht.jsx)(Jr,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,ht.jsx)(bt.Input,{type:"text",placeholder:"{{instance}}",value:t.textFormat,onChange:e=>{r(tc(ec({},t),{textFormat:e.currentTarget.value}))},"data-testid":Tn.components.DataSource.Prometheus.annotations.text})}),(0,ht.jsx)(Jr,{label:"Series value as timestamp",tooltip:"The unit of timestamp is milliseconds. If the unit of the series value is seconds, multiply its range vector by 1000.",children:(0,ht.jsx)(on,{value:t.useValueForTime,onChange:e=>{r(tc(ec({},t),{useValueForTime:e.currentTarget.value}))},"data-testid":Tn.components.DataSource.Prometheus.annotations.seriesValueAsTimestamp})})]})]})}var nc=Object.defineProperty,ac=Object.defineProperties,ic=Object.getOwnPropertyDescriptors,oc=Object.getOwnPropertySymbols,sc=Object.prototype.hasOwnProperty,lc=Object.prototype.propertyIsEnumerable,cc=(e,t,r)=>t in e?nc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uc=(e,t)=>{for(var r in t||(t={}))sc.call(t,r)&&cc(e,r,t[r]);if(oc)for(var r of oc(t))lc.call(t,r)&&cc(e,r,t[r]);return e},dc=(e,t)=>ac(e,ic(t));const pc=/^label_names\(\)\s*$/,hc=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/,mc=/^metrics\((.+)\)\s*$/,fc=/^query_result\((.+)\)\s*$/,gc=/^label_names\((.+)\)\s*$/;function bc(e){if("string"!=typeof e)return e;const t={refId:"PrometheusDatasource-VariableQuery",qryType:Xn.LabelNames},r=e.match(gc);if(r)return dc(uc({},t),{qryType:Xn.LabelNames,match:r[1]});const n=e.match(pc);if(n)return dc(uc({},t),{qryType:Xn.LabelNames});const a=e.match(/^label_values\(/);if(a){const r=e.match(hc),n=r?r[2]:"",a=r?r[1]:"";if(a){const e=jr(a);return dc(uc({},t),{qryType:Xn.LabelValues,label:n,metric:e.query.metric,labelFilters:e.query.labels})}return dc(uc({},t),{qryType:Xn.LabelValues,label:n})}const i=e.match(/^metrics\(/);if(i){const r=e.match(mc),n=r?r[1]:"";return dc(uc({},t),{qryType:Xn.MetricNames,metric:n})}const o=e.match(/^query_result\(/);if(o){const r=e.match(fc),n=r?r[1]:"";return dc(uc({},t),{qryType:Xn.VarQueryResult,varQuery:n})}return n||a||i||o?t:dc(uc({},t),{qryType:Xn.SeriesQuery,seriesQuery:e})}var vc=Object.defineProperty,yc=Object.defineProperties,xc=Object.getOwnPropertyDescriptors,Oc=Object.getOwnPropertySymbols,wc=Object.prototype.hasOwnProperty,Sc=Object.prototype.propertyIsEnumerable,_c=(e,t,r)=>t in e?vc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;class Pc{constructor(t,r){var n;this.datasource=t,this.query=r,_c(this,"symbol"!=typeof(n="range")?n+"":n,undefined),this.datasource=t,this.query=r,this.range=(0,e.getDefaultTimeRange)()}process(e){this.range=e;const t=pc,r=gc,n=mc,a=fc,i=this.query.match(t),o=this.query.match(r);if(o){const e=`{__name__=~".*${o[1]}.*"}`;return this.datasource.languageProvider.getSeriesLabels(e,[]).then((e=>e.map((e=>({text:e})))))}if(i)return this.datasource.getTagKeys({filters:[],timeRange:e});const s=this.query.match(/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/);if(s){const e=s[1],t=s[2];return function(e){return e&&"{}"!==e.split(" ").join("")}(e)?this.labelValuesQuery(t,e):this.labelValuesQuery(t)}const l=this.query.match(n);if(l)return this.metricNameQuery(l[1]);const c=this.query.match(a);return c?this.queryResultQuery(c[1]):["label_values()","metrics()","query_result()"].includes(this.query)?Promise.resolve([]):this.metricNameAndLabelsQuery(this.query)}labelValuesQuery(e,r){const n=ps(this.range.from,!1),a=ps(this.range.to,!0),i=(o=((e,t)=>{for(var r in t||(t={}))wc.call(t,r)&&_c(e,r,t[r]);if(Oc)for(var r of Oc(t))Sc.call(t,r)&&_c(e,r,t[r]);return e})({},r&&{"match[]":r}),s={start:n.toString(),end:a.toString()},yc(o,xc(s)));var o,s;if(!r||this.datasource.hasLabelsMatchAPISupport()){const r=`/api/v1/label/${e}/values`;return this.datasource.metadataRequest(r,i).then((e=>(0,t.map)(e.data.data,(e=>({text:e})))))}{const r="/api/v1/series";return this.datasource.metadataRequest(r,i).then((r=>{const n=(0,t.map)(r.data.data,(t=>t[e]||"")).filter((e=>""!==e));return(0,t.uniq)(n).map((e=>({text:e,expandable:!0})))}))}}metricNameQuery(e){const r=ps(this.range.from,!1),n=ps(this.range.to,!0),a={start:r.toString(),end:n.toString()};return this.datasource.metadataRequest("/api/v1/label/__name__/values",a).then((r=>(0,t.chain)(r.data.data).filter((t=>new RegExp(e).test(t))).map((e=>({text:e,expandable:!0}))).value()))}queryResultQuery(e){const r={query:e,time:ps(this.range.to,!0).toString()};return this.datasource.metadataRequest("/api/v1/query",r).then((e=>{switch(e.data.data.resultType){case"scalar":case"string":return[{text:e.data.data.result[1]||"",expandable:!1}];case"vector":return(0,t.map)(e.data.data.result,(e=>{let r=e.metric.__name__||"";return delete e.metric.__name__,r+="{"+(0,t.map)(e.metric,((e,t)=>t+'="'+e+'"')).join(",")+"}",r+=" "+e.value[1]+" "+1e3*e.value[0],{text:r,expandable:!0}}));default:throw Error(`Unknown/Unhandled result type: [${e.data.data.resultType}]`)}}))}metricNameAndLabelsQuery(e){const r=ps(this.range.from,!1),n=ps(this.range.to,!0),a={"match[]":e,start:r.toString(),end:n.toString()},i=this;return this.datasource.metadataRequest("/api/v1/series",a).then((e=>(0,t.map)(e.data.data,(e=>({text:i.datasource.getOriginalMetricName(e),expandable:!0})))))}}var Ec=Object.defineProperty,Tc=Object.defineProperties,Cc=Object.getOwnPropertyDescriptors,Ic=Object.getOwnPropertySymbols,jc=Object.prototype.hasOwnProperty,$c=Object.prototype.propertyIsEnumerable,Dc=(e,t,r)=>t in e?Ec(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,kc=(e,t)=>{for(var r in t||(t={}))jc.call(t,r)&&Dc(e,r,t[r]);if(Ic)for(var r of Ic(t))$c.call(t,r)&&Dc(e,r,t[r]);return e},Rc=(e,t)=>Tc(e,Cc(t));function Ac(e,r,n){var a;const i=[],o=null==(a=null==n?void 0:n.languageProvider)?void 0:a.metricsMetadata;if(e.trim().match(/^\w+_bucket$|^\w+_bucket{.*}$/)){const t="Selected metric has buckets.";i.push({type:"HISTOGRAM_QUANTILE",label:t,fix:{label:"Consider calculating aggregated quantile by adding histogram_quantile().",action:{type:"ADD_HISTOGRAM_QUANTILE",query:e}}})}else if(o&&Fc(e)){const t=Lc(e),{nameMetric:r}=Mc(t,"histogram",o,!1);if(r){const t="Selected metric is a native histogram.";i.push({type:"HISTOGRAM_AVG",label:t,fix:{label:"Consider calculating the arithmetic average of observed values by adding histogram_avg().",action:{type:"ADD_HISTOGRAM_AVG",query:e}}},{type:"HISTOGRAM_COUNT",label:t,fix:{label:"Consider calculating the count of observations by adding histogram_count().",action:{type:"ADD_HISTOGRAM_COUNT",query:e}}},{type:"HISTOGRAM_SUM",label:t,fix:{label:"Consider calculating the sum of observations by adding histogram_sum().",action:{type:"ADD_HISTOGRAM_SUM",query:e}}},{type:"HISTOGRAM_FRACTION",label:t,fix:{label:"Consider calculating the estimated fraction of observations between the provided lower and upper values by adding histogram_fraction().",action:{type:"ADD_HISTOGRAM_FRACTION",query:e}}},{type:"HISTOGRAM_STDDEV",label:t,fix:{label:"Consider calculating the estimated standard deviation of observations by adding histogram_stddev().",action:{type:"ADD_HISTOGRAM_STDDEV",query:e}}},{type:"HISTOGRAM_STDVAR",label:t,fix:{label:"Consider calculating the estimated standard variance of observations by adding histogram_stdvar().",action:{type:"ADD_HISTOGRAM_STDVAR",query:e}}})}}if(-1===e.indexOf("rate(")&&-1===e.indexOf("increase(")){const t=e.match(new RegExp("\\b((?<!:)\\w+_(total|sum|count)(?!:))\\b"));let r=t?t[1]:"",n=!1;if(o){const t=Mc(Lc(e),"counter",o,n);r=t.nameMetric,n=t.certain}if(r){let t,r=`Selected metric ${n?"is":"looks like"} a counter.`;Fc(e)?t={label:"Consider calculating rate of counter by adding rate().",action:{type:"ADD_RATE",query:e}}:r=`${r} Consider calculating rate of counter by adding rate().`,i.push({type:"APPLY_RATE",label:r,fix:t})}}if(n&&n.ruleMappings){const r=function(e,r){const n=[],a=Object.keys(r).reduce(((t,a)=>{if(-1===e.search(a))return t;if(r[a].length>1){const{idx:i,expandedQuery:o,identifier:s,identifierValue:l}=function(e,t,r){var n,a;const{query:i}=jr(e),o=Nc(t,i);if(0===o.length)return{idx:-1,identifier:"",identifierValue:"",expandedQuery:""};let s="",l="",c=-1;return o.forEach((e=>{-1===c&&-1!==e.label.search("uuid")&&(s=e.label,l=e.value)})),r.forEach(((e,t)=>{e.labels&&Object.entries(e.labels).forEach((([e,r])=>{-1===c&&e===s&&r===l&&(c=t)}))})),{idx:c,identifier:s,identifierValue:l,expandedQuery:null!=(a=null==(n=r[c])?void 0:n.query)?a:""}}(e,a,r[a]);return-1===i?(n.push({type:"EXPAND_RULES_WARNING",label:"We found multiple recording rules that match in this query. To expand the recording rule, add an identifier label/value."}),t):Rc(kc({},t),{[a]:{expandedQuery:o,identifier:s,identifierValue:l}})}return Rc(kc({},t),{[a]:{expandedQuery:r[a][0].query}})}),{});if((0,t.size)(a)>0){const t="Query contains recording rules.";n.push({type:"EXPAND_RULES",label:t,fix:{label:"Expand rules",action:{type:"EXPAND_RULES",query:e,options:a}}})}return n}(e,n.ruleMappings);i.push(...r)}return r&&r.length>=20&&e.trim().match(/^\w+$/)&&i.push({type:"ADD_SUM",label:"Many time series results returned.",fix:{label:"Consider aggregating with sum().",action:{type:"ADD_SUM",query:e,preventSubmit:!0}}}),i}function Nc(e,t){if(t.metric===e)return t.labels;if(t.binaryQueries)for(let r=0;r<t.binaryQueries.length;r++){const n=Nc(e,t.binaryQueries[r].query);if(n&&n.length>0)return n}return[]}function Lc(e){return Array.from(e.matchAll(/\$?[a-zA-Z_:][a-zA-Z0-9_:]*/g)).map((([e])=>e)).filter((e=>!e.startsWith("$"))).flatMap((e=>e.split(":")))}function Mc(e,t,r,n){var a;return{nameMetric:null!=(a=e.find((e=>{const a=r[e];return!(!a||a.type.toLowerCase()!==t||(n=!0,0))})))?a:"",certain:n}}function Fc(e){return e.trim().match(/^\w+$|^\w+{.*}$/)}var Bc=Object.defineProperty,qc=Object.defineProperties,Qc=Object.getOwnPropertyDescriptors,Vc=Object.getOwnPropertySymbols,Wc=Object.prototype.hasOwnProperty,zc=Object.prototype.propertyIsEnumerable,Uc=(e,t,r)=>t in e?Bc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Gc=(e,t)=>{for(var r in t||(t={}))Wc.call(t,r)&&Uc(e,r,t[r]);if(Vc)for(var r of Vc(t))zc.call(t,r)&&Uc(e,r,t[r]);return e},Hc=(e,t)=>qc(e,Qc(t)),Xc=(e,t,r)=>(Uc(e,"symbol"!=typeof t?t+"":t,r),r);const Yc="10m",Kc=e=>{var t;return`${e.type}|${e.name}|${JSON.stringify(null!=(t=e.labels)?t:"")}`};class Jc{constructor(t){Xc(this,"overlapWindowMs"),Xc(this,"getTargetSignature"),Xc(this,"cache",new Map);const r=t.overlapString;if((0,e.isValidDuration)(r)){const t=(0,e.parseDuration)(r);this.overlapWindowMs=(0,e.durationToMilliseconds)(t)}else{const t=(0,e.parseDuration)(Yc);this.overlapWindowMs=(0,e.durationToMilliseconds)(t)}this.getTargetSignature=t.getTargetSignature}requestInfo(t){var r,n,a;const i=t.range.from.valueOf(),o=t.range.to.valueOf(),s="now"===(null==(n=null==(r=t.rangeRaw)?void 0:r.to)?void 0:n.toString());let l,c=s;const u=new Map;t.targets.forEach((e=>{let r=`${t.dashboardUID}|${t.panelId}|${e.refId}`,n=this.getTargetSignature(t,e);u.set(r,n)}));for(const[e,t]of u){let r=this.cache.get(e);if((null==r?void 0:r.sig)!==t?c=!1:(l=null!=(a=null==r?void 0:r.prevTo)?a:1/0,c=o>l&&i<=l),!c)break}if(c&&l){let r=Math.max(l-this.overlapWindowMs,i);const n=(0,e.dateTime)(o),a=(0,e.dateTime)((0,e.incrRoundDn)(r,t.intervalMs));t=Hc(Gc({},t),{range:Hc(Gc({},t.range),{from:a,to:n})})}else u.forEach(((e,t)=>{this.cache.delete(t)}));return{requests:[t],targSigs:u,shouldCache:s}}procFrames(t,r,n){if(null==r?void 0:r.shouldCache){const a=t.range.from.valueOf(),i=t.range.to.valueOf(),o=new Map;n.forEach((e=>{let r=`${t.dashboardUID}|${t.panelId}|${e.refId}`,n=o.get(r);n||(n=[],o.set(r,n)),n.push(e)}));let s=[];o.forEach(((t,n)=>{var o,l;let c=null!=(l=n?null==(o=this.cache.get(n))?void 0:o.frames:null)?l:[];t.forEach((t=>{if(0===t.length||0===t.fields.length)return;let r=Kc(t.fields[1]),n=c.find((e=>Kc(e.fields[1])===r));if(n){let r=n.fields.map((e=>e.values)),a=t.fields.map((e=>e.values)),i=(0,e.amendTable)(r,a);if(i){for(let e=0;e<i.length;e++)n.fields[e].values=i[e];n.length=n.fields[0].values.length}}else c.push(t)}));let u=[];c.forEach((t=>{let r=t.fields.map((e=>e.values)),n=(0,e.trimTable)(r,a,i);if(n[0].length>0){for(let e=0;e<n.length;e++)t.fields[e].values=n[e];u.push(t)}})),this.cache.set(n,{sig:r.targSigs.get(n),frames:u,prevTo:i}),s.push(...u)})),n=s.map((e=>Hc(Gc({},e),{fields:e.fields.map((e=>Hc(Gc({},e),{config:Gc({},e.config),values:e.values.slice()})))})))}return n}}var Zc=Object.defineProperty,eu=Object.defineProperties,tu=Object.getOwnPropertyDescriptors,ru=Object.getOwnPropertySymbols,nu=Object.prototype.hasOwnProperty,au=Object.prototype.propertyIsEnumerable,iu=(e,t,r)=>t in e?Zc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ou=(e,t)=>{for(var r in t||(t={}))nu.call(t,r)&&iu(e,r,t[r]);if(ru)for(var r of ru(t))au.call(t,r)&&iu(e,r,t[r]);return e},su=(e,t)=>eu(e,tu(t)),lu=(e,t)=>{var r={};for(var n in e)nu.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&ru)for(var n of ru(e))t.indexOf(n)<0&&au.call(e,n)&&(r[n]=e[n]);return r};const cu=/^[+-]?inf(?:inity)?$/i;const uu="le";function du(e){var t;const r=[];if(e.datasourceUid){const n=(0,j.getDataSourceSrv)().getInstanceSettings(e.datasourceUid);n&&r.push({title:e.urlDisplayLabel||`Query with ${null==n?void 0:n.name}`,url:"",internal:{query:{query:"${__value.raw}",queryType:"traceql"},datasourceUid:e.datasourceUid,datasourceName:null!=(t=null==n?void 0:n.name)?t:"Data source not found"}})}return e.url&&r.push({title:e.urlDisplayLabel||`Go to ${e.url}`,url:e.url,targetBlank:!0}),r}function pu(t){if(0===t.length||1===t.length&&0===t[0].length)return[];const r=t[0].fields.find((t=>t.type===e.FieldType.time)),n=t.map((t=>{let r=t.fields.find((t=>t.type===e.FieldType.number));return su(ou({},r),{name:r.config.displayNameFromDS})}));return[su(ou({},t[0]),{meta:su(ou({},t[0].meta),{type:e.DataFrameType.HeatmapRows}),fields:[r,...n]})]}function hu(t){for(let r=t.length-1;r>0;r--){const n=t[r].fields.find((t=>t.type===e.FieldType.number)),a=t[r-1].fields.find((t=>t.type===e.FieldType.number));if(!n||!a)throw new Error("Prometheus heatmap transform error: data should be a time series");for(let e=0;e<n.values.length;e++){const t=a.values[e]||[0];n.values[e]-=t,n.values[e]<1e-9&&(n.values[e]=0)}}return t}function mu(e,t){var r,n,a,i,o,s;let l,c;try{l=fu(null!=(a=null!=(n=null==(r=e.fields[1].state)?void 0:r.displayName)?n:e.name)?a:e.fields[1].name),c=fu(null!=(s=null!=(o=null==(i=t.fields[1].state)?void 0:i.displayName)?o:t.name)?s:t.fields[1].name)}catch(e){return console.error(e),0}return l>c?1:l<c?-1:0}function fu(e){return cu.test(e)?"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:parseFloat(e)}const gu=gt().forwardRef((function({items:e,renderItem:t,onChange:r},n){return gt().createElement(Br,null,e.map(((n,a)=>gt().createElement("div",{key:a},t(n,(t=>((t,n)=>{const a=[...e];a[t]=n,r(a)})(a,t)),(()=>(t=>{const n=[...e];n.splice(t,1),r(n)})(a)))))),gt().createElement(bt.Button,{ref:n,onClick:()=>{const t=[...e,{}];r(t)},variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))})),bu=({children:e})=>{const t=(0,bt.useStyles2)(yu),r=mt.Children.map(e,(e=>(0,mt.isValidElement)(e)&&e.props.invalid?(0,mt.cloneElement)(e,{className:(0,Nr.cx)(e.props.className,t.invalidChild)}):e));return gt().createElement("div",{className:t.root},r)},vu=["","base","hovered","invalid","focused"],yu=()=>({root:(0,Nr.css)({display:"flex","> *":{"&:not(:first-child)":{marginLeft:-1},"&:first-child":{borderTopRightRadius:0,borderBottomRightRadius:0},"&:last-child":{borderTopLeftRadius:0,borderBottomLeftRadius:0},"&:not(:first-child):not(:last-child)":{borderRadius:0},position:"relative",zIndex:vu.indexOf("base"),"&:hover":{zIndex:vu.indexOf("hovered")},"&:focus-within":{zIndex:vu.indexOf("focused")}}}),invalidChild:(0,Nr.css)({zIndex:vu.indexOf("invalid")})});var xu=Object.defineProperty,Ou=Object.defineProperties,wu=Object.getOwnPropertyDescriptors,Su=Object.getOwnPropertySymbols,_u=Object.prototype.hasOwnProperty,Pu=Object.prototype.propertyIsEnumerable,Eu=(e,t,r)=>t in e?xu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Tu=e=>{var t=e,{className:r}=t,n=((e,t)=>{var r={};for(var n in e)_u.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Su)for(var n of Su(e))t.indexOf(n)<0&&Pu.call(e,n)&&(r[n]=e[n]);return r})(t,["className"]);const a=(0,bt.useStyles2)(Cu);return gt().createElement(bt.Button,(i=((e,t)=>{for(var r in t||(t={}))_u.call(t,r)&&Eu(e,r,t[r]);if(Su)for(var r of Su(t))Pu.call(t,r)&&Eu(e,r,t[r]);return e})({},n),o={className:(0,Nr.cx)(r,a.button)},Ou(i,wu(o))));var i,o},Cu=e=>({button:(0,Nr.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})});var Iu=Object.defineProperty,ju=Object.defineProperties,$u=Object.getOwnPropertyDescriptors,Du=Object.getOwnPropertySymbols,ku=Object.prototype.hasOwnProperty,Ru=Object.prototype.propertyIsEnumerable,Au=(e,t,r)=>t in e?Iu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Nu=(e,t)=>{for(var r in t||(t={}))ku.call(t,r)&&Au(e,r,t[r]);if(Du)for(var r of Du(t))Ru.call(t,r)&&Au(e,r,t[r]);return e},Lu=(e,t)=>ju(e,$u(t));function Mu({item:t,defaultOp:r,onChange:n,onDelete:a,onGetLabelNames:i,onGetLabelValues:o,invalidLabel:s,invalidValue:l,getLabelValuesAutofillSuggestions:c,debounceDuration:u}){var d,p,h,m;const[f,g]=(0,mt.useState)({}),[b,v]=(0,mt.useState)(!1),[y,x]=(0,mt.useState)(!1),[O,w]=(0,mt.useState)([]),S=(e=t.op)=>{var r;return null==(r=Fu.find((t=>t.label===e)))?void 0:r.isMultiValue},_=e=>{if(e){const t=/\(([^)]+)\)/,r=null==e?void 0:e.match(t);return r&&r[0].indexOf("|")>0?[e]:e.indexOf("|")>0?e.split("|"):[e]}return[]},P=fa()((e=>c(e,t.label)),u),E=fa()((e=>hs(O.filter((t=>t.value.includes(e))))),u),T=null!=(d=null==t?void 0:t.value)?d:"";return(0,ht.jsx)("div",{"data-testid":"prometheus-dimensions-filter-item",children:(0,ht.jsxs)(bu,{children:[(0,ht.jsx)(bt.AsyncSelect,{placeholder:"Select label","data-testid":Tn.components.QueryBuilder.labelSelect,inputId:"prometheus-dimensions-filter-item-key",width:"auto",value:t.label?(0,e.toOption)(t.label):null,allowCustomValue:!0,onOpenMenu:async()=>{g({isLoadingLabelNames:!0});const e=await i(t);w(e),v(!0);const r=hs(e);g({labelNames:r,isLoadingLabelNames:void 0})},onCloseMenu:()=>{v(!1)},isOpen:b,isLoading:null!=(p=f.isLoadingLabelNames)&&p,loadOptions:E,defaultOptions:f.labelNames,onChange:e=>{var a;e.label&&n(Lu(Nu({},t),{op:null!=(a=t.op)?a:r,label:e.label}))},invalid:s}),(0,ht.jsx)(bt.Select,{"data-testid":Tn.components.QueryBuilder.matchOperatorSelect,className:"query-segment-operator",value:(0,e.toOption)(null!=(h=t.op)?h:r),options:Fu,width:"auto",onChange:e=>{null!=e.value&&n(Lu(Nu({},t),{op:e.value,value:S(e.value)?t.value:_(null==t?void 0:t.value)[0]}))}}),(0,ht.jsx)(bt.AsyncSelect,{placeholder:"Select value","data-testid":Tn.components.QueryBuilder.valueSelect,inputId:"prometheus-dimensions-filter-item-value",width:"auto",value:S()?_(T).map(e.toOption):_(T).map(e.toOption)[0],allowCustomValue:!0,formatCreateLabel:e=>e,createOptionPosition:(null==(m=t.op)?void 0:m.includes("~"))?"first":"last",onOpenMenu:async()=>{g({isLoadingLabelValues:!0});const e=await o(t);hs(e),x(!0),g(Lu(Nu({},f),{labelValues:e,isLoadingLabelValues:void 0}))},onCloseMenu:()=>{x(!1)},isOpen:y,defaultOptions:f.labelValues,isMulti:S(),isLoading:f.isLoadingLabelValues,loadOptions:P,onChange:e=>{var a,i;if(e.value)n(Lu(Nu({},t),{value:e.value,op:null!=(a=t.op)?a:r}));else{const a=e.map((e=>e.label)).join("|");n(Lu(Nu({},t),{value:a,op:null!=(i=t.op)?i:r}))}},invalid:l}),(0,ht.jsx)(Tu,{"aria-label":`remove-${t.label}`,icon:"times",variant:"secondary",onClick:a})]})},T)}const Fu=[{label:"=",value:"=",isMultiValue:!1},{label:"!=",value:"!=",isMultiValue:!1},{label:"=~",value:"=~",isMultiValue:!0},{label:"!~",value:"!~",isMultiValue:!0}];function Bu({labelsFilters:e,onChange:r,onGetLabelNames:n,onGetLabelValues:a,labelFilterRequired:i,getLabelValuesAutofillSuggestions:o,debounceDuration:s,variableEditor:l}){const[c,u]=(0,mt.useState)([{op:"="}]);(0,mt.useEffect)((()=>{e.length>0?u(e):u([{op:"="}])}),[e]);const d=n=>{u(n);const a=n.filter((e=>null!=e.label&&null!=e.value));(0,t.isEqual)(a,e)||r(a)},p=c.some((e=>e.label&&e.value)),h=()=>(0,ht.jsx)(gu,{items:c,onChange:d,renderItem:(e,t,r)=>(0,ht.jsx)(Mu,{debounceDuration:s,item:e,defaultOp:"=",onChange:t,onDelete:r,onGetLabelNames:n,onGetLabelValues:a,invalidLabel:i&&!e.label,invalidValue:i&&!e.value,getLabelValuesAutofillSuggestions:o})});return(0,ht.jsx)(ht.Fragment,{children:l?(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsxs)("div",{className:(0,Nr.cx)((0,Nr.css)({display:"flex"})),children:[(0,ht.jsx)(bt.InlineLabel,{width:20,tooltip:(0,ht.jsx)("div",{children:"Optional: used to filter the metric select for this query type."}),children:"Label filters"}),h()]})}):(0,ht.jsx)(va,{children:(0,ht.jsx)(Jr,{label:"Label filters",error:"Select at least 1 label filter (label and value)",invalid:i&&!p,children:h()})})})}var qu=Object.defineProperty,Qu=Object.defineProperties,Vu=Object.getOwnPropertyDescriptors,Wu=Object.getOwnPropertySymbols,zu=Object.prototype.hasOwnProperty,Uu=Object.prototype.propertyIsEnumerable,Gu=(e,t,r)=>t in e?qu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Hu=(e,t)=>{for(var r in t||(t={}))zu.call(t,r)&&Gu(e,r,t[r]);if(Wu)for(var r of Wu(t))Uu.call(t,r)&&Gu(e,r,t[r]);return e},Xu=(e,t)=>Qu(e,Vu(t));function Yu({datasource:e,query:t,onChange:r,onBlur:n,variableEditor:a}){const i=(0,mt.useCallback)((async t=>{const r=e.getVariables(),n=await t;return[...r.map((e=>({label:e,value:e}))),...n.map((e=>({label:e.value,value:e.value,title:e.description})))]}),[e]),o=(t,r)=>{if(!t.label)return Promise.resolve([]);const n=e.languageProvider.fetchSeries(r),a=e.interpolateString(t.label);return n.then((e=>{const t=new Set;return e.forEach((e=>{const r=e[a];t.add(r)})),Array.from(t).map((e=>({label:e,value:e})))}))},s=(r,n)=>{if(!r.label)return Promise.resolve([]);const a=`[${e.uid}][${t.metric}][${r.label}][${r.op}]`;return e.languageProvider.fetchSeriesValuesWithMatch(r.label,n,a).then((e=>e.map((e=>({value:e,label:e})))))},l=(0,mt.useCallback)((()=>i(async function(e,t){var r,n;let a;if(e.languageProvider.metricsMetadata||await e.languageProvider.loadMetricsMetadata(),e.languageProvider.metricsMetadata||(e.languageProvider.metricsMetadata={}),t.labels.length>0){const n=Or.renderLabels(t.labels);a=null!=(r=(await e.languageProvider.getSeries(n,!0)).__name__)?r:[]}else a=null!=(n=await e.languageProvider.getLabelValues("__name__"))?n:[];return a.map((t=>({value:t,description:ca(t,e.languageProvider.metricsMetadata)})))}(e,t))),[e,t,i]);return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(Vo,{query:t,onChange:r,onGetMetrics:l,datasource:e,labelsFilters:t.labels,metricLookupDisabled:e.lookupsDisabled,onBlur:n||(()=>{}),variableEditor:a}),(0,ht.jsx)(Bu,{debounceDuration:e.getDebounceTimeInMilliseconds(),getLabelValuesAutofillSuggestions:(r,n)=>{const a={label:null!=n?n:"__name__",op:"=~",value:Ir(`.*${r}`)},i=t.labels.filter((e=>e.label!==a.label));i.push(a),t.metric&&i.push({label:"__name__",op:"=",value:t.metric});const l=i.map((t=>Xu(Hu({},t),{label:e.interpolateString(t.label),value:e.interpolateString(t.value)}))),c=Or.renderLabels(l);let u;return u=e.hasLabelsMatchAPISupport()?s(a,c):o(a,c),u.then((e=>(hs(e),e)))},labelsFilters:t.labels,onChange:e=>{r(Xu(Hu({},t),{labels:e}))},onGetLabelNames:r=>i((async r=>{if(!t.metric)return await e.languageProvider.fetchLabels(),e.languageProvider.getLabelKeys().map((e=>({value:e})));const n=t.labels.filter((e=>e!==r));n.push({label:"__name__",op:"=",value:t.metric});const a=Or.renderLabels(n);let i=await e.languageProvider.fetchLabelsWithMatch(a);return Object.keys(i).filter((e=>!n.find((t=>t.label===e)))).map((e=>({value:e})))})(r)),onGetLabelValues:r=>i((async r=>{if(!r.label)return[];if(!t.metric)return(await e.languageProvider.getLabelValues(r.label)).map((e=>({value:e})));const n=t.labels.filter((e=>e!==r));n.push({label:"__name__",op:"=",value:t.metric});const a=n.map((t=>Xu(Hu({},t),{label:e.interpolateString(t.label),value:e.interpolateString(t.value)}))),i=Or.renderLabels(a);return e.hasLabelsMatchAPISupport()?s(r,i):o(r,i)})(r)),variableEditor:a})]})}var Ku=Object.defineProperty,Ju=Object.getOwnPropertySymbols,Zu=Object.prototype.hasOwnProperty,ed=Object.prototype.propertyIsEnumerable,td=(e,t,r)=>t in e?Ku(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rd=(e,t)=>{for(var r in t||(t={}))Zu.call(t,r)&&td(e,r,t[r]);if(Ju)for(var r of Ju(t))ed.call(t,r)&&td(e,r,t[r]);return e};const nd=[{label:"Label names",value:Xn.LabelNames},{label:"Label values",value:Xn.LabelValues},{label:"Metrics",value:Xn.MetricNames},{label:"Query result",value:Xn.VarQueryResult},{label:"Series query",value:Xn.SeriesQuery},{label:"Classic query",value:Xn.ClassicQuery}],ad=({onChange:t,query:r,datasource:n,range:a})=>{const[i,o]=(0,mt.useState)(void 0),[s,l]=(0,mt.useState)(""),[c,u]=(0,mt.useState)(""),[d,p]=(0,mt.useState)(""),[h,m]=(0,mt.useState)(""),[f,g]=(0,mt.useState)(""),[b,v]=(0,mt.useState)(""),[y,x]=(0,mt.useState)([]),[O,w]=(0,mt.useState)([]);function S(e,t){w([...t,...e]);const r=hs(e);x([...t,...r])}const[_,P]=(0,mt.useState)([]);(0,mt.useEffect)((()=>{n.languageProvider.start(a)}),[]),(0,mt.useEffect)((()=>{var e,t,n,a,i,s,c,d;if(r)if(r.qryType===Xn.ClassicQuery)o(r.qryType),v(null!=(e=r.query)?e:"");else{const e=function(e){return"string"==typeof e?bc(e):e.query?bc(e.query):e}(r);u(null!=(t=e.match)?t:""),o(e.qryType),l(null!=(n=e.label)?n:""),p(null!=(a=e.metric)?a:""),P(null!=(i=e.labelFilters)?i:[]),m(null!=(s=e.varQuery)?s:""),g(null!=(c=e.seriesQuery)?c:""),v(null!=(d=e.classicQuery)?d:"")}}),[r]),(0,mt.useEffect)((()=>{if(i!==Xn.LabelValues)return;const e=n.getVariables().map((e=>({label:e,value:e})));if(d){const t=[{label:"__name__",op:"=",value:d}],r=Or.renderLabels(t);n.languageProvider.fetchLabelsWithMatch(r).then((t=>{S(Object.keys(t).map((e=>({label:e,value:e}))),e)}))}else n.getTagKeys({filters:[]}).then((t=>{S(t.map((({text:e})=>({label:e,value:e}))),e)}))}),[n,i,d]);const E=(e,r)=>{let n=r?{labelFilters:r}:{labelFilters:_};const a=rd(rd(rd({},{qryType:i,label:s,metric:d,match:c,varQuery:h,seriesQuery:f,classicQuery:b,refId:"PrometheusVariableQueryEditor-VariableQuery"}),e),n),o=function(e){var t,r,n,a;switch(e.qryType){case Xn.LabelNames:return e.match?`label_names(${e.match})`:"label_names()";case Xn.LabelValues:if(e.metric||e.labelFilters&&0!==e.labelFilters.length){const r={metric:e.metric,labels:null!=(t=e.labelFilters)?t:[],operations:[]};return`label_values(${Or.renderQuery(r)},${e.label})`}return`label_values(${e.label})`;case Xn.MetricNames:return`metrics(${e.metric})`;case Xn.VarQueryResult:return`query_result(${(a=e.varQuery)?a.replace(/[\r\n]+/gm,""):""})`;case Xn.SeriesQuery:return null!=(r=e.seriesQuery)?r:"";case Xn.ClassicQuery:return null!=(n=e.classicQuery)?n:""}return""}(a);t({query:o,qryType:a.qryType,refId:"PrometheusVariableQueryEditor-VariableQuery"})},T=(0,mt.useCallback)((()=>({metric:d,labels:_,operations:[]})),[d,_]),C=fa()((e=>hs(O.filter((t=>{var r;return null==(r=t.value)?void 0:r.includes(e)})))),300);return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Query type",labelWidth:20,tooltip:(0,ht.jsx)("div",{children:"The Prometheus data source plugin provides the following query types for template variables."}),children:(0,ht.jsx)(bt.Select,{placeholder:"Select query type","aria-label":"Query type",onChange:e=>{var t;o(e.value),e.value!==Xn.SeriesQuery&&E({qryType:null!=(t=e.value)?t:0})},value:i,options:nd,width:25,"data-testid":Tn.components.DataSource.Prometheus.variableQueryEditor.queryType})})}),i===Xn.LabelValues&&(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Label",labelWidth:20,required:!0,"aria-labelledby":"label-select",tooltip:(0,ht.jsx)("div",{children:"Returns a list of label values for the label name in all metrics unless the metric is specified."}),children:(0,ht.jsx)(bt.AsyncSelect,{"aria-label":"label-select",onChange:e=>{const t=e&&e.value?e.value:"";l(t),i===Xn.LabelValues&&t&&E({label:t})},value:s?(0,e.toOption)(s):null,defaultOptions:y,width:25,allowCustomValue:!0,isClearable:!0,loadOptions:C,"data-testid":Tn.components.DataSource.Prometheus.variableQueryEditor.labelValues.labelSelect})})}),(0,ht.jsx)(Yu,{query:T(),datasource:n,onChange:e=>{var t;p(e.metric),P(e.labels);const r=e.metric,n=null!=(t=e.labels)?t:[];i===Xn.LabelValues&&s&&(r||n)&&E({qryType:i,metric:r},n)},variableEditor:!0})]}),i===Xn.LabelNames&&(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Metric regex",labelWidth:20,"aria-labelledby":"Metric regex",tooltip:(0,ht.jsx)("div",{children:"Returns a list of label names, optionally filtering by specified metric regex."}),children:(0,ht.jsx)(bt.Input,{type:"text","aria-label":"Metric regex",placeholder:"Metric regex",value:c,onBlur:e=>{var t;u(e.currentTarget.value),t=e.currentTarget.value,i===Xn.LabelNames&&E({qryType:i,match:t})},onChange:e=>{u(e.currentTarget.value)},width:25,"data-testid":Tn.components.DataSource.Prometheus.variableQueryEditor.labelnames.metricRegex})})}),i===Xn.MetricNames&&(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Metric regex",labelWidth:20,"aria-labelledby":"Metric selector",tooltip:(0,ht.jsx)("div",{children:"Returns a list of metrics matching the specified metric regex."}),children:(0,ht.jsx)(bt.Input,{type:"text","aria-label":"Metric selector",placeholder:"Metric regex",value:d,onChange:e=>{p(e.currentTarget.value)},onBlur:e=>{var t;p(e.currentTarget.value),t=e.currentTarget.value,i===Xn.MetricNames&&t&&E({metric:t})},width:25,"data-testid":Tn.components.DataSource.Prometheus.variableQueryEditor.metricNames.metricRegex})})}),i===Xn.VarQueryResult&&(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Query",labelWidth:20,tooltip:(0,ht.jsx)("div",{children:"Returns a list of Prometheus query results for the query. This can include Prometheus functions, i.e. sum(go_goroutines)."}),children:(0,ht.jsx)(bt.TextArea,{type:"text","aria-label":"Prometheus Query",placeholder:"Prometheus Query",value:h,onChange:e=>{m(e.currentTarget.value)},onBlur:()=>{i===Xn.VarQueryResult&&h&&E({qryType:i})},cols:100,"data-testid":Tn.components.DataSource.Prometheus.variableQueryEditor.varQueryResult})})}),i===Xn.SeriesQuery&&(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Series Query",labelWidth:20,tooltip:(0,ht.jsx)("div",{children:'Enter a metric with labels, only a metric or only labels, i.e. go_goroutines{instance="localhost:9090"}, go_goroutines, or {instance="localhost:9090"}. Returns a list of time series associated with the entered data.'}),children:(0,ht.jsx)(bt.Input,{type:"text","aria-label":"Series Query",placeholder:"Series Query",value:f,onChange:e=>{g(e.currentTarget.value)},onBlur:()=>{i===Xn.SeriesQuery&&f&&E({qryType:i})},width:100,"data-testid":Tn.components.DataSource.Prometheus.variableQueryEditor.seriesQuery})})}),i===Xn.ClassicQuery&&(0,ht.jsx)(bt.InlineFieldRow,{children:(0,ht.jsx)(bt.InlineField,{label:"Classic Query",labelWidth:20,tooltip:(0,ht.jsx)("div",{children:"The original implemetation of the Prometheus variable query editor. Enter a string with the correct query type and parameters as described in these docs. For example, label_values(label, metric)."}),children:(0,ht.jsx)(bt.Input,{type:"text","aria-label":"Classic Query",placeholder:"Classic Query",value:b,onChange:e=>{v(e.currentTarget.value)},onBlur:()=>{i===Xn.ClassicQuery&&b&&E({qryType:i})},width:100,"data-testid":Tn.components.DataSource.Prometheus.variableQueryEditor.classicQuery})})})]})};var id=Object.defineProperty,od=Object.defineProperties,sd=Object.getOwnPropertyDescriptors,ld=Object.getOwnPropertySymbols,cd=Object.prototype.hasOwnProperty,ud=Object.prototype.propertyIsEnumerable,dd=(e,t,r)=>t in e?id(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pd=(e,t)=>{for(var r in t||(t={}))cd.call(t,r)&&dd(e,r,t[r]);if(ld)for(var r of ld(t))ud.call(t,r)&&dd(e,r,t[r]);return e};class hd extends e.CustomVariableSupport{constructor(e,t=(0,j.getTemplateSrv)()){var r;super(),this.datasource=e,this.templateSrv=t,dd(this,"symbol"!=typeof(r="editor")?r+"":r,ad)}query(t){let n;if(n="string"==typeof t.targets[0]?t.targets[0]:t.targets[0].query,!n)return(0,r.of)({data:[]});const a=pd((i=pd({},t.scopedVars),o={__interval:{text:this.datasource.interval,value:this.datasource.interval},__interval_ms:{text:e.rangeUtil.intervalToMs(this.datasource.interval),value:e.rangeUtil.intervalToMs(this.datasource.interval)}},od(i,sd(o))),this.datasource.getRangeScopedVars(t.range));var i,o;const s=this.templateSrv.replace(n,a,this.datasource.interpolateQueryExpr),l=new Pc(this.datasource,s);return(0,r.from)(l.process(t.range)).pipe(P((e=>({data:e}))))}}var md=Object.defineProperty,fd=Object.defineProperties,gd=Object.getOwnPropertyDescriptors,bd=Object.getOwnPropertySymbols,vd=Object.prototype.hasOwnProperty,yd=Object.prototype.propertyIsEnumerable,xd=(e,t,r)=>t in e?md(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Od=(e,t)=>{for(var r in t||(t={}))vd.call(t,r)&&xd(e,r,t[r]);if(bd)for(var r of bd(t))yd.call(t,r)&&xd(e,r,t[r]);return e},wd=(e,t)=>fd(e,gd(t)),Sd=(e,t,r)=>(xd(e,"symbol"!=typeof t?t+"":t,r),r);const _d=["api/v1/query","api/v1/query_range","api/v1/series","api/v1/labels"];class Pd extends j.DataSourceWithBackend{constructor(t,r=(0,j.getTemplateSrv)(),n){var a,i,o,s,l,c;super(t),this.templateSrv=r,Sd(this,"type"),Sd(this,"ruleMappings"),Sd(this,"hasIncrementalQuery"),Sd(this,"url"),Sd(this,"id"),Sd(this,"access"),Sd(this,"basicAuth"),Sd(this,"withCredentials"),Sd(this,"interval"),Sd(this,"queryTimeout"),Sd(this,"httpMethod"),Sd(this,"languageProvider"),Sd(this,"exemplarTraceIdDestinations"),Sd(this,"lookupsDisabled"),Sd(this,"customQueryParameters"),Sd(this,"datasourceConfigurationPrometheusFlavor"),Sd(this,"datasourceConfigurationPrometheusVersion"),Sd(this,"disableRecordingRules"),Sd(this,"defaultEditor"),Sd(this,"exemplarsAvailable"),Sd(this,"cacheLevel"),Sd(this,"cache"),Sd(this,"metricNamesAutocompleteSuggestionLimit"),Sd(this,"init",(async()=>{this.disableRecordingRules||this.loadRules(),this.exemplarsAvailable=await this.areExemplarsAvailable()})),Sd(this,"processAnnotationResponse",((t,r)=>{var n;const a=(0,j.toDataQueryResponse)({data:r}).data;if(!a||!a.length)return[];const i=t.annotation,{tagKeys:o="",titleFormat:s="",textFormat:l=""}=i,c=1e3*e.rangeUtil.intervalToSeconds(i.step||"60s"),u=o.split(","),d=[];for(const r of a){if(0===r.fields.length)continue;const a=r.fields[0],o=r.fields[1],p=(null==o?void 0:o.labels)||{},h=Object.keys(p).filter((e=>u.includes(e))).map((e=>p[e])),m=[];let f=0;o.values.forEach((e=>{let r,n;const i=a.values[f];t.annotation.useValueForTime?(r=Math.floor(parseFloat(e)),n=1):(r=Math.floor(parseFloat(i)),n=parseFloat(e)),f++,m.push([r,n])}));const g=m.filter((e=>e[1]>0)).map((e=>e[0]));let b=null;for(const t of g)b&&(null!=(n=b.timeEnd)?n:0)+c>=t?b.timeEnd=t:(b&&d.push(b),b={time:t,timeEnd:t,annotation:i,title:(0,e.renderLegendFormat)(s,p),tags:h,text:(0,e.renderLegendFormat)(l,p)});b&&(b.timeEnd=g[g.length-1],d.push(b))}return d})),this.type="prometheus",this.id=t.id,this.url=t.url,this.access=t.access,this.basicAuth=t.basicAuth,this.withCredentials=Boolean(t.withCredentials),this.interval=t.jsonData.timeInterval||"15s",this.queryTimeout=t.jsonData.queryTimeout,this.httpMethod=t.jsonData.httpMethod||"GET",this.exemplarTraceIdDestinations=t.jsonData.exemplarTraceIdDestinations,this.hasIncrementalQuery=null!=(a=t.jsonData.incrementalQuerying)&&a,this.ruleMappings={},this.languageProvider=null!=n?n:new ha(this),this.lookupsDisabled=null!=(i=t.jsonData.disableMetricsLookup)&&i,this.customQueryParameters=new URLSearchParams(t.jsonData.customQueryParameters),this.datasourceConfigurationPrometheusFlavor=t.jsonData.prometheusType,this.datasourceConfigurationPrometheusVersion=t.jsonData.prometheusVersion,this.defaultEditor=t.jsonData.defaultEditor,this.disableRecordingRules=null!=(o=t.jsonData.disableRecordingRules)&&o,this.variables=new hd(this,this.templateSrv),this.exemplarsAvailable=!0,this.cacheLevel=null!=(s=t.jsonData.cacheLevel)?s:Un.Low,this.metricNamesAutocompleteSuggestionLimit=null!=(l=t.jsonData.codeModeMetricNamesSuggestionLimit)?l:sa,this.cache=new Jc({getTargetSignature:this.getPrometheusTargetSignature.bind(this),overlapString:null!=(c=t.jsonData.incrementalQueryOverlapWindow)?c:Yc}),this.annotations={QueryEditor:rc}}getQueryDisplayText(e){return e.expr}getPrometheusTargetSignature(e,t){var r,n;return`${this.interpolateString(t.expr)}|${null!=(r=t.interval)?r:e.interval}|${JSON.stringify(null!=(n=e.rangeRaw)?n:"")}|${t.exemplar}`}hasLabelsMatchAPISupport(){return this._isDatasourceVersionGreaterOrEqualTo("2.24.0",Gn.Prometheus)||this._isDatasourceVersionGreaterOrEqualTo("2.0.0",Gn.Mimir)||this._isDatasourceVersionGreaterOrEqualTo("1.11.0",Gn.Cortex)||this._isDatasourceVersionGreaterOrEqualTo("0.18.0",Gn.Thanos)}_isDatasourceVersionGreaterOrEqualTo(e,t){return!this.datasourceConfigurationPrometheusVersion||!this.datasourceConfigurationPrometheusFlavor||t===this.datasourceConfigurationPrometheusFlavor&&I().gte(this.datasourceConfigurationPrometheusVersion,e)}_addTracingHeaders(e,t){e.headers={},"proxy"===this.access&&(e.headers["X-Dashboard-UID"]=t.dashboardUID,e.headers["X-Panel-Id"]=t.panelId)}directAccessError(){return(0,r.throwError)((()=>new Error("Browser access mode in the Prometheus datasource is no longer available. Switch to server access mode.")))}_request(e,r,n={}){if("direct"===this.access)return this.directAccessError();r=r||{};for(const[e,t]of this.customQueryParameters)null==r[e]&&(r[e]=t);let a=this.url+e;e.startsWith(`/api/datasources/uid/${this.uid}`)&&(a=e);const i=(0,t.defaults)(n,{url:a,method:this.httpMethod,headers:{}});return"GET"===i.method?r&&Object.keys(r).length&&(i.url=i.url+(i.url.search(/\?/)>=0?"&":"?")+Object.entries(r).map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&")):(i.headers["Content-Type"]="application/x-www-form-urlencoded",i.data=r),(this.basicAuth||this.withCredentials)&&(i.withCredentials=!0),this.basicAuth&&(i.headers.Authorization=this.basicAuth),(0,j.getBackendSrv)().fetch(i)}async importFromAbstractQueries(e){return e.map((e=>this.languageProvider.importFromAbstractQuery(e)))}async exportToAbstractQueries(e){return e.map((e=>this.languageProvider.exportToAbstractQuery(e)))}async metadataRequest(e,t={},n){if(_d.some((t=>e.includes(t))))try{return await(0,r.lastValueFrom)(this._request(`/api/datasources/uid/${this.uid}/resources${e}`,t,Od({method:this.httpMethod,hideFromInspector:!0,showErrorAlert:!1},n)))}catch(e){if("POST"!==this.httpMethod||!(0,j.isFetchError)(e)||405!==e.status&&400!==e.status)throw e;console.warn("Couldn't use configured POST HTTP method for this request. Trying to use GET method instead.")}return await(0,r.lastValueFrom)(this._request(`/api/datasources/uid/${this.uid}/resources${e}`,t,Od({method:"GET",hideFromInspector:!0},n)))}interpolateQueryExpr(e=[],t){if(!t.multi&&!t.includeAll)return Ed(e);if("string"==typeof e)return Td(e);const r=e.map((e=>Td(e)));return 1===r.length?r[0]:"("+r.join("|")+")"}targetContainsTemplate(e){return this.templateSrv.containsTemplate(e.expr)}shouldRunExemplarQuery(e,t){if(e.exemplar){const r=this.languageProvider.histogramMetrics.find((t=>e.expr.includes(t))),n=t.targets.findIndex((t=>t.refId===e.refId)),a=t.targets.slice(0,n).filter((e=>!e.hide));return!(r&&(!r||a.some((e=>e.expr.includes(r)))))}return!1}processTargetV2(e,t){var r;const n=[],a=wd(Od({},e),{exemplar:this.shouldRunExemplarQuery(e,t),requestId:t.panelId+e.refId,utcOffsetSec:60*t.range.to.utcOffset()});return j.config.featureToggles.promQLScope&&(a.scopes=(null!=(r=t.scopes)?r:[]).map((e=>Od({name:e.metadata.name},e.spec)))),j.config.featureToggles.groupByVariable&&(a.groupByKeys=t.groupByKeys),e.instant&&e.range?n.push(wd(Od({},a),{refId:a.refId,instant:!1}),wd(Od({},a),{refId:a.refId+"-Instant",range:!1})):n.push(a),n}query(r){if("direct"===this.access)return this.directAccessError();let n,a;const i=r.targets.some((e=>e.instant));this.hasIncrementalQuery&&!i?(a=this.cache.requestInfo(r),n=a.requests[0]):n=r;const o=n.targets.map((e=>this.processTargetV2(e,n))),s=new Date;return super.query(wd(Od({},n),{targets:o.flat()})).pipe(P((n=>function(r,n,a){j.config.featureToggles.prometheusDataplane&&r.data.forEach((t=>{const a=n.targets.find((e=>e.refId===t.refId));a&&"__auto"===a.legendFormat&&t.fields.forEach((n=>{var a,i;if((null==(a=n.labels)?void 0:a.__name__)&&(null==(i=n.labels)?void 0:i.__name__)===n.name){const a=su(ou({},n),{name:e.TIME_SERIES_VALUE_FIELD_NAME});n.config.displayNameFromDS=(0,e.getFieldDisplayName)(a,t,r.data)}}))}));const[i,o]=(0,t.partition)(r.data,(t=>((t,r)=>{var n,a,i,o;if(r.app===e.CoreApp.Explore&&("vector"===(null==(a=null==(n=t.meta)?void 0:n.custom)?void 0:a.resultType)||"scalar"===(null==(o=null==(i=t.meta)?void 0:i.custom)?void 0:o.resultType)))return!0;const s=r.targets.find((e=>e.refId===t.refId));return"table"===(null==s?void 0:s.format)})(t,n))),s=function(r){if(0===r.length||1===r.length&&0===r[0].length)return r;const n=(0,t.groupBy)(r,"refId"),a=Object.keys(n);return a.map((t=>{const r=function(e,t=""){return e>1?`Value #${t}`:"Value"}(a.length,t),i=function({data:t,valueName:r=e.TIME_SERIES_VALUE_FIELD_NAME,parseValue:n=!0,labels:a,displayNameFromDS:i}){return{name:r,type:e.FieldType.number,display:(0,e.getDisplayProcessor)(),config:{displayNameFromDS:i},labels:a,values:t.map((e=>n?fu(e[1]):e[1]))}}({data:[],valueName:r}),o=function(t,r=!1){return{name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{},values:t.map((e=>r?e[0]:1e3*e[0]))}}([]),s=[];return n[t].forEach((t=>{var r;const n=t.fields[1],a=null!=(r=null==n?void 0:n.labels)?r:{};Object.keys(a).sort().forEach((t=>{if(!s.some((e=>e.name===t))){const r=t===uu;s.push({name:t,config:{filterable:!0},type:r?e.FieldType.number:e.FieldType.string,values:[]})}}))})),n[t].forEach((e=>{var t,r,n,a;const l=null!=(r=null==(t=e.fields[0])?void 0:t.values)?r:[],c=null!=(a=null==(n=e.fields[1])?void 0:n.values)?a:[];l.forEach((e=>o.values.push(e))),c.forEach((t=>{var r;i.values.push(fu(t));const n=null!=(r=e.fields[1].labels)?r:{};s.forEach((e=>{return e.values.push((t=n,r=e.name,t.hasOwnProperty(r)?r===uu?fu(t[r]):t[r]:""));var t,r}))}))})),{refId:t,fields:[o,...s,i],meta:su(ou({},n[t][0].meta),{preferredVisualisationType:"rawPrometheus"}),length:o.values.length}}))}(i),[l,c]=(0,t.partition)(o,(e=>{var t,r;return"exemplar"===(null==(r=null==(t=e.meta)?void 0:t.custom)?void 0:r.resultType)})),{exemplarTraceIdDestinations:u}=a,d=l.map((t=>{var r;if(null==u?void 0:u.length)for(const e of u){const n=t.fields.find((t=>t.name===e.name));if(n){const t=du(e);n.config.links=(null==(r=n.config.links)?void 0:r.length)?[...n.config.links,...t]:t}}return su(ou({},t),{meta:su(ou({},t.meta),{dataTopic:e.DataTopic.Annotations})})})),[p,h]=(0,t.partition)(c,(t=>((t,r)=>{var n;if((null==(n=t.meta)?void 0:n.type)===e.DataFrameType.HeatmapCells)return!1;const a=r.targets.find((e=>e.refId===t.refId));return"heatmap"===(null==a?void 0:a.format)})(t,n)));p.forEach((t=>{var r;if(null==t.name){let n=t.fields.find((t=>t.type===e.FieldType.number));if(n){let e=null==(r=n.labels)?void 0:r.le;e&&(t.name=e,n.config.displayNameFromDS=e)}}}));const m=(0,t.groupBy)(p,(e=>e.refId));let f=[];for(const r in m){const n=m[r],a=(0,t.groupBy)(n,(t=>{var r;const n=t.fields.find((t=>t.type===e.FieldType.number));if((null==n?void 0:n.labels)&&uu in n.labels){const e=null==n?void 0:n.labels,t=lu(e,["le"]);return Object.values(t).join()}return Object.values(null!=(r=null==n?void 0:n.labels)?r:[]).join()}));(0,t.forOwn)(a,((e,t)=>{const r=e.sort(mu);f.push(pu(hu(r)))}))}const g=h.map((e=>su(ou({},e),{meta:su(ou({},e.meta),{preferredVisualisationType:"graph"})}))),b=(0,t.flatten)(f);return su(ou({},r),{data:[...g,...s,...b,...d]})}(wd(Od({},n),{data:this.cache.procFrames(r,a,n.data)}),r,{exemplarTraceIdDestinations:this.exemplarTraceIdDestinations}))),T((t=>{!function(t,r,n){var a,i,o,s;const{app:l,targets:c}=r;if(l===e.CoreApp.Explore)for(const e of c)(0,j.reportInteraction)("grafana_prometheus_query_executed",{app:l,grafana_version:j.config.buildInfo.version,has_data:t.data.some((e=>e.length>0)),has_error:void 0!==t.error,expr:e.expr,format:e.format,instant:e.instant,range:e.range,exemplar:e.exemplar,hinting:e.hinting,interval:e.interval,intervalFactor:e.intervalFactor,utcOffsetSec:e.utcOffsetSec,legend:e.legendFormat,valueWithRefId:e.valueWithRefId,requestId:r.requestId,showingGraph:e.showingGraph,showingTable:e.showingTable,editor_mode:e.editorMode,simultaneously_sent_query_count:c.length,time_range_from:null==(i=null==(a=null==r?void 0:r.range)?void 0:a.from)?void 0:i.toISOString(),time_range_to:null==(s=null==(o=null==r?void 0:r.range)?void 0:o.to)?void 0:s.toISOString(),time_taken:Date.now()-n.getTime()})}(t,r,s)})))}metricFindQuery(t,r){var n,a;if(!t)return Promise.resolve([]);const i=Od({__interval:{text:this.interval,value:this.interval},__interval_ms:{text:e.rangeUtil.intervalToMs(this.interval),value:e.rangeUtil.intervalToMs(this.interval)}},this.getRangeScopedVars(null!=(n=null==r?void 0:r.range)?n:(0,e.getDefaultTimeRange)())),o=this.templateSrv.replace(t,i,this.interpolateQueryExpr);return new Pc(this,o).process(null!=(a=null==r?void 0:r.range)?a:(0,e.getDefaultTimeRange)())}getRangeScopedVars(e){const t=e.to.diff(e.from),r=Math.round(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:r,value:r},__range:{text:r+"s",value:r+"s"}}}async annotationQuery(e){if("direct"===this.access){const e=new Error("Browser access mode in the Prometheus datasource is no longer available. Switch to server access mode.");return Promise.reject(e)}const t=e.annotation,{expr:n=""}=t;if(!n)return Promise.resolve([]);const a={expr:n,range:!0,instant:!1,exemplar:!1,interval:e.annotation.step||"60s",refId:"X",datasource:this.getRef()};return await(0,r.lastValueFrom)((0,j.getBackendSrv)().fetch({url:"/api/ds/query",method:"POST",headers:this.getRequestHeaders(),data:{from:(1e3*ps(e.range.from,!1)).toString(),to:(1e3*ps(e.range.to,!0)).toString(),queries:[this.applyTemplateVariables(a,{})]},requestId:`prom-query-${t.name}`}).pipe(P((t=>this.processAnnotationResponse(e,t.data)))))}async getTagKeys(e){if(!e||0===e.filters.length)return await this.languageProvider.fetchLabels(e.timeRange,e.queries),this.languageProvider.getLabelKeys().map((e=>({value:e,text:e})));const t=e.filters.map((e=>({label:e.key,value:e.value,op:e.operator}))),r=Or.renderLabels(t);let n=await this.languageProvider.fetchLabelsWithMatch(r);return Object.keys(n).filter((t=>!e.filters.find((e=>e.key===t)))).map((e=>({value:e,text:e})))}async getTagValues(t){var r,n,a,i;const o=t.filters.map((e=>({label:e.key,value:e.value,op:e.operator}))),s=Or.renderLabels(o);if(this.hasLabelsMatchAPISupport()){const e=`[${this.uid}][${t.key}]`;return(await this.languageProvider.fetchSeriesValuesWithMatch(t.key,s,e,t.timeRange)).map((e=>({value:e,text:e})))}const l=this.getTimeRangeParams(null!=(r=t.timeRange)?r:(0,e.getDefaultTimeRange)()),c=await this.metadataRequest(`/api/v1/label/${t.key}/values`,l);return null!=(i=null==(a=null==(n=null==c?void 0:c.data)?void 0:n.data)?void 0:a.map((e=>({text:e}))))?i:[]}interpolateVariablesInQueries(e,t,r){let n=e;return e&&e.length&&(n=e.map((e=>{const n=this.templateSrv.replace(e.expr,t,this.interpolateQueryExpr),a=j.config.featureToggles.promQLScope?n:this.templateSrv.replace(this.enhanceExprWithAdHocFilters(r,n),t,this.interpolateQueryExpr);return wd(Od(Od({},e),j.config.featureToggles.promQLScope?{adhocFilters:this.generateScopeFilters(r)}:{}),{datasource:this.getRef(),expr:a,interval:this.templateSrv.replace(e.interval,t)})}))),n}getQueryHints(e,t){var r;return Ac(null!=(r=e.expr)?r:"",t,this)}getInitHints(){return function(e){const t=[];return e.lookupsDisabled&&t.push({label:"Labels and metrics lookup was disabled in data source settings.",type:"INFO"}),t}(this)}async loadRules(){var e,t;try{const r=null==(t=null==(e=(await this.metadataRequest("/api/v1/rules",{},{showErrorAlert:!1})).data)?void 0:e.data)?void 0:t.groups;r&&(this.ruleMappings=function(e){return e.reduce(((e,t)=>t.rules.filter((e=>"recording"===e.type)).reduce(((e,t)=>{var r;const n=null!=(r=e[t.name])?r:[];return n.push({query:t.query,labels:t.labels}),e[t.name]=n,e}),e)),{})}(r))}catch(e){console.log("Rules API is experimental. Ignore next error."),console.error(e)}}async areExemplarsAvailable(){try{return"success"===(await this.metadataRequest("/api/v1/query_exemplars",{query:"test",start:(0,e.dateTime)().subtract(30,"minutes").valueOf().toString(),end:(0,e.dateTime)().valueOf().toString()},{showErrorAlert:!1})).data.status}catch(e){return!1}}modifyQuery(e,t){var r,n,a;let i=null!=(r=e.expr)?r:"";switch(t.type){case"ADD_FILTER":{const{key:e,value:r}=null!=(n=t.options)?n:{};e&&r&&(i=Rr(i,e,r));break}case"ADD_FILTER_OUT":{const{key:e,value:r}=null!=(a=t.options)?a:{};e&&r&&(i=Rr(i,e,r,"!="));break}case"ADD_HISTOGRAM_QUANTILE":i=`histogram_quantile(0.95, sum(rate(${i}[$__rate_interval])) by (le))`;break;case"ADD_HISTOGRAM_AVG":i=`histogram_avg(rate(${i}[$__rate_interval]))`;break;case"ADD_HISTOGRAM_FRACTION":i=`histogram_fraction(0,0.2,rate(${i}[$__rate_interval]))`;break;case"ADD_HISTOGRAM_COUNT":i=`histogram_count(rate(${i}[$__rate_interval]))`;break;case"ADD_HISTOGRAM_SUM":i=`histogram_sum(rate(${i}[$__rate_interval]))`;break;case"ADD_HISTOGRAM_STDDEV":i=`histogram_stddev(rate(${i}[$__rate_interval]))`;break;case"ADD_HISTOGRAM_STDVAR":i=`histogram_stdvar(rate(${i}[$__rate_interval]))`;break;case"ADD_RATE":i=`rate(${i}[$__rate_interval])`;break;case"ADD_SUM":i=`sum(${i.trim()}) by ($1)`;break;case"EXPAND_RULES":t.options&&(i=function(e,t){const r=Object.keys(t).reduce(((e,t)=>{let r=[],n=[],a=[];return e.filter(Boolean).forEach(((e,i)=>{e.match(new RegExp(`(\\s|\\(|^)(${t})(\\s|$|\\(|\\[|\\{)`,"ig"))&&(r=e.split(t),2===r.length?(a.push(i),n.push(...[r[0],t,r[1]].filter(Boolean))):r.length>2&&(a.push(i),r=r.map((e=>""===e?t:e)),n.push(...r)))})),a.forEach((t=>e[t]="")),(e=e.filter(Boolean)).push(...n),e}),[e]);let n=!1;const a=r.map(((e,a)=>{if(n)return n=!1,"";if(t[e]){const{expandedQuery:i,identifierValue:o,identifier:s}=t[e];if(a+1!==r.length&&r[a+1].match(ts)){n=!0;const e=new RegExp(`(,)?(\\s)?(${s}=\\"${o}\\")(,)?(\\s)?`,"g");return function(e){var t;const r=e.match(/(\)\{|\}\{|\]\{)/);if(!r)return e;const n=null!=(t=r.index)?t:0,a=e.slice(0,n+1),i=e.slice(n+1),o=[];i.replace(ts,((e,t,r,n,a,i)=>(o.push({key:t,operator:r,value:n,comma:a,space:i}),"")));let s=a;o.filter(Boolean).forEach((e=>{const t=e.value.slice(1,-1);s=Rr(s,e.key,t,e.operator)}));let l=o.reduce(((e,t)=>{var r,n;return e+`${t.key}${t.operator}${t.value}${null!=(r=t.comma)?r:""}${null!=(n=t.space)?n:""}`}),"");l="{"+l+"}";const c=i.replace(l,"");return s+c}(i+r[a+1].replace(e,""))}return i}return e}));return a.filter(Boolean).join("")}(i,t.options))}return wd(Od({},e),{expr:i})}getAdjustedInterval(t){return function(t,r){if(t===Un.None)return{start:ps(r.from,!1).toString(),end:ps(r.to,!0).toString()};const n=ps(r.from,!1),a=(0,e.incrRoundDn)(n,60*ds(t)),i=60*function(e,t=1){return Math.ceil(e/60)-Math.ceil(e/60)%t}(ps(r.to,!0),ds(t));if(a===i){const e=i+60*ds(t);return{start:a.toString(),end:e.toString()}}return{start:a.toString(),end:i.toString()}}(this.cacheLevel,t)}getTimeRangeParams(e){return{start:ps(e.from,!1).toString(),end:ps(e.to,!0).toString()}}getOriginalMetricName(e){return function(e){const t=e.__name__||"";return delete e.__name__,`${t}{${Object.entries(e).map((e=>`${e[0]}="${e[1]}"`)).join(",")}}`}(e)}generateScopeFilters(t){return t?t.map((t=>wd(Od({},t),{value:this.templateSrv.replace(t.value,{},this.interpolateQueryExpr),operator:e.scopeFilterOperatorMap[t.operator]}))):[]}enhanceExprWithAdHocFilters(e,t){if(!e||0===e.length)return t;const r=e.reduce(((e,t)=>{const{key:r,operator:n}=t;let{value:a}=t;return"=~"!==n&&"!~"!==n||(a=Ed(a)),Rr(e,r,a,n)}),t);return r}filterQuery(e){return!(e.hide||!e.expr)}applyTemplateVariables(e,t,r){const n=Od({},t);n.__interval={value:"$__interval"},n.__interval_ms={value:"$__interval_ms"};const a=this.templateSrv.replace(e.expr,n,this.interpolateQueryExpr),i=j.config.featureToggles.promQLScope?a:this.templateSrv.replace(this.enhanceExprWithAdHocFilters(r,a),n,this.interpolateQueryExpr);return wd(Od(Od({},e),j.config.featureToggles.promQLScope?{adhocFilters:this.generateScopeFilters(r)}:{}),{expr:i,interval:this.templateSrv.replace(e.interval,n),legendFormat:this.templateSrv.replace(e.legendFormat,n)})}getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}interpolateString(e,t){return this.templateSrv.replace(e,t,this.interpolateQueryExpr)}getDebounceTimeInMilliseconds(){switch(this.cacheLevel){case Un.Medium:return 600;case Un.High:return 1200;default:return 350}}getDaysToCacheMetadata(){switch(this.cacheLevel){case Un.Medium:return 7;case Un.High:return 30;default:return 1}}getCacheDurationInMinutes(){return ds(this.cacheLevel)}getDefaultQuery(t){const r={refId:"A",expr:"",range:!0,instant:!1};return t===e.CoreApp.UnifiedAlerting?wd(Od({},r),{instant:!0,range:!1}):t===e.CoreApp.Explore?wd(Od({},r),{instant:!0,range:!0}):r}}function Ed(e){return"string"==typeof e?e.replace(/\\/g,"\\\\").replace(/'/g,"\\\\'"):e}function Td(e){return"string"==typeof e?e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&"):e}const Cd=({children:e})=>{const t=(0,bt.useStyles2)(Id);return gt().createElement("div",{className:t.root},e)},Id=e=>({root:(0,Nr.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})}),jd=({grow:e,shrink:t})=>gt().createElement("div",{style:{display:"block",flexGrow:e,flexShrink:t}}),$d=e=>{const{pattern:t,onPatternSelect:r,hasNewQueryOption:n,hasPreviousQuery:a,selectedPatternName:i,setSelectedPatternName:o}=e,s=(0,bt.useStyles2)(Dd),l={grammar:ut,name:"promql"};return(0,ht.jsxs)(bt.Card,{className:s.card,children:[(0,ht.jsx)(bt.Card.Heading,{children:t.name}),(0,ht.jsx)("div",{className:s.rawQueryContainer,children:(0,ht.jsx)(Bl,{"aria-label":`${t.name} raw query`,query:Or.renderQuery({labels:[],operations:t.operations,binaryQueries:t.binaryQueries}),lang:l,className:s.rawQuery})}),(0,ht.jsx)(bt.Card.Actions,{children:i!==t.name?(0,ht.jsx)(bt.Button,{size:"sm","aria-label":"use this query button",onClick:()=>{a?o(t.name):r(t)},children:"Use this query"}):(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("div",{className:s.spacing,children:`If you would like to use this query, ${n?"you can either apply this query pattern or create a new query":"this query pattern will be applied to your current query"}.`}),(0,ht.jsx)(bt.Button,{size:"sm","aria-label":"back button",fill:"outline",onClick:()=>o(null),children:"Back"}),(0,ht.jsx)(bt.Button,{size:"sm","aria-label":"apply query starter button",onClick:()=>{r(t)},children:"Apply query"}),n&&(0,ht.jsx)(bt.Button,{size:"sm","aria-label":"create new query button",onClick:()=>{r(t,!0)},children:"Create new query"})]})})]})},Dd=e=>({card:(0,Nr.css)({width:"49.5%",display:"flex",flexDirection:"column"}),rawQueryContainer:(0,Nr.css)({flexGrow:1}),rawQuery:(0,Nr.css)({backgroundColor:e.colors.background.primary,padding:e.spacing(1),marginTop:e.spacing(1)}),spacing:(0,Nr.css)({marginBottom:e.spacing(1)})});var kd=Object.defineProperty,Rd=Object.defineProperties,Ad=Object.getOwnPropertyDescriptors,Nd=Object.getOwnPropertySymbols,Ld=Object.prototype.hasOwnProperty,Md=Object.prototype.propertyIsEnumerable,Fd=(e,t,r)=>t in e?kd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Bd=(e,t)=>{for(var r in t||(t={}))Ld.call(t,r)&&Fd(e,r,t[r]);if(Nd)for(var r of Nd(t))Md.call(t,r)&&Fd(e,r,t[r]);return e},qd=(e,t)=>Rd(e,Ad(t));const Qd=r=>{const{isOpen:n,onClose:a,onChange:i,onAddQuery:o,query:s,queries:l,app:c}=r,[u,d]=(0,mt.useState)([]),[p,h]=(0,mt.useState)(null),m=(0,bt.useStyles2)(Vd),f=!!o,g=(0,mt.useMemo)((()=>{var e;const t=jr(null!=(e=s.expr)?e:""),r=t.query.operations.length>0,n=t.query.metric,a=t.query.labels.length>0,i=!!t.query.binaryQueries&&t.query.binaryQueries.length>0;return r||n||a||i}),[s.expr]),b=(t,r=!1)=>{const n=jr(r?"":s.expr);(0,j.reportInteraction)("grafana_prom_kickstart_your_query_selected",{app:null!=c?c:"",editorMode:s.editorMode,selectedPattern:t.name,preSelectedOperationsCount:n.query.operations.length,preSelectedLabelsCount:n.query.labels.length,createNewQuery:f&&r}),n.query.operations=t.operations,n.query.binaryQueries=t.binaryQueries,f&&r?o(qd(Bd({},s),{refId:(0,e.getNextRefId)(null!=l?l:[s]),expr:Or.renderQuery(n.query)})):i(qd(Bd({},s),{expr:Or.renderQuery(n.query)})),h(null),a()};return(0,ht.jsxs)(bt.Modal,{"aria-label":"Kick start your query modal",isOpen:n,title:"Kick start your query",onDismiss:a,children:[(0,ht.jsx)("div",{className:m.spacing,children:"Kick start your query by selecting one of these queries. You can then continue to complete your query."}),Object.values(Ot).map((e=>(0,ht.jsx)(bt.Collapse,{"aria-label":`open and close ${e} query starter card`,label:`${(0,t.capitalize)(e)} query starters`,isOpen:u.includes(e),collapsible:!0,onToggle:()=>d((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e])),children:(0,ht.jsx)("div",{className:m.cardsContainer,children:Or.getQueryPatterns().filter((t=>t.type===e)).map((e=>(0,ht.jsx)($d,{pattern:e,hasNewQueryOption:f,hasPreviousQuery:g,onPatternSelect:b,selectedPatternName:p,setSelectedPatternName:h},e.name)))})},e))),(0,ht.jsx)(bt.Button,{"aria-label":"close kick start your query modal",variant:"secondary",onClick:a,children:"Close"})]})},Vd=e=>({cardsContainer:(0,Nr.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"}),spacing:(0,Nr.css)({marginBottom:e.spacing(1)})});var Wd=(e=>(e.Code="code",e.Builder="builder",e))(Wd||{});const zd=[{label:"Builder",value:Wd.Builder},{label:"Code",value:Wd.Code}];function Ud({mode:e,onChange:t}){return(0,ht.jsx)("div",{"data-testid":"QueryEditorModeToggle",children:(0,ht.jsx)(bt.RadioButtonGroup,{options:zd,size:"sm",value:e,onChange:t})})}var Gd=Object.defineProperty,Hd=Object.defineProperties,Xd=Object.getOwnPropertyDescriptors,Yd=Object.getOwnPropertySymbols,Kd=Object.prototype.hasOwnProperty,Jd=Object.prototype.propertyIsEnumerable,Zd=(e,t,r)=>t in e?Gd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ep=(e,t)=>{for(var r in t||(t={}))Kd.call(t,r)&&Zd(e,r,t[r]);if(Yd)for(var r of Yd(t))Jd.call(t,r)&&Zd(e,r,t[r]);return e};function tp(e){var r=e,{label:n}=r,a=((e,t)=>{var r={};for(var n in e)Kd.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Yd)for(var n of Yd(e))t.indexOf(n)<0&&Jd.call(e,n)&&(r[n]=e[n]);return r})(r,["label"]);const i=n.replace(" ","-"),o=(0,mt.useRef)((0,t.uniqueId)(`switch-${i}`)),s=(0,bt.useStyles2)(rp);return(0,ht.jsxs)(bt.Stack,{gap:1,children:[(0,ht.jsx)("label",{htmlFor:o.current,className:s.switchLabel,children:n}),(0,ht.jsx)(bt.Switch,(l=ep({},a),c={id:o.current},Hd(l,Xd(c))))]});var l,c}const rp=e=>({switchLabel:(0,Nr.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}})});var np=Object.defineProperty,ap=Object.defineProperties,ip=Object.getOwnPropertyDescriptors,op=Object.getOwnPropertySymbols,sp=Object.prototype.hasOwnProperty,lp=Object.prototype.propertyIsEnumerable,cp=(e,t,r)=>t in e?np(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,up=(e,t)=>{for(var r in t||(t={}))sp.call(t,r)&&cp(e,r,t[r]);if(op)for(var r of op(t))lp.call(t,r)&&cp(e,r,t[r]);return e},dp=(e,t)=>ap(e,ip(t));const pp="PrometheusQueryEditorModeDefault";function hp(t,r,n){""===t.expr&&e.store.set(pp,r),n(dp(up({},t),{editorMode:r}))}function mp(t,r=Wd.Builder){if(null!=t&&""!==t)return Wd.Code;const n=e.store.get(pp);switch(n){case Wd.Builder:case Wd.Code:return n;default:return r}}var fp=b(8398),gp=b.n(fp),bp=b(200);function vp(e,t){var r=(0,mt.useState)((function(){return{inputs:t,result:e()}}))[0],n=(0,mt.useRef)(!0),a=(0,mt.useRef)(r),i=n.current||Boolean(t&&a.current.inputs&&function(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(t,a.current.inputs))?a.current:{inputs:t,result:e()};return(0,mt.useEffect)((function(){n.current=!1,a.current=i}),[i]),i.result}var yp=vp,xp=function(e,t){return vp((function(){return e}),t)},Op=function(e){var t=e.top,r=e.right,n=e.bottom,a=e.left;return{top:t,right:r,bottom:n,left:a,width:r-a,height:n-t,x:a,y:t,center:{x:(r+a)/2,y:(n+t)/2}}},wp=function(e,t){return{top:e.top-t.top,left:e.left-t.left,bottom:e.bottom+t.bottom,right:e.right+t.right}},Sp=function(e,t){return{top:e.top+t.top,left:e.left+t.left,bottom:e.bottom-t.bottom,right:e.right-t.right}},_p={top:0,right:0,bottom:0,left:0},Pp=function(e){var t=e.borderBox,r=e.margin,n=void 0===r?_p:r,a=e.border,i=void 0===a?_p:a,o=e.padding,s=void 0===o?_p:o,l=Op(wp(t,n)),c=Op(Sp(t,i)),u=Op(Sp(c,s));return{marginBox:l,borderBox:Op(t),paddingBox:c,contentBox:u,margin:n,border:i,padding:s}},Ep=function(e){var t=e.slice(0,-2);if("px"!==e.slice(-2))return 0;var r=Number(t);return isNaN(r)&&function(){throw new Error("Invariant failed")}(),r},Tp=function(e,t){var r,n,a=e.borderBox,i=e.border,o=e.margin,s=e.padding,l=(n=t,{top:(r=a).top+n.y,left:r.left+n.x,bottom:r.bottom+n.y,right:r.right+n.x});return Pp({borderBox:l,border:i,margin:o,padding:s})},Cp=function(e,t){return void 0===t&&(t={x:window.pageXOffset,y:window.pageYOffset}),Tp(e,t)},Ip=function(e,t){var r={top:Ep(t.marginTop),right:Ep(t.marginRight),bottom:Ep(t.marginBottom),left:Ep(t.marginLeft)},n={top:Ep(t.paddingTop),right:Ep(t.paddingRight),bottom:Ep(t.paddingBottom),left:Ep(t.paddingLeft)},a={top:Ep(t.borderTopWidth),right:Ep(t.borderRightWidth),bottom:Ep(t.borderBottomWidth),left:Ep(t.borderLeftWidth)};return Pp({borderBox:e,margin:r,padding:n,border:a})},jp=function(e){var t=e.getBoundingClientRect(),r=window.getComputedStyle(e);return Ip(t,r)},$p=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function Dp(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!((n=e[r])===(a=t[r])||$p(n)&&$p(a)))return!1;var n,a;return!0}function kp(e,t){void 0===t&&(t=Dp);var r=null;function n(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(r&&r.lastThis===this&&t(n,r.lastArgs))return r.lastResult;var i=e.apply(this,n);return r={lastResult:i,lastArgs:n,lastThis:this},i}return n.clear=function(){r=null},n}const Rp=function(e){var t=[],r=null,n=function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];t=a,r||(r=requestAnimationFrame((function(){r=null,e.apply(void 0,t)})))};return n.cancel=function(){r&&(cancelAnimationFrame(r),r=null)},n};function Ap(e,t){}function Np(){}function Lp(e,t,r){const n=t.map((t=>{const n=(a=r,i=t.options,{...a,...i});var a,i;return e.addEventListener(t.eventName,t.fn,n),function(){e.removeEventListener(t.eventName,t.fn,n)}}));return function(){n.forEach((e=>{e()}))}}Ap.bind(null,"warn"),Ap.bind(null,"error");class Mp extends Error{}function Fp(e,t){if(!e)throw new Mp("Invariant failed")}Mp.prototype.toString=function(){return this.message};class Bp extends gt().Component{constructor(...e){super(...e),this.callbacks=null,this.unbind=Np,this.onWindowError=e=>{const t=this.getCallbacks();t.isDragging()&&t.tryAbort(),e.error instanceof Mp&&e.preventDefault()},this.getCallbacks=()=>{if(!this.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return this.callbacks},this.setCallbacks=e=>{this.callbacks=e}}componentDidMount(){this.unbind=Lp(window,[{eventName:"error",fn:this.onWindowError}])}componentDidCatch(e){if(!(e instanceof Mp))throw e;this.setState({})}componentWillUnmount(){this.unbind()}render(){return this.props.children(this.setCallbacks)}}const qp=e=>e+1,Qp=(e,t)=>{const r=e.droppableId===t.droppableId,n=qp(e.index),a=qp(t.index);return r?`\n      You have moved the item from position ${n}\n      to position ${a}\n    `:`\n    You have moved the item from position ${n}\n    in list ${e.droppableId}\n    to list ${t.droppableId}\n    in position ${a}\n  `},Vp=(e,t,r)=>t.droppableId===r.droppableId?`\n      The item ${e}\n      has been combined with ${r.draggableId}`:`\n      The item ${e}\n      in list ${t.droppableId}\n      has been combined with ${r.draggableId}\n      in list ${r.droppableId}\n    `,Wp=e=>`\n  The item has returned to its starting position\n  of ${qp(e.index)}\n`,zp={dragHandleUsageInstructions:"\n  Press space bar to start a drag.\n  When dragging you can use the arrow keys to move the item around and escape to cancel.\n  Some screen readers may require you to be in focus mode or to use your pass through key\n",onDragStart:e=>`\n  You have lifted an item in position ${qp(e.source.index)}\n`,onDragUpdate:e=>{const t=e.destination;if(t)return Qp(e.source,t);const r=e.combine;return r?Vp(e.draggableId,e.source,r):"You are over an area that cannot be dropped on"},onDragEnd:e=>{if("CANCEL"===e.reason)return`\n      Movement cancelled.\n      ${Wp(e.source)}\n    `;const t=e.destination,r=e.combine;return t?`\n      You have dropped the item.\n      ${Qp(e.source,t)}\n    `:r?`\n      You have dropped the item.\n      ${Vp(e.draggableId,e.source,r)}\n    `:`\n    The item has been dropped while not over a drop area.\n    ${Wp(e.source)}\n  `}};var Up=zp;const Gp={x:0,y:0},Hp=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),Xp=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),Yp=(e,t)=>e.x===t.x&&e.y===t.y,Kp=e=>({x:0!==e.x?-e.x:0,y:0!==e.y?-e.y:0}),Jp=(e,t,r=0)=>"x"===e?{x:t,y:r}:{x:r,y:t},Zp=(e,t)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),eh=(e,t)=>Math.min(...t.map((t=>Zp(e,t)))),th=e=>t=>({x:e(t.x),y:e(t.y)}),rh=(e,t)=>({top:e.top+t.y,left:e.left+t.x,bottom:e.bottom+t.y,right:e.right+t.x}),nh=e=>[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.left,y:e.bottom},{x:e.right,y:e.bottom}],ah=(e,t)=>t&&t.shouldClipSubject?((e,t)=>{const r=Op({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return r.width<=0||r.height<=0?null:r})(t.pageMarginBox,e):Op(e);var ih=({page:e,withPlaceholder:t,axis:r,frame:n})=>{const a=((e,t)=>t?rh(e,t.scroll.diff.displacement):e)(e.marginBox,n),i=((e,t,r)=>r&&r.increasedBy?{...e,[t.end]:e[t.end]+r.increasedBy[t.line]}:e)(a,r,t);return{page:e,withPlaceholder:t,active:ah(i,n)}},oh=(e,t)=>{e.frame||Fp(!1);const r=e.frame,n=Xp(t,r.scroll.initial),a=Kp(n),i={...r,scroll:{initial:r.scroll.initial,current:t,diff:{value:n,displacement:a},max:r.scroll.max}},o=ih({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:i});return{...e,frame:i,subject:o}};const sh=kp((e=>e.reduce(((e,t)=>(e[t.descriptor.id]=t,e)),{}))),lh=kp((e=>e.reduce(((e,t)=>(e[t.descriptor.id]=t,e)),{}))),ch=kp((e=>Object.values(e))),uh=kp((e=>Object.values(e)));var dh=kp(((e,t)=>{const r=uh(t).filter((t=>e===t.descriptor.droppableId)).sort(((e,t)=>e.descriptor.index-t.descriptor.index));return r}));function ph(e){return e.at&&"REORDER"===e.at.type?e.at.destination:null}function hh(e){return e.at&&"COMBINE"===e.at.type?e.at.combine:null}var mh=kp(((e,t)=>t.filter((t=>t.descriptor.id!==e.descriptor.id)))),fh=(e,t)=>e.descriptor.droppableId===t.descriptor.id;const gh={point:Gp,value:0},bh={invisible:{},visible:{},all:[]};var vh={displaced:bh,displacedBy:gh,at:null},yh=(e,t)=>r=>e<=r&&r<=t,xh=e=>{const t=yh(e.top,e.bottom),r=yh(e.left,e.right);return n=>{if(t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right))return!0;const a=t(n.top)||t(n.bottom),i=r(n.left)||r(n.right);if(a&&i)return!0;const o=n.top<e.top&&n.bottom>e.bottom,s=n.left<e.left&&n.right>e.right;return!(!o||!s)||(o&&i||s&&a)}},Oh=e=>{const t=yh(e.top,e.bottom),r=yh(e.left,e.right);return e=>t(e.top)&&t(e.bottom)&&r(e.left)&&r(e.right)};const wh={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},Sh={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},_h=({target:e,destination:t,viewport:r,withDroppableDisplacement:n,isVisibleThroughFrameFn:a})=>{const i=n?((e,t)=>{const r=t.frame?t.frame.scroll.diff.displacement:Gp;return rh(e,r)})(e,t):e;return((e,t,r)=>!!t.subject.active&&r(t.subject.active)(e))(i,t,a)&&((e,t,r)=>r(t)(e))(i,r,a)},Ph=e=>_h({...e,isVisibleThroughFrameFn:Oh});function Eh({afterDragging:e,destination:t,displacedBy:r,viewport:n,forceShouldAnimate:a,last:i}){return e.reduce((function(e,o){const s=function(e,t){const r=e.page.marginBox,n={top:t.point.y,right:0,bottom:0,left:t.point.x};return Op(wp(r,n))}(o,r),l=o.descriptor.id;var c;if(e.all.push(l),c={target:s,destination:t,viewport:n,withDroppableDisplacement:!0},!_h({...c,isVisibleThroughFrameFn:xh}))return e.invisible[o.descriptor.id]=!0,e;const u=((e,t,r)=>{if("boolean"==typeof r)return r;if(!t)return!0;const{invisible:n,visible:a}=t;if(n[e])return!1;const i=a[e];return!i||i.shouldAnimate})(l,i,a),d={draggableId:l,shouldAnimate:u};return e.visible[l]=d,e}),{all:[],visible:{},invisible:{}})}function Th({insideDestination:e,inHomeList:t,displacedBy:r,destination:n}){const a=function(e,t){if(!e.length)return 0;const r=e[e.length-1].descriptor.index;return t.inHomeList?r:r+1}(e,{inHomeList:t});return{displaced:bh,displacedBy:r,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:a}}}}function Ch({draggable:e,insideDestination:t,destination:r,viewport:n,displacedBy:a,last:i,index:o,forceShouldAnimate:s}){const l=fh(e,r);if(null==o)return Th({insideDestination:t,inHomeList:l,displacedBy:a,destination:r});const c=t.find((e=>e.descriptor.index===o));if(!c)return Th({insideDestination:t,inHomeList:l,displacedBy:a,destination:r});const u=mh(e,t),d=t.indexOf(c);return{displaced:Eh({afterDragging:u.slice(d),destination:r,displacedBy:a,last:i,viewport:n.frame,forceShouldAnimate:s}),displacedBy:a,at:{type:"REORDER",destination:{droppableId:r.descriptor.id,index:o}}}}function Ih(e,t){return Boolean(t.effected[e])}const jh=(e,t)=>t.margin[e.start]+t.borderBox[e.size]/2,$h=(e,t,r)=>t[e.crossAxisStart]+r.margin[e.crossAxisStart]+r.borderBox[e.crossAxisSize]/2,Dh=({axis:e,moveRelativeTo:t,isMoving:r})=>Jp(e.line,t.marginBox[e.end]+jh(e,r),$h(e,t.marginBox,r)),kh=({axis:e,moveRelativeTo:t,isMoving:r})=>Jp(e.line,t.marginBox[e.start]-((e,t)=>t.margin[e.end]+t.borderBox[e.size]/2)(e,r),$h(e,t.marginBox,r));var Rh=(e,t)=>{const r=e.frame;return r?Hp(t,r.scroll.diff.displacement):t},Ah=e=>{const t=(({impact:e,draggable:t,droppable:r,draggables:n,afterCritical:a})=>{const i=t.page.borderBox.center,o=e.at;return r&&o?"REORDER"===o.type?(({impact:e,draggable:t,draggables:r,droppable:n,afterCritical:a})=>{const i=dh(n.descriptor.id,r),o=t.page,s=n.axis;if(!i.length)return(({axis:e,moveInto:t,isMoving:r})=>Jp(e.line,t.contentBox[e.start]+jh(e,r),$h(e,t.contentBox,r)))({axis:s,moveInto:n.page,isMoving:o});const{displaced:l,displacedBy:c}=e,u=l.all[0];if(u){const e=r[u];if(Ih(u,a))return kh({axis:s,moveRelativeTo:e.page,isMoving:o});const t=Tp(e.page,c.point);return kh({axis:s,moveRelativeTo:t,isMoving:o})}const d=i[i.length-1];if(d.descriptor.id===t.descriptor.id)return o.borderBox.center;if(Ih(d.descriptor.id,a)){const e=Tp(d.page,Kp(a.displacedBy.point));return Dh({axis:s,moveRelativeTo:e,isMoving:o})}return Dh({axis:s,moveRelativeTo:d.page,isMoving:o})})({impact:e,draggable:t,draggables:n,droppable:r,afterCritical:a}):(({afterCritical:e,impact:t,draggables:r})=>{const n=hh(t);n||Fp(!1);const a=n.draggableId,i=r[a].page.borderBox.center,o=(({displaced:e,afterCritical:t,combineWith:r,displacedBy:n})=>{const a=Boolean(e.visible[r]||e.invisible[r]);return Ih(r,t)?a?Gp:Kp(n.point):a?n.point:Gp})({displaced:t.displaced,afterCritical:e,combineWith:a,displacedBy:t.displacedBy});return Hp(i,o)})({impact:e,draggables:n,afterCritical:a}):i})(e),r=e.droppable;return r?Rh(r,t):t},Nh=(e,t)=>{const r=Xp(t,e.scroll.initial),n=Kp(r);return{frame:Op({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:r,displacement:n}}}};function Lh(e,t){return e.map((e=>t[e]))}var Mh=({pageBorderBoxCenter:e,draggable:t,viewport:r})=>{const n=((e,t)=>Hp(e.scroll.diff.displacement,t))(r,e),a=Xp(n,t.page.borderBox.center);return Hp(t.client.borderBox.center,a)},Fh=({draggable:e,destination:t,newPageBorderBoxCenter:r,viewport:n,withDroppableDisplacement:a,onlyOnMainAxis:i=!1})=>{const o=Xp(r,e.page.borderBox.center),s={target:rh(e.page.borderBox,o),destination:t,withDroppableDisplacement:a,viewport:n};return i?(e=>{return _h({...e,isVisibleThroughFrameFn:(t=e.destination.axis,e=>{const r=yh(e.top,e.bottom),n=yh(e.left,e.right);return e=>t===wh?r(e.top)&&r(e.bottom):n(e.left)&&n(e.right)})});var t})(s):Ph(s)},Bh=({isMovingForward:e,draggable:t,destination:r,draggables:n,previousImpact:a,viewport:i,previousPageBorderBoxCenter:o,previousClientSelection:s,afterCritical:l})=>{if(!r.isEnabled)return null;const c=dh(r.descriptor.id,n),u=fh(t,r),d=(({isMovingForward:e,draggable:t,destination:r,insideDestination:n,previousImpact:a})=>{if(!r.isCombineEnabled)return null;if(!ph(a))return null;function i(e){const t={type:"COMBINE",combine:{draggableId:e,droppableId:r.descriptor.id}};return{...a,at:t}}const o=a.displaced.all,s=o.length?o[0]:null;if(e)return s?i(s):null;const l=mh(t,n);if(!s)return l.length?i(l[l.length-1].descriptor.id):null;const c=l.findIndex((e=>e.descriptor.id===s));-1===c&&Fp(!1);const u=c-1;return u<0?null:i(l[u].descriptor.id)})({isMovingForward:e,draggable:t,destination:r,insideDestination:c,previousImpact:a})||(({isMovingForward:e,isInHomeList:t,draggable:r,draggables:n,destination:a,insideDestination:i,previousImpact:o,viewport:s,afterCritical:l})=>{const c=o.at;if(c||Fp(!1),"REORDER"===c.type){const n=(({isMovingForward:e,isInHomeList:t,insideDestination:r,location:n})=>{if(!r.length)return null;const a=n.index,i=e?a+1:a-1,o=r[0].descriptor.index,s=r[r.length-1].descriptor.index;return i<o||i>(t?s:s+1)?null:i})({isMovingForward:e,isInHomeList:t,location:c.destination,insideDestination:i});return null==n?null:Ch({draggable:r,insideDestination:i,destination:a,viewport:s,last:o.displaced,displacedBy:o.displacedBy,index:n})}const u=(({isMovingForward:e,destination:t,draggables:r,combine:n,afterCritical:a})=>{if(!t.isCombineEnabled)return null;const i=n.draggableId,o=r[i].descriptor.index;return Ih(i,a)?e?o:o-1:e?o+1:o})({isMovingForward:e,destination:a,displaced:o.displaced,draggables:n,combine:c.combine,afterCritical:l});return null==u?null:Ch({draggable:r,insideDestination:i,destination:a,viewport:s,last:o.displaced,displacedBy:o.displacedBy,index:u})})({isMovingForward:e,isInHomeList:u,draggable:t,draggables:n,destination:r,insideDestination:c,previousImpact:a,viewport:i,afterCritical:l});if(!d)return null;const p=Ah({impact:d,draggable:t,droppable:r,draggables:n,afterCritical:l});if(Fh({draggable:t,destination:r,newPageBorderBoxCenter:p,viewport:i.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:Mh({pageBorderBoxCenter:p,draggable:t,viewport:i}),impact:d,scrollJumpRequest:null};const h=Xp(p,o),m=(({impact:e,viewport:t,destination:r,draggables:n,maxScrollChange:a})=>{const i=Nh(t,Hp(t.scroll.current,a)),o=r.frame?oh(r,Hp(r.frame.scroll.current,a)):r,s=e.displaced,l=Eh({afterDragging:Lh(s.all,n),destination:r,displacedBy:e.displacedBy,viewport:i.frame,last:s,forceShouldAnimate:!1}),c=Eh({afterDragging:Lh(s.all,n),destination:o,displacedBy:e.displacedBy,viewport:t.frame,last:s,forceShouldAnimate:!1}),u={},d={},p=[s,l,c];return s.all.forEach((e=>{const t=function(e,t){for(let r=0;r<t.length;r++){const n=t[r].visible[e];if(n)return n}return null}(e,p);t?d[e]=t:u[e]=!0})),{...e,displaced:{all:s.all,invisible:u,visible:d}}})({impact:d,viewport:i,destination:r,draggables:n,maxScrollChange:h});return{clientSelection:s,impact:m,scrollJumpRequest:h}};const qh=e=>{const t=e.subject.active;return t||Fp(!1),t},Qh=(e,t)=>{const r=e.page.borderBox.center;return Ih(e.descriptor.id,t)?Xp(r,t.displacedBy.point):r},Vh=(e,t)=>{const r=e.page.borderBox;return Ih(e.descriptor.id,t)?rh(r,Kp(t.displacedBy.point)):r};var Wh=kp((function(e,t){const r=t[e.line];return{value:r,point:Jp(e.line,r)}}));const zh=(e,t)=>({...e,scroll:{...e.scroll,max:t}}),Uh=(e,t,r)=>{const n=e.frame;fh(t,e)&&Fp(!1),e.subject.withPlaceholder&&Fp(!1);const a=Wh(e.axis,t.displaceBy).point,i=((e,t,r)=>{const n=e.axis;if("virtual"===e.descriptor.mode)return Jp(n.line,t[n.line]);const a=e.subject.page.contentBox[n.size],i=dh(e.descriptor.id,r).reduce(((e,t)=>e+t.client.marginBox[n.size]),0)+t[n.line]-a;return i<=0?null:Jp(n.line,i)})(e,a,r),o={placeholderSize:a,increasedBy:i,oldFrameMaxScroll:e.frame?e.frame.scroll.max:null};if(!n){const t=ih({page:e.subject.page,withPlaceholder:o,axis:e.axis,frame:e.frame});return{...e,subject:t}}const s=i?Hp(n.scroll.max,i):n.scroll.max,l=zh(n,s),c=ih({page:e.subject.page,withPlaceholder:o,axis:e.axis,frame:l});return{...e,subject:c,frame:l}};var Gh=e=>{const t=e.at;return t?"REORDER"===t.type?t.destination.droppableId:t.combine.droppableId:null},Hh=({state:e,type:t})=>{const r=((e,t)=>{const r=Gh(e);return r?t[r]:null})(e.impact,e.dimensions.droppables),n=Boolean(r),a=e.dimensions.droppables[e.critical.droppable.id],i=r||a,o=i.axis.direction,s="vertical"===o&&("MOVE_UP"===t||"MOVE_DOWN"===t)||"horizontal"===o&&("MOVE_LEFT"===t||"MOVE_RIGHT"===t);if(s&&!n)return null;const l="MOVE_DOWN"===t||"MOVE_RIGHT"===t,c=e.dimensions.draggables[e.critical.draggable.id],u=e.current.page.borderBoxCenter,{draggables:d,droppables:p}=e.dimensions;return s?Bh({isMovingForward:l,previousPageBorderBoxCenter:u,draggable:c,destination:i,draggables:d,viewport:e.viewport,previousClientSelection:e.current.client.selection,previousImpact:e.impact,afterCritical:e.afterCritical}):(({isMovingForward:e,previousPageBorderBoxCenter:t,draggable:r,isOver:n,draggables:a,droppables:i,viewport:o,afterCritical:s})=>{const l=(({isMovingForward:e,pageBorderBoxCenter:t,source:r,droppables:n,viewport:a})=>{const i=r.subject.active;if(!i)return null;const o=r.axis,s=yh(i[o.start],i[o.end]),l=ch(n).filter((e=>e!==r)).filter((e=>e.isEnabled)).filter((e=>Boolean(e.subject.active))).filter((e=>xh(a.frame)(qh(e)))).filter((t=>{const r=qh(t);return e?i[o.crossAxisEnd]<r[o.crossAxisEnd]:r[o.crossAxisStart]<i[o.crossAxisStart]})).filter((e=>{const t=qh(e),r=yh(t[o.start],t[o.end]);return s(t[o.start])||s(t[o.end])||r(i[o.start])||r(i[o.end])})).sort(((t,r)=>{const n=qh(t)[o.crossAxisStart],a=qh(r)[o.crossAxisStart];return e?n-a:a-n})).filter(((e,t,r)=>qh(e)[o.crossAxisStart]===qh(r[0])[o.crossAxisStart]));if(!l.length)return null;if(1===l.length)return l[0];const c=l.filter((e=>yh(qh(e)[o.start],qh(e)[o.end])(t[o.line])));return 1===c.length?c[0]:c.length>1?c.sort(((e,t)=>qh(e)[o.start]-qh(t)[o.start]))[0]:l.sort(((e,r)=>{const n=eh(t,nh(qh(e))),a=eh(t,nh(qh(r)));return n!==a?n-a:qh(e)[o.start]-qh(r)[o.start]}))[0]})({isMovingForward:e,pageBorderBoxCenter:t,source:n,droppables:i,viewport:o});if(!l)return null;const c=dh(l.descriptor.id,a),u=(({pageBorderBoxCenter:e,viewport:t,destination:r,insideDestination:n,afterCritical:a})=>{const i=n.filter((e=>Ph({target:Vh(e,a),destination:r,viewport:t.frame,withDroppableDisplacement:!0}))).sort(((t,n)=>{const i=Zp(e,Rh(r,Qh(t,a))),o=Zp(e,Rh(r,Qh(n,a)));return i<o?-1:o<i?1:t.descriptor.index-n.descriptor.index}));return i[0]||null})({pageBorderBoxCenter:t,viewport:o,destination:l,insideDestination:c,afterCritical:s}),d=(({previousPageBorderBoxCenter:e,moveRelativeTo:t,insideDestination:r,draggable:n,draggables:a,destination:i,viewport:o,afterCritical:s})=>{if(!t){if(r.length)return null;const e={displaced:bh,displacedBy:gh,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:0}}},t=Ah({impact:e,draggable:n,droppable:i,draggables:a,afterCritical:s}),l=fh(n,i)?i:Uh(i,n,a);return Fh({draggable:n,destination:l,newPageBorderBoxCenter:t,viewport:o.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?e:null}const l=Boolean(e[i.axis.line]<=t.page.borderBox.center[i.axis.line]),c=(()=>{const e=t.descriptor.index;return t.descriptor.id===n.descriptor.id||l?e:e+1})(),u=Wh(i.axis,n.displaceBy);return Ch({draggable:n,insideDestination:r,destination:i,viewport:o,displacedBy:u,last:bh,index:c})})({previousPageBorderBoxCenter:t,destination:l,draggable:r,draggables:a,moveRelativeTo:u,insideDestination:c,viewport:o,afterCritical:s});if(!d)return null;const p=Ah({impact:d,draggable:r,droppable:l,draggables:a,afterCritical:s});return{clientSelection:Mh({pageBorderBoxCenter:p,draggable:r,viewport:o}),impact:d,scrollJumpRequest:null}})({isMovingForward:l,previousPageBorderBoxCenter:u,draggable:c,isOver:i,draggables:d,droppables:p,viewport:e.viewport,afterCritical:e.afterCritical})};function Xh(e){return"DRAGGING"===e.phase||"COLLECTING"===e.phase}function Yh(e){const t=yh(e.top,e.bottom),r=yh(e.left,e.right);return function(e){return t(e.y)&&r(e.x)}}const Kh=(e,t)=>Op(rh(e,t));function Jh({displaced:e,id:t}){return Boolean(e.visible[t]||e.invisible[t])}var Zh=({pageOffset:e,draggable:t,draggables:r,droppables:n,previousImpact:a,viewport:i,afterCritical:o})=>{const s=Kh(t.page.borderBox,e),l=function({pageBorderBox:e,draggable:t,droppables:r}){const n=ch(r).filter((t=>{if(!t.isEnabled)return!1;const r=t.subject.active;if(!r)return!1;if(a=r,!((n=e).left<a.right&&n.right>a.left&&n.top<a.bottom&&n.bottom>a.top))return!1;var n,a;if(Yh(r)(e.center))return!0;const i=t.axis,o=r.center[i.crossAxisLine],s=e[i.crossAxisStart],l=e[i.crossAxisEnd],c=yh(r[i.crossAxisStart],r[i.crossAxisEnd]),u=c(s),d=c(l);return!u&&!d||(u?s<o:l>o)}));return n.length?1===n.length?n[0].descriptor.id:function({pageBorderBox:e,draggable:t,candidates:r}){const n=t.page.borderBox.center,a=r.map((t=>{const r=t.axis,a=Jp(t.axis.line,e.center[r.line],t.page.borderBox.center[r.crossAxisLine]);return{id:t.descriptor.id,distance:Zp(n,a)}})).sort(((e,t)=>t.distance-e.distance));return a[0]?a[0].id:null}({pageBorderBox:e,draggable:t,candidates:n}):null}({pageBorderBox:s,draggable:t,droppables:n});if(!l)return vh;const c=n[l],u=dh(c.descriptor.id,r),d=((e,t)=>{const r=e.frame;return r?Kh(t,r.scroll.diff.value):t})(c,s);return(({draggable:e,pageBorderBoxWithDroppableScroll:t,previousImpact:r,destination:n,insideDestination:a,afterCritical:i})=>{if(!n.isCombineEnabled)return null;const o=n.axis,s=Wh(n.axis,e.displaceBy),l=s.value,c=t[o.start],u=t[o.end],d=mh(e,a).find((e=>{const t=e.descriptor.id,n=e.page.borderBox,a=n[o.size]/4,s=Ih(t,i),d=Jh({displaced:r.displaced,id:t});return s?d?u>n[o.start]+a&&u<n[o.end]-a:c>n[o.start]-l+a&&c<n[o.end]-l-a:d?u>n[o.start]+l+a&&u<n[o.end]+l-a:c>n[o.start]+a&&c<n[o.end]-a}));return d?{displacedBy:s,displaced:r.displaced,at:{type:"COMBINE",combine:{draggableId:d.descriptor.id,droppableId:n.descriptor.id}}}:null})({pageBorderBoxWithDroppableScroll:d,draggable:t,previousImpact:a,destination:c,insideDestination:u,afterCritical:o})||(({pageBorderBoxWithDroppableScroll:e,draggable:t,destination:r,insideDestination:n,last:a,viewport:i,afterCritical:o})=>{const s=r.axis,l=Wh(r.axis,t.displaceBy),c=l.value,u=e[s.start],d=e[s.end],p=function({draggable:e,closest:t,inHomeList:r}){return t?r&&t.descriptor.index>e.descriptor.index?t.descriptor.index-1:t.descriptor.index:null}({draggable:t,closest:mh(t,n).find((e=>{const t=e.descriptor.id,r=e.page.borderBox.center[s.line],n=Ih(t,o),i=Jh({displaced:a,id:t});return n?i?d<=r:u<r-c:i?d<=r+c:u<r}))||null,inHomeList:fh(t,r)});return Ch({draggable:t,insideDestination:n,destination:r,viewport:i,last:a,displacedBy:l,index:p})})({pageBorderBoxWithDroppableScroll:d,draggable:t,destination:c,insideDestination:u,last:a.displaced,viewport:i,afterCritical:o})},em=(e,t)=>({...e,[t.descriptor.id]:t});var tm=({state:e,clientSelection:t,dimensions:r,viewport:n,impact:a,scrollJumpRequest:i})=>{const o=n||e.viewport,s=r||e.dimensions,l=t||e.current.client.selection,c=Xp(l,e.initial.client.selection),u={offset:c,selection:l,borderBoxCenter:Hp(e.initial.client.borderBoxCenter,c)},d={selection:Hp(u.selection,o.scroll.current),borderBoxCenter:Hp(u.borderBoxCenter,o.scroll.current),offset:Hp(u.offset,o.scroll.diff.value)},p={client:u,page:d};if("COLLECTING"===e.phase)return{...e,dimensions:s,viewport:o,current:p};const h=s.draggables[e.critical.draggable.id],m=a||Zh({pageOffset:d.offset,draggable:h,draggables:s.draggables,droppables:s.droppables,previousImpact:e.impact,viewport:o,afterCritical:e.afterCritical}),f=(({draggable:e,draggables:t,droppables:r,previousImpact:n,impact:a})=>{const i=(({previousImpact:e,impact:t,droppables:r})=>{const n=Gh(e),a=Gh(t);if(!n)return r;if(n===a)return r;const i=r[n];if(!i.subject.withPlaceholder)return r;const o=(e=>{const t=e.subject.withPlaceholder;t||Fp(!1);const r=e.frame;if(!r){const t=ih({page:e.subject.page,axis:e.axis,frame:null,withPlaceholder:null});return{...e,subject:t}}const n=t.oldFrameMaxScroll;n||Fp(!1);const a=zh(r,n),i=ih({page:e.subject.page,axis:e.axis,frame:a,withPlaceholder:null});return{...e,subject:i,frame:a}})(i);return em(r,o)})({previousImpact:n,impact:a,droppables:r}),o=Gh(a);if(!o)return i;const s=r[o];if(fh(e,s))return i;if(s.subject.withPlaceholder)return i;const l=Uh(s,e,t);return em(i,l)})({draggable:h,impact:m,previousImpact:e.impact,draggables:s.draggables,droppables:s.droppables});return{...e,current:p,dimensions:{draggables:s.draggables,droppables:f},impact:m,viewport:o,scrollJumpRequest:i||null,forceShouldAnimate:!i&&null}},rm=({impact:e,viewport:t,draggables:r,destination:n,forceShouldAnimate:a})=>{const i=e.displaced,o=function(e,t){return e.map((e=>t[e]))}(i.all,r),s=Eh({afterDragging:o,destination:n,displacedBy:e.displacedBy,viewport:t.frame,forceShouldAnimate:a,last:i});return{...e,displaced:s}},nm=({impact:e,draggable:t,droppable:r,draggables:n,viewport:a,afterCritical:i})=>{const o=Ah({impact:e,draggable:t,draggables:n,droppable:r,afterCritical:i});return Mh({pageBorderBoxCenter:o,draggable:t,viewport:a})},am=({state:e,dimensions:t,viewport:r})=>{"SNAP"!==e.movementMode&&Fp(!1);const n=e.impact,a=r||e.viewport,i=t||e.dimensions,{draggables:o,droppables:s}=i,l=o[e.critical.draggable.id],c=Gh(n);c||Fp(!1);const u=s[c],d=rm({impact:n,viewport:a,destination:u,draggables:o}),p=nm({impact:d,draggable:l,droppable:u,draggables:o,viewport:a,afterCritical:e.afterCritical});return tm({impact:d,clientSelection:p,state:e,dimensions:i,viewport:a})},im=({draggable:e,home:t,draggables:r,viewport:n})=>{const a=Wh(t.axis,e.displaceBy),i=dh(t.descriptor.id,r),o=i.indexOf(e);-1===o&&Fp(!1);const s=i.slice(o+1),l=s.reduce(((e,t)=>(e[t.descriptor.id]=!0,e)),{}),c={inVirtualList:"virtual"===t.descriptor.mode,displacedBy:a,effected:l};var u;return{impact:{displaced:Eh({afterDragging:s,destination:t,displacedBy:a,last:null,viewport:n.frame,forceShouldAnimate:!1}),displacedBy:a,at:{type:"REORDER",destination:(u=e.descriptor,{index:u.index,droppableId:u.droppableId})}},afterCritical:c}};const om=e=>"SNAP"===e.movementMode,sm=(e,t,r)=>{const n=((e,t)=>({draggables:e.draggables,droppables:em(e.droppables,t)}))(e.dimensions,t);return!om(e)||r?tm({state:e,dimensions:n}):am({state:e,dimensions:n})};function lm(e){return e.isDragging&&"SNAP"===e.movementMode?{...e,scrollJumpRequest:null}:e}const cm={phase:"IDLE",completed:null,shouldFlush:!1};var um=(e=cm,t)=>{if("FLUSH"===t.type)return{...cm,shouldFlush:!0};if("INITIAL_PUBLISH"===t.type){"IDLE"!==e.phase&&Fp(!1);const{critical:r,clientSelection:n,viewport:a,dimensions:i,movementMode:o}=t.payload,s=i.draggables[r.draggable.id],l=i.droppables[r.droppable.id],c={selection:n,borderBoxCenter:s.client.borderBox.center,offset:Gp},u={client:c,page:{selection:Hp(c.selection,a.scroll.initial),borderBoxCenter:Hp(c.selection,a.scroll.initial),offset:Hp(c.selection,a.scroll.diff.value)}},d=ch(i.droppables).every((e=>!e.isFixedOnPage)),{impact:p,afterCritical:h}=im({draggable:s,home:l,draggables:i.draggables,viewport:a});return{phase:"DRAGGING",isDragging:!0,critical:r,movementMode:o,dimensions:i,initial:u,current:u,isWindowScrollAllowed:d,impact:p,afterCritical:h,onLiftImpact:p,viewport:a,scrollJumpRequest:null,forceShouldAnimate:null}}if("COLLECTION_STARTING"===t.type)return"COLLECTING"===e.phase||"DROP_PENDING"===e.phase?e:("DRAGGING"!==e.phase&&Fp(!1),{...e,phase:"COLLECTING"});if("PUBLISH_WHILE_DRAGGING"===t.type)return"COLLECTING"!==e.phase&&"DROP_PENDING"!==e.phase&&Fp(!1),(({state:e,published:t})=>{const r=t.modified.map((t=>{const r=e.dimensions.droppables[t.droppableId];return oh(r,t.scroll)})),n={...e.dimensions.droppables,...sh(r)},a=lh((({additions:e,updatedDroppables:t,viewport:r})=>{const n=r.scroll.diff.value;return e.map((e=>{const a=e.descriptor.droppableId,i=(e=>{const t=e.frame;return t||Fp(!1),t})(t[a]),o=i.scroll.diff.value,s=(({draggable:e,offset:t,initialWindowScroll:r})=>{const n=Tp(e.client,t),a=Cp(n,r);return{...e,placeholder:{...e.placeholder,client:n},client:n,page:a}})({draggable:e,offset:Hp(n,o),initialWindowScroll:r.scroll.initial});return s}))})({additions:t.additions,updatedDroppables:n,viewport:e.viewport})),i={...e.dimensions.draggables,...a};t.removals.forEach((e=>{delete i[e]}));const o={droppables:n,draggables:i},s=Gh(e.impact),l=s?o.droppables[s]:null,c=o.draggables[e.critical.draggable.id],u=o.droppables[e.critical.droppable.id],{impact:d,afterCritical:p}=im({draggable:c,home:u,draggables:i,viewport:e.viewport}),h=l&&l.isCombineEnabled?e.impact:d,m=Zh({pageOffset:e.current.page.offset,draggable:o.draggables[e.critical.draggable.id],draggables:o.draggables,droppables:o.droppables,previousImpact:h,viewport:e.viewport,afterCritical:p}),f={...e,phase:"DRAGGING",impact:m,onLiftImpact:d,dimensions:o,afterCritical:p,forceShouldAnimate:!1};return"COLLECTING"===e.phase?f:{...f,phase:"DROP_PENDING",reason:e.reason,isWaiting:!1}})({state:e,published:t.payload});if("MOVE"===t.type){if("DROP_PENDING"===e.phase)return e;Xh(e)||Fp(!1);const{client:r}=t.payload;return Yp(r,e.current.client.selection)?e:tm({state:e,clientSelection:r,impact:om(e)?e.impact:null})}if("UPDATE_DROPPABLE_SCROLL"===t.type){if("DROP_PENDING"===e.phase)return lm(e);if("COLLECTING"===e.phase)return lm(e);Xh(e)||Fp(!1);const{id:r,newScroll:n}=t.payload,a=e.dimensions.droppables[r];if(!a)return e;const i=oh(a,n);return sm(e,i,!1)}if("UPDATE_DROPPABLE_IS_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;Xh(e)||Fp(!1);const{id:r,isEnabled:n}=t.payload,a=e.dimensions.droppables[r];a||Fp(!1),a.isEnabled===n&&Fp(!1);const i={...a,isEnabled:n};return sm(e,i,!0)}if("UPDATE_DROPPABLE_IS_COMBINE_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;Xh(e)||Fp(!1);const{id:r,isCombineEnabled:n}=t.payload,a=e.dimensions.droppables[r];a||Fp(!1),a.isCombineEnabled===n&&Fp(!1);const i={...a,isCombineEnabled:n};return sm(e,i,!0)}if("MOVE_BY_WINDOW_SCROLL"===t.type){if("DROP_PENDING"===e.phase||"DROP_ANIMATING"===e.phase)return e;Xh(e)||Fp(!1),e.isWindowScrollAllowed||Fp(!1);const r=t.payload.newScroll;if(Yp(e.viewport.scroll.current,r))return lm(e);const n=Nh(e.viewport,r);return om(e)?am({state:e,viewport:n}):tm({state:e,viewport:n})}if("UPDATE_VIEWPORT_MAX_SCROLL"===t.type){if(!Xh(e))return e;const r=t.payload.maxScroll;if(Yp(r,e.viewport.scroll.max))return e;const n={...e.viewport,scroll:{...e.viewport.scroll,max:r}};return{...e,viewport:n}}if("MOVE_UP"===t.type||"MOVE_DOWN"===t.type||"MOVE_LEFT"===t.type||"MOVE_RIGHT"===t.type){if("COLLECTING"===e.phase||"DROP_PENDING"===e.phase)return e;"DRAGGING"!==e.phase&&Fp(!1);const r=Hh({state:e,type:t.type});return r?tm({state:e,impact:r.impact,clientSelection:r.clientSelection,scrollJumpRequest:r.scrollJumpRequest}):e}if("DROP_PENDING"===t.type){const r=t.payload.reason;return"COLLECTING"!==e.phase&&Fp(!1),{...e,phase:"DROP_PENDING",isWaiting:!0,reason:r}}if("DROP_ANIMATE"===t.type){const{completed:r,dropDuration:n,newHomeClientOffset:a}=t.payload;return"DRAGGING"!==e.phase&&"DROP_PENDING"!==e.phase&&Fp(!1),{phase:"DROP_ANIMATING",completed:r,dropDuration:n,newHomeClientOffset:a,dimensions:e.dimensions}}if("DROP_COMPLETE"===t.type){const{completed:e}=t.payload;return{phase:"IDLE",completed:e,shouldFlush:!1}}return e};const dm=e=>({type:"PUBLISH_WHILE_DRAGGING",payload:e}),pm=()=>({type:"COLLECTION_STARTING",payload:null}),hm=e=>({type:"UPDATE_DROPPABLE_SCROLL",payload:e}),mm=e=>({type:"UPDATE_DROPPABLE_IS_ENABLED",payload:e}),fm=e=>({type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:e}),gm=e=>({type:"MOVE",payload:e}),bm=()=>({type:"MOVE_UP",payload:null}),vm=()=>({type:"MOVE_DOWN",payload:null}),ym=()=>({type:"MOVE_RIGHT",payload:null}),xm=()=>({type:"MOVE_LEFT",payload:null}),Om=e=>({type:"DROP_COMPLETE",payload:e}),wm=e=>({type:"DROP",payload:e}),Sm="cubic-bezier(.2,1,.1,1)",_m=0,Pm=.7,Em=.75,Tm={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},Cm=`${Tm.outOfTheWay}s cubic-bezier(0.2, 0, 0, 1)`,Im={fluid:`opacity ${Cm}`,snap:`transform ${Cm}, opacity ${Cm}`,drop:e=>{const t=`${e}s ${Sm}`;return`transform ${t}, opacity ${t}`},outOfTheWay:`transform ${Cm}`,placeholder:`height ${Cm}, width ${Cm}, margin ${Cm}`},jm=e=>Yp(e,Gp)?void 0:`translate(${e.x}px, ${e.y}px)`,$m=jm,{minDropTime:Dm,maxDropTime:km}=Tm,Rm=km-Dm;var Am=({getState:e,dispatch:t})=>r=>n=>{if("DROP"!==n.type)return void r(n);const a=e(),i=n.payload.reason;if("COLLECTING"===a.phase)return void t((o={reason:i},{type:"DROP_PENDING",payload:o}));var o;if("IDLE"===a.phase)return;"DROP_PENDING"===a.phase&&a.isWaiting&&Fp(!1),"DRAGGING"!==a.phase&&"DROP_PENDING"!==a.phase&&Fp(!1);const s=a.critical,l=a.dimensions,c=l.draggables[a.critical.draggable.id],{impact:u,didDropInsideDroppable:d}=(({draggables:e,reason:t,lastImpact:r,home:n,viewport:a,onLiftImpact:i})=>r.at&&"DROP"===t?"REORDER"===r.at.type?{impact:r,didDropInsideDroppable:!0}:{impact:{...r,displaced:bh},didDropInsideDroppable:!0}:{impact:rm({draggables:e,impact:i,destination:n,viewport:a,forceShouldAnimate:!0}),didDropInsideDroppable:!1})({reason:i,lastImpact:a.impact,afterCritical:a.afterCritical,onLiftImpact:a.onLiftImpact,home:a.dimensions.droppables[a.critical.droppable.id],viewport:a.viewport,draggables:a.dimensions.draggables}),p=d?ph(u):null,h=d?hh(u):null,m={index:s.draggable.index,droppableId:s.droppable.id},f={draggableId:c.descriptor.id,type:c.descriptor.type,source:m,reason:i,mode:a.movementMode,destination:p,combine:h},g=(({impact:e,draggable:t,dimensions:r,viewport:n,afterCritical:a})=>{const{draggables:i,droppables:o}=r,s=Gh(e),l=s?o[s]:null,c=o[t.descriptor.droppableId],u=nm({impact:e,draggable:t,draggables:i,afterCritical:a,droppable:l||c,viewport:n});return Xp(u,t.client.borderBox.center)})({impact:u,draggable:c,dimensions:l,viewport:a.viewport,afterCritical:a.afterCritical}),b={critical:a.critical,afterCritical:a.afterCritical,result:f,impact:u};if(Yp(a.current.client.offset,g)&&!Boolean(f.combine))return void t(Om({completed:b}));const v=(({current:e,destination:t,reason:r})=>{const n=Zp(e,t);if(n<=0)return Dm;if(n>=1500)return km;const a=Dm+Rm*(n/1500);return Number(("CANCEL"===r?.6*a:a).toFixed(2))})({current:a.current.client.offset,destination:g,reason:i});t((e=>({type:"DROP_ANIMATE",payload:e}))({newHomeClientOffset:g,dropDuration:v,completed:b}))},Nm=()=>({x:window.pageXOffset,y:window.pageYOffset});var Lm=e=>{const t=function({onWindowScroll:e}){const t=Rp((function(){e(Nm())})),r=function(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:t=>{t.target!==window&&t.target!==window.document||e()}}}(t);let n=Np;function a(){return n!==Np}return{start:function(){a()&&Fp(!1),n=Lp(window,[r])},stop:function(){a()||Fp(!1),t.cancel(),n(),n=Np},isActive:a}}({onWindowScroll:t=>{e.dispatch({type:"MOVE_BY_WINDOW_SCROLL",payload:{newScroll:t}})}});return e=>r=>{t.isActive()||"INITIAL_PUBLISH"!==r.type||t.start(),t.isActive()&&(e=>"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type)(r)&&t.stop(),e(r)}};const Mm=(e,t)=>{t()},Fm=(e,t)=>({draggableId:e.draggable.id,type:e.droppable.type,source:{droppableId:e.droppable.id,index:e.draggable.index},mode:t});function Bm(e,t,r,n){if(!e)return void r(n(t));const a=(e=>{let t=!1,r=!1;const n=setTimeout((()=>{r=!0})),a=a=>{t||r||(t=!0,e(a),clearTimeout(n))};return a.wasCalled=()=>t,a})(r);e(t,{announce:a}),a.wasCalled()||r(n(t))}var qm=(e,t)=>{const r=((e,t)=>{const r=(()=>{const e=[];return{add:t=>{const r=setTimeout((()=>(t=>{const r=e.findIndex((e=>e.timerId===t));-1===r&&Fp(!1);const[n]=e.splice(r,1);n.callback()})(r))),n={timerId:r,callback:t};e.push(n)},flush:()=>{if(!e.length)return;const t=[...e];e.length=0,t.forEach((e=>{clearTimeout(e.timerId),e.callback()}))}}})();let n=null;const a=r=>{n||Fp(!1),n=null,Mm(0,(()=>Bm(e().onDragEnd,r,t,Up.onDragEnd)))};return{beforeCapture:(t,r)=>{n&&Fp(!1),Mm(0,(()=>{const n=e().onBeforeCapture;n&&n({draggableId:t,mode:r})}))},beforeStart:(t,r)=>{n&&Fp(!1),Mm(0,(()=>{const n=e().onBeforeDragStart;n&&n(Fm(t,r))}))},start:(a,i)=>{n&&Fp(!1);const o=Fm(a,i);n={mode:i,lastCritical:a,lastLocation:o.source,lastCombine:null},r.add((()=>{Mm(0,(()=>Bm(e().onDragStart,o,t,Up.onDragStart)))}))},update:(a,i)=>{const o=ph(i),s=hh(i);n||Fp(!1);const l=!((e,t)=>{if(e===t)return!0;const r=e.draggable.id===t.draggable.id&&e.draggable.droppableId===t.draggable.droppableId&&e.draggable.type===t.draggable.type&&e.draggable.index===t.draggable.index,n=e.droppable.id===t.droppable.id&&e.droppable.type===t.droppable.type;return r&&n})(a,n.lastCritical);l&&(n.lastCritical=a);const c=(d=o,!(null==(u=n.lastLocation)&&null==d||null!=u&&null!=d&&u.droppableId===d.droppableId&&u.index===d.index));var u,d;c&&(n.lastLocation=o);const p=!((e,t)=>null==e&&null==t||null!=e&&null!=t&&e.draggableId===t.draggableId&&e.droppableId===t.droppableId)(n.lastCombine,s);if(p&&(n.lastCombine=s),!l&&!c&&!p)return;const h={...Fm(a,n.mode),combine:s,destination:o};r.add((()=>{Mm(0,(()=>Bm(e().onDragUpdate,h,t,Up.onDragUpdate)))}))},flush:()=>{n||Fp(!1),r.flush()},drop:a,abort:()=>{if(!n)return;const e={...Fm(n.lastCritical,n.mode),combine:null,destination:null,reason:"CANCEL"};a(e)}}})(e,t);return e=>t=>n=>{if("BEFORE_INITIAL_CAPTURE"===n.type)return void r.beforeCapture(n.payload.draggableId,n.payload.movementMode);if("INITIAL_PUBLISH"===n.type){const e=n.payload.critical;return r.beforeStart(e,n.payload.movementMode),t(n),void r.start(e,n.payload.movementMode)}if("DROP_COMPLETE"===n.type){const e=n.payload.completed.result;return r.flush(),t(n),void r.drop(e)}if(t(n),"FLUSH"===n.type)return void r.abort();const a=e.getState();"DRAGGING"===a.phase&&r.update(a.critical,a.impact)}},Qm=e=>t=>r=>{if("DROP_ANIMATION_FINISHED"!==r.type)return void t(r);const n=e.getState();"DROP_ANIMATING"!==n.phase&&Fp(!1),e.dispatch(Om({completed:n.completed}))},Vm=e=>{let t=null,r=null;return n=>a=>{if("FLUSH"!==a.type&&"DROP_COMPLETE"!==a.type&&"DROP_ANIMATION_FINISHED"!==a.type||(r&&(cancelAnimationFrame(r),r=null),t&&(t(),t=null)),n(a),"DROP_ANIMATE"!==a.type)return;const i={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){"DROP_ANIMATING"===e.getState().phase&&e.dispatch({type:"DROP_ANIMATION_FINISHED",payload:null})}};r=requestAnimationFrame((()=>{r=null,t=Lp(window,[i])}))}},Wm=e=>t=>r=>{if(t(r),"PUBLISH_WHILE_DRAGGING"!==r.type)return;const n=e.getState();"DROP_PENDING"===n.phase&&(n.isWaiting||e.dispatch(wm({reason:n.reason})))};const zm=ya.compose;var Um=({scrollHeight:e,scrollWidth:t,height:r,width:n})=>{const a=Xp({x:t,y:e},{x:n,y:r});return{x:Math.max(0,a.x),y:Math.max(0,a.y)}},Gm=()=>{const e=document.documentElement;return e||Fp(!1),e},Hm=()=>{const e=Gm();return Um({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight})};function Xm(e,t,r){return r.descriptor.id!==t.id&&(r.descriptor.type===t.type&&"virtual"===e.droppable.getById(r.descriptor.droppableId).descriptor.mode)}var Ym=(e,t)=>{let r=null;const n=function({registry:e,callbacks:t}){let r={additions:{},removals:{},modified:{}},n=null;const a=()=>{n||(t.collectionStarting(),n=requestAnimationFrame((()=>{n=null;const{additions:a,removals:i,modified:o}=r,s=Object.keys(a).map((t=>e.draggable.getById(t).getDimension(Gp))).sort(((e,t)=>e.descriptor.index-t.descriptor.index)),l=Object.keys(o).map((t=>({droppableId:t,scroll:e.droppable.getById(t).callbacks.getScrollWhileDragging()}))),c={additions:s,removals:Object.keys(i),modified:l};r={additions:{},removals:{},modified:{}},t.publish(c)})))};return{add:e=>{const t=e.descriptor.id;r.additions[t]=e,r.modified[e.descriptor.droppableId]=!0,r.removals[t]&&delete r.removals[t],a()},remove:e=>{const t=e.descriptor;r.removals[t.id]=!0,r.modified[t.droppableId]=!0,r.additions[t.id]&&delete r.additions[t.id],a()},stop:()=>{n&&(cancelAnimationFrame(n),n=null,r={additions:{},removals:{},modified:{}})}}}({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),a=t=>{r||Fp(!1);const a=r.critical.draggable;"ADDITION"===t.type&&Xm(e,a,t.value)&&n.add(t.value),"REMOVAL"===t.type&&Xm(e,a,t.value)&&n.remove(t.value)},i={updateDroppableIsEnabled:(n,a)=>{e.droppable.exists(n)||Fp(!1),r&&t.updateDroppableIsEnabled({id:n,isEnabled:a})},updateDroppableIsCombineEnabled:(n,a)=>{r&&(e.droppable.exists(n)||Fp(!1),t.updateDroppableIsCombineEnabled({id:n,isCombineEnabled:a}))},scrollDroppable:(t,n)=>{r&&e.droppable.getById(t).callbacks.scroll(n)},updateDroppableScroll:(n,a)=>{r&&(e.droppable.exists(n)||Fp(!1),t.updateDroppableScroll({id:n,newScroll:a}))},startPublishing:t=>{r&&Fp(!1);const n=e.draggable.getById(t.draggableId),i=e.droppable.getById(n.descriptor.droppableId),o={draggable:n.descriptor,droppable:i.descriptor},s=e.subscribe(a);return r={critical:o,unsubscribe:s},(({critical:e,scrollOptions:t,registry:r})=>{const n=(()=>{const e=Nm(),t=Hm(),r=e.y,n=e.x,a=Gm(),i=a.clientWidth,o=a.clientHeight;return{frame:Op({top:r,left:n,right:n+i,bottom:r+o}),scroll:{initial:e,current:e,max:t,diff:{value:Gp,displacement:Gp}}}})(),a=n.scroll.current,i=e.droppable,o=r.droppable.getAllByType(i.type).map((e=>e.callbacks.getDimensionAndWatchScroll(a,t))),s=r.draggable.getAllByType(e.draggable.type).map((e=>e.getDimension(a)));return{dimensions:{draggables:lh(s),droppables:sh(o)},critical:e,viewport:n}})({critical:o,registry:e,scrollOptions:t.scrollOptions})},stopPublishing:()=>{if(!r)return;n.stop();const t=r.critical.droppable;e.droppable.getAllByType(t.type).forEach((e=>e.callbacks.dragStopped())),r.unsubscribe(),r=null}};return i},Km=(e,t)=>"IDLE"===e.phase||"DROP_ANIMATING"===e.phase&&e.completed.result.draggableId!==t&&"DROP"===e.completed.result.reason,Jm=e=>{window.scrollBy(e.x,e.y)};const Zm=kp((e=>ch(e).filter((e=>!!e.isEnabled&&!!e.frame))));const ef={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:e=>e**2,durationDampening:{stopDampeningAt:1200,accelerateAt:360},disabled:!1};var tf=({startOfRange:e,endOfRange:t,current:r})=>{const n=t-e;return 0===n?0:(r-e)/n},rf=({distanceToEdge:e,thresholds:t,dragStartTime:r,shouldUseTimeDampening:n,getAutoScrollerOptions:a})=>{const i=((e,t,r=()=>ef)=>{const n=r();if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return n.maxPixelScroll;if(e===t.startScrollingFrom)return 1;const a=1-tf({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),i=n.maxPixelScroll*n.ease(a);return Math.ceil(i)})(e,t,a);return 0===i?0:n?Math.max(((e,t,r)=>{const n=r(),a=n.durationDampening.accelerateAt,i=n.durationDampening.stopDampeningAt,o=t,s=i,l=Date.now()-o;if(l>=i)return e;if(l<a)return 1;const c=tf({startOfRange:a,endOfRange:s,current:l}),u=e*n.ease(c);return Math.ceil(u)})(i,r,a),1):i},nf=({container:e,distanceToEdges:t,dragStartTime:r,axis:n,shouldUseTimeDampening:a,getAutoScrollerOptions:i})=>{const o=((e,t,r=()=>ef)=>{const n=r();return{startScrollingFrom:e[t.size]*n.startFromPercentage,maxScrollValueAt:e[t.size]*n.maxScrollAtPercentage}})(e,n,i);return t[n.end]<t[n.start]?rf({distanceToEdge:t[n.end],thresholds:o,dragStartTime:r,shouldUseTimeDampening:a,getAutoScrollerOptions:i}):-1*rf({distanceToEdge:t[n.start],thresholds:o,dragStartTime:r,shouldUseTimeDampening:a,getAutoScrollerOptions:i})};const af=th((e=>0===e?0:e));var of=({dragStartTime:e,container:t,subject:r,center:n,shouldUseTimeDampening:a,getAutoScrollerOptions:i})=>{const o={top:n.y-t.top,right:t.right-n.x,bottom:t.bottom-n.y,left:n.x-t.left},s=nf({container:t,distanceToEdges:o,dragStartTime:e,axis:wh,shouldUseTimeDampening:a,getAutoScrollerOptions:i}),l=nf({container:t,distanceToEdges:o,dragStartTime:e,axis:Sh,shouldUseTimeDampening:a,getAutoScrollerOptions:i}),c=af({x:l,y:s});if(Yp(c,Gp))return null;const u=(({container:e,subject:t,proposedScroll:r})=>{const n=t.height>e.height,a=t.width>e.width;return a||n?a&&n?null:{x:a?0:r.x,y:n?0:r.y}:r})({container:t,subject:r,proposedScroll:c});return u?Yp(u,Gp)?null:u:null};const sf=th((e=>0===e?0:e>0?1:-1)),lf=(()=>{const e=(e,t)=>e<0?e:e>t?e-t:0;return({current:t,max:r,change:n})=>{const a=Hp(t,n),i={x:e(a.x,r.x),y:e(a.y,r.y)};return Yp(i,Gp)?null:i}})(),cf=({max:e,current:t,change:r})=>{const n={x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)},a=sf(r),i=lf({max:n,current:t,change:a});return!i||0!==a.x&&0===i.x||0!==a.y&&0===i.y},uf=(e,t)=>cf({current:e.scroll.current,max:e.scroll.max,change:t}),df=(e,t)=>{const r=e.frame;return!!r&&cf({current:r.scroll.current,max:r.scroll.max,change:t})};var pf=({state:e,dragStartTime:t,shouldUseTimeDampening:r,scrollWindow:n,scrollDroppable:a,getAutoScrollerOptions:i})=>{const o=e.current.page.borderBoxCenter,s=e.dimensions.draggables[e.critical.draggable.id].page.marginBox;if(e.isWindowScrollAllowed){const a=(({viewport:e,subject:t,center:r,dragStartTime:n,shouldUseTimeDampening:a,getAutoScrollerOptions:i})=>{const o=of({dragStartTime:n,container:e.frame,subject:t,center:r,shouldUseTimeDampening:a,getAutoScrollerOptions:i});return o&&uf(e,o)?o:null})({dragStartTime:t,viewport:e.viewport,subject:s,center:o,shouldUseTimeDampening:r,getAutoScrollerOptions:i});if(a)return void n(a)}const l=(({center:e,destination:t,droppables:r})=>{if(t){const e=r[t];return e.frame?e:null}const n=((e,t)=>{const r=Zm(t).find((t=>(t.frame||Fp(!1),Yh(t.frame.pageMarginBox)(e))))||null;return r})(e,r);return n})({center:o,destination:Gh(e.impact),droppables:e.dimensions.droppables});if(!l)return;const c=(({droppable:e,subject:t,center:r,dragStartTime:n,shouldUseTimeDampening:a,getAutoScrollerOptions:i})=>{const o=e.frame;if(!o)return null;const s=of({dragStartTime:n,container:o.pageMarginBox,subject:t,center:r,shouldUseTimeDampening:a,getAutoScrollerOptions:i});return s&&df(e,s)?s:null})({dragStartTime:t,droppable:l,subject:s,center:o,shouldUseTimeDampening:r,getAutoScrollerOptions:i});c&&a(l.descriptor.id,c)},hf=({move:e,scrollDroppable:t,scrollWindow:r})=>n=>{const a=n.scrollJumpRequest;if(!a)return;const i=Gh(n.impact);i||Fp(!1);const o=((e,r)=>{if(!df(e,r))return r;const n=((e,t)=>{const r=e.frame;return r&&df(e,t)?lf({current:r.scroll.current,max:r.scroll.max,change:t}):null})(e,r);if(!n)return t(e.descriptor.id,r),null;const a=Xp(r,n);return t(e.descriptor.id,a),Xp(r,a)})(n.dimensions.droppables[i],a);if(!o)return;const s=n.viewport,l=((e,t,n)=>{if(!e)return n;if(!uf(t,n))return n;const a=((e,t)=>{if(!uf(e,t))return null;const r=e.scroll.max,n=e.scroll.current;return lf({current:n,max:r,change:t})})(t,n);if(!a)return r(n),null;const i=Xp(n,a);return r(i),Xp(n,i)})(n.isWindowScrollAllowed,s,o);l&&((t,r)=>{const n=Hp(t.current.client.selection,r);e({client:n})})(n,l)};const mf="data-rfd",ff=(()=>{const e=`${mf}-drag-handle`;return{base:e,draggableId:`${e}-draggable-id`,contextId:`${e}-context-id`}})(),gf=(()=>{const e=`${mf}-draggable`;return{base:e,contextId:`${e}-context-id`,id:`${e}-id`}})(),bf=(()=>{const e=`${mf}-droppable`;return{base:e,contextId:`${e}-context-id`,id:`${e}-id`}})(),vf={contextId:`${mf}-scroll-container-context-id`},yf=(e,t)=>e.map((e=>{const r=e.styles[t];return r?`${e.selector} { ${r} }`:""})).join(" ");var xf="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?mt.useLayoutEffect:mt.useEffect;const Of=()=>{const e=document.querySelector("head");return e||Fp(!1),e},wf=e=>{const t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.type="text/css",t};function Sf(e,t){return Array.from(e.querySelectorAll(t))}var _f=e=>e&&e.ownerDocument&&e.ownerDocument.defaultView?e.ownerDocument.defaultView:window;function Pf(e){return e instanceof _f(e).HTMLElement}function Ef(){const e={draggables:{},droppables:{}},t=[];function r(e){t.length&&t.forEach((t=>t(e)))}function n(t){return e.draggables[t]||null}function a(t){return e.droppables[t]||null}return{draggable:{register:t=>{e.draggables[t.descriptor.id]=t,r({type:"ADDITION",value:t})},update:(t,r)=>{const n=e.draggables[r.descriptor.id];n&&n.uniqueId===t.uniqueId&&(delete e.draggables[r.descriptor.id],e.draggables[t.descriptor.id]=t)},unregister:t=>{const a=t.descriptor.id,i=n(a);i&&t.uniqueId===i.uniqueId&&(delete e.draggables[a],e.droppables[t.descriptor.droppableId]&&r({type:"REMOVAL",value:t}))},getById:function(e){const t=n(e);return t||Fp(!1),t},findById:n,exists:e=>Boolean(n(e)),getAllByType:t=>Object.values(e.draggables).filter((e=>e.descriptor.type===t))},droppable:{register:t=>{e.droppables[t.descriptor.id]=t},unregister:t=>{const r=a(t.descriptor.id);r&&t.uniqueId===r.uniqueId&&delete e.droppables[t.descriptor.id]},getById:function(e){const t=a(e);return t||Fp(!1),t},findById:a,exists:e=>Boolean(a(e)),getAllByType:t=>Object.values(e.droppables).filter((e=>e.descriptor.type===t))},subscribe:function(e){return t.push(e),function(){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}},clean:function(){e.draggables={},e.droppables={},t.length=0}}}var Tf=gt().createContext(null),Cf=()=>{const e=document.body;return e||Fp(!1),e},If={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"};let jf=0;const $f={separator:"::"};var Df="useId"in gt()?function(e,t=$f){const r=gt().useId();return yp((()=>`${e}${t.separator}${r}`),[t.separator,e,r])}:function(e,t=$f){return yp((()=>`${e}${t.separator}${jf++}`),[t.separator,e])},kf=gt().createContext(null);function Rf(e){const t=(0,mt.useRef)(e);return(0,mt.useEffect)((()=>{t.current=e})),t}function Af(e){return"IDLE"!==e.phase&&"DROP_ANIMATING"!==e.phase&&e.isDragging}const Nf=9,Lf=13,Mf=33,Ff=34,Bf=35,qf=36,Qf={[Lf]:!0,[Nf]:!0};var Vf=e=>{Qf[e.keyCode]&&e.preventDefault()},Wf=(()=>{const e="visibilitychange";return"undefined"==typeof document?e:[e,`ms${e}`,`webkit${e}`,`moz${e}`,`o${e}`].find((e=>`on${e}`in document))||e})();const zf={type:"IDLE"};function Uf(){}const Gf={[Ff]:!0,[Mf]:!0,[qf]:!0,[Bf]:!0};const Hf={type:"IDLE"},Xf=["input","button","textarea","select","option","optgroup","video","audio"];function Yf(e,t){if(null==t)return!1;if(Xf.includes(t.tagName.toLowerCase()))return!0;const r=t.getAttribute("contenteditable");return"true"===r||""===r||t!==e&&Yf(e,t.parentElement)}function Kf(e,t){const r=t.target;return!!Pf(r)&&Yf(e,r)}var Jf=e=>Op(e.getBoundingClientRect()).center;const Zf=(()=>{const e="matches";return"undefined"==typeof document?e:[e,"msMatchesSelector","webkitMatchesSelector"].find((e=>e in Element.prototype))||e})();function eg(e,t){return null==e?null:e[Zf](t)?e:eg(e.parentElement,t)}function tg(e,t){return e.closest?e.closest(t):eg(e,t)}function rg(e){e.preventDefault()}function ng({expected:e,phase:t,isLockActive:r,shouldWarn:n}){return!!r()&&e===t}function ag({lockAPI:e,store:t,registry:r,draggableId:n}){if(e.isClaimed())return!1;const a=r.draggable.findById(n);return!!a&&!!a.options.isEnabled&&!!Km(t.getState(),n)}const ig=[function(e){const t=(0,mt.useRef)(zf),r=(0,mt.useRef)(Np),n=yp((()=>({eventName:"mousedown",fn:function(t){if(t.defaultPrevented)return;if(0!==t.button)return;if(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)return;const n=e.findClosestDraggableId(t);if(!n)return;const a=e.tryGetLock(n,o,{sourceEvent:t});if(!a)return;t.preventDefault();const i={x:t.clientX,y:t.clientY};r.current(),c(a,i)}})),[e]),a=yp((()=>({eventName:"webkitmouseforcewillbegin",fn:t=>{if(t.defaultPrevented)return;const r=e.findClosestDraggableId(t);if(!r)return;const n=e.findOptionsForDraggable(r);n&&(n.shouldRespectForcePress||e.canGetLock(r)&&t.preventDefault())}})),[e]),i=xp((function(){r.current=Lp(window,[a,n],{passive:!1,capture:!0})}),[a,n]),o=xp((()=>{"IDLE"!==t.current.type&&(t.current=zf,r.current(),i())}),[i]),s=xp((()=>{const e=t.current;o(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[o]),l=xp((function(){const e=function({cancel:e,completed:t,getPhase:r,setPhase:n}){return[{eventName:"mousemove",fn:e=>{const{button:t,clientX:a,clientY:i}=e;if(0!==t)return;const o={x:a,y:i},s=r();if("DRAGGING"===s.type)return e.preventDefault(),void s.actions.move(o);if("PENDING"!==s.type&&Fp(!1),l=s.point,c=o,!(Math.abs(c.x-l.x)>=5||Math.abs(c.y-l.y)>=5))return;var l,c;e.preventDefault();const u=s.actions.fluidLift(o);n({type:"DRAGGING",actions:u})}},{eventName:"mouseup",fn:n=>{const a=r();"DRAGGING"===a.type?(n.preventDefault(),a.actions.drop({shouldBlockNextClick:!0}),t()):e()}},{eventName:"mousedown",fn:t=>{"DRAGGING"===r().type&&t.preventDefault(),e()}},{eventName:"keydown",fn:t=>{if("PENDING"!==r().type)return 27===t.keyCode?(t.preventDefault(),void e()):void Vf(t);e()}},{eventName:"resize",fn:e},{eventName:"scroll",options:{passive:!0,capture:!1},fn:()=>{"PENDING"===r().type&&e()}},{eventName:"webkitmouseforcedown",fn:t=>{const n=r();"IDLE"===n.type&&Fp(!1),n.actions.shouldRespectForcePress()?e():t.preventDefault()}},{eventName:Wf,fn:e}]}({cancel:s,completed:o,getPhase:()=>t.current,setPhase:e=>{t.current=e}});r.current=Lp(window,e,{capture:!0,passive:!1})}),[s,o]),c=xp((function(e,r){"IDLE"!==t.current.type&&Fp(!1),t.current={type:"PENDING",point:r,actions:e},l()}),[l]);xf((function(){return i(),function(){r.current()}}),[i])},function(e){const t=(0,mt.useRef)(Uf),r=yp((()=>({eventName:"keydown",fn:function(r){if(r.defaultPrevented)return;if(32!==r.keyCode)return;const a=e.findClosestDraggableId(r);if(!a)return;const i=e.tryGetLock(a,l,{sourceEvent:r});if(!i)return;r.preventDefault();let o=!0;const s=i.snapLift();function l(){o||Fp(!1),o=!1,t.current(),n()}t.current(),t.current=Lp(window,function(e,t){function r(){t(),e.cancel()}return[{eventName:"keydown",fn:n=>27===n.keyCode?(n.preventDefault(),void r()):32===n.keyCode?(n.preventDefault(),t(),void e.drop()):40===n.keyCode?(n.preventDefault(),void e.moveDown()):38===n.keyCode?(n.preventDefault(),void e.moveUp()):39===n.keyCode?(n.preventDefault(),void e.moveRight()):37===n.keyCode?(n.preventDefault(),void e.moveLeft()):void(Gf[n.keyCode]?n.preventDefault():Vf(n))},{eventName:"mousedown",fn:r},{eventName:"mouseup",fn:r},{eventName:"click",fn:r},{eventName:"touchstart",fn:r},{eventName:"resize",fn:r},{eventName:"wheel",fn:r,options:{passive:!0}},{eventName:Wf,fn:r}]}(s,l),{capture:!0,passive:!1})}})),[e]),n=xp((function(){t.current=Lp(window,[r],{passive:!1,capture:!0})}),[r]);xf((function(){return n(),function(){t.current()}}),[n])},function(e){const t=(0,mt.useRef)(Hf),r=(0,mt.useRef)(Np),n=xp((function(){return t.current}),[]),a=xp((function(e){t.current=e}),[]),i=yp((()=>({eventName:"touchstart",fn:function(t){if(t.defaultPrevented)return;const n=e.findClosestDraggableId(t);if(!n)return;const a=e.tryGetLock(n,s,{sourceEvent:t});if(!a)return;const i=t.touches[0],{clientX:o,clientY:l}=i,c={x:o,y:l};r.current(),d(a,c)}})),[e]),o=xp((function(){r.current=Lp(window,[i],{capture:!0,passive:!1})}),[i]),s=xp((()=>{const e=t.current;"IDLE"!==e.type&&("PENDING"===e.type&&clearTimeout(e.longPressTimerId),a(Hf),r.current(),o())}),[o,a]),l=xp((()=>{const e=t.current;s(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[s]),c=xp((function(){const e={capture:!0,passive:!1},t={cancel:l,completed:s,getPhase:n},a=Lp(window,function({cancel:e,completed:t,getPhase:r}){return[{eventName:"touchmove",options:{capture:!1},fn:t=>{const n=r();if("DRAGGING"!==n.type)return void e();n.hasMoved=!0;const{clientX:a,clientY:i}=t.touches[0],o={x:a,y:i};t.preventDefault(),n.actions.move(o)}},{eventName:"touchend",fn:n=>{const a=r();"DRAGGING"===a.type?(n.preventDefault(),a.actions.drop({shouldBlockNextClick:!0}),t()):e()}},{eventName:"touchcancel",fn:t=>{"DRAGGING"===r().type?(t.preventDefault(),e()):e()}},{eventName:"touchforcechange",fn:t=>{const n=r();"IDLE"===n.type&&Fp(!1);const a=t.touches[0];if(!a)return;if(!(a.force>=.15))return;const i=n.actions.shouldRespectForcePress();if("PENDING"!==n.type)return i?n.hasMoved?void t.preventDefault():void e():void t.preventDefault();i&&e()}},{eventName:Wf,fn:e}]}(t),e),i=Lp(window,function({cancel:e,getPhase:t}){return[{eventName:"orientationchange",fn:e},{eventName:"resize",fn:e},{eventName:"contextmenu",fn:e=>{e.preventDefault()}},{eventName:"keydown",fn:r=>{"DRAGGING"===t().type?(27===r.keyCode&&r.preventDefault(),e()):e()}},{eventName:Wf,fn:e}]}(t),e);r.current=function(){a(),i()}}),[l,n,s]),u=xp((function(){const e=n();"PENDING"!==e.type&&Fp(!1);const t=e.actions.fluidLift(e.point);a({type:"DRAGGING",actions:t,hasMoved:!1})}),[n,a]),d=xp((function(e,t){"IDLE"!==n().type&&Fp(!1);const r=setTimeout(u,120);a({type:"PENDING",point:t,actions:e,longPressTimerId:r}),c()}),[c,n,a,u]);xf((function(){return o(),function(){r.current();const e=n();"PENDING"===e.type&&(clearTimeout(e.longPressTimerId),a(Hf))}}),[n,o,a]),xf((function(){return Lp(window,[{eventName:"touchmove",fn:()=>{},options:{capture:!1,passive:!1}}])}),[])}];function og({contextId:e,store:t,registry:r,customSensors:n,enableDefaultSensors:a}){const i=[...a?ig:[],...n||[]],o=(0,mt.useState)((()=>function(){let e=null;function t(){e||Fp(!1),e=null}return{isClaimed:function(){return Boolean(e)},isActive:function(t){return t===e},claim:function(t){e&&Fp(!1);const r={abandon:t};return e=r,r},release:t,tryAbandon:function(){e&&(e.abandon(),t())}}}()))[0],s=xp((function(e,t){Af(e)&&!Af(t)&&o.tryAbandon()}),[o]);xf((function(){let e=t.getState();return t.subscribe((()=>{const r=t.getState();s(e,r),e=r}))}),[o,t,s]),xf((()=>o.tryAbandon),[o.tryAbandon]);const l=xp((e=>ag({lockAPI:o,registry:r,store:t,draggableId:e})),[o,r,t]),c=xp(((n,a,i)=>function({lockAPI:e,contextId:t,store:r,registry:n,draggableId:a,forceSensorStop:i,sourceEvent:o}){if(!ag({lockAPI:e,store:r,registry:n,draggableId:a}))return null;const s=n.draggable.getById(a),l=function(e,t){const r=`[${gf.contextId}="${e}"]`,n=Sf(document,r).find((e=>e.getAttribute(gf.id)===t));return n&&Pf(n)?n:null}(t,s.descriptor.id);if(!l)return null;if(o&&!s.options.canDragInteractiveElements&&Kf(l,o))return null;const c=e.claim(i||Np);let u="PRE_DRAG";function d(){return s.options.shouldRespectForcePress}function p(){return e.isActive(c)}const h=function(e,t){ng({expected:e,phase:u,isLockActive:p,shouldWarn:!0})&&r.dispatch(t())}.bind(null,"DRAGGING");function m(t){function n(){e.release(),u="COMPLETED"}function a(e,a={shouldBlockNextClick:!1}){if(t.cleanup(),a.shouldBlockNextClick){const e=Lp(window,[{eventName:"click",fn:rg,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(e)}n(),r.dispatch(wm({reason:e}))}return"PRE_DRAG"!==u&&(n(),Fp(!1)),r.dispatch((e=>({type:"LIFT",payload:e}))(t.liftActionArgs)),u="DRAGGING",{isActive:()=>ng({expected:"DRAGGING",phase:u,isLockActive:p,shouldWarn:!1}),shouldRespectForcePress:d,drop:e=>a("DROP",e),cancel:e=>a("CANCEL",e),...t.actions}}return{isActive:()=>ng({expected:"PRE_DRAG",phase:u,isLockActive:p,shouldWarn:!1}),shouldRespectForcePress:d,fluidLift:function(e){const t=Rp((e=>{h((()=>gm({client:e})))}));return{...m({liftActionArgs:{id:a,clientSelection:e,movementMode:"FLUID"},cleanup:()=>t.cancel(),actions:{move:t}}),move:t}},snapLift:function(){const e={moveUp:()=>h(bm),moveRight:()=>h(ym),moveDown:()=>h(vm),moveLeft:()=>h(xm)};return m({liftActionArgs:{id:a,clientSelection:Jf(l),movementMode:"SNAP"},cleanup:Np,actions:e})},abort:function(){ng({expected:"PRE_DRAG",phase:u,isLockActive:p,shouldWarn:!0})&&e.release()}}}({lockAPI:o,registry:r,contextId:e,store:t,draggableId:n,forceSensorStop:a||null,sourceEvent:i&&i.sourceEvent?i.sourceEvent:null})),[e,o,r,t]),u=xp((t=>function(e,t){const r=function(e,t){const r=t.target;if(!((n=r)instanceof _f(n).Element))return null;var n;const a=function(e){return`[${ff.contextId}="${e}"]`}(e),i=tg(r,a);return i&&Pf(i)?i:null}(e,t);return r?r.getAttribute(ff.draggableId):null}(e,t)),[e]),d=xp((e=>{const t=r.draggable.findById(e);return t?t.options:null}),[r.draggable]),p=xp((function(){o.isClaimed()&&(o.tryAbandon(),"IDLE"!==t.getState().phase&&t.dispatch({type:"FLUSH",payload:null}))}),[o,t]),h=xp((()=>o.isClaimed()),[o]),m=yp((()=>({canGetLock:l,tryGetLock:c,findClosestDraggableId:u,findOptionsForDraggable:d,tryReleaseLock:p,isLockClaimed:h})),[l,c,u,d,p,h]);for(let e=0;e<i.length;e++)i[e](m)}function sg(e){return e.current||Fp(!1),e.current}function lg(e){const{contextId:t,setCallbacks:r,sensors:n,nonce:a,dragHandleUsageInstructions:i}=e,o=(0,mt.useRef)(null),s=Rf(e),l=xp((()=>(e=>({onBeforeCapture:t=>{const r=()=>{e.onBeforeCapture&&e.onBeforeCapture(t)};gt().version.startsWith("16")||gt().version.startsWith("17")?r():(0,fp.flushSync)(r)},onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDragUpdate:e.onDragUpdate}))(s.current)),[s]),c=xp((()=>(e=>({...ef,...e.autoScrollerOptions,durationDampening:{...ef.durationDampening,...e.autoScrollerOptions}}))(s.current)),[s]),u=function(e){const t=yp((()=>(e=>`rfd-announcement-${e}`)(e)),[e]),r=(0,mt.useRef)(null);return(0,mt.useEffect)((function(){const e=document.createElement("div");return r.current=e,e.id=t,e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),un(e.style,If),Cf().appendChild(e),function(){setTimeout((function(){const t=Cf();t.contains(e)&&t.removeChild(e),e===r.current&&(r.current=null)}))}}),[t]),xp((e=>{const t=r.current;t&&(t.textContent=e)}),[])}(t),d=function({contextId:e,text:t}){const r=Df("hidden-text",{separator:"-"}),n=yp((()=>function({contextId:e,uniqueId:t}){return`rfd-hidden-text-${e}-${t}`}({contextId:e,uniqueId:r})),[r,e]);return(0,mt.useEffect)((function(){const e=document.createElement("div");return e.id=n,e.textContent=t,e.style.display="none",Cf().appendChild(e),function(){const t=Cf();t.contains(e)&&t.removeChild(e)}}),[n,t]),n}({contextId:t,text:i}),p=function(e,t){const r=yp((()=>(e=>{const t=(e=>t=>`[${t}="${e}"]`)(e),r=(()=>{const e="\n      cursor: -webkit-grab;\n      cursor: grab;\n    ";return{selector:t(ff.contextId),styles:{always:"\n          -webkit-touch-callout: none;\n          -webkit-tap-highlight-color: rgba(0,0,0,0);\n          touch-action: manipulation;\n        ",resting:e,dragging:"pointer-events: none;",dropAnimating:e}}})(),n=[(()=>{const e=`\n      transition: ${Im.outOfTheWay};\n    `;return{selector:t(gf.contextId),styles:{dragging:e,dropAnimating:e,userCancel:e}}})(),r,{selector:t(bf.contextId),styles:{always:"overflow-anchor: none;"}},{selector:"body",styles:{dragging:"\n        cursor: grabbing;\n        cursor: -webkit-grabbing;\n        user-select: none;\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none;\n        overflow-anchor: none;\n      "}}];return{always:yf(n,"always"),resting:yf(n,"resting"),dragging:yf(n,"dragging"),dropAnimating:yf(n,"dropAnimating"),userCancel:yf(n,"userCancel")}})(e)),[e]),n=(0,mt.useRef)(null),a=(0,mt.useRef)(null),i=xp(kp((e=>{const t=a.current;t||Fp(!1),t.textContent=e})),[]),o=xp((e=>{const t=n.current;t||Fp(!1),t.textContent=e}),[]);xf((()=>{(n.current||a.current)&&Fp(!1);const s=wf(t),l=wf(t);return n.current=s,a.current=l,s.setAttribute(`${mf}-always`,e),l.setAttribute(`${mf}-dynamic`,e),Of().appendChild(s),Of().appendChild(l),o(r.always),i(r.resting),()=>{const e=e=>{const t=e.current;t||Fp(!1),Of().removeChild(t),e.current=null};e(n),e(a)}}),[t,o,i,r.always,r.resting,e]);const s=xp((()=>i(r.dragging)),[i,r.dragging]),l=xp((e=>{i("DROP"!==e?r.userCancel:r.dropAnimating)}),[i,r.dropAnimating,r.userCancel]),c=xp((()=>{a.current&&i(r.resting)}),[i,r.resting]);return yp((()=>({dragging:s,dropping:l,resting:c})),[s,l,c])}(t,a),h=xp((e=>{sg(o).dispatch(e)}),[]),m=yp((()=>(0,ya.bindActionCreators)({publishWhileDragging:dm,updateDroppableScroll:hm,updateDroppableIsEnabled:mm,updateDroppableIsCombineEnabled:fm,collectionStarting:pm},h)),[h]),f=function(){const e=yp(Ef,[]);return(0,mt.useEffect)((()=>function(){gt().version.startsWith("16")||gt().version.startsWith("17")?requestAnimationFrame(e.clean):e.clean()}),[e]),e}(),g=yp((()=>Ym(f,m)),[f,m]),b=yp((()=>(({scrollDroppable:e,scrollWindow:t,move:r,getAutoScrollerOptions:n})=>{const a=(({scrollWindow:e,scrollDroppable:t,getAutoScrollerOptions:r=()=>ef})=>{const n=Rp(e),a=Rp(t);let i=null;const o=e=>{i||Fp(!1);const{shouldUseTimeDampening:t,dragStartTime:o}=i;pf({state:e,scrollWindow:n,scrollDroppable:a,dragStartTime:o,shouldUseTimeDampening:t,getAutoScrollerOptions:r})};return{start:e=>{i&&Fp(!1);const t=Date.now();let n=!1;const a=()=>{n=!0};pf({state:e,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:a,scrollDroppable:a,getAutoScrollerOptions:r}),i={dragStartTime:t,shouldUseTimeDampening:n},n&&o(e)},stop:()=>{i&&(n.cancel(),a.cancel(),i=null)},scroll:o}})({scrollWindow:t,scrollDroppable:e,getAutoScrollerOptions:n}),i=hf({move:r,scrollWindow:t,scrollDroppable:e});return{scroll:e=>{n().disabled||"DRAGGING"!==e.phase||("FLUID"!==e.movementMode?e.scrollJumpRequest&&i(e):a.scroll(e))},start:a.start,stop:a.stop}})({scrollWindow:Jm,scrollDroppable:g.scrollDroppable,getAutoScrollerOptions:c,...(0,ya.bindActionCreators)({move:gm},h)})),[g.scrollDroppable,h,c]),v=function(e){const t=(0,mt.useRef)({}),r=(0,mt.useRef)(null),n=(0,mt.useRef)(null),a=(0,mt.useRef)(!1),i=xp((function(e,r){const n={id:e,focus:r};return t.current[e]=n,function(){const r=t.current;r[e]!==n&&delete r[e]}}),[]),o=xp((function(t){const r=function(e,t){const r=`[${ff.contextId}="${e}"]`,n=Sf(document,r);if(!n.length)return null;const a=n.find((e=>e.getAttribute(ff.draggableId)===t));return a&&Pf(a)?a:null}(e,t);r&&r!==document.activeElement&&r.focus()}),[e]),s=xp((function(e,t){r.current===e&&(r.current=t)}),[]),l=xp((function(){n.current||a.current&&(n.current=requestAnimationFrame((()=>{n.current=null;const e=r.current;e&&o(e)})))}),[o]),c=xp((function(e){r.current=null;const t=document.activeElement;t&&t.getAttribute(ff.draggableId)===e&&(r.current=e)}),[]);return xf((()=>(a.current=!0,function(){a.current=!1;const e=n.current;e&&cancelAnimationFrame(e)})),[]),yp((()=>({register:i,tryRecordFocus:c,tryRestoreFocusRecorded:l,tryShiftRecord:s})),[i,c,l,s])}(t),y=yp((()=>(({dimensionMarshal:e,focusMarshal:t,styleMarshal:r,getResponders:n,announce:a,autoScroller:i})=>{return(0,ya.createStore)(um,zm((0,ya.applyMiddleware)((o=r,()=>e=>t=>{"INITIAL_PUBLISH"===t.type&&o.dragging(),"DROP_ANIMATE"===t.type&&o.dropping(t.payload.completed.result.reason),"FLUSH"!==t.type&&"DROP_COMPLETE"!==t.type||o.resting(),e(t)}),(e=>()=>t=>r=>{"DROP_COMPLETE"!==r.type&&"FLUSH"!==r.type&&"DROP_ANIMATE"!==r.type||e.stopPublishing(),t(r)})(e),(e=>({getState:t,dispatch:r})=>n=>a=>{if("LIFT"!==a.type)return void n(a);const{id:i,clientSelection:o,movementMode:s}=a.payload,l=t();"DROP_ANIMATING"===l.phase&&r(Om({completed:l.completed})),"IDLE"!==t().phase&&Fp(!1),r({type:"FLUSH",payload:null}),r({type:"BEFORE_INITIAL_CAPTURE",payload:{draggableId:i,movementMode:s}});const c={draggableId:i,scrollOptions:{shouldPublishImmediately:"SNAP"===s}},{critical:u,dimensions:d,viewport:p}=e.startPublishing(c);r({type:"INITIAL_PUBLISH",payload:{critical:u,dimensions:d,clientSelection:o,movementMode:s,viewport:p}})})(e),Am,Qm,Vm,Wm,(e=>t=>r=>n=>{if((e=>"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type)(n))return e.stop(),void r(n);if("INITIAL_PUBLISH"===n.type){r(n);const a=t.getState();return"DRAGGING"!==a.phase&&Fp(!1),void e.start(a)}r(n),e.scroll(t.getState())})(i),Lm,(e=>{let t=!1;return()=>r=>n=>{if("INITIAL_PUBLISH"===n.type)return t=!0,e.tryRecordFocus(n.payload.critical.draggable.id),r(n),void e.tryRestoreFocusRecorded();if(r(n),t){if("FLUSH"===n.type)return t=!1,void e.tryRestoreFocusRecorded();if("DROP_COMPLETE"===n.type){t=!1;const r=n.payload.completed.result;r.combine&&e.tryShiftRecord(r.draggableId,r.combine.draggableId),e.tryRestoreFocusRecorded()}}}})(t),qm(n,a))));var o})({announce:u,autoScroller:b,dimensionMarshal:g,focusMarshal:v,getResponders:l,styleMarshal:p})),[u,b,g,v,l,p]);o.current=y;const x=xp((()=>{const e=sg(o);"IDLE"!==e.getState().phase&&e.dispatch({type:"FLUSH",payload:null})}),[]),O=xp((()=>{const e=sg(o).getState();return"DROP_ANIMATING"===e.phase||"IDLE"!==e.phase&&e.isDragging}),[]);r(yp((()=>({isDragging:O,tryAbort:x})),[O,x]));const w=xp((e=>Km(sg(o).getState(),e)),[]),S=xp((()=>Xh(sg(o).getState())),[]),_=yp((()=>({marshal:g,focus:v,contextId:t,canLift:w,isMovementAllowed:S,dragHandleUsageInstructionsId:d,registry:f})),[t,g,d,v,w,S,f]);return og({contextId:t,store:y,registry:f,customSensors:n||null,enableDefaultSensors:!1!==e.enableDefaultSensors}),(0,mt.useEffect)((()=>x),[x]),gt().createElement(kf.Provider,{value:_},gt().createElement(bp.Provider,{context:Tf,store:y},e.children))}let cg=0;var ug="useId"in gt()?function(){return gt().useId()}:function(){return yp((()=>""+cg++),[])};function dg(e){const t=ug(),r=e.dragHandleUsageInstructions||Up.dragHandleUsageInstructions;return gt().createElement(Bp,null,(n=>gt().createElement(lg,{nonce:e.nonce,contextId:t,setCallbacks:n,dragHandleUsageInstructions:r,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd,autoScrollerOptions:e.autoScrollerOptions},e.children)))}const pg=(e,t)=>t?Im.drop(t.duration):e?Im.snap:Im.fluid,hg=(e,t)=>{if(e)return t?_m:Pm};function mg(e){return"DRAGGING"===e.type?function(e){const t=e.dimension.client,{offset:r,combineWith:n,dropping:a}=e,i=Boolean(n),o=(e=>null!=e.forceShouldAnimate?e.forceShouldAnimate:"SNAP"===e.mode)(e),s=Boolean(a),l=s?((e,t)=>{const r=jm(e);if(r)return t?`${r} scale(${Em})`:r})(r,i):$m(r);return{position:"fixed",top:t.marginBox.top,left:t.marginBox.left,boxSizing:"border-box",width:t.borderBox.width,height:t.borderBox.height,transition:pg(o,a),transform:l,opacity:hg(i,s),zIndex:s?4500:5e3,pointerEvents:"none"}}(e):{transform:$m((t=e).offset),transition:t.shouldAnimateDisplacement?void 0:"none"};var t}var fg=gt().createContext(null);function gg(e){const t=(0,mt.useContext)(e);return t||Fp(!1),t}function bg(e){e.preventDefault()}var vg=(e,t)=>e===t,yg=e=>{const{combine:t,destination:r}=e;return r?r.droppableId:t?t.droppableId:null};function xg(e=null){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}const Og={mapped:{type:"SECONDARY",offset:Gp,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:xg(null)}},wg={dropAnimationFinished:()=>({type:"DROP_ANIMATION_FINISHED",payload:null})},Sg=(0,bp.connect)((()=>{const e=function(){const e=kp(((e,t)=>({x:e,y:t}))),t=kp(((e,t,r=null,n=null,a=null)=>({isDragging:!0,isClone:t,isDropAnimating:Boolean(a),dropAnimation:a,mode:e,draggingOver:r,combineWith:n,combineTargetFor:null}))),r=kp(((e,r,n,a,i=null,o=null,s=null)=>({mapped:{type:"DRAGGING",dropping:null,draggingOver:i,combineWith:o,mode:r,offset:e,dimension:n,forceShouldAnimate:s,snapshot:t(r,a,i,o,null)}})));return(n,a)=>{if(Af(n)){if(n.critical.draggable.id!==a.draggableId)return null;const t=n.current.client.offset,o=n.dimensions.draggables[a.draggableId],s=Gh(n.impact),l=(i=n.impact).at&&"COMBINE"===i.at.type?i.at.combine.draggableId:null,c=n.forceShouldAnimate;return r(e(t.x,t.y),n.movementMode,o,a.isClone,s,l,c)}var i;if("DROP_ANIMATING"===n.phase){const e=n.completed;if(e.result.draggableId!==a.draggableId)return null;const r=a.isClone,i=n.dimensions.draggables[a.draggableId],o=e.result,s=o.mode,l=yg(o),c=(e=>e.combine?e.combine.draggableId:null)(o),u={duration:n.dropDuration,curve:Sm,moveTo:n.newHomeClientOffset,opacity:c?_m:null,scale:c?Em:null};return{mapped:{type:"DRAGGING",offset:n.newHomeClientOffset,dimension:i,dropping:u,draggingOver:l,combineWith:c,mode:s,forceShouldAnimate:null,snapshot:t(s,r,l,c,u)}}}return null}}(),t=function(){const e=kp(((e,t)=>({x:e,y:t}))),t=kp(xg),r=kp(((e,r=null,n)=>({mapped:{type:"SECONDARY",offset:e,combineTargetFor:r,shouldAnimateDisplacement:n,snapshot:t(r)}}))),n=e=>e?r(Gp,e,!0):null,a=(t,a,i,o)=>{const s=i.displaced.visible[t],l=Boolean(o.inVirtualList&&o.effected[t]),c=hh(i),u=c&&c.draggableId===t?a:null;if(!s){if(!l)return n(u);if(i.displaced.invisible[t])return null;const a=Kp(o.displacedBy.point),s=e(a.x,a.y);return r(s,u,!0)}if(l)return n(u);const d=i.displacedBy.point,p=e(d.x,d.y);return r(p,u,s.shouldAnimate)};return(e,t)=>{if(Af(e))return e.critical.draggable.id===t.draggableId?null:a(t.draggableId,e.critical.draggable.id,e.impact,e.afterCritical);if("DROP_ANIMATING"===e.phase){const r=e.completed;return r.result.draggableId===t.draggableId?null:a(t.draggableId,r.result.draggableId,r.impact,r.afterCritical)}return null}}();return(r,n)=>e(r,n)||t(r,n)||Og}),wg,null,{context:Tf,areStatePropsEqual:vg})((e=>{const t=(0,mt.useRef)(null),r=xp(((e=null)=>{t.current=e}),[]),n=xp((()=>t.current),[]),{contextId:a,dragHandleUsageInstructionsId:i,registry:o}=gg(kf),{type:s,droppableId:l}=gg(fg),c=yp((()=>({id:e.draggableId,index:e.index,type:s,droppableId:l})),[e.draggableId,e.index,s,l]),{children:u,draggableId:d,isEnabled:p,shouldRespectForcePress:h,canDragInteractiveElements:m,isClone:f,mapped:g,dropAnimationFinished:b}=e;f||function(e){const t=Df("draggable"),{descriptor:r,registry:n,getDraggableRef:a,canDragInteractiveElements:i,shouldRespectForcePress:o,isEnabled:s}=e,l=yp((()=>({canDragInteractiveElements:i,shouldRespectForcePress:o,isEnabled:s})),[i,s,o]),c=xp((e=>{const t=a();return t||Fp(!1),function(e,t,r=Gp){const n=window.getComputedStyle(t),a=t.getBoundingClientRect(),i=Ip(a,n),o=Cp(i,r);return{descriptor:e,placeholder:{client:i,tagName:t.tagName.toLowerCase(),display:n.display},displaceBy:{x:i.marginBox.width,y:i.marginBox.height},client:i,page:o}}(r,t,e)}),[r,a]),u=yp((()=>({uniqueId:t,descriptor:r,options:l,getDimension:c})),[r,c,l,t]),d=(0,mt.useRef)(u),p=(0,mt.useRef)(!0);xf((()=>(n.draggable.register(d.current),()=>n.draggable.unregister(d.current))),[n.draggable]),xf((()=>{if(p.current)return void(p.current=!1);const e=d.current;d.current=u,n.draggable.update(u,e)}),[u,n.draggable])}(yp((()=>({descriptor:c,registry:o,getDraggableRef:n,canDragInteractiveElements:m,shouldRespectForcePress:h,isEnabled:p})),[c,o,n,m,h,p]));const v=yp((()=>p?{tabIndex:0,role:"button","aria-describedby":i,"data-rfd-drag-handle-draggable-id":d,"data-rfd-drag-handle-context-id":a,draggable:!1,onDragStart:bg}:null),[a,i,d,p]),y=xp((e=>{"DRAGGING"===g.type&&g.dropping&&"transform"===e.propertyName&&(gt().version.startsWith("16")||gt().version.startsWith("17")?b():(0,fp.flushSync)(b))}),[b,g]),x=yp((()=>{const e=mg(g),t="DRAGGING"===g.type&&g.dropping?y:void 0;return{innerRef:r,draggableProps:{"data-rfd-draggable-context-id":a,"data-rfd-draggable-id":d,style:e,onTransitionEnd:t},dragHandleProps:v}}),[a,v,d,g,y,r]),O=yp((()=>({draggableId:c.id,type:c.type,source:{index:c.index,droppableId:c.droppableId}})),[c.droppableId,c.id,c.index,c.type]);return gt().createElement(gt().Fragment,null,u(x,g.snapshot,O))}));var _g=Sg;function Pg(e){return gg(fg).isUsingCloneFor!==e.draggableId||e.isClone?gt().createElement(_g,e):null}function Eg(e){const t="boolean"!=typeof e.isDragDisabled||!e.isDragDisabled,r=Boolean(e.disableInteractiveElementBlocking),n=Boolean(e.shouldRespectForcePress);return gt().createElement(Pg,un({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:r,shouldRespectForcePress:n}))}const Tg=e=>t=>e===t,Cg=Tg("scroll"),Ig=Tg("auto"),jg=(Tg("visible"),(e,t)=>t(e.overflowX)||t(e.overflowY)),$g=e=>null==e||e===document.body||e===document.documentElement?null:(e=>{const t=window.getComputedStyle(e),r={overflowX:t.overflowX,overflowY:t.overflowY};return jg(r,Cg)||jg(r,Ig)})(e)?e:$g(e.parentElement);var Dg=e=>({x:e.scrollLeft,y:e.scrollTop});const kg=e=>!!e&&("fixed"===window.getComputedStyle(e).position||kg(e.parentElement));const Rg={passive:!1},Ag={passive:!0};var Ng=e=>e.shouldPublishImmediately?Rg:Ag;const Lg=e=>e&&e.env.closestScrollable||null;function Mg(e){const t=(0,mt.useRef)(null),r=gg(kf),n=Df("droppable"),{registry:a,marshal:i}=r,o=Rf(e),s=yp((()=>({id:e.droppableId,type:e.type,mode:e.mode})),[e.droppableId,e.mode,e.type]),l=(0,mt.useRef)(s),c=yp((()=>kp(((e,r)=>{t.current||Fp(!1);const n={x:e,y:r};i.updateDroppableScroll(s.id,n)}))),[s.id,i]),u=xp((()=>{const e=t.current;return e&&e.env.closestScrollable?Dg(e.env.closestScrollable):Gp}),[]),d=xp((()=>{const e=u();c(e.x,e.y)}),[u,c]),p=yp((()=>Rp(d)),[d]),h=xp((()=>{const e=t.current,r=Lg(e);e&&r||Fp(!1),e.scrollOptions.shouldPublishImmediately?d():p()}),[p,d]),m=xp(((e,n)=>{t.current&&Fp(!1);const a=o.current,i=a.getDroppableRef();i||Fp(!1);const l=(e=>({closestScrollable:$g(e),isFixedOnPage:kg(e)}))(i),c={ref:i,descriptor:s,env:l,scrollOptions:n};t.current=c;const u=(({ref:e,descriptor:t,env:r,windowScroll:n,direction:a,isDropDisabled:i,isCombineEnabled:o,shouldClipSubject:s})=>{const l=r.closestScrollable,c=((e,t)=>{const r=jp(e);if(!t)return r;if(e!==t)return r;const n=r.paddingBox.top-t.scrollTop,a=r.paddingBox.left-t.scrollLeft,i=n+t.scrollHeight,o=a+t.scrollWidth,s=wp({top:n,right:o,bottom:i,left:a},r.border);return Pp({borderBox:s,margin:r.margin,border:r.border,padding:r.padding})})(e,l),u=Cp(c,n),d=(()=>{if(!l)return null;const e=jp(l),t={scrollHeight:l.scrollHeight,scrollWidth:l.scrollWidth};return{client:e,page:Cp(e,n),scroll:Dg(l),scrollSize:t,shouldClipSubject:s}})(),p=(({descriptor:e,isEnabled:t,isCombineEnabled:r,isFixedOnPage:n,direction:a,client:i,page:o,closest:s})=>{const l=(()=>{if(!s)return null;const{scrollSize:e,client:t}=s,r=Um({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,height:t.paddingBox.height,width:t.paddingBox.width});return{pageMarginBox:s.page.marginBox,frameClient:t,scrollSize:e,shouldClipSubject:s.shouldClipSubject,scroll:{initial:s.scroll,current:s.scroll,max:r,diff:{value:Gp,displacement:Gp}}}})(),c="vertical"===a?wh:Sh;return{descriptor:e,isCombineEnabled:r,isFixedOnPage:n,axis:c,isEnabled:t,client:i,page:o,frame:l,subject:ih({page:o,withPlaceholder:null,axis:c,frame:l})}})({descriptor:t,isEnabled:!i,isCombineEnabled:o,isFixedOnPage:r.isFixedOnPage,direction:a,client:c,page:u,closest:d});return p})({ref:i,descriptor:s,env:l,windowScroll:e,direction:a.direction,isDropDisabled:a.isDropDisabled,isCombineEnabled:a.isCombineEnabled,shouldClipSubject:!a.ignoreContainerClipping}),d=l.closestScrollable;return d&&(d.setAttribute(vf.contextId,r.contextId),d.addEventListener("scroll",h,Ng(c.scrollOptions))),u}),[r.contextId,s,h,o]),f=xp((()=>{const e=t.current,r=Lg(e);return e&&r||Fp(!1),Dg(r)}),[]),g=xp((()=>{const e=t.current;e||Fp(!1);const r=Lg(e);t.current=null,r&&(p.cancel(),r.removeAttribute(vf.contextId),r.removeEventListener("scroll",h,Ng(e.scrollOptions)))}),[h,p]),b=xp((e=>{const r=t.current;r||Fp(!1);const n=Lg(r);n||Fp(!1),n.scrollTop+=e.y,n.scrollLeft+=e.x}),[]),v=yp((()=>({getDimensionAndWatchScroll:m,getScrollWhileDragging:f,dragStopped:g,scroll:b})),[g,m,f,b]),y=yp((()=>({uniqueId:n,descriptor:s,callbacks:v})),[v,s,n]);xf((()=>(l.current=y.descriptor,a.droppable.register(y),()=>{t.current&&g(),a.droppable.unregister(y)})),[v,s,g,y,i,a.droppable]),xf((()=>{t.current&&i.updateDroppableIsEnabled(l.current.id,!e.isDropDisabled)}),[e.isDropDisabled,i]),xf((()=>{t.current&&i.updateDroppableIsCombineEnabled(l.current.id,e.isCombineEnabled)}),[e.isCombineEnabled,i])}function Fg(){}const Bg={width:0,height:0,margin:{top:0,right:0,bottom:0,left:0}};var qg=gt().memo((e=>{const t=(0,mt.useRef)(null),r=xp((()=>{t.current&&(clearTimeout(t.current),t.current=null)}),[]),{animate:n,onTransitionEnd:a,onClose:i,contextId:o}=e,[s,l]=(0,mt.useState)("open"===e.animate);(0,mt.useEffect)((()=>s?"open"!==n?(r(),l(!1),Fg):t.current?Fg:(t.current=setTimeout((()=>{t.current=null,l(!1)})),r):Fg),[n,s,r]);const c=xp((e=>{"height"===e.propertyName&&(a(),"close"===n&&i())}),[n,i,a]),u=(({isAnimatingOpenOnMount:e,placeholder:t,animate:r})=>{const n=(({isAnimatingOpenOnMount:e,placeholder:t,animate:r})=>e||"close"===r?Bg:{height:t.client.borderBox.height,width:t.client.borderBox.width,margin:t.client.margin})({isAnimatingOpenOnMount:e,placeholder:t,animate:r});return{display:t.display,boxSizing:"border-box",width:n.width,height:n.height,marginTop:n.margin.top,marginRight:n.margin.right,marginBottom:n.margin.bottom,marginLeft:n.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:"none"!==r?Im.placeholder:null}})({isAnimatingOpenOnMount:s,animate:e.animate,placeholder:e.placeholder});return gt().createElement(e.placeholder.tagName,{style:u,"data-rfd-placeholder-context-id":o,onTransitionEnd:c,ref:e.innerRef})}));class Qg extends gt().PureComponent{constructor(...e){super(...e),this.state={isVisible:Boolean(this.props.on),data:this.props.on,animate:this.props.shouldAnimate&&this.props.on?"open":"none"},this.onClose=()=>{"close"===this.state.animate&&this.setState({isVisible:!1})}}static getDerivedStateFromProps(e,t){return e.shouldAnimate?e.on?{isVisible:!0,data:e.on,animate:"open"}:t.isVisible?{isVisible:!0,data:t.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:Boolean(e.on),data:e.on,animate:"none"}}render(){if(!this.state.isVisible)return null;const e={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(e)}}const Vg={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:function(){return document.body||Fp(!1),document.body}},Wg=e=>{let t,r={...e};for(t in Vg)void 0===e[t]&&(r={...r,[t]:Vg[t]});return r},zg=(e,t)=>e===t.droppable.type,Ug=(e,t)=>t.draggables[e.draggable.id],Gg=(0,bp.connect)((()=>{const e={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},t={...e,shouldAnimatePlaceholder:!1},r=kp((e=>({draggableId:e.id,type:e.type,source:{index:e.index,droppableId:e.droppableId}}))),n=kp(((n,a,i,o,s,l)=>{const c=s.descriptor.id;if(s.descriptor.droppableId===n){const e=l?{render:l,dragging:r(s.descriptor)}:null,t={isDraggingOver:i,draggingOverWith:i?c:null,draggingFromThisWith:c,isUsingPlaceholder:!0};return{placeholder:s.placeholder,shouldAnimatePlaceholder:!1,snapshot:t,useClone:e}}if(!a)return t;if(!o)return e;const u={isDraggingOver:i,draggingOverWith:c,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:s.placeholder,shouldAnimatePlaceholder:!0,snapshot:u,useClone:null}}));return(r,a)=>{const i=Wg(a),o=i.droppableId,s=i.type,l=!i.isDropDisabled,c=i.renderClone;if(Af(r)){const e=r.critical;if(!zg(s,e))return t;const a=Ug(e,r.dimensions),i=Gh(r.impact)===o;return n(o,l,i,i,a,c)}if("DROP_ANIMATING"===r.phase){const e=r.completed;if(!zg(s,e.critical))return t;const a=Ug(e.critical,r.dimensions);return n(o,l,yg(e.result)===o,Gh(e.impact)===o,a,c)}if("IDLE"===r.phase&&r.completed&&!r.shouldFlush){const n=r.completed;if(!zg(s,n.critical))return t;const a=Gh(n.impact)===o,i=Boolean(n.impact.at&&"COMBINE"===n.impact.at.type),l=n.critical.droppable.id===o;return a?i?e:t:l?e:t}return t}}),{updateViewportMaxScroll:e=>({type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:e})},((e,t,r)=>({...Wg(r),...e,...t})),{context:Tf,areStatePropsEqual:vg})((e=>{const t=(0,mt.useContext)(kf);t||Fp(!1);const{contextId:r,isMovementAllowed:n}=t,a=(0,mt.useRef)(null),i=(0,mt.useRef)(null),{children:o,droppableId:s,type:l,mode:c,direction:u,ignoreContainerClipping:d,isDropDisabled:p,isCombineEnabled:h,snapshot:m,useClone:f,updateViewportMaxScroll:g,getContainerForClone:b}=e,v=xp((()=>a.current),[]),y=xp(((e=null)=>{a.current=e}),[]),x=(xp((()=>i.current),[]),xp(((e=null)=>{i.current=e}),[])),O=xp((()=>{n()&&g({maxScroll:Hm()})}),[n,g]);Mg({droppableId:s,type:l,mode:c,direction:u,isDropDisabled:p,isCombineEnabled:h,ignoreContainerClipping:d,getDroppableRef:v});const w=yp((()=>gt().createElement(Qg,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},(({onClose:e,data:t,animate:n})=>gt().createElement(qg,{placeholder:t,onClose:e,innerRef:x,animate:n,contextId:r,onTransitionEnd:O})))),[r,O,e.placeholder,e.shouldAnimatePlaceholder,x]),S=yp((()=>({innerRef:y,placeholder:w,droppableProps:{"data-rfd-droppable-id":s,"data-rfd-droppable-context-id":r}})),[r,s,w,y]),_=f?f.dragging.draggableId:null,P=yp((()=>({droppableId:s,type:l,isUsingCloneFor:_})),[s,_,l]);return gt().createElement(fg.Provider,{value:P},o(S,m),function(){if(!f)return null;const{dragging:e,render:t}=f,r=gt().createElement(Pg,{draggableId:e.draggableId,index:e.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},((r,n)=>t(r,n,e)));return gp().createPortal(r,b())}())}));var Hg=Gg;function Xg(e){var t=(0,mt.useRef)();return(0,mt.useEffect)((function(){t.current=e})),t.current}const Yg=Math.min,Kg=Math.max,Jg=Math.round,Zg=Math.floor,eb=e=>({x:e,y:e}),tb={left:"right",right:"left",bottom:"top",top:"bottom"},rb={start:"end",end:"start"};function nb(e,t,r){return Kg(e,Yg(t,r))}function ab(e,t){return"function"==typeof e?e(t):e}function ib(e){return e.split("-")[0]}function ob(e){return e.split("-")[1]}function sb(e){return"x"===e?"y":"x"}function lb(e){return"y"===e?"height":"width"}function cb(e){return["top","bottom"].includes(ib(e))?"y":"x"}function ub(e){return sb(cb(e))}function db(e){return e.replace(/start|end/g,(e=>rb[e]))}function pb(e){return e.replace(/left|right|bottom|top/g,(e=>tb[e]))}function hb(e){const{x:t,y:r,width:n,height:a}=e;return{width:n,height:a,top:r,left:t,right:t+n,bottom:r+a,x:t,y:r}}function mb(e,t,r){let{reference:n,floating:a}=e;const i=cb(t),o=ub(t),s=lb(o),l=ib(t),c="y"===i,u=n.x+n.width/2-a.width/2,d=n.y+n.height/2-a.height/2,p=n[s]/2-a[s]/2;let h;switch(l){case"top":h={x:u,y:n.y-a.height};break;case"bottom":h={x:u,y:n.y+n.height};break;case"right":h={x:n.x+n.width,y:d};break;case"left":h={x:n.x-a.width,y:d};break;default:h={x:n.x,y:n.y}}switch(ob(t)){case"start":h[o]-=p*(r&&c?-1:1);break;case"end":h[o]+=p*(r&&c?-1:1)}return h}async function fb(e,t){var r;void 0===t&&(t={});const{x:n,y:a,platform:i,rects:o,elements:s,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:p=!1,padding:h=0}=ab(t,e),m=function(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}(h),f=s[p?"floating"===d?"reference":"floating":d],g=hb(await i.getClippingRect({element:null==(r=await(null==i.isElement?void 0:i.isElement(f)))||r?f:f.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(s.floating)),boundary:c,rootBoundary:u,strategy:l})),b="floating"===d?{x:n,y:a,width:o.floating.width,height:o.floating.height}:o.reference,v=await(null==i.getOffsetParent?void 0:i.getOffsetParent(s.floating)),y=await(null==i.isElement?void 0:i.isElement(v))&&await(null==i.getScale?void 0:i.getScale(v))||{x:1,y:1},x=hb(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:b,offsetParent:v,strategy:l}):b);return{top:(g.top-x.top+m.top)/y.y,bottom:(x.bottom-g.bottom+m.bottom)/y.y,left:(g.left-x.left+m.left)/y.x,right:(x.right-g.right+m.right)/y.x}}function gb(){return"undefined"!=typeof window}function bb(e){return xb(e)?(e.nodeName||"").toLowerCase():"#document"}function vb(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function yb(e){var t;return null==(t=(xb(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function xb(e){return!!gb()&&(e instanceof Node||e instanceof vb(e).Node)}function Ob(e){return!!gb()&&(e instanceof Element||e instanceof vb(e).Element)}function wb(e){return!!gb()&&(e instanceof HTMLElement||e instanceof vb(e).HTMLElement)}function Sb(e){return!(!gb()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof vb(e).ShadowRoot)}function _b(e){const{overflow:t,overflowX:r,overflowY:n,display:a}=jb(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(a)}function Pb(e){return["table","td","th"].includes(bb(e))}function Eb(e){return[":popover-open",":modal"].some((t=>{try{return e.matches(t)}catch(e){return!1}}))}function Tb(e){const t=Cb(),r=Ob(e)?jb(e):e;return"none"!==r.transform||"none"!==r.perspective||!!r.containerType&&"normal"!==r.containerType||!t&&!!r.backdropFilter&&"none"!==r.backdropFilter||!t&&!!r.filter&&"none"!==r.filter||["transform","perspective","filter"].some((e=>(r.willChange||"").includes(e)))||["paint","layout","strict","content"].some((e=>(r.contain||"").includes(e)))}function Cb(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Ib(e){return["html","body","#document"].includes(bb(e))}function jb(e){return vb(e).getComputedStyle(e)}function $b(e){return Ob(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Db(e){if("html"===bb(e))return e;const t=e.assignedSlot||e.parentNode||Sb(e)&&e.host||yb(e);return Sb(t)?t.host:t}function kb(e){const t=Db(e);return Ib(t)?e.ownerDocument?e.ownerDocument.body:e.body:wb(t)&&_b(t)?t:kb(t)}function Rb(e,t,r){var n;void 0===t&&(t=[]),void 0===r&&(r=!0);const a=kb(e),i=a===(null==(n=e.ownerDocument)?void 0:n.body),o=vb(a);if(i){const e=Ab(o);return t.concat(o,o.visualViewport||[],_b(a)?a:[],e&&r?Rb(e):[])}return t.concat(a,Rb(a,[],r))}function Ab(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Nb(e){const t=jb(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=wb(e),i=a?e.offsetWidth:r,o=a?e.offsetHeight:n,s=Jg(r)!==i||Jg(n)!==o;return s&&(r=i,n=o),{width:r,height:n,$:s}}function Lb(e){return Ob(e)?e:e.contextElement}function Mb(e){const t=Lb(e);if(!wb(t))return eb(1);const r=t.getBoundingClientRect(),{width:n,height:a,$:i}=Nb(t);let o=(i?Jg(r.width):r.width)/n,s=(i?Jg(r.height):r.height)/a;return o&&Number.isFinite(o)||(o=1),s&&Number.isFinite(s)||(s=1),{x:o,y:s}}const Fb=eb(0);function Bb(e){const t=vb(e);return Cb()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:Fb}function qb(e,t,r,n){void 0===t&&(t=!1),void 0===r&&(r=!1);const a=e.getBoundingClientRect(),i=Lb(e);let o=eb(1);t&&(n?Ob(n)&&(o=Mb(n)):o=Mb(e));const s=function(e,t,r){return void 0===t&&(t=!1),!(!r||t&&r!==vb(e))&&t}(i,r,n)?Bb(i):eb(0);let l=(a.left+s.x)/o.x,c=(a.top+s.y)/o.y,u=a.width/o.x,d=a.height/o.y;if(i){const e=vb(i),t=n&&Ob(n)?vb(n):n;let r=e,a=Ab(r);for(;a&&n&&t!==r;){const e=Mb(a),t=a.getBoundingClientRect(),n=jb(a),i=t.left+(a.clientLeft+parseFloat(n.paddingLeft))*e.x,o=t.top+(a.clientTop+parseFloat(n.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,d*=e.y,l+=i,c+=o,r=vb(a),a=Ab(r)}}return hb({width:u,height:d,x:l,y:c})}function Qb(e,t){const r=$b(e).scrollLeft;return t?t.left+r:qb(yb(e)).left+r}function Vb(e,t,r){let n;if("viewport"===t)n=function(e,t){const r=vb(e),n=yb(e),a=r.visualViewport;let i=n.clientWidth,o=n.clientHeight,s=0,l=0;if(a){i=a.width,o=a.height;const e=Cb();(!e||e&&"fixed"===t)&&(s=a.offsetLeft,l=a.offsetTop)}return{width:i,height:o,x:s,y:l}}(e,r);else if("document"===t)n=function(e){const t=yb(e),r=$b(e),n=e.ownerDocument.body,a=Kg(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=Kg(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let o=-r.scrollLeft+Qb(e);const s=-r.scrollTop;return"rtl"===jb(n).direction&&(o+=Kg(t.clientWidth,n.clientWidth)-a),{width:a,height:i,x:o,y:s}}(yb(e));else if(Ob(t))n=function(e,t){const r=qb(e,!0,"fixed"===t),n=r.top+e.clientTop,a=r.left+e.clientLeft,i=wb(e)?Mb(e):eb(1);return{width:e.clientWidth*i.x,height:e.clientHeight*i.y,x:a*i.x,y:n*i.y}}(t,r);else{const r=Bb(e);n={...t,x:t.x-r.x,y:t.y-r.y}}return hb(n)}function Wb(e,t){const r=Db(e);return!(r===t||!Ob(r)||Ib(r))&&("fixed"===jb(r).position||Wb(r,t))}function zb(e,t,r){const n=wb(t),a=yb(t),i="fixed"===r,o=qb(e,!0,i,t);let s={scrollLeft:0,scrollTop:0};const l=eb(0);if(n||!n&&!i)if(("body"!==bb(t)||_b(a))&&(s=$b(t)),n){const e=qb(t,!0,i,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else a&&(l.x=Qb(a));let c=0,u=0;if(a&&!n&&!i){const e=a.getBoundingClientRect();u=e.top+s.scrollTop,c=e.left+s.scrollLeft-Qb(a,e)}return{x:o.left+s.scrollLeft-l.x-c,y:o.top+s.scrollTop-l.y-u,width:o.width,height:o.height}}function Ub(e){return"static"===jb(e).position}function Gb(e,t){if(!wb(e)||"fixed"===jb(e).position)return null;if(t)return t(e);let r=e.offsetParent;return yb(e)===r&&(r=r.ownerDocument.body),r}function Hb(e,t){const r=vb(e);if(Eb(e))return r;if(!wb(e)){let t=Db(e);for(;t&&!Ib(t);){if(Ob(t)&&!Ub(t))return t;t=Db(t)}return r}let n=Gb(e,t);for(;n&&Pb(n)&&Ub(n);)n=Gb(n,t);return n&&Ib(n)&&Ub(n)&&!Tb(n)?r:n||function(e){let t=Db(e);for(;wb(t)&&!Ib(t);){if(Tb(t))return t;if(Eb(t))return null;t=Db(t)}return null}(e)||r}const Xb={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:r,offsetParent:n,strategy:a}=e;const i="fixed"===a,o=yb(n),s=!!t&&Eb(t.floating);if(n===o||s&&i)return r;let l={scrollLeft:0,scrollTop:0},c=eb(1);const u=eb(0),d=wb(n);if((d||!d&&!i)&&(("body"!==bb(n)||_b(o))&&(l=$b(n)),wb(n))){const e=qb(n);c=Mb(n),u.x=e.x+n.clientLeft,u.y=e.y+n.clientTop}return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x,y:r.y*c.y-l.scrollTop*c.y+u.y}},getDocumentElement:yb,getClippingRect:function(e){let{element:t,boundary:r,rootBoundary:n,strategy:a}=e;const i=[..."clippingAncestors"===r?Eb(t)?[]:function(e,t){const r=t.get(e);if(r)return r;let n=Rb(e,[],!1).filter((e=>Ob(e)&&"body"!==bb(e))),a=null;const i="fixed"===jb(e).position;let o=i?Db(e):e;for(;Ob(o)&&!Ib(o);){const t=jb(o),r=Tb(o);r||"fixed"!==t.position||(a=null),(i?!r&&!a:!r&&"static"===t.position&&a&&["absolute","fixed"].includes(a.position)||_b(o)&&!r&&Wb(e,o))?n=n.filter((e=>e!==o)):a=t,o=Db(o)}return t.set(e,n),n}(t,this._c):[].concat(r),n],o=i[0],s=i.reduce(((e,r)=>{const n=Vb(t,r,a);return e.top=Kg(n.top,e.top),e.right=Yg(n.right,e.right),e.bottom=Yg(n.bottom,e.bottom),e.left=Kg(n.left,e.left),e}),Vb(t,o,a));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}},getOffsetParent:Hb,getElementRects:async function(e){const t=this.getOffsetParent||Hb,r=this.getDimensions,n=await r(e.floating);return{reference:zb(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:r}=Nb(e);return{width:t,height:r}},getScale:Mb,isElement:Ob,isRTL:function(e){return"rtl"===jb(e).direction}};function Yb(e,t,r,n){void 0===n&&(n={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:o="function"==typeof ResizeObserver,layoutShift:s="function"==typeof IntersectionObserver,animationFrame:l=!1}=n,c=Lb(e),u=a||i?[...c?Rb(c):[],...Rb(t)]:[];u.forEach((e=>{a&&e.addEventListener("scroll",r,{passive:!0}),i&&e.addEventListener("resize",r)}));const d=c&&s?function(e,t){let r,n=null;const a=yb(e);function i(){var e;clearTimeout(r),null==(e=n)||e.disconnect(),n=null}return function o(s,l){void 0===s&&(s=!1),void 0===l&&(l=1),i();const{left:c,top:u,width:d,height:p}=e.getBoundingClientRect();if(s||t(),!d||!p)return;const h={rootMargin:-Zg(u)+"px "+-Zg(a.clientWidth-(c+d))+"px "+-Zg(a.clientHeight-(u+p))+"px "+-Zg(c)+"px",threshold:Kg(0,Yg(1,l))||1};let m=!0;function f(e){const t=e[0].intersectionRatio;if(t!==l){if(!m)return o();t?o(!1,t):r=setTimeout((()=>{o(!1,1e-7)}),1e3)}m=!1}try{n=new IntersectionObserver(f,{...h,root:a.ownerDocument})}catch(e){n=new IntersectionObserver(f,h)}n.observe(e)}(!0),i}(c,r):null;let p,h=-1,m=null;o&&(m=new ResizeObserver((e=>{let[n]=e;n&&n.target===c&&m&&(m.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame((()=>{var e;null==(e=m)||e.observe(t)}))),r()})),c&&!l&&m.observe(c),m.observe(t));let f=l?qb(e):null;return l&&function t(){const n=qb(e);!f||n.x===f.x&&n.y===f.y&&n.width===f.width&&n.height===f.height||r(),f=n,p=requestAnimationFrame(t)}(),r(),()=>{var e;u.forEach((e=>{a&&e.removeEventListener("scroll",r),i&&e.removeEventListener("resize",r)})),null==d||d(),null==(e=m)||e.disconnect(),m=null,l&&cancelAnimationFrame(p)}}const Kb=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:a,y:i,placement:o,middlewareData:s}=t,l=await async function(e,t){const{placement:r,platform:n,elements:a}=e,i=await(null==n.isRTL?void 0:n.isRTL(a.floating)),o=ib(r),s=ob(r),l="y"===cb(r),c=["left","top"].includes(o)?-1:1,u=i&&l?-1:1,d=ab(t,e);let{mainAxis:p,crossAxis:h,alignmentAxis:m}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return s&&"number"==typeof m&&(h="end"===s?-1*m:m),l?{x:h*u,y:p*c}:{x:p*c,y:h*u}}(t,e);return o===(null==(r=s.offset)?void 0:r.placement)&&null!=(n=s.arrow)&&n.alignmentOffset?{}:{x:a+l.x,y:i+l.y,data:{...l,placement:o}}}}},Jb=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:a}=t,{mainAxis:i=!0,crossAxis:o=!1,limiter:s={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...l}=ab(e,t),c={x:r,y:n},u=await fb(t,l),d=cb(ib(a)),p=sb(d);let h=c[p],m=c[d];if(i){const e="y"===p?"bottom":"right";h=nb(h+u["y"===p?"top":"left"],h,h-u[e])}if(o){const e="y"===d?"bottom":"right";m=nb(m+u["y"===d?"top":"left"],m,m-u[e])}const f=s.fn({...t,[p]:h,[d]:m});return{...f,data:{x:f.x-r,y:f.y-n,enabled:{[p]:i,[d]:o}}}}}},Zb=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:a,middlewareData:i,rects:o,initialPlacement:s,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:p,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:f=!0,...g}=ab(e,t);if(null!=(r=i.arrow)&&r.alignmentOffset)return{};const b=ib(a),v=cb(s),y=ib(s)===s,x=await(null==l.isRTL?void 0:l.isRTL(c.floating)),O=p||(y||!f?[pb(s)]:function(e){const t=pb(e);return[db(e),t,db(t)]}(s)),w="none"!==m;!p&&w&&O.push(...function(e,t,r,n){const a=ob(e);let i=function(e,t,r){const n=["left","right"],a=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(e){case"top":case"bottom":return r?t?a:n:t?n:a;case"left":case"right":return t?i:o;default:return[]}}(ib(e),"start"===r,n);return a&&(i=i.map((e=>e+"-"+a)),t&&(i=i.concat(i.map(db)))),i}(s,f,m,x));const S=[s,...O],_=await fb(t,g),P=[];let E=(null==(n=i.flip)?void 0:n.overflows)||[];if(u&&P.push(_[b]),d){const e=function(e,t,r){void 0===r&&(r=!1);const n=ob(e),a=ub(e),i=lb(a);let o="x"===a?n===(r?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[i]>t.floating[i]&&(o=pb(o)),[o,pb(o)]}(a,o,x);P.push(_[e[0]],_[e[1]])}if(E=[...E,{placement:a,overflows:P}],!P.every((e=>e<=0))){var T,C;const e=((null==(T=i.flip)?void 0:T.index)||0)+1,t=S[e];if(t)return{data:{index:e,overflows:E},reset:{placement:t}};let r=null==(C=E.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:C.placement;if(!r)switch(h){case"bestFit":{var I;const e=null==(I=E.filter((e=>{if(w){const t=cb(e.placement);return t===v||"y"===t}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:I[0];e&&(r=e);break}case"initialPlacement":r=s}if(a!==r)return{reset:{placement:r}}}return{}}}},ev=(e,t,r)=>{const n=new Map,a={platform:Xb,...r},i={...a.platform,_c:n};return(async(e,t,r)=>{const{placement:n="bottom",strategy:a="absolute",middleware:i=[],platform:o}=r,s=i.filter(Boolean),l=await(null==o.isRTL?void 0:o.isRTL(t));let c=await o.getElementRects({reference:e,floating:t,strategy:a}),{x:u,y:d}=mb(c,n,l),p=n,h={},m=0;for(let r=0;r<s.length;r++){const{name:i,fn:f}=s[r],{x:g,y:b,data:v,reset:y}=await f({x:u,y:d,initialPlacement:n,placement:p,strategy:a,middlewareData:h,rects:c,platform:o,elements:{reference:e,floating:t}});u=null!=g?g:u,d=null!=b?b:d,h={...h,[i]:{...h[i],...v}},y&&m<=50&&(m++,"object"==typeof y&&(y.placement&&(p=y.placement),y.rects&&(c=!0===y.rects?await o.getElementRects({reference:e,floating:t,strategy:a}):y.rects),({x:u,y:d}=mb(c,p,l))),r=-1)}return{x:u,y:d,placement:p,strategy:a,middlewareData:h}})(e,t,{...a,platform:i})};var tv="undefined"!=typeof document?mt.useLayoutEffect:mt.useEffect;function rv(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let r,n,a;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;0!=n--;)if(!rv(e[n],t[n]))return!1;return!0}if(a=Object.keys(e),r=a.length,r!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!{}.hasOwnProperty.call(t,a[n]))return!1;for(n=r;0!=n--;){const r=a[n];if(!("_owner"===r&&e.$$typeof||rv(e[r],t[r])))return!1}return!0}return e!=e&&t!=t}function nv(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function av(e,t){const r=nv(e);return Math.round(t*r)/r}function iv(e){const t=mt.useRef(e);return tv((()=>{t.current=e})),t}const ov=(e,t)=>({...Kb(e),options:[e,t]}),sv=(e,t)=>({...Jb(e),options:[e,t]}),lv=(e,t)=>({...Zb(e),options:[e,t]});function cv(e,t){if(!e||!t)return!1;const r=null==t.getRootNode?void 0:t.getRootNode();if(e.contains(t))return!0;if(r&&Sb(r)){let r=t;for(;r;){if(e===r)return!0;r=r.parentNode||r.host}}return!1}function uv(e,t){const r=["mouse","pen"];return t||r.push("",void 0),r.includes(e)}function dv(e){return(null==e?void 0:e.ownerDocument)||document}function pv(e,t){if(null==t)return!1;if("composedPath"in e)return e.composedPath().includes(t);const r=e;return null!=r.target&&t.contains(r.target)}function hv(e){return"composedPath"in e?e.composedPath()[0]:e.target}const mv={...ft},fv=mv.useInsertionEffect||(e=>e());function gv(e){const t=mt.useRef((()=>{}));return fv((()=>{t.current=e})),mt.useCallback((function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return null==t.current?void 0:t.current(...r)}),[])}var bv="undefined"!=typeof document?mt.useLayoutEffect:mt.useEffect;let vv=!1,yv=0;const xv=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+yv++,Ov=mv.useId||function(){const[e,t]=mt.useState((()=>vv?xv():void 0));return bv((()=>{null==e&&t(xv())}),[]),mt.useEffect((()=>{vv=!0}),[]),e};const wv=mt.createContext(null),Sv=mt.createContext(null),_v=()=>mt.useContext(Sv);function Pv(e,t){let r=e.filter((e=>{var r;return e.parentId===t&&(null==(r=e.context)?void 0:r.open)})),n=r;for(;n.length;)n=e.filter((e=>{var t;return null==(t=n)?void 0:t.some((t=>{var r;return e.parentId===t.id&&(null==(r=e.context)?void 0:r.open)}))})),r=r.concat(n);return r}function Ev(e){return wb(e.target)&&"BUTTON"===e.target.tagName}function Tv(e){return function(e){return wb(e)&&e.matches("input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])")}(e)}const Cv={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},Iv={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},jv=e=>{var t,r;return{escapeKey:"boolean"==typeof e?e:null!=(t=null==e?void 0:e.escapeKey)&&t,outsidePress:"boolean"==typeof e?e:null==(r=null==e?void 0:e.outsidePress)||r}};function $v(e){void 0===e&&(e={});const{nodeId:t}=e,r=function(e){const{open:t=!1,onOpenChange:r,elements:n}=e,a=Ov(),i=mt.useRef({}),[o]=mt.useState((()=>function(){const e=new Map;return{emit(t,r){var n;null==(n=e.get(t))||n.forEach((e=>e(r)))},on(t,r){e.set(t,[...e.get(t)||[],r])},off(t,r){var n;e.set(t,(null==(n=e.get(t))?void 0:n.filter((e=>e!==r)))||[])}}}())),s=null!=((null==(h=mt.useContext(wv))?void 0:h.id)||null),[l,c]=mt.useState(n.reference),u=gv(((e,t,n)=>{i.current.openEvent=e?t:void 0,o.emit("openchange",{open:e,event:t,reason:n,nested:s}),null==r||r(e,t,n)})),d=mt.useMemo((()=>({setPositionReference:c})),[]),p=mt.useMemo((()=>({reference:l||n.reference||null,floating:n.floating||null,domReference:n.reference})),[l,n.reference,n.floating]);var h;return mt.useMemo((()=>({dataRef:i,open:t,onOpenChange:u,elements:p,events:o,floatingId:a,refs:d})),[t,u,p,o,a,d])}({...e,elements:{reference:null,floating:null,...e.elements}}),n=e.rootContext||r,a=n.elements,[i,o]=mt.useState(null),[s,l]=mt.useState(null),c=(null==a?void 0:a.reference)||i,u=mt.useRef(null),d=_v();bv((()=>{c&&(u.current=c)}),[c]);const p=function(e){void 0===e&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:a,elements:{reference:i,floating:o}={},transform:s=!0,whileElementsMounted:l,open:c}=e,[u,d]=mt.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[p,h]=mt.useState(n);rv(p,n)||h(n);const[m,f]=mt.useState(null),[g,b]=mt.useState(null),v=mt.useCallback((e=>{e!==w.current&&(w.current=e,f(e))}),[]),y=mt.useCallback((e=>{e!==S.current&&(S.current=e,b(e))}),[]),x=i||m,O=o||g,w=mt.useRef(null),S=mt.useRef(null),_=mt.useRef(u),P=null!=l,E=iv(l),T=iv(a),C=iv(c),I=mt.useCallback((()=>{if(!w.current||!S.current)return;const e={placement:t,strategy:r,middleware:p};T.current&&(e.platform=T.current),ev(w.current,S.current,e).then((e=>{const t={...e,isPositioned:!1!==C.current};j.current&&!rv(_.current,t)&&(_.current=t,fp.flushSync((()=>{d(t)})))}))}),[p,t,r,T,C]);tv((()=>{!1===c&&_.current.isPositioned&&(_.current.isPositioned=!1,d((e=>({...e,isPositioned:!1}))))}),[c]);const j=mt.useRef(!1);tv((()=>(j.current=!0,()=>{j.current=!1})),[]),tv((()=>{if(x&&(w.current=x),O&&(S.current=O),x&&O){if(E.current)return E.current(x,O,I);I()}}),[x,O,I,E,P]);const $=mt.useMemo((()=>({reference:w,floating:S,setReference:v,setFloating:y})),[v,y]),D=mt.useMemo((()=>({reference:x,floating:O})),[x,O]),k=mt.useMemo((()=>{const e={position:r,left:0,top:0};if(!D.floating)return e;const t=av(D.floating,u.x),n=av(D.floating,u.y);return s?{...e,transform:"translate("+t+"px, "+n+"px)",...nv(D.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:n}}),[r,s,D.floating,u.x,u.y]);return mt.useMemo((()=>({...u,update:I,refs:$,elements:D,floatingStyles:k})),[u,I,$,D,k])}({...e,elements:{...a,...s&&{reference:s}}}),h=mt.useCallback((e=>{const t=Ob(e)?{getBoundingClientRect:()=>e.getBoundingClientRect(),contextElement:e}:e;l(t),p.refs.setReference(t)}),[p.refs]),m=mt.useCallback((e=>{(Ob(e)||null===e)&&(u.current=e,o(e)),(Ob(p.refs.reference.current)||null===p.refs.reference.current||null!==e&&!Ob(e))&&p.refs.setReference(e)}),[p.refs]),f=mt.useMemo((()=>({...p.refs,setReference:m,setPositionReference:h,domReference:u})),[p.refs,m,h]),g=mt.useMemo((()=>({...p.elements,domReference:c})),[p.elements,c]),b=mt.useMemo((()=>({...p,...n,refs:f,elements:g,nodeId:t})),[p,f,g,t,n]);return bv((()=>{n.dataRef.current.floatingContext=b;const e=null==d?void 0:d.nodesRef.current.find((e=>e.id===t));e&&(e.context=b)})),mt.useMemo((()=>({...p,context:b,refs:f,elements:g})),[p,f,g,b])}const Dv="active",kv="selected";function Rv(e,t,r){const n=new Map,a="item"===r;let i=e;if(a&&e){const{[Dv]:t,[kv]:r,...n}=e;i=n}return{..."floating"===r&&{tabIndex:-1},...i,...t.map((t=>{const n=t?t[r]:null;return"function"==typeof n?e?n(e):null:n})).concat(e).reduce(((e,t)=>t?(Object.entries(t).forEach((t=>{let[r,i]=t;var o;a&&[Dv,kv].includes(r)||(0===r.indexOf("on")?(n.has(r)||n.set(r,[]),"function"==typeof i&&(null==(o=n.get(r))||o.push(i),e[r]=function(){for(var e,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return null==(e=n.get(r))?void 0:e.map((e=>e(...a))).find((e=>void 0!==e))})):e[r]=i)})),e):e),{})}}var Av=Object.defineProperty,Nv=Object.defineProperties,Lv=Object.getOwnPropertyDescriptors,Mv=Object.getOwnPropertySymbols,Fv=Object.prototype.hasOwnProperty,Bv=Object.prototype.propertyIsEnumerable,qv=(e,t,r)=>t in e?Av(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Qv=(e,t)=>{for(var r in t||(t={}))Fv.call(t,r)&&qv(e,r,t[r]);if(Mv)for(var r of Mv(t))Bv.call(t,r)&&qv(e,r,t[r]);return e};const Vv=(0,mt.memo)((({def:e,operation:t})=>{const r=(0,bt.useStyles2)(Wv),[n,a]=(0,mt.useState)(!1),i=[ov(16),lv({fallbackAxisSideDirection:"end",crossAxis:!1,boundary:document.body}),sv()],{context:o,refs:s,floatingStyles:l}=$v({open:n,placement:"top",onOpenChange:a,middleware:i,whileElementsMounted:Yb}),c=function(e,t){void 0===t&&(t={});const{open:r,onOpenChange:n,dataRef:a,elements:{domReference:i}}=e,{enabled:o=!0,event:s="click",toggle:l=!0,ignoreMouse:c=!1,keyboardHandlers:u=!0}=t,d=mt.useRef(),p=mt.useRef(!1),h=mt.useMemo((()=>({onPointerDown(e){d.current=e.pointerType},onMouseDown(e){const t=d.current;0===e.button&&"click"!==s&&(uv(t,!0)&&c||(!r||!l||a.current.openEvent&&"mousedown"!==a.current.openEvent.type?(e.preventDefault(),n(!0,e.nativeEvent,"click")):n(!1,e.nativeEvent,"click")))},onClick(e){const t=d.current;"mousedown"===s&&d.current?d.current=void 0:uv(t,!0)&&c||(!r||!l||a.current.openEvent&&"click"!==a.current.openEvent.type?n(!0,e.nativeEvent,"click"):n(!1,e.nativeEvent,"click"))},onKeyDown(e){d.current=void 0,e.defaultPrevented||!u||Ev(e)||(" "!==e.key||Tv(i)||(e.preventDefault(),p.current=!0),"Enter"===e.key&&n(!r||!l,e.nativeEvent,"click"))},onKeyUp(e){e.defaultPrevented||!u||Ev(e)||Tv(i)||" "===e.key&&p.current&&(p.current=!1,n(!r||!l,e.nativeEvent,"click"))}})),[a,i,s,c,u,n,r,l]);return mt.useMemo((()=>o?{reference:h}:{}),[o,h])}(o),u=function(e,t){void 0===t&&(t={});const{open:r,onOpenChange:n,elements:a,dataRef:i}=e,{enabled:o=!0,escapeKey:s=!0,outsidePress:l=!0,outsidePressEvent:c="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:p=!1,bubbles:h,capture:m}=t,f=_v(),g=gv("function"==typeof l?l:()=>!1),b="function"==typeof l?g:l,v=mt.useRef(!1),y=mt.useRef(!1),{escapeKey:x,outsidePress:O}=jv(h),{escapeKey:w,outsidePress:S}=jv(m),_=gv((e=>{var t;if(!r||!o||!s||"Escape"!==e.key)return;const a=null==(t=i.current.floatingContext)?void 0:t.nodeId,l=f?Pv(f.nodesRef.current,a):[];if(!x&&(e.stopPropagation(),l.length>0)){let e=!0;if(l.forEach((t=>{var r;null==(r=t.context)||!r.open||t.context.dataRef.current.__escapeKeyBubbles||(e=!1)})),!e)return}n(!1,function(e){return"nativeEvent"in e}(e)?e.nativeEvent:e,"escape-key")})),P=gv((e=>{var t;const r=()=>{var t;_(e),null==(t=hv(e))||t.removeEventListener("keydown",r)};null==(t=hv(e))||t.addEventListener("keydown",r)})),E=gv((e=>{var t;const r=v.current;v.current=!1;const o=y.current;if(y.current=!1,"click"===c&&o)return;if(r)return;if("function"==typeof b&&!b(e))return;const s=hv(e),l="["+("data-floating-ui-"+"inert"+"]"),u=dv(a.floating).querySelectorAll(l);let d=Ob(s)?s:null;for(;d&&!Ib(d);){const e=Db(d);if(Ib(e)||!Ob(e))break;d=e}if(u.length&&Ob(s)&&!s.matches("html,body")&&!cv(s,a.floating)&&Array.from(u).every((e=>!cv(d,e))))return;if(wb(s)&&I){const t=s.clientWidth>0&&s.scrollWidth>s.clientWidth,r=s.clientHeight>0&&s.scrollHeight>s.clientHeight;let n=r&&e.offsetX>s.clientWidth;if(r&&"rtl"===jb(s).direction&&(n=e.offsetX<=s.offsetWidth-s.clientWidth),n||t&&e.offsetY>s.clientHeight)return}const p=null==(t=i.current.floatingContext)?void 0:t.nodeId,h=f&&Pv(f.nodesRef.current,p).some((t=>{var r;return pv(e,null==(r=t.context)?void 0:r.elements.floating)}));if(pv(e,a.floating)||pv(e,a.domReference)||h)return;const m=f?Pv(f.nodesRef.current,p):[];if(m.length>0){let e=!0;if(m.forEach((t=>{var r;null==(r=t.context)||!r.open||t.context.dataRef.current.__outsidePressBubbles||(e=!1)})),!e)return}n(!1,e,"outside-press")})),T=gv((e=>{var t;const r=()=>{var t;E(e),null==(t=hv(e))||t.removeEventListener(c,r)};null==(t=hv(e))||t.addEventListener(c,r)}));mt.useEffect((()=>{if(!r||!o)return;function e(e){n(!1,e,"ancestor-scroll")}i.current.__escapeKeyBubbles=x,i.current.__outsidePressBubbles=O;const t=dv(a.floating);s&&t.addEventListener("keydown",w?P:_,w),b&&t.addEventListener(c,S?T:E,S);let l=[];return p&&(Ob(a.domReference)&&(l=Rb(a.domReference)),Ob(a.floating)&&(l=l.concat(Rb(a.floating))),!Ob(a.reference)&&a.reference&&a.reference.contextElement&&(l=l.concat(Rb(a.reference.contextElement)))),l=l.filter((e=>{var r;return e!==(null==(r=t.defaultView)?void 0:r.visualViewport)})),l.forEach((t=>{t.addEventListener("scroll",e,{passive:!0})})),()=>{s&&t.removeEventListener("keydown",w?P:_,w),b&&t.removeEventListener(c,S?T:E,S),l.forEach((t=>{t.removeEventListener("scroll",e)}))}}),[i,a,s,b,c,r,n,p,o,x,O,_,w,P,E,S,T]),mt.useEffect((()=>{v.current=!1}),[b,c]);const C=mt.useMemo((()=>({onKeyDown:_,[Cv[d]]:e=>{u&&n(!1,e.nativeEvent,"reference-press")}})),[_,n,u,d]),I=mt.useMemo((()=>({onKeyDown:_,onMouseDown(){y.current=!0},onMouseUp(){y.current=!0},[Iv[c]]:()=>{v.current=!0}})),[_,c]);return mt.useMemo((()=>o?{reference:C,floating:I}:{}),[o,C,I])}(o),{getReferenceProps:d,getFloatingProps:p}=function(e){void 0===e&&(e=[]);const t=e.map((e=>null==e?void 0:e.reference)),r=e.map((e=>null==e?void 0:e.floating)),n=e.map((e=>null==e?void 0:e.item)),a=mt.useCallback((t=>Rv(t,e,"reference")),t),i=mt.useCallback((t=>Rv(t,e,"floating")),r),o=mt.useCallback((t=>Rv(t,e,"item")),n);return mt.useMemo((()=>({getReferenceProps:a,getFloatingProps:i,getItemProps:o})),[a,i,o])}([u,c]);return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.Button,Qv({title:"Click to show description",ref:s.setReference,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"},d())),n&&(0,ht.jsx)(bt.Portal,{children:(0,ht.jsxs)("div",(h=Qv({ref:s.setFloating,style:l},p()),m={className:r.docBox,children:[(0,ht.jsxs)("div",{className:r.docBoxHeader,children:[(0,ht.jsx)("span",{children:e.renderer(t,e,"<expr>")}),(0,ht.jsx)(jd,{grow:1}),(0,ht.jsx)(bt.Button,{icon:"times",onClick:()=>a(!1),fill:"text",variant:"secondary",title:"Remove operation"})]}),(0,ht.jsx)("div",{className:r.docBoxBody,dangerouslySetInnerHTML:{__html:zv(e,t)}})]},Nv(h,Lv(m))))})]});var h,m}));Vv.displayName="OperationDocs";const Wv=e=>({docBox:(0,Nr.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,Nr.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,Nr.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary})});function zv(t,r){var n;return(0,e.renderMarkdown)(t.explainHandler?t.explainHandler(r,t):null!=(n=t.documentation)?n:"no docs")}var Uv=Object.defineProperty,Gv=Object.defineProperties,Hv=Object.getOwnPropertyDescriptors,Xv=Object.getOwnPropertySymbols,Yv=Object.prototype.hasOwnProperty,Kv=Object.prototype.propertyIsEnumerable,Jv=(e,t,r)=>t in e?Uv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Zv=(e,t)=>{for(var r in t||(t={}))Yv.call(t,r)&&Jv(e,r,t[r]);if(Xv)for(var r of Xv(t))Kv.call(t,r)&&Jv(e,r,t[r]);return e},ey=(e,t)=>Gv(e,Hv(t));const ty=(0,mt.memo)((({operation:e,def:t,index:r,onChange:n,onRemove:a,queryModeller:i,dragHandleProps:o})=>{var s;const l=(0,bt.useStyles2)(ry),[c,u]=(0,mt.useState)({}),d=()=>{if(c.isOpen)u(ey(Zv({},c),{isOpen:!1}));else{const e=i.getAlternativeOperations(t.alternativesKey).map((e=>({label:e.name,value:e})));u({isOpen:!0,alternatives:e})}};return(0,ht.jsxs)("div",{className:l.header,children:[!c.isOpen&&(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("div",ey(Zv({},o),{children:null!=(s=t.name)?s:t.id})),(0,ht.jsx)(jd,{grow:1}),(0,ht.jsxs)("div",{className:`${l.operationHeaderButtons} operation-header-show-on-hover`,children:[(0,ht.jsx)(bt.Button,{icon:"angle-down",size:"sm",onClick:d,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),(0,ht.jsx)(Vv,{def:t,operation:e}),(0,ht.jsx)(bt.Button,{icon:"times",size:"sm",onClick:()=>a(r),fill:"text",variant:"secondary",title:"Remove operation"})]})]}),c.isOpen&&(0,ht.jsx)("div",{className:l.selectWrapper,children:(0,ht.jsx)(bt.Select,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:c.alternatives,isOpen:!0,onCloseMenu:d,onChange:a=>{if(a.value){const o=i.getOperationDef(a.value.id),s=[...o.defaultParams];for(let r=0;r<Math.min(e.params.length,s.length);r++)o.params[r].type===t.params[r].type&&(s[r]=e.params[r]);const l=ey(Zv({},e),{params:s,id:a.value.id});n(r,t.changeTypeHandler?t.changeTypeHandler(l,o):l)}}})})]})}));ty.displayName="OperationHeader";const ry=e=>({header:(0,Nr.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,Nr.css)({opacity:1}),selectWrapper:(0,Nr.css)({paddingRight:e.spacing(2)})});function ny(e){return e.editor?e.editor:e.options?oy:"boolean"===e.type?iy:ay}function ay(e){var t;return(0,ht.jsx)(bt.AutoSizeInput,{id:Ft(e.operationId,e.index),defaultValue:null==(t=e.value)?void 0:t.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:3*(e.paramDef.minWidth||20),onCommitChange:t=>{e.onChange(e.index,t.currentTarget.value),e.paramDef.runQueryOnEnter&&"keydown"===t.type&&e.onRunQuery()}})}function iy(e){return(0,ht.jsx)(bt.Checkbox,{id:Ft(e.operationId,e.index),value:Boolean(e.value),onChange:t=>e.onChange(e.index,t.currentTarget.checked)})}function oy({paramDef:t,value:r,index:n,operationId:a,onChange:i}){var o,s;const l=(0,bt.useStyles2)(sy);let c=t.options;(null==(o=c[0])?void 0:o.label)||(c=t.options.map((e=>({label:e.toString(),value:e}))));let u=null!=(s=c.find((e=>e.value===r)))?s:(0,e.toOption)(r);return!r&&t.optional?(0,ht.jsx)("div",{className:l.optionalParam,children:(0,ht.jsx)(bt.Button,{size:"sm",variant:"secondary",title:`Add ${t.name}`,icon:"plus",onClick:()=>i(n,c[0].value),children:t.name})}):(0,ht.jsxs)(bt.Stack,{gap:.5,direction:"row",alignItems:"center",children:[(0,ht.jsx)(bt.Select,{id:Ft(a,n),value:u,options:c,placeholder:t.placeholder,allowCustomValue:!0,onChange:e=>i(n,e.value),width:t.minWidth||"auto"}),t.optional&&(0,ht.jsx)(bt.Button,{"data-testid":`operations.${n}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${t.name}`,onClick:()=>i(n,"")})]})}const sy=e=>({optionalParam:(0,Nr.css)({marginTop:e.spacing(1)})});var ly=Object.defineProperty,cy=Object.defineProperties,uy=Object.getOwnPropertyDescriptors,dy=Object.getOwnPropertySymbols,py=Object.prototype.hasOwnProperty,hy=Object.prototype.propertyIsEnumerable,my=(e,t,r)=>t in e?ly(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fy=(e,t)=>{for(var r in t||(t={}))py.call(t,r)&&my(e,r,t[r]);if(dy)for(var r of dy(t))hy.call(t,r)&&my(e,r,t[r]);return e},gy=(e,t)=>cy(e,uy(t));function by({operation:e,index:t,onRemove:r,onChange:n,onRunQuery:a,queryModeller:i,query:o,datasource:s,flash:l,highlight:c,timeRange:u}){const d=(0,bt.useStyles2)(yy),p=i.getOperationDef(e.id),h=function(e){const[t,r]=(0,mt.useState)(!0);return(0,mt.useEffect)((()=>{let t;return e?t=setTimeout((()=>{r(!1)}),1e3):r(!0),()=>clearTimeout(t)}),[e]),t&&e}(l),m=(0,mt.useId)();if(!p)return(0,ht.jsxs)("span",{children:["Operation ",e.id," not found"]});const f=(r,a)=>{const i=gy(fy({},e),{params:[...e.params]});i.params[r]=a,vy(p,i,t,r,n)},g=()=>{const r=gy(fy({},e),{params:[...e.params,""]});vy(p,r,t,e.params.length,n)},b=r=>{const a=gy(fy({},e),{params:[...e.params.slice(0,r),...e.params.slice(r+1)]});vy(p,a,t,r,n)},v=[];for(let r=0;r<e.params.length;r++){const n=p.params[Math.min(p.params.length-1,r)],i=ny(n);v.push((0,ht.jsxs)("div",{className:d.paramRow,children:[!n.hideName&&(0,ht.jsxs)("div",{className:d.paramName,children:[(0,ht.jsx)("label",{htmlFor:Ft(m,r),children:n.name}),n.description&&(0,ht.jsx)(bt.Tooltip,{placement:"top",content:n.description,theme:"info",children:(0,ht.jsx)(bt.Icon,{name:"info-circle",size:"sm",className:d.infoIcon})})]}),(0,ht.jsx)("div",{className:d.paramValue,children:(0,ht.jsxs)(bt.Stack,{gap:.5,direction:"row",alignItems:"center",children:[(0,ht.jsx)(i,{index:r,paramDef:n,value:e.params[r],operation:e,operationId:m,onChange:f,onRunQuery:a,query:o,datasource:s,timeRange:u}),n.restParam&&(e.params.length>p.params.length||n.optional)&&(0,ht.jsx)(bt.Button,{"data-testid":`operations.${t}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${n.name}`,onClick:()=>b(r)})]})})]},`${r}-1`))}let y;if(p.params.length>0){const r=p.params[p.params.length-1];r.restParam&&(y=function(e,t,r,n,a){return(0,ht.jsx)("div",{className:a.restParam,children:(0,ht.jsx)(bt.Button,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:t,"data-testid":`operations.${r}.add-rest-param`,children:e.name})},`${n}-2`)}(r,g,t,e.params.length,d))}return(0,ht.jsx)(Eg,{draggableId:`operation-${t}`,index:t,children:a=>(0,ht.jsxs)("div",gy(fy({className:(0,Nr.cx)(d.card,(h||c)&&d.cardHighlight),ref:a.innerRef},a.draggableProps),{"data-testid":`operations.${t}.wrapper`,children:[(0,ht.jsx)(ty,{operation:e,dragHandleProps:a.dragHandleProps,def:p,index:t,onChange:n,onRemove:r,queryModeller:i}),(0,ht.jsx)("div",{className:d.body,children:v}),y,t<o.operations.length-1&&(0,ht.jsxs)("div",{className:d.arrow,children:[(0,ht.jsx)("div",{className:d.arrowLine}),(0,ht.jsx)("div",{className:d.arrowArrow})]})]}))})}function vy(e,t,r,n,a){e.paramChangedHandler?a(r,e.paramChangedHandler(n,t,e)):a(r,t)}const yy=e=>({cardWrapper:(0,Nr.css)({alignItems:"stretch"}),error:(0,Nr.css)({marginBottom:e.spacing(1)}),card:(0,Nr.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,marginBottom:e.spacing(1),position:"relative",[e.transitions.handleMotion("no-preference","reduce")]:{transition:"all 0.5s ease-in 0s"},height:"100%"}),cardError:(0,Nr.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,Nr.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,Nr.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,Nr.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,Nr.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,Nr.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,Nr.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,Nr.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,Nr.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,Nr.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,Nr.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});var xy=Object.defineProperty,Oy=Object.defineProperties,wy=Object.getOwnPropertyDescriptors,Sy=Object.getOwnPropertySymbols,_y=Object.prototype.hasOwnProperty,Py=Object.prototype.propertyIsEnumerable,Ey=(e,t,r)=>t in e?xy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ty=(e,t)=>{for(var r in t||(t={}))_y.call(t,r)&&Ey(e,r,t[r]);if(Sy)for(var r of Sy(t))Py.call(t,r)&&Ey(e,r,t[r]);return e},Cy=(e,t)=>Oy(e,wy(t));function Iy({query:e,datasource:t,queryModeller:r,onChange:n,onRunQuery:a,highlightedOp:i,timeRange:o}){const s=(0,bt.useStyles2)(jy),{operations:l}=e,c=function(e){const t=(n=(0,mt.useRef)(!1),a=(0,mt.useCallback)((function(){return n.current}),[]),(0,mt.useEffect)((function(){return n.current=!0,function(){n.current=!1}}),[]),a),r=Xg(e);var n,a;if(!t())return e.map((()=>!1));if(!r)return e.map((()=>!0));let i=[];if(r.length-1===e.length&&e.every((e=>r.includes(e))))return e.map((()=>!1));if(r.length+1===e.length&&r.every((t=>e.includes(t)))){const t=e.find((e=>!r.includes(e)));i=e.map((e=>e===t))}else i=e.map(((e,t)=>{var n,a,i;return!((a=e.id)===(i=null==(n=r[t])?void 0:n.id)||`__${a}_by`===i||a===`__${i}_by`)}));return i}(l),[u,d]=(0,mt.useState)(!1),p=(t,r)=>{const a=[...l];a.splice(t,1,r),n(Cy(Ty({},e),{operations:a}))},h=t=>{const r=[...l.slice(0,t),...l.slice(t+1)];n(Cy(Ty({},e),{operations:r}))},m=r.getCategories().map((e=>({value:e,label:e,items:r.getOperationsForCategory(e).map((e=>({value:e.id,label:e.name,isLeaf:!0})))})));return(0,ht.jsx)(bt.Stack,{gap:1,direction:"column",children:(0,ht.jsxs)(bt.Stack,{gap:1,children:[l.length>0&&(0,ht.jsx)(dg,{onDragEnd:t=>{if(!t.destination)return;const r=[...l],a=r[t.source.index];r.splice(t.source.index,1),r.splice(t.destination.index,0,a),n(Cy(Ty({},e),{operations:r}))},children:(0,ht.jsx)(Hg,{droppableId:"sortable-field-mappings",direction:"horizontal",children:n=>(0,ht.jsxs)("div",Cy(Ty({className:s.operationList,ref:n.innerRef},n.droppableProps),{children:[l.map(((n,s)=>(0,ht.jsx)(by,{queryModeller:r,index:s,operation:n,query:e,datasource:t,onChange:p,onRemove:h,onRunQuery:a,flash:c[s],highlight:i===n,timeRange:o},n.id+JSON.stringify(n.params)+s))),n.placeholder]}))})}),(0,ht.jsx)("div",{className:s.addButton,children:u?(0,ht.jsx)(bt.Cascader,{options:m,onSelect:t=>{const a=r.getOperationDef(t);a&&(n(a.addOperationHandler(a,e,r)),d(!1))},onBlur:()=>{d(!1)},autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):(0,ht.jsx)(bt.Button,{icon:"plus",variant:"secondary",onClick:()=>d(!0),title:"Add operation",children:"Operations"})})]})})}const jy=e=>({heading:(0,Nr.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,Nr.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,Nr.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})});function $y({children:e}){const t=(0,bt.useStyles2)(Dy);return(0,ht.jsx)("div",{className:t.root,children:(0,ht.jsx)(bt.Stack,{gap:1,children:e})})}const Dy=e=>({root:(0,Nr.css)({padding:e.spacing(1,1,0,1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.radius.default})}),ky=({datasource:e,query:t,onChange:r,data:n,queryModeller:a,buildVisualQueryFromString:i})=>{const[o,s]=(0,mt.useState)([]),l=(0,bt.useStyles2)(Ry);return(0,mt.useEffect)((()=>{const r={expr:a.renderQuery(t),refId:""},i=e.getQueryHints(r,(null==n?void 0:n.series)||[]).filter((e=>{var t;return null==(t=e.fix)?void 0:t.action}));s(i)}),[e,t,n,a]),(0,ht.jsx)(ht.Fragment,{children:o.length>0&&(0,ht.jsx)("div",{className:l.container,children:o.map((n=>{var o,s,c,u;return(0,ht.jsx)(bt.Tooltip,{content:`${n.label} ${null==(o=n.fix)?void 0:o.label}`,children:(0,ht.jsxs)(bt.Button,{onClick:()=>{var o;if((0,j.reportInteraction)("grafana_query_builder_hints_clicked",{hint:n.type,datasourceType:e.type}),null==(o=null==n?void 0:n.fix)?void 0:o.action){const o={expr:a.renderQuery(t),refId:""},s=e.modifyQuery(o,n.fix.action),l=i(s.expr);return r(l.query)}},fill:"outline",size:"sm",className:l.hint,children:["hint: ",(null==(s=n.fix)?void 0:s.title)||(null==(u=null==(c=n.fix)?void 0:c.action)?void 0:u.type.toLowerCase().replace("_"," "))]})},n.type)}))})})};ky.displayName="QueryBuilderHints";const Ry=e=>({container:(0,Nr.css)({display:"flex",alignItems:"start"}),hint:(0,Nr.css)({marginRight:e.spacing(1)})});var Ay=Object.defineProperty,Ny=Object.defineProperties,Ly=Object.getOwnPropertyDescriptors,My=Object.getOwnPropertySymbols,Fy=Object.prototype.hasOwnProperty,By=Object.prototype.propertyIsEnumerable,qy=(e,t,r)=>t in e?Ay(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Qy=(e,t)=>{for(var r in t||(t={}))Fy.call(t,r)&&qy(e,r,t[r]);if(My)for(var r of My(t))By.call(t,r)&&qy(e,r,t[r]);return e},Vy=(e,t)=>Ny(e,Ly(t));const Wy=(0,mt.memo)((t=>{const{nestedQuery:r,index:n,datasource:a,onChange:i,onRemove:o,onRunQuery:s,showExplain:l}=t,c=(0,bt.useStyles2)(Uy);return(0,ht.jsxs)("div",{className:c.card,children:[(0,ht.jsxs)("div",{className:c.header,children:[(0,ht.jsx)("div",{className:c.name,children:"Operator"}),(0,ht.jsx)(bt.Select,{width:"auto",options:zy,value:(0,e.toOption)(r.operator),onChange:e=>{i(n,Vy(Qy({},r),{operator:e.value}))}}),(0,ht.jsx)("div",{className:c.name,children:"Vector matches"}),(0,ht.jsxs)("div",{className:c.vectorMatchWrapper,children:[(0,ht.jsx)(bt.Select,{width:"auto",value:r.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:e=>{i(n,Vy(Qy({},r),{vectorMatchesType:e.value}))}}),(0,ht.jsx)(bt.AutoSizeInput,{className:c.vectorMatchInput,minWidth:20,defaultValue:r.vectorMatches,onCommitChange:e=>{i(n,Vy(Qy({},r),{vectorMatches:e.currentTarget.value,vectorMatchesType:r.vectorMatchesType||"on"}))}})]}),(0,ht.jsx)(jd,{grow:1}),(0,ht.jsx)(bt.IconButton,{name:"times",size:"sm",onClick:()=>o(n),tooltip:"Remove match"})]}),(0,ht.jsx)("div",{className:c.body,children:(0,ht.jsx)(Qr,{children:(0,ht.jsx)(bO,{showExplain:l,query:r.query,datasource:a,onRunQuery:s,onChange:e=>{i(n,Vy(Qy({},r),{query:e}))}})})})]})})),zy=Gt.map((e=>({label:e.sign,value:e.sign})));Wy.displayName="NestedQuery";const Uy=e=>({card:(0,Nr.css)({label:"card",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),header:(0,Nr.css)({label:"header",padding:e.spacing(.5,.5,.5,1),gap:e.spacing(1),display:"flex",alignItems:"center"}),name:(0,Nr.css)({label:"name",whiteSpace:"nowrap"}),body:(0,Nr.css)({label:"body",paddingLeft:e.spacing(2)}),vectorMatchInput:(0,Nr.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,Nr.css)({label:"vectorMatchWrapper",display:"flex"})});var Gy=Object.defineProperty,Hy=Object.defineProperties,Xy=Object.getOwnPropertyDescriptors,Yy=Object.getOwnPropertySymbols,Ky=Object.prototype.hasOwnProperty,Jy=Object.prototype.propertyIsEnumerable,Zy=(e,t,r)=>t in e?Gy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ex=(e,t)=>{for(var r in t||(t={}))Ky.call(t,r)&&Zy(e,r,t[r]);if(Yy)for(var r of Yy(t))Jy.call(t,r)&&Zy(e,r,t[r]);return e},tx=(e,t)=>Hy(e,Xy(t));function rx(e){var t;const{query:r,datasource:n,onChange:a,onRunQuery:i,showExplain:o}=e,s=null!=(t=r.binaryQueries)?t:[],l=(e,t)=>{const n=[...s];n.splice(e,1,t),a(tx(ex({},r),{binaryQueries:n}))},c=e=>{const t=[...s.slice(0,e),...s.slice(e+1)];a(tx(ex({},r),{binaryQueries:t}))};return(0,ht.jsx)(bt.Stack,{direction:"column",gap:1,children:s.map(((e,t)=>(0,ht.jsx)(Wy,{nestedQuery:e,index:t,onChange:l,datasource:n,onRemove:c,onRunQuery:i,showExplain:o},t.toString())))})}var nx=Object.defineProperty,ax=Object.defineProperties,ix=Object.getOwnPropertyDescriptors,ox=Object.getOwnPropertySymbols,sx=Object.prototype.hasOwnProperty,lx=Object.prototype.propertyIsEnumerable,cx=(e,t,r)=>t in e?nx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ux=(e,t)=>{for(var r in t||(t={}))sx.call(t,r)&&cx(e,r,t[r]);if(ox)for(var r of ox(t))lx.call(t,r)&&cx(e,r,t[r]);return e},dx=(e,t)=>ax(e,ix(t));const px=[{label:"Yes",value:"yes"},{label:"No",value:"no"}],hx=[{label:"Too vague",value:"too vague"},{label:"Too technical",value:"too technical"},{label:"Inaccurate",value:"inaccurate"},{label:"Other",value:"other"}];function mx(e){const{querySuggestion:t,order:r,queryExplain:n,historical:a,onChange:i,closeDrawer:o,last:s,allSuggestions:l,prompt:c}=e,[u,d]=(0,mt.useState)(!1),[p,h]=(0,mt.useState)(!1),[m,f]=(0,mt.useState)(!1),[g,b]=(0,mt.useState)({radioInput:"",text:""}),[v,y]=(0,mt.useState)({radioInput:"",text:""}),x=(0,bt.useTheme2)(),O=cO(x),{query:w,explanation:S}=t,_=e=>{const r="explanation"===e?"Why was the explanation not helpful?":"Were the query suggestions helpful?";return(0,ht.jsxs)("div",{className:O.suggestionFeedback,children:[(0,ht.jsxs)("div",{children:[(0,ht.jsxs)("div",{className:O.feedbackQuestion,children:[(0,ht.jsx)("h6",{children:r}),(0,ht.jsx)("i",{children:"(Required)"})]}),(0,ht.jsx)(bt.RadioButtonList,{name:"default",options:"explanation"===e?hx:px,value:"explanation"===e?v.radioInput:g.radioInput,onChange:t=>{"explanation"===e?y(dx(ux({},v),{radioInput:t})):b(dx(ux({},g),{radioInput:t}))}})]}),(0,ht.jsxs)("div",{className:(0,Nr.cx)("explanation"===e&&O.explationTextInput),children:["explanation"!==e&&(0,ht.jsx)("div",{className:O.feedbackQuestion,children:(0,ht.jsx)("h6",{children:"How can we improve the query suggestions?"})}),(0,ht.jsx)(bt.TextArea,{type:"text","aria-label":"Promqail suggestion text",placeholder:"Enter your feedback",value:"explanation"===e?v.text:g.text,onChange:t=>{"explanation"===e?y(dx(ux({},v),{text:t.currentTarget.value})):b(dx(ux({},g),{text:t.currentTarget.value}))},cols:100})]}),(0,ht.jsx)("div",{className:O.submitFeedback,children:(0,ht.jsx)(bt.Button,{variant:"primary",size:"sm",disabled:"explanation"===e?!v.radioInput:!g.radioInput,onClick:()=>{"explanation"===e?(fx(v.radioInput,v.text,t,a,c),h(!0)):(function(e,t,r,n,a){(0,j.reportInteraction)("grafana_prometheus_promqail_suggestion_feedback",{helpful:e,textFeedback:t,suggestionType:n?"historical":"AI",allSuggestions:r,prompt:a})}(g.radioInput,g.text,null!=l?l:"",a,c),f(!0))},children:"Submit"})})]})};return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsxs)("div",{className:O.querySuggestion,children:[(0,ht.jsx)("div",{title:w,className:(0,Nr.cx)(O.codeText,O.longCode),children:`${r}.  ${w}`}),(0,ht.jsx)("div",{className:O.useButton,children:(0,ht.jsx)(bt.Button,{variant:"primary",size:"sm",onClick:()=>{(0,j.reportInteraction)("grafana_prometheus_promqail_use_query_button_clicked",{query:t.query});const e=jr(t.query);i(e.query),o()},children:"Use"})})]}),(0,ht.jsxs)("div",{children:[(0,ht.jsx)(bt.Button,{fill:"text",variant:"secondary",icon:u?"angle-up":"angle-down",onClick:()=>{d(!u),n(r-1)},className:(0,Nr.cx)(O.bodySmall),size:"sm",children:"Explainer"}),!u&&5!==r&&(0,ht.jsx)("div",{className:O.textPadding}),u&&!t.explanation&&(0,ht.jsx)("div",{className:O.center,children:(0,ht.jsx)(bt.Spinner,{})}),u&&t.explanation&&(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsxs)("div",{className:(0,Nr.cx)(O.bodySmall,O.explainPadding),children:[(0,ht.jsx)("div",{className:O.textPadding,children:"This query is trying to answer the question:"}),(0,ht.jsx)("div",{className:O.textPadding,children:S}),(0,ht.jsxs)("div",{className:O.textPadding,children:["Learn more with this"," ",(0,ht.jsx)("a",{className:O.doc,href:"https://prometheus.io/docs/prometheus/latest/querying/examples/#query-examples",target:"_blank",rel:"noopener noreferrer",children:"Prometheus doc"})]}),(0,ht.jsxs)("div",{className:(0,Nr.cx)(O.rightButtons,O.secondaryText),children:["Was this explanation helpful?",(0,ht.jsx)("div",{className:O.floatRight,children:p?"Thank you for your feedback!":(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.Button,{fill:"outline",variant:"secondary",size:"sm",className:O.leftButton,onClick:()=>{fx("Yes","",t,a,c),h(!0)},children:"Yes"}),(0,ht.jsx)(bt.Toggletip,{"aria-label":"Suggestion feedback",content:_("explanation"),placement:"bottom-end",closeButton:!0,children:(0,ht.jsx)(bt.Button,{fill:"outline",variant:"secondary",size:"sm",children:"No"})})]})})]})]}),!s&&(0,ht.jsx)("hr",{})]}),s&&(0,ht.jsx)("div",{className:(0,Nr.cx)(O.feedbackStyle),children:m?(0,ht.jsx)(bt.Button,{fill:"outline",variant:"secondary",size:"sm",disabled:!0,children:"Thank you for your feedback!"}):(0,ht.jsx)(bt.Toggletip,{"aria-label":"Suggestion feedback",content:_("suggestion"),placement:"bottom-end",closeButton:!0,children:(0,ht.jsx)(bt.Button,{fill:"outline",variant:"secondary",size:"sm",children:"Give feedback on suggestions"})})})]})]})}function fx(e,t,r,n,a){(0,j.reportInteraction)("grafana_prometheus_promqail_explanation_feedback",{helpful:e,textFeedback:t,suggestionType:n?"historical":"AI",query:r.query,explanation:r.explanation,prompt:a})}var gx=(e=>(e.Historical="historical",e.AI="AI",e))(gx||{});function bx(e){const{suggestionType:t,querySuggestions:r,closeDrawer:n,nextInteraction:a,queryExplain:i,onChange:o,prompt:s}=e,[l,c]=(0,mt.useState)(!1),u=(0,bt.useTheme2)(),d=cO(u);let p,h,m;return t===gx.Historical?(p=`Here are ${r.length} query suggestions:`,m="I want to write a prompt"):t===gx.AI&&(p=p="Here is your query suggestion:",h="This query is based off of natural language descriptions of the most commonly used PromQL queries.",m="Refine prompt"),(0,ht.jsxs)(ht.Fragment,{children:[t===gx.Historical?(0,ht.jsx)("div",{className:d.bottomMargin,children:p}):(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("div",{className:d.textPadding,children:p}),(0,ht.jsx)("div",{className:(0,Nr.cx)(d.secondaryText,d.bottomMargin),children:h})]}),(0,ht.jsx)("div",{className:d.infoContainerWrapper,children:(0,ht.jsx)("div",{className:d.infoContainer,children:r.map(((e,a)=>(0,ht.jsx)(mx,{historical:t===gx.Historical,querySuggestion:e,order:a+1,queryExplain:i,onChange:o,closeDrawer:n,last:a===r.length-1,allSuggestions:r.reduce(((e,t)=>e+"$$"+t.query),""),prompt:null!=s?s:""},a)))})}),!l&&(0,ht.jsxs)("div",{className:d.nextInteractionHeight,children:[(0,ht.jsx)("div",{className:(0,Nr.cx)(d.afterButtons,d.textPadding),children:(0,ht.jsx)(bt.Button,{onClick:()=>{c(!0),a()},"data-testid":uO.refinePrompt,fill:"outline",variant:"secondary",size:"md",children:m})}),(0,ht.jsx)("div",{className:(0,Nr.cx)(d.textPadding,d.floatRight),children:(0,ht.jsx)(bt.Button,{fill:"outline",variant:"secondary",size:"md",onClick:n,children:"Cancel"})})]})]})}var vx="data:image/svg+xml,%3csvg width='26' height='27' viewBox='0 0 26 27' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M0 9.5C0 4.52944 4.02944 0.5 9 0.5H17C21.9706 0.5 26 4.52944 26 9.5V15.5C26 20.4706 21.9706 24.5 17 24.5H0V9.5Z' fill='url(%23paint0_linear_68_17626)'/%3e%3cpath d='M8.91193 18.7053C7.14915 18.7053 5.77876 17.7031 5.77876 15.88C5.77876 13.7731 7.57777 13.3143 9.33452 13.109C11.0007 12.9158 11.6768 12.9279 11.6768 12.2699V12.2276C11.6768 11.1772 11.0792 10.5675 9.91406 10.5675C8.70064 10.5675 8.0245 11.2013 7.75888 11.8594L6.0625 11.473C6.66619 9.78267 8.21165 9.10653 9.88992 9.10653C11.3629 9.10653 13.4879 9.64382 13.4879 12.3423V18.5H11.7251V17.2322H11.6527C11.3086 17.9265 10.4453 18.7053 8.91193 18.7053ZM9.30433 17.2564C10.8075 17.2564 11.6829 16.2543 11.6829 15.1555V13.9602C11.4233 14.2198 10.0348 14.3768 9.44922 14.4553C8.40483 14.5941 7.54759 14.9382 7.54759 15.9041C7.54759 16.7976 8.28409 17.2564 9.30433 17.2564ZM15.8921 18.5V9.22727H17.6972V18.5H15.8921ZM16.8037 7.79652C16.1759 7.79652 15.6627 7.31357 15.6627 6.72195C15.6627 6.13033 16.1759 5.64133 16.8037 5.64133C17.4255 5.64133 17.9447 6.13033 17.9447 6.72195C17.9447 7.31357 17.4255 7.79652 16.8037 7.79652Z' fill='white'/%3e%3cpath d='M0 24.5H3L0 26.5V24.5Z' fill='%235B5CC2'/%3e%3cdefs%3e%3clinearGradient id='paint0_linear_68_17626' x1='4.76666' y1='-5.1' x2='24.472' y2='5.4613' gradientUnits='userSpaceOnUse'%3e%3cstop offset='0.0333246' stop-color='%23965AFB'/%3e%3cstop offset='1' stop-color='%23096174'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e";function yx(e,t){return a((function(r,n){var a=0;r.subscribe(S(n,(function(r){return e.call(t,r,a++)&&n.next(r)})))}))}var xx=b(8449);const Ox="grafana-llm-app",wx=`/api/plugins/${Ox}`;let Sx=new xx.SemVer("0.2.0");function _x(e){try{Sx=new xx.SemVer(e)}catch(e){(0,j.logWarning)("Failed to parse version of grafana-llm-app; assuming old version is present.")}}function Px(e){return"error"in e}function Ex(){return(0,r.pipe)((0,r.pipe)(yx((e=>"content"in e.choices[0].delta)),P((e=>e.choices[0].delta.content))),function(e,t){return a(function(e,t,r){return function(n,a){var i=r,o=t,s=0;n.subscribe(S(a,(function(t){var r=s++;o=i?e(o,t,r):(i=!0,t),a.next(o)}),void 0))}}(e,t,arguments.length>=2))}(((e,t)=>e+t),""))}function Tx(t){const r={scope:e.LiveChannelScope.Plugin,namespace:Ox,path:"openai/v1/chat/completions/"+self.crypto.randomUUID(),data:t};return(0,j.getGrafanaLiveSrv)().getStream(r).pipe(yx((t=>(0,e.isLiveChannelMessageEvent)(t)))).pipe(T((e=>{if(Px(e.message))throw new Error(e.message.error)})),(n=e=>{return Px(e.message)||!("done"in(t=e.message.choices[0].delta)&&null!=t.done);var t},void 0===i&&(i=!1),a((function(e,t){e.subscribe(S(t,(function(e){var r=n(e,0);(r||i)&&t.next(e),!r&&t.complete()})))}))),P((e=>e.message)));var n,i}let Cx=!1;let Ix=!1;function jx({documentation:e,metricName:t,metricType:r,metricMetadata:n,query:a}){return""===e&&(e="No documentation provided."),""===n&&(n="No description provided."),`\n        PromQL Documentation: \n        ${e}\n\n        PromQL Metrics Metadata:\n        ${t}(${r}): ${n}\n\n        PromQL Expression: \n        ${a}\n\n        This query is trying to answer the question:\n    `}function $x({promql:e,question:t,metricType:r,labels:n,templates:a}){return`Relevant PromQL templates:\n  ${a=""===a?"No templates provided.":a.replace(/\n/g,"\n  ")}\n  \n  Prometheus metric: ${e}\n  Metric type: ${r}\n  Available Prometheus metric labels: ${n}\n  User question: ${t}\n  \n  \`\`\`promql`}function Dx(e,t){return{query:null!=e?e:{metric:"",labels:[],operations:[]},showExplainer:!1,showStartingMessage:null==t||t,indicateCheckbox:!1,askForQueryHelp:!1,interactions:[]}}function kx(e,t){return{suggestionType:e,prompt:"",suggestions:[],isLoading:null!=t&&t,explanationIsLoading:!1}}const Rx=[{template:"metric_a{}",description:'Get the data for "metric_a"'},{template:"avg by(c) (metric_a{})",description:'Average of all series in "metric_a" grouped by the label "c"'},{template:"count by(d) (metric_a{})",description:'Number of series in the metric "metric_a" grouped by the label "d"'},{template:"sum by(g) (sum_over_time(metric_a{}[1h]))",description:'For each series in the metric "metric_a", sum all values over 1 hour, then group those series by label "g" and sum.'},{template:"count(metric_a{})",description:'Count of series in the metric "metric_a"'},{template:"(metric_a{})",description:'Get the data for "metric_a"'},{template:"count_over_time(metric_a{}[1h])",description:"Number of series of metric_a in a 1 hour interval"},{template:"changes(metric_a{}[1m])",description:"Number of times the values of each series in metric_a have changed in 1 minute periods"},{template:"count(count by(g) (metric_a{}))",description:"Total number of series in metric_a"},{template:"last_over_time(metric_a{}[1h])",description:"For each series in metric_a, get the last value in the 1 hour period."},{template:"sum by(g) (count_over_time(metric_a{}[1h]))",description:'Grouped sum over the label "g" of the number of series of metric_a in a 1 hour period'},{template:"count(metric_a{} == 99)",description:"Number of series of metric_a that have value 99"},{template:"min(metric_a{})",description:'At each timestamp, find the minimum of all series of the metric "metric_a"'},{template:"metric_a{} != 99",description:"Series of metric_a which do not have the value 99"},{template:"metric_a{} - 99",description:"metric_a minus 99"},{template:"quantile_over_time(0.99,metric_a{}[1h])",description:"The 99th quantile of values of metric_a in 1 hour"},{template:'count_values("aaaa",metric_a{})',description:'Count number of label values for a label named "aaaa"'},{template:"quantile by(l) (1,metric_a)",description:'Quantile of series in the metric "metric_a" grouped by the label "l"'}],Ax=[{template:"sum by(d) (rate(metric_a{}[1h]))",description:'Sum of the rate of increase or decrease of the metric "metric_a" per 1 hour period, grouped by the label "d"'},{template:"rate(metric_a{}[1m])",description:'Rate of change of the metric "metric_a" over 1 minute'},{template:"sum by(a) (increase(metric_a{}[5m]))",description:'Taking the metric "metric_a" find the increase in 5 minute periods of each series and aggregate sum over the label "a"'},{template:"sum(rate(metric_a{}[1m]))",description:'Total rate of change of all series of metric "metric_a" in 1 minute intervals'},{template:"sum(increase(metric_a{}[10m]))",description:'Total increase for each series of metric "metric_a" in 10 minute intervals'},{template:"increase(metric_a{}[1h])",description:'Increase in all series of "metric_a" in 1 hour period'},{template:"sum by(d) (irate(metric_a{}[1h]))",description:'Sum of detailed rate of change of the metric "metric_a" over 1 hour grouped by label "d"'},{template:"irate(metric_a{}[1h])",description:'Detailed rate of change of the metric "metric_a" over 1 hour'},{template:"avg by(d) (rate(metric_a{}[1h]))",description:'Taking the rate of change of the metric "metric_a" in a 1 hour period, group by the label "d" and find the average of each group'},{template:"topk(5,sum by(g) (rate(metric_a{}[1h])))",description:'Top 5 of the summed groups "g" of the rate of change of metric_a'},{template:"sum(rate(metric_a{}[1h])) / sum(rate(metric_a{}[1h]))",description:"Relative sums of metric_a with different labels"},{template:"histogram_quantile(99,rate(metric_a{}[1h]))",description:"99th percentile of the rate of change of metric_a in 1 hour periods"},{template:"avg(rate(metric_a{}[1m]))",description:"Average of the rate of all series of metric_a in 1 minute periods"},{template:"rate(metric_a{}[5m]) > 99",description:"Show series of metric_a only if their rate over 5 minutes is greater than 99"},{template:"count by(g) (rate(metric_a{}[1h]))",description:'Count of series of metric_a over all labels "g"'}],Nx=[{template:"histogram_quantile(99,sum by(le) (rate(metric_a{}[1h])))",description:'Calculate the rate at which the metric "metric_a" is increasing or decreasing, summed over each bucket label "le", and then calculates the 99th percentile of those rates.'},{template:"histogram_quantile(99,sum by(g) (metric_a{}))",description:'99th percentile of the sum of metric_a grouped by label "g"'},{template:"histogram_quantile(99,sum by(g) (irate(metric_a{}[1h])))",description:'99th percentile of the grouped by "g" sum of the rate of each series in metric_a in an hour'},{template:"histogram_quantile(99,metric_a{})",description:"99th percentile of metric_a"}],Lx=[{template:"sum by(c) (metric_a{})",description:'Sum the metric "metric_a" by each value in label "c"'},{template:"sum(metric_a{})",description:'Total sum of all the series of the metric named "metric_a"'},{template:"max by(dd) (metric_a{})",description:'Grouping the series the metric "metric_a" by the label "dd", get the maximum value of each group'},{template:"max(metric_a{})",description:'Maximum value of all series of the metric "metric_a" '},{template:"avg(metric_a{})",description:'Average value of all the series of metric "metric_a"'},{template:"metric_a{} > 99",description:'Show only the series of metric "metric_a" which currently have value greater than 99'},{template:"metric_a{} / 99",description:'Values for "metric_a" all divided by 99'},{template:"metric_a{} == 99",description:"Show series of metric_a that have value 99"},{template:"sum_over_time(metric_a{}[1h])",description:"Sum each series of metric_a over 1 hour"},{template:"avg_over_time(metric_a{}[1h])",description:"Average of each series of metric_a in a 1 hour period"},{template:"sum(sum_over_time(metric_a{}[1h]))",description:"Sum of all values in all series in a 1 hour period"},{template:"delta(metric_a{}[1m])",description:'Span or delta (maximum - minimum) of values of the metric "metric_a" in a 1 minute period. '},{template:"avg by(g) (avg_over_time(metric_a{}[1h]))",description:'For 1 hour, take each series and find the average, then group by label "g" and find the average of each group'},{template:"max_over_time(metric_a{}[1h])",description:'Maximum values of each series in metric "metric_a" in a 1 hour period'},{template:"metric_a{} * 99",description:"Values of metric_a multiplied by 99"},{template:"metric_a{} < 99",description:"Series of metric_a that have values less than 99"},{template:"max by() (max_over_time(metric_a{}[1h]))",description:"Find maximum value of all series in 1 hour periods"},{template:"topk(99,metric_a{})",description:"First 5 series of metric_a that have the highest values"},{template:"min by(g) (metric_a{})",description:'Minimum values of the series of metric_a grouped by label "g"'},{template:"topk(10,sum by(g) (metric_a{}))",description:"Top 10 of the series of metric_a grouped and summed by the label 'g'"},{template:"avg(avg_over_time(metric_a{}[1h]))",description:"Average of all values inside a 1 hour period"},{template:"quantile by(h) (0.95,metric_a{})",description:'Calculate 95th percentile of metric_a when aggregated by the label "h"'},{template:"avg by(g) (metric_a{} > 99)",description:'Taking all series of metric_a with value greater than 99, group by label "g" and find the average of each group'},{template:"sum(metric_a{}) / 99",description:"Sum of all series of metric_a divided by 99"},{template:"count(sum by(g) (metric_a{}))",description:'Number of series of metric_a grouped by the label "g"'},{template:"max(max_over_time(metric_a{}[1h]))",description:"Find the max value of all series of metric_a in a 1 hour period"}];function Mx(e,t,r){return{query:e.template.replace("metric_a",t).replace("{}",r),explanation:e.description.replace("metric_a",t)}}var Fx=Object.defineProperty,Bx=Object.defineProperties,qx=Object.getOwnPropertyDescriptors,Qx=Object.getOwnPropertySymbols,Vx=Object.prototype.hasOwnProperty,Wx=Object.prototype.propertyIsEnumerable,zx=(e,t,r)=>t in e?Fx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ux=(e,t)=>{for(var r in t||(t={}))Vx.call(t,r)&&zx(e,r,t[r]);if(Qx)for(var r of Qx(t))Wx.call(t,r)&&zx(e,r,t[r]);return e},Gx=(e,t)=>Bx(e,qx(t));const Hx="gpt-3.5-turbo-1106";async function Xx(e,t,r,n,a,i){const o=function(e,t,r){var n,a;let i="",o="";const s=jr(e);return r.languageProvider.metricsMetadata&&(o=null!=(n=da(t,r.languageProvider.metricsMetadata))?n:"",i=null!=(a=ua(t,r.languageProvider.metricsMetadata))?a:""),[{role:"system",content:'You are an expert in Prometheus, the event monitoring and alerting application.\n\nYou are given relevant PromQL documentation, a type and description for a Prometheus metric, and a PromQL query on that metric. Using the provided information for reference, please explain what the output of a given query is in 1 sentences. Do not walk through what the functions do separately, make your answer concise. \n\nInput will be in the form:\n\n\nPromQL Documentation:\n<PromQL documentation>\n\nPromQL Metrics Metadata:\n<metric_name>(<metric type of the metric queried>): <description of what the metric means>\n\nPromQL Expression: \n<PromQL query>\n\nExamples of input and output\n----------\nPromQL Documentation:\nA counter is a cumulative metric that represents a single monotonically increasing counter whose value can only increase or be reset to zero on restart. For example, you can use a counter to represent the number of requests served, tasks completed, or errors.\ntopk (largest k elements by sample value)\nsum (calculate sum over dimensions)\nrate(v range-vector) calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. \n\nPromQL Metrics Metadata:\ntraces_exporter_sent_spans(counter): Number of spans successfully sent to destination.\n\nPromQL Expression:\ntopk(3, sum by(cluster) (rate(traces_exporter_sent_spans{exporter="otlp"}[5m])))\n\nThis query is trying to answer the question:\nWhat is the top 3 clusters that have successfully sent the most number of spans to the destination?\n'},{role:"user",content:jx({documentation:s.query.operations.map((e=>{const t=Or.getOperationDef(e.id);if(!t)return"";const r=t.renderer(e,t,"<expr>"),n=t.explainHandler?t.explainHandler(e,t):t.documentation;return n?`### ${r}:\n${n}`:""})).filter((e=>""!==e)).join("\n"),metricName:t,metricType:o,metricMetadata:i,query:e})}]}(n.suggestions[a].query,r.metric,i),s=n;return Tx({model:Hx,messages:o,temperature:0}).pipe(Ex()).subscribe((r=>{const n=s.suggestions.map(((e,t)=>a===t?{query:s.suggestions[a].query,explanation:r}:e)),i={idx:t,interaction:Gx(Ux({},s),{suggestions:n,explanationIsLoading:!1})};e(fO(i))}))}function Yx(e,t){for(const r of e)if(!t.includes(r))return!1;return!0}async function Kx(e,t,r,n,a,i){var o;const s=i||kx(gx.Historical);let l="";if(a.languageProvider.metricsMetadata||await a.languageProvider.loadMetricsMetadata(),a.languageProvider.metricsMetadata){const e=(c=r.metric).endsWith("_bucket")||c.endsWith("_count")||c.endsWith("_sum")?c.slice(0,c.lastIndexOf("_")):c;l=null!=(o=da(e,a.languageProvider.metricsMetadata))?o:""}var c,u;if(""===l&&(l=function(e,t){if(new Set(["up","scrape_duration_seconds","scrape_samples_post_metric_relabeling","scrape_series_added","scrape_samples_scraped","ALERTS","ALERTS_FOR_STATE"]).has(e))return"counter";if(e.startsWith(":"))return"gauge";if(e.endsWith("_info"))return"counter";if(e.endsWith("_created")||e.endsWith("_total"))return"counter";const r=e.lastIndexOf("_");if(r<0)return"gauge";const[n,a]=[e.slice(0,r),e.slice(r+1)];if(["bucket","count","sum"].includes(a)){let e=[`${n}_bucket`,`${n}_count`,`${n}_sum`,n];return Yx(e,t)?"histogram,summary":(e=[`${n}_bucket`,`${n}_count`,`${n}_sum`],Yx(e,t)?"histogram":(e=[`${n}_sum`,`${n}_count`,n],Yx(e,t)?"summary":"counter"))}return Yx([`${e}_sum`,`${e}_count`,e],t)?t.includes(`${e}_bucket`)?"histogram,summary":"summary":"gauge"}(r.metric,a.languageProvider.metrics)),s.suggestionType===gx.Historical)return new Promise((n=>setTimeout((()=>{const a=function(e,t,r){let n=[];switch(t){case"counter":n=n.concat(Ax.map((t=>Mx(t,e,r))).sort((()=>Math.random()-.5)).slice(0,2)),n=n.concat(Rx.map((t=>Mx(t,e,r))).sort((()=>Math.random()-.5)).slice(0,3));break;case"gauge":n=n.concat(Lx.map((t=>Mx(t,e,r))).sort((()=>Math.random()-.5)).slice(0,2)),n=n.concat(Rx.map((t=>Mx(t,e,r))).sort((()=>Math.random()-.5)).slice(0,3));break;case"histogram":n=n.concat(Nx.map((t=>Mx(t,e,r))).sort((()=>Math.random()-.5)).slice(0,2)),n=n.concat(Rx.map((t=>Mx(t,e,r))).sort((()=>Math.random()-.5)).slice(0,3));break;default:n=n.concat(Rx.map((t=>Mx(t,e,r))).sort((()=>Math.random()-.5)).slice(0,5))}return n}(r.metric,l,Or.renderLabels(r.labels)),i={idx:t,interaction:Gx(Ux({},s),{suggestions:a,isLoading:!1})};e(fO(i)),n()}),1e3)));{const o=await a.languageProvider.fetchLabelsWithMatch(r.metric);let c={metric:r.metric,labels:Object.keys(o).filter((e=>"__name__"!==e)).join(",")},d=[];(null==i?void 0:i.suggestionType)===gx.AI&&(c=Gx(Ux({},c),{prompt:i.prompt}),d=await async function(e){return(await(0,j.getBackendSrv)().post("/api/plugins/grafana-llm-app/resources/vector/search",e,{headers:{"Content-Type":"application/json"}})).results}({query:i.prompt,collection:"grafana.promql.templates",topK:5,filter:{$or:(u=l.split(",").concat(["*"]),u.map((e=>({metric_type:{$eq:e}}))))}}),(0,j.reportInteraction)("grafana_prometheus_promqail_vector_results",{metric:r.metric,prompt:i.prompt,results:d}));const p=d.map((e=>`${e.payload.promql} | ${e.payload.description} (score=${(100*e.score).toFixed(1)})`)).join("\n"),h=function({promql:e,question:t,metricType:r,labels:n,templates:a}){return[{role:"system",content:"You are a Prometheus Query Language (PromQL) expert assistant inside Grafana.\nWhen the user asks a question, respond with a valid PromQL query and only the query.\n\nTo help you answer the question, you will receive:\n- List of potentially relevant PromQL templates with descriptions, ranked by semantic search score\n- Prometheus metric\n- Metric type\n- Available Prometheus metric labels\n- User question\n\nPolicy:\n- Do not invent labels names, you can only use the available labels\n- For rate queries, use the $__rate_interval variable"},{role:"user",content:$x({promql:e,question:t,metricType:r,labels:n,templates:a})}]}({promql:r.metric,question:i?i.prompt:"",metricType:l,labels:n.join(", "),templates:p});return Tx({model:Hx,messages:h,temperature:.5}).pipe(Ex()).subscribe((r=>{const n={idx:t,interaction:Gx(Ux({},s),{suggestions:[{query:r,explanation:""}],isLoading:!1})};e(fO(n))}))}}var Jx=Object.defineProperty,Zx=Object.defineProperties,eO=Object.getOwnPropertyDescriptors,tO=Object.getOwnPropertySymbols,rO=Object.prototype.hasOwnProperty,nO=Object.prototype.propertyIsEnumerable,aO=(e,t,r)=>t in e?Jx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,iO=(e,t)=>{for(var r in t||(t={}))rO.call(t,r)&&aO(e,r,t[r]);if(tO)for(var r of tO(t))nO.call(t,r)&&aO(e,r,t[r]);return e},oO=(e,t)=>Zx(e,eO(t));const sO="SKIP_STARTING_MESSAGE",lO=t=>{const{query:r,closeDrawer:n,onChange:a,datasource:i}=t,o=e.store.getBool(sO,!1),[s,l]=(0,mt.useReducer)(dO.reducer,Dx(r,!o)),[c,u]=(0,mt.useState)([]),d=s.interactions.reduce(((e,t)=>e+t.suggestions.length),0),p=(0,mt.useRef)(null);(0,mt.useEffect)((()=>{var e;p&&(null==(e=null==p?void 0:p.current)||e.scrollIntoView({behavior:"smooth"}))}),[s.interactions.length,d]),(0,mt.useEffect)((()=>{(async()=>{let e=await i.languageProvider.fetchLabelsWithMatch(r.metric);u(Object.keys(e))})()}),[r,i]);const h=(0,bt.useTheme2)(),m=cO(h);return(0,ht.jsxs)("div",{className:m.containerPadding,children:[(0,ht.jsxs)("div",{className:m.header,children:[(0,ht.jsx)("h3",{children:"Query advisor"}),(0,ht.jsx)(bt.Button,{icon:"times",fill:"text",variant:"secondary",onClick:n})]}),(0,ht.jsxs)("div",{children:[(0,ht.jsxs)("div",{className:m.iconSection,children:[(0,ht.jsx)("img",{src:vx,alt:"AI logo color"})," Assistant"]}),s.showStartingMessage?(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("div",{className:m.dataList,children:(0,ht.jsxs)("ol",{children:[(0,ht.jsx)("li",{className:m.textPadding,children:"Query Advisor suggests queries based on a metric and requests you type in."}),(0,ht.jsx)("li",{className:m.textPadding,children:"Query Advisor sends Prometheus metrics, labels and metadata to the LLM provider you've configured. Be sure to align its usage with your company's internal policies."}),(0,ht.jsx)("li",{className:m.textPadding,children:"An AI-suggested query may not fully answer your question. Always take a moment to understand a query before you use it."})]})}),(0,ht.jsx)(bt.Alert,{title:"",severity:"info",className:(0,Nr.cx)(m.textPadding,m.noMargin),children:"Query Advisor is currently in Private Preview. Feedback is appreciated and can be provided on explanations and suggestions."},"promqail-llm-app"),(0,ht.jsx)("div",{className:m.textPadding,children:(0,ht.jsx)(bt.Checkbox,{checked:s.indicateCheckbox,value:s.indicateCheckbox,onChange:()=>{const t=e.store.getBool(sO,!1);e.store.set(sO,!t),l(hO(!t))},label:"Don't show this message again"})}),(0,ht.jsx)("div",{className:m.rightButtonsWrapper,children:(0,ht.jsxs)("div",{className:m.rightButtons,children:[(0,ht.jsx)(bt.Button,{className:m.leftButton,fill:"outline",variant:"secondary",onClick:n,children:"Cancel"}),(0,ht.jsx)(bt.Button,{fill:"solid",variant:"primary",onClick:()=>l(pO(!1)),"data-testid":uO.securityInfoButton,children:"Continue"})]})})]}):(0,ht.jsxs)("div",{className:m.bodySmall,children:[(0,ht.jsx)("div",{className:m.textPadding,children:"Here is the metric you have selected:"}),(0,ht.jsx)("div",{className:m.infoContainerWrapper,children:(0,ht.jsx)("div",{className:m.infoContainer,children:(0,ht.jsx)("table",{className:m.metricTable,children:(0,ht.jsxs)("tbody",{children:[(0,ht.jsxs)("tr",{children:[(0,ht.jsx)("td",{className:m.metricTableName,children:"metric"}),(0,ht.jsx)("td",{className:m.metricTableValue,children:s.query.metric}),(0,ht.jsx)("td",{children:(0,ht.jsx)(bt.Button,{fill:"outline",variant:"secondary",onClick:n,className:m.metricTableButton,size:"sm",children:"Choose new metric"})})]}),s.query.labels.map(((e,t)=>{const r=0===t?"labels":"";return(0,ht.jsxs)("tr",{children:[(0,ht.jsx)("td",{children:r}),(0,ht.jsx)("td",{className:m.metricTableValue,children:`${e.label}${e.op}${e.value}`}),(0,ht.jsx)("td",{children:" "})]},`${e.label}-${t}`)}))]})})})}),!s.askForQueryHelp&&0===s.interactions.length&&(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("div",{className:m.queryQuestion,children:"Do you know what you want to query?"}),(0,ht.jsx)("div",{className:m.rightButtonsWrapper,children:(0,ht.jsxs)("div",{className:m.rightButtons,children:[(0,ht.jsx)(bt.Button,{className:m.leftButton,fill:"solid",variant:"secondary","data-testid":uO.clickForHistorical,onClick:()=>{const e=gx.Historical;l(mO({suggestionType:e,isLoading:!0})),(0,j.reportInteraction)("grafana_prometheus_promqail_know_what_you_want_to_query",{promVisualQuery:r,doYouKnow:"no"}),Kx(l,0,r,c,i)},children:"No"}),(0,ht.jsx)(bt.Button,{fill:"solid",variant:"primary","data-testid":uO.clickForAi,onClick:()=>{(0,j.reportInteraction)("grafana_prometheus_promqail_know_what_you_want_to_query",{promVisualQuery:r,doYouKnow:"yes"});const e=gx.AI;l(mO({suggestionType:e,isLoading:!1}))},children:"Yes"})]})})]}),s.interactions.map(((e,t)=>{var o,s;return(0,ht.jsx)("div",{children:e.suggestionType===gx.AI?(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)("div",{className:m.textPadding,children:"What kind of data do you want to see with your metric?"}),(0,ht.jsxs)("div",{className:(0,Nr.cx)(m.secondaryText,m.bottomMargin),children:[(0,ht.jsx)("div",{children:"You do not need to enter in a metric or a label again in the prompt."}),(0,ht.jsx)("div",{children:"Example: I want to monitor request latency, not errors."})]}),(0,ht.jsx)("div",{className:m.inputPadding,children:(0,ht.jsx)(bt.Input,{value:e.prompt,spellCheck:!1,placeholder:"Enter prompt",disabled:e.suggestions.length>0,onChange:r=>{const n=r.currentTarget.value,a={idx:t,interaction:oO(iO({},e),{prompt:n})};l(fO(a))}})}),0===e.suggestions.length?e.isLoading?(0,ht.jsx)(ht.Fragment,{children:(0,ht.jsxs)("div",{className:m.loadingMessageContainer,children:["Waiting for OpenAI ",(0,ht.jsx)(bt.Spinner,{className:m.floatRight})]})}):(0,ht.jsx)(ht.Fragment,{children:(0,ht.jsx)("div",{className:m.rightButtonsWrapper,children:(0,ht.jsxs)("div",{className:m.rightButtons,children:[(0,ht.jsx)(bt.Button,{className:m.leftButton,fill:"outline",variant:"secondary",onClick:n,children:"Cancel"}),(0,ht.jsx)(bt.Button,{className:m.leftButton,fill:"outline",variant:"secondary",onClick:()=>{const n=oO(iO({},e),{suggestionType:gx.Historical,isLoading:!0}),a={idx:t,interaction:n};(0,j.reportInteraction)("grafana_prometheus_promqail_suggest_query_instead",{promVisualQuery:r}),l(fO(a)),Kx(l,t,r,c,i,n)},children:"Suggest queries instead"}),(0,ht.jsx)(bt.Button,{fill:"solid",variant:"primary","data-testid":uO.submitPrompt+t,onClick:()=>{const n=oO(iO({},e),{isLoading:!0}),a={idx:t,interaction:n};(0,j.reportInteraction)("grafana_prometheus_promqail_prompt_submitted",{promVisualQuery:r,prompt:e.prompt}),l(fO(a)),Kx(l,t,r,c,i,e)},children:"Submit"})]})})}):(0,ht.jsx)(bx,{suggestionType:gx.AI,querySuggestions:e.suggestions,closeDrawer:n,nextInteraction:()=>{const e=gx.AI;l(mO({suggestionType:e,isLoading:!1}))},queryExplain:n=>""===e.suggestions[n].explanation?Xx(l,t,r,e,n,i):e.suggestions[n].explanation,onChange:a,prompt:null!=(o=e.prompt)?o:""})]}):e.isLoading?(0,ht.jsx)(ht.Fragment,{children:(0,ht.jsxs)("div",{className:m.loadingMessageContainer,children:["Waiting for OpenAI ",(0,ht.jsx)(bt.Spinner,{className:m.floatRight})]})}):(0,ht.jsx)(bx,{suggestionType:gx.Historical,querySuggestions:e.suggestions,closeDrawer:n,nextInteraction:()=>{const e=gx.AI;l(mO({suggestionType:e,isLoading:!1}))},queryExplain:n=>""===e.suggestions[n].explanation?Xx(l,t,r,e,n,i):e.suggestions[n].explanation,onChange:a,prompt:null!=(s=e.prompt)?s:""})},t)}))]})]}),(0,ht.jsx)("div",{ref:p})]})},cO=e=>({sectionPadding:(0,Nr.css)({padding:"20px"}),header:(0,Nr.css)({display:"flex",button:{marginLeft:"auto"}}),iconSection:(0,Nr.css)({padding:"0 0 10px 0",color:`${e.colors.text.secondary}`,img:{paddingRight:"4px"}}),rightButtonsWrapper:(0,Nr.css)({display:"flex"}),rightButtons:(0,Nr.css)({marginLeft:"auto"}),leftButton:(0,Nr.css)({marginRight:"10px"}),dataList:(0,Nr.css)({padding:"0px 28px 0px 28px"}),textPadding:(0,Nr.css)({paddingBottom:"12px"}),containerPadding:(0,Nr.css)({padding:"28px"}),infoContainer:(0,Nr.css)({border:`${e.colors.border.strong}`,padding:"16px",backgroundColor:`${e.colors.background.secondary}`,borderRadius:"8px",borderBottomLeftRadius:0}),infoContainerWrapper:(0,Nr.css)({paddingBottom:"24px"}),metricTable:(0,Nr.css)({width:"100%"}),metricTableName:(0,Nr.css)({width:"15%"}),metricTableValue:(0,Nr.css)({fontFamily:`${e.typography.fontFamilyMonospace}`,fontSize:`${e.typography.bodySmall.fontSize}`,overflow:"scroll",textWrap:"nowrap",maxWidth:"150px",width:"60%",maskImage:"linear-gradient(to right, rgba(0, 0, 0, 1) 90%, rgba(0, 0, 0, 0))"}),metricTableButton:(0,Nr.css)({float:"right"}),queryQuestion:(0,Nr.css)({textAlign:"end",padding:"8px 0"}),secondaryText:(0,Nr.css)({color:`${e.colors.text.secondary}`}),loadingMessageContainer:(0,Nr.css)({border:`${e.colors.border.strong}`,padding:"16px",backgroundColor:`${e.colors.background.secondary}`,marginBottom:"20px",borderRadius:"8px",color:`${e.colors.text.secondary}`,fontStyle:"italic"}),floatRight:(0,Nr.css)({float:"right"}),codeText:(0,Nr.css)({fontFamily:`${e.typography.fontFamilyMonospace}`,fontSize:`${e.typography.bodySmall.fontSize}`}),bodySmall:(0,Nr.css)({fontSize:`${e.typography.bodySmall.fontSize}`}),explainPadding:(0,Nr.css)({paddingLeft:"26px"}),bottomMargin:(0,Nr.css)({marginBottom:"20px"}),topPadding:(0,Nr.css)({paddingTop:"22px"}),doc:(0,Nr.css)({textDecoration:"underline"}),afterButtons:(0,Nr.css)({display:"flex",justifyContent:"flex-end"}),feedbackStyle:(0,Nr.css)({margin:0,textAlign:"right",paddingTop:"22px",paddingBottom:"22px"}),nextInteractionHeight:(0,Nr.css)({height:"88px"}),center:(0,Nr.css)({display:"flex",alignItems:"center",justifyContent:"center"}),inputPadding:(0,Nr.css)({paddingBottom:"24px"}),querySuggestion:(0,Nr.css)({display:"flex",flexWrap:"nowrap"}),longCode:(0,Nr.css)({width:"90%",textWrap:"nowrap",overflow:"scroll",maskImage:"linear-gradient(to right, rgba(0, 0, 0, 1) 90%, rgba(0, 0, 0, 0))",div:{display:"inline-block"}}),useButton:(0,Nr.css)({marginLeft:"auto"}),suggestionFeedback:(0,Nr.css)({textAlign:"left"}),feedbackQuestion:(0,Nr.css)({display:"flex",padding:"8px 0px",h6:{marginBottom:0},i:{marginTop:"1px"}}),explationTextInput:(0,Nr.css)({paddingLeft:"24px"}),submitFeedback:(0,Nr.css)({padding:"16px 0"}),noMargin:(0,Nr.css)({margin:0}),enableButtonTooltip:(0,Nr.css)({padding:8}),enableButtonTooltipText:(0,Nr.css)({color:`${e.colors.text.secondary}`,ul:{marginLeft:16}}),link:(0,Nr.css)({color:`${e.colors.text.link} !important`})}),uO={promQail:"prom-qail",securityInfoButton:"security-info-button",clickForHistorical:"click-for-historical",clickForAi:"click-for-ai",submitPrompt:"submit-prompt",refinePrompt:"refine-prompt"},dO=bi({name:"metrics-modal-state",initialState:Dx(),reducers:{showExplainer:(e,t)=>{e.showExplainer=t.payload},showStartingMessage:(e,t)=>{e.showStartingMessage=t.payload},indicateCheckbox:(e,t)=>{e.indicateCheckbox=t.payload},askForQueryHelp:(e,t)=>{e.askForQueryHelp=t.payload},addInteraction:(e,t)=>{const r=kx(t.payload.suggestionType,t.payload.isLoading),n=e.interactions;e.interactions=n.concat([r])},updateInteraction:(e,t)=>{const r=t.payload.idx,n=t.payload.interaction;e.interactions=e.interactions.map(((e,t)=>t===r?n:e))}}}),{showStartingMessage:pO,indicateCheckbox:hO,addInteraction:mO,updateInteraction:fO}=dO.actions;function gO(e){const{llmAppEnabled:t,metric:r,setShowDrawer:n}=e,a=!t,i=!r,o=(0,bt.useTheme2)(),s=cO(o),l=()=>(0,ht.jsxs)(bt.Button,{variant:"secondary",onClick:()=>{(0,j.reportInteraction)("grafana_prometheus_promqail_ai_button_clicked",{metric:r}),n(!0)},disabled:!r||!t,"data-testid":Tn.components.DataSource.Prometheus.queryEditor.builder.queryAdvisor,children:[(0,ht.jsx)("img",{height:16,src:vx,alt:"AI logo black and white"}),"Â ","Get query suggestions"]}),c=(0,ht.jsx)(bt.Tooltip,{content:"First, select a metric.",placement:"bottom-end",children:l()}),u=(0,ht.jsx)(bt.Tooltip,{interactive:!0,placement:"auto-end",content:(0,ht.jsxs)("div",{className:s.enableButtonTooltip,children:[(0,ht.jsx)("h6",{children:"Query Advisor is disabled"}),(0,ht.jsx)("div",{className:s.enableButtonTooltipText,children:"To enable Query Advisor you must:"}),(0,ht.jsx)("div",{className:s.enableButtonTooltipText,children:(0,ht.jsxs)("ul",{children:[(0,ht.jsx)("li",{children:(0,ht.jsx)("a",{href:"https://grafana.com/docs/grafana-cloud/alerting-and-irm/machine-learning/llm-plugin/",target:"_blank",rel:"noreferrer noopener",className:s.link,children:"Install and enable the LLM plugin"})}),(0,ht.jsx)("li",{children:"Select a metric"})]})})]}),children:l()});return a?u:i?c:l()}const bO=(0,mt.memo)((e=>{const{datasource:t,query:r,onChange:n,onRunQuery:a,data:i,showExplain:o}=e,[s,l]=(0,mt.useState)(),[c,u]=(0,mt.useState)(!1),[d,p]=(0,mt.useState)(!1),{prometheusPromQAIL:h}=j.config.featureToggles,m={grammar:ut,name:"promql"},f=t.getInitHints();return(0,mt.useEffect)((()=>{h&&async function(){const e=await async function(){const e=(async()=>{try{if(!(await(0,j.getBackendSrv)().get(`${wx}/settings`,void 0,void 0,{showSuccessAlert:!1,showErrorAlert:!1})).enabled)return{configured:!1,ok:!1,error:"The Grafana LLM plugin is not enabled."}}catch(e){return(0,j.logDebug)(String(e)),(0,j.logDebug)("Failed to check if OpenAI is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored."),Cx=!0,{configured:!1,ok:!1,error:"The Grafana LLM plugin is not installed."}}let e;try{e=await(0,j.getBackendSrv)().get(`${wx}/health`,void 0,void 0,{showSuccessAlert:!1,showErrorAlert:!1})}catch(e){return Cx||((0,j.logDebug)(String(e)),(0,j.logDebug)("Failed to check if OpenAI is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored."),Cx=!0),{configured:!1,ok:!1,error:"The Grafana LLM plugin is not installed."}}const{details:t}=e;return void 0!==(null==t?void 0:t.version)&&_x(t.version),void 0===(null==t?void 0:t.openAI)?{configured:!1,ok:!1,error:"The Grafana LLM plugin is outdated; please update it."}:"boolean"==typeof t.openAI?{configured:t.openAI,ok:t.openAI}:t.openAI})().then((e=>e.ok)),t=(async()=>{try{if(!(await(0,j.getBackendSrv)().get(`${wx}/settings`,void 0,void 0,{showSuccessAlert:!1,showErrorAlert:!1})).enabled)return{enabled:!1,ok:!1,error:"The Grafana LLM plugin is not enabled."}}catch(e){return(0,j.logDebug)(String(e)),(0,j.logDebug)("Failed to check if the vector service is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored."),Ix=!0,{enabled:!1,ok:!1,error:"The Grafana LLM plugin is not installed."}}let e;try{e=await(0,j.getBackendSrv)().get(`${wx}/health`,void 0,void 0,{showSuccessAlert:!1,showErrorAlert:!1})}catch(e){return Ix||((0,j.logDebug)(String(e)),(0,j.logDebug)("Failed to check if vector service is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored."),Ix=!0),{enabled:!1,ok:!1,error:"The Grafana LLM plugin is not installed."}}const{details:t}=e;return void 0!==(null==t?void 0:t.version)&&_x(t.version),void 0===(null==t?void 0:t.vector)?{enabled:!1,ok:!1,error:"The Grafana LLM plugin is outdated; please update it."}:"boolean"==typeof t.vector?{enabled:t.vector,ok:t.vector}:t.vector})().then((e=>e.ok));return Promise.all([e,t]).then((e=>e.every((e=>e))))}();p(e)}()}),[h]),(0,ht.jsxs)(ht.Fragment,{children:[h&&c&&(0,ht.jsx)(bt.Drawer,{closeOnMaskClick:!1,onClose:()=>u(!1),children:(0,ht.jsx)(lO,{query:r,closeDrawer:()=>u(!1),onChange:n,datasource:t})}),(0,ht.jsx)(Vr,{children:(0,ht.jsx)(Yu,{query:r,onChange:n,datasource:t})}),f.length?(0,ht.jsx)("div",{className:(0,Nr.css)({flexBasis:"100%"}),children:(0,ht.jsxs)("div",{className:"text-warning",children:[f[0].label," ",f[0].fix?(0,ht.jsx)("button",{type:"button",className:"text-warning",children:f[0].fix.label}):null]})}):null,o&&(0,ht.jsx)(Ml,{stepNumber:1,title:(0,ht.jsx)(Bl,{query:`${r.metric} ${Or.renderLabels(r.labels)}`,lang:m}),children:Vl}),(0,ht.jsxs)($y,{children:[(0,ht.jsx)(Iy,{queryModeller:Or,datasource:t,query:r,onChange:n,onRunQuery:a,highlightedOp:s}),h&&(0,ht.jsx)("div",{className:(0,Nr.css)({padding:"0 0 0 6px"}),children:(0,ht.jsx)(gO,{llmAppEnabled:d,metric:r.metric,setShowDrawer:u})}),(0,ht.jsx)("div",{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.builder.hints,children:(0,ht.jsx)(ky,{datasource:t,query:r,onChange:n,data:i,queryModeller:Or,buildVisualQueryFromString:jr})})]}),o&&(0,ht.jsx)(Ql,{lang:m,query:r,stepNumber:2,queryModeller:Or,onMouseEnter:e=>l(e),onMouseLeave:()=>l(void 0)}),r.binaryQueries&&r.binaryQueries.length>0&&(0,ht.jsx)(rx,{query:r,datasource:t,onChange:n,onRunQuery:a,showExplain:o})]})}));function vO({query:e}){return e?(0,ht.jsx)(Vr,{children:(0,ht.jsx)(va,{children:(0,ht.jsx)(Bl,{query:e,lang:{grammar:ut,name:"promql"}})})}):null}bO.displayName="PromQueryBuilder";var yO=Object.defineProperty,xO=Object.defineProperties,OO=Object.getOwnPropertyDescriptors,wO=Object.getOwnPropertySymbols,SO=Object.prototype.hasOwnProperty,_O=Object.prototype.propertyIsEnumerable,PO=(e,t,r)=>t in e?yO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,EO=(e,t)=>{for(var r in t||(t={}))SO.call(t,r)&&PO(e,r,t[r]);if(wO)for(var r of wO(t))_O.call(t,r)&&PO(e,r,t[r]);return e},TO=(e,t)=>xO(e,OO(t));const CO=j.config.featureToggles.prometheusMetricEncyclopedia;function IO(e){const{query:t,onChange:r,onRunQuery:n,datasource:a,data:i,showExplain:o}=e,[s,l]=(0,mt.useReducer)(jO.reducer,{expr:t.expr});return(0,mt.useEffect)((()=>{var e,r,n,a;l(DO(t.expr)),CO&&l(kO({useBackend:null!=(e=t.useBackend)&&e,disableTextWrap:null!=(r=t.disableTextWrap)&&r,fullMetaSearch:null!=(n=t.fullMetaSearch)&&n,includeNullMetadata:null==(a=t.includeNullMetadata)||a}))}),[t]),(0,mt.useEffect)((()=>{a.languageProvider.start(null==i?void 0:i.timeRange)}),[null==i?void 0:i.timeRange,a.languageProvider]),s.visQuery?(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bO,{query:s.visQuery,datasource:a,onChange:t=>{const n=Or.renderQuery(t);if(l($O({visQuery:t,expr:n})),CO){const a=function(e){var t,r,n,a;return{useBackend:null!=(t=null==e?void 0:e.useBackend)&&t,disableTextWrap:null!=(r=null==e?void 0:e.disableTextWrap)&&r,fullMetaSearch:null!=(n=null==e?void 0:e.fullMetaSearch)&&n,includeNullMetadata:null!=(a=e.includeNullMetadata)&&a}}(t);r(EO(TO(EO({},e.query),{expr:n}),a))}else r(TO(EO({},e.query),{expr:n}))},onRunQuery:n,data:i,showExplain:o}),(0,ht.jsx)(vO,{query:t.expr})]}):null}const jO=bi({name:"prom-builder-container",initialState:{expr:""},reducers:{visualQueryChange:(e,t)=>{e.expr=t.payload.expr,e.visQuery=t.payload.visQuery},exprChanged:(e,t)=>{var r;if(!e.visQuery||e.expr!==t.payload){e.expr=t.payload;const n=jr(null!=(r=t.payload)?r:"");e.visQuery=n.query}},setMetricsModalSettings:(e,t)=>{e.visQuery&&CO&&(e.visQuery.useBackend=t.payload.useBackend,e.visQuery.disableTextWrap=t.payload.disableTextWrap,e.visQuery.fullMetaSearch=t.payload.fullMetaSearch,e.visQuery.includeNullMetadata=t.payload.includeNullMetadata)}}}),{visualQueryChange:$O,exprChanged:DO,setMetricsModalSettings:kO}=jO.actions;var RO=Object.getOwnPropertySymbols,AO=Object.prototype.hasOwnProperty,NO=Object.prototype.propertyIsEnumerable;function LO(e){var t=e,{datasource:r,onChange:n,query:a}=t,i=((e,t)=>{var r={};for(var n in e)AO.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&RO)for(var n of RO(e))t.indexOf(n)<0&&NO.call(e,n)&&(r[n]=e[n]);return r})(t,["datasource","onChange","query"]);const[o,s]=(0,mt.useState)(null),l=(0,bt.useStyles2)(MO),c=Xg(o);(0,mt.useEffect)((()=>{r.exemplarsAvailable?a.instant&&!a.range?(s("Exemplars are not available for instant queries"),n(!1)):(s(null),c&&!o&&n(!0)):(s("Exemplars for this query are not available"),n(!1))}),[r.exemplarsAvailable,a.instant,a.range,n,c,o]);const u=(0,Nr.cx)({[l.activeIcon]:!!a.exemplar},l.eyeIcon);return(0,ht.jsx)(bt.InlineLabel,{width:"auto","data-testid":i["data-testid"],children:(0,ht.jsx)(bt.Tooltip,{content:null!=o?o:"",children:(0,ht.jsxs)("div",{className:l.iconWrapper,children:["Exemplars",(0,ht.jsx)(bt.IconButton,{name:"eye",tooltip:a.exemplar?"Disable query with exemplars":"Enable query with exemplars",disabled:!!o,className:u,onClick:()=>{n(!a.exemplar)}})]})})})}function MO(e){return{eyeIcon:(0,Nr.css)({marginLeft:e.spacing(2)}),activeIcon:(0,Nr.css)({color:e.colors.primary.main}),iconWrapper:(0,Nr.css)({display:"flex",alignItems:"center"})}}var FO=Object.defineProperty,BO=Object.defineProperties,qO=Object.getOwnPropertyDescriptors,QO=Object.getOwnPropertySymbols,VO=Object.prototype.hasOwnProperty,WO=Object.prototype.propertyIsEnumerable,zO=(e,t,r)=>t in e?FO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,UO=(e,t)=>{for(var r in t||(t={}))VO.call(t,r)&&zO(e,r,t[r]);if(QO)for(var r of QO(t))WO.call(t,r)&&zO(e,r,t[r]);return e},GO=(e,t)=>BO(e,qO(t));function HO(e){const t=[{value:"range",label:"Range",description:"Run query over a range of time"},{value:"instant",label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used'}];return e&&t.push({value:"both",label:"Both",description:"Run an Instant query and a Range query"}),t}function XO(e,t){return r=>{t(GO(UO({},e),"instant"===r?{instant:!0,range:!1,exemplar:!1}:"range"===r?{instant:!1,range:!0}:{instant:!0,range:!0}))}}(0,mt.memo)((({query:e,datasource:r,onChange:n,onRunQuery:a})=>{var i;const o=HO(!0),s=Xg(e),l=(0,bt.useStyles2)(KO),c=(0,mt.useCallback)((r=>{(0,t.isEqual)(e,s)&&r===e.exemplar||n(GO(UO({},e),{exemplar:r}))}),[s,e,n]),u=XO(e,n);return(0,ht.jsxs)("div",{"aria-label":"Prometheus extra field",className:"gf-form-inline","data-testid":YO.extraFieldEditor,children:[(0,ht.jsxs)("div",{"data-testid":YO.queryTypeField,className:(0,Nr.cx)("gf-form",l.queryTypeField,(0,Nr.css)({flexWrap:"nowrap"})),"aria-label":"Query type field",children:[(0,ht.jsx)(bt.InlineFormLabel,{width:"auto",children:"Query type"}),(0,ht.jsx)(bt.RadioButtonGroup,{options:o,value:e.range&&e.instant?"both":e.instant?"instant":"range",onChange:u})]}),(0,ht.jsxs)("div",{"data-testid":YO.stepField,className:(0,Nr.cx)("gf-form",(0,Nr.css)({flexWrap:"nowrap"})),"aria-label":"Step field",children:[(0,ht.jsx)(bt.InlineFormLabel,{width:6,tooltip:"Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: s)",children:"Min step"}),(0,ht.jsx)("input",{type:"text",className:"gf-form-input width-4",placeholder:"auto",onChange:function(t){var r;t.currentTarget.value!==e.interval&&(r=t.currentTarget.value,n(GO(UO({},e),{interval:r})))},onKeyDown:function(e){"Enter"===e.key&&e.shiftKey&&a()},value:null!=(i=e.interval)?i:""})]}),(0,ht.jsx)(LO,{onChange:c,datasource:r,query:e})]})})).displayName="PromExploreExtraField";const YO={extraFieldEditor:"prom-editor-extra-field",stepField:"prom-editor-extra-field-step",queryTypeField:"prom-editor-extra-field-query-type"},KO=e=>({queryTypeField:(0,Nr.css)({marginRight:e.spacing(.5)})});var JO=function(e,t){return"boolean"==typeof t?t:!e};function ZO({title:e,children:t,collapsedInfo:r}){const[n,a]=(o=!1,(0,mt.useReducer)(JO,o)),i=(0,bt.useStyles2)(ew);var o;return(0,ht.jsx)("div",{className:i.wrapper,children:(0,ht.jsx)(bt.Collapse,{className:i.collapse,collapsible:!0,isOpen:n,onToggle:a,label:(0,ht.jsxs)(bt.Stack,{gap:0,children:[(0,ht.jsx)("h6",{className:i.title,children:e}),!n&&(0,ht.jsx)("div",{className:i.description,children:r.map(((e,t)=>(0,ht.jsx)("span",{children:e},t)))})]}),children:(0,ht.jsx)("div",{className:i.body,children:t})})})}const ew=e=>({collapse:(0,Nr.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,Nr.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,Nr.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,Nr.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,Nr.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),tooltip:(0,Nr.css)({marginRight:e.spacing(.25)})}),tw=[{label:"Auto",value:Hn.Auto,description:"Only includes unique labels"},{label:"Verbose",value:Hn.Verbose,description:"All label names and values"},{label:"Custom",value:Hn.Custom,description:"Provide a naming template"}],rw=mt.memo((({legendFormat:e,onChange:t,onRunQuery:r})=>{const n=nw(e),a=(0,mt.useRef)(null);return(0,ht.jsx)(Jr,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname.","data-testid":Tn.components.DataSource.Prometheus.queryEditor.legend,children:(0,ht.jsxs)(ht.Fragment,{children:[n===Hn.Custom&&(0,ht.jsx)(bt.AutoSizeInput,{id:"legendFormat",minWidth:22,placeholder:"auto",defaultValue:e,onCommitChange:n=>{let a=n.currentTarget.value;0===a.length&&(a=Hn.Auto),a!==e&&(t(a),r())},ref:a}),n!==Hn.Custom&&(0,ht.jsx)(bt.Select,{inputId:"legend.mode",isSearchable:!1,placeholder:"Select legend mode",options:tw,width:22,onChange:e=>{switch(e.value){case Hn.Auto:t(Hn.Auto);break;case Hn.Custom:t("{{label_name}}"),setTimeout((()=>{var e,t;null==(e=a.current)||e.focus(),null==(t=a.current)||t.setSelectionRange(2,12,"forward")}),10);break;case Hn.Verbose:t("")}r()},value:tw.find((e=>e.value===n))})]})})}));function nw(e){return e===Hn.Auto?Hn.Auto:null==e||""===e?Hn.Verbose:Hn.Custom}rw.displayName="PromQueryLegendEditor";var aw=Object.defineProperty,iw=Object.defineProperties,ow=Object.getOwnPropertyDescriptors,sw=Object.getOwnPropertySymbols,lw=Object.prototype.hasOwnProperty,cw=Object.prototype.propertyIsEnumerable,uw=(e,t,r)=>t in e?aw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dw=(e,t)=>{for(var r in t||(t={}))lw.call(t,r)&&uw(e,r,t[r]);if(sw)for(var r of sw(t))cw.call(t,r)&&uw(e,r,t[r]);return e},pw=(e,t)=>iw(e,ow(t));const hw=mt.memo((({query:t,app:r,onChange:n,onRunQuery:a})=>{const i=HO(r===e.CoreApp.Explore||r===e.CoreApp.Correlations||r===e.CoreApp.PanelEditor),o=XO(t,n),s=Pw.find((e=>e.value===t.format))||Pw[0],l=function(e){return e.range&&e.instant?"both":e.instant?"instant":"range"}(t),c=i.find((e=>e.value===l)).label;return(0,ht.jsx)(Vr,{children:(0,ht.jsx)("div",{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.options,children:(0,ht.jsxs)(ZO,{title:"Options",collapsedInfo:fw(t,s.label,c,r),children:[(0,ht.jsx)(rw,{legendFormat:t.legendFormat,onChange:e=>n(pw(dw({},t),{legendFormat:e})),onRunQuery:a}),(0,ht.jsx)(Jr,{label:"Min step",tooltip:(0,ht.jsxs)(ht.Fragment,{children:["An additional lower limit for the step parameter of the Prometheus query and for the"," ",(0,ht.jsx)("code",{children:"$__interval"})," and ",(0,ht.jsx)("code",{children:"$__rate_interval"})," variables."]}),children:(0,ht.jsx)(bt.AutoSizeInput,{type:"text","aria-label":"Set lower limit for the step parameter",placeholder:"auto",minWidth:10,onCommitChange:e=>{n(pw(dw({},t),{interval:e.currentTarget.value.trim()})),a()},defaultValue:t.interval,id:Tn.components.DataSource.Prometheus.queryEditor.step})}),(0,ht.jsx)(Jr,{label:"Format",children:(0,ht.jsx)(bt.Select,{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.format,value:s,allowCustomValue:!0,onChange:e=>{n(pw(dw({},t),{format:e.value})),a()},options:Pw})}),(0,ht.jsx)(Jr,{label:"Type","data-testid":Tn.components.DataSource.Prometheus.queryEditor.type,children:(0,ht.jsx)(bt.RadioButtonGroup,{options:i,value:l,onChange:o})}),mw(t,r)&&(0,ht.jsx)(Jr,{label:"Exemplars",children:(0,ht.jsx)(on,{value:t.exemplar||!1,onChange:e=>{const r=e.currentTarget.checked;n(pw(dw({},t),{exemplar:r})),a()},id:Tn.components.DataSource.Prometheus.queryEditor.exemplars})}),t.intervalFactor&&t.intervalFactor>1&&(0,ht.jsx)(Jr,{label:"Resolution",children:(0,ht.jsx)(bt.Select,{"aria-label":"Select resolution",isSearchable:!1,options:Ew,onChange:e=>{n(pw(dw({},t),{intervalFactor:e.value})),a()},value:Ew.find((e=>e.value===t.intervalFactor))})})]})})})}));function mw(t,r){return!(r===e.CoreApp.UnifiedAlerting||!t.range)}function fw(e,t,r,n){var a;const i=[];return i.push(`Legend: ${function(e){var t;const r=nw(e);return r!==Hn.Custom?null==(t=tw.find((e=>e.value===r)))?void 0:t.label:e}(e.legendFormat)}`),i.push(`Format: ${t}`),i.push(`Step: ${null!=(a=e.interval)?a:"auto"}`),i.push(`Type: ${r}`),mw(e,n)&&(e.exemplar?i.push("Exemplars: true"):i.push("Exemplars: false")),i}function gw(e){const[t,r]=(0,mt.useState)("n"),[n,a]=(0,mt.useState)(!1),i=(0,mt.useCallback)((t=>{(function(e){return e.type===Us&&"detail"in e&&"object"==typeof e.detail&&null!==e.detail&&"limit"in e.detail&&"datasourceUid"in e.detail})(t)&&t.detail.datasourceUid===e.datasourceUid&&(a(!0),r(t.detail.limit.toString()))}),[e.datasourceUid]);return(0,mt.useEffect)((()=>(addEventListener(Us,i),()=>{removeEventListener(Us,i)})),[i]),Boolean(j.config.featureToggles.prometheusCodeModeMetricNamesSearch)&&e.editorMode===Wd.Code&&n?(0,ht.jsx)("div",{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.code.metricsCountInfo,children:(0,ht.jsxs)(bt.Stack,{direction:"row",gap:1,children:[(0,ht.jsx)(bt.Text,{color:"secondary",element:"p",italic:!0,children:"Autocomplete suggestions limited"}),(0,ht.jsx)(bt.IconButton,{name:"info-circle",tooltip:`The number of metric names exceeds the autocomplete limit. Only the ${t}-most relevant metrics are displayed. You can adjust the threshold in the data source settings.`})]})}):null}hw.displayName="PromQueryBuilderOptions";var bw=Object.defineProperty,vw=Object.defineProperties,yw=Object.getOwnPropertyDescriptors,xw=Object.getOwnPropertySymbols,Ow=Object.prototype.hasOwnProperty,ww=Object.prototype.propertyIsEnumerable,Sw=(e,t,r)=>t in e?bw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_w=(e,t)=>{for(var r in t||(t={}))Ow.call(t,r)&&Sw(e,r,t[r]);if(xw)for(var r of xw(t))ww.call(t,r)&&Sw(e,r,t[r]);return e};const Pw=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Heatmap",value:"heatmap"}],Ew=(0,t.map)([1,2,3,4,5,10],(e=>({value:e,label:"1/"+e}))),Tw=(0,mt.memo)((r=>{const{onChange:n,onRunQuery:a,data:i,app:o,onAddQuery:s,datasource:{defaultEditor:l},queries:c}=r,[u,d]=(0,mt.useState)(!1),[p,h]=(0,mt.useState)(!1),[m,f]=(0,mt.useState)(!1),{flag:g,setFlag:b}=function(t,r=!1){const[n,a]=(0,mt.useState)(function(t,r=!1){const n=e.store.get(t);return void 0===n?r:Boolean(parseInt(n,10))}(t,r));return{flag:n,setFlag:(0,mt.useCallback)((r=>{!function(t,r){e.store.set(t,r?"1":"0")}(t,r),a(r)}),[t])}}("PrometheusQueryEditorExplainDefault"),v=function(t,r,n){let a=t;t.editorMode||(a=dp(up({},t),{editorMode:mp(t.expr,n)})),t.expr||(a=dp(up({},a),{expr:"",legendFormat:Hn.Auto})),null==t.range&&null==t.instant&&(a=dp(up({},a),{range:!0}),r===e.CoreApp.Explore&&(a.instant=!0));const i=t.instant&&t.range;return r===e.CoreApp.UnifiedAlerting&&i&&(a=dp(up({},a),{instant:!1,range:!0})),a}(r.query,o,l),y=v.editorMode,x=(0,mt.useCallback)((e=>{var t;(0,j.reportInteraction)("user_grafana_prometheus_editor_mode_clicked",{newEditor:e,previousEditor:null!=(t=v.editorMode)?t:"",newQuery:!v.expr,app:null!=o?o:""}),e===Wd.Builder&&jr(v.expr||"").errors.length?d(!0):hp(v,e,n)}),[n,v,o]);(0,mt.useEffect)((()=>{f(!1)}),[i]);const O=e=>{(0,t.isEqual)(e,r.query)||f(!0),n(e)};return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.ConfirmModal,{isOpen:u,title:"Parsing error: Switch to the builder mode?",body:"There is a syntax error, or the query structure cannot be visualized when switching to the builder mode. Parts of the query may be lost. ",confirmText:"Continue",onConfirm:()=>{hp(v,Wd.Builder,n),d(!1)},onDismiss:()=>d(!1)}),(0,ht.jsx)(Qd,{isOpen:p,onClose:()=>h(!1),query:v,queries:c,app:o,onChange:n,onAddQuery:s}),(0,ht.jsxs)(Cd,{children:[(0,ht.jsx)(bt.Button,{"data-testid":Tn.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>h((e=>!e)),children:"Kick start your query"}),(0,ht.jsx)("div",{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.explain,children:(0,ht.jsx)(tp,{label:"Explain",value:g,onChange:e=>{b(e.currentTarget.checked)}})}),(0,ht.jsx)(jd,{grow:1}),o!==e.CoreApp.Explore&&o!==e.CoreApp.Correlations&&(0,ht.jsx)(bt.Button,{variant:m?"primary":"secondary",size:"sm",onClick:a,icon:(null==i?void 0:i.state)===e.LoadingState.Loading?"spinner":void 0,disabled:(null==i?void 0:i.state)===e.LoadingState.Loading,children:"Run queries"}),(0,ht.jsx)(gw,{datasourceUid:r.datasource.uid,editorMode:y}),(0,ht.jsx)("div",{"data-testid":Tn.components.DataSource.Prometheus.queryEditor.editorToggle,children:(0,ht.jsx)(Ud,{mode:y,onChange:x})})]}),(0,ht.jsx)(bt.Space,{v:.5}),(0,ht.jsxs)(Qr,{children:[y===Wd.Code&&(0,ht.jsx)(zl,(w=_w({},r),S={query:v,showExplain:g,onChange:O},vw(w,yw(S)))),y===Wd.Builder&&(0,ht.jsx)(IO,{query:v,datasource:r.datasource,onChange:O,onRunQuery:r.onRunQuery,data:i,showExplain:g}),(0,ht.jsx)(hw,{query:v,app:r.app,onChange:n,onRunQuery:a})]})]});var w,S}));function Cw(e){const{datasource:t,query:r,range:n,data:a,onChange:i,onRunQuery:o}=e;return(0,ht.jsx)(Ll,{datasource:t,query:r,onRunQuery:o,onChange:i,history:[],range:n,data:a,"data-testid":Iw.editor})}Tw.displayName="PromQueryEditorSelector";const Iw={editor:"prom-editor-cloud-alerting"};var jw=Object.defineProperty,$w=Object.getOwnPropertySymbols,Dw=Object.prototype.hasOwnProperty,kw=Object.prototype.propertyIsEnumerable,Rw=(e,t,r)=>t in e?jw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Aw=(e,t)=>{for(var r in t||(t={}))Dw.call(t,r)&&Rw(e,r,t[r]);if($w)for(var r of $w(t))kw.call(t,r)&&Rw(e,r,t[r]);return e};const Nw=(0,mt.memo)((function(t){const{app:r}=t;return r===e.CoreApp.CloudAlerting?(0,ht.jsx)(Cw,Aw({},t)):(0,ht.jsx)(Tw,Aw({},t))})),Lw=[{title:"Request Rate",expression:"rate(http_request_total[5m])",label:"Given an HTTP request counter, this query calculates the per-second average request rate over the last 5 minutes."},{title:"95th Percentile of Request Latencies",expression:"histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))",label:"Calculates the 95th percentile of HTTP request rate over 5 minute windows."},{title:"Alerts Firing",expression:'sort_desc(sum(sum_over_time(ALERTS{alertstate="firing"}[24h])) by (alertname))',label:"Sums up the alerts that have been firing over the last 24 hours."},{title:"Step",label:"Defines the graph resolution using a duration format (15s, 1m, 3h, ...). Small steps create high-resolution graphs but can be slow over larger time ranges. Using a longer step lowers the resolution and smooths the graph by producing fewer datapoints. If no step is given the resolution is calculated automatically."}],Mw=e=>({cheatSheetItem:(0,Nr.css)({margin:e.spacing(3,0)}),cheatSheetItemTitle:(0,Nr.css)({fontSize:e.typography.h3.fontSize}),cheatSheetExample:(0,Nr.css)({margin:e.spacing(.5,0),textAlign:"left",border:"none",background:"transparent",display:"block"})}),Fw=["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-south-2","ap-southeast-1","ap-southeast-2","ap-southeast-3","ap-southeast-4","ca-central-1","ca-west-1","cn-north-1","cn-northwest-1","eu-central-1","eu-central-2","eu-north-1","eu-south-1","eu-south-2","eu-west-1","eu-west-2","eu-west-3","il-central-1","me-central-1","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"];var Bw=(e=>(e.Keys="keys",e.Credentials="credentials",e.Default="default",e.EC2IAMRole="ec2_iam_role",e.ARN="arn",e.GrafanaAssumeRole="grafana_assume_role",e))(Bw||{});const qw=[{label:"Workspace IAM Role",value:Bw.EC2IAMRole},{label:"Grafana Assume Role",value:Bw.GrafanaAssumeRole},{label:"AWS SDK Default",value:Bw.Default},{label:"Access & secret key",value:Bw.Keys},{label:"Credentials file",value:Bw.Credentials}],Qw=(0,Nr.css)({maxWidth:"715px"});var Vw=Object.defineProperty,Ww=Object.defineProperties,zw=Object.getOwnPropertyDescriptors,Uw=Object.getOwnPropertySymbols,Gw=Object.prototype.hasOwnProperty,Hw=Object.prototype.propertyIsEnumerable,Xw=(e,t,r)=>t in e?Vw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Yw=(e,t)=>{for(var r in t||(t={}))Gw.call(t,r)&&Xw(e,r,t[r]);if(Uw)for(var r of Uw(t))Hw.call(t,r)&&Xw(e,r,t[r]);return e};const Kw=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:a=!0,kind:i="section",className:o})=>{const{colors:s,typography:l,spacing:c}=(0,bt.useTheme2)(),[u,d]=(0,mt.useState)(!n||a),p=u?"angle-up":"angle-down",h="sub-section"===i,m=`${u?"Collapse":"Expand"} section ${t}`,f={header:(0,Nr.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,Nr.css)({margin:0}),subtitle:(0,Nr.css)({margin:0,fontWeight:l.fontWeightRegular}),descriptionText:(0,Nr.css)((g=Yw({marginTop:c(h?.25:.5),marginBottom:0},l.bodySmall),b={color:s.text.secondary},Ww(g,zw(b)))),content:(0,Nr.css)({marginTop:c(2)})};var g,b;return gt().createElement("div",{className:o},gt().createElement("div",{className:f.header},"section"===i?gt().createElement("h3",{className:f.title},t):gt().createElement("h6",{className:f.subtitle},t),n&&gt().createElement(bt.IconButton,{name:p,onClick:()=>d(!u),type:"button",size:"xl","aria-label":m})),r&&gt().createElement("p",{className:f.descriptionText},r),u&&gt().createElement("div",{className:f.content},e))};var Jw=Object.defineProperty,Zw=Object.defineProperties,eS=Object.getOwnPropertyDescriptors,tS=Object.getOwnPropertySymbols,rS=Object.prototype.hasOwnProperty,nS=Object.prototype.propertyIsEnumerable,aS=(e,t,r)=>t in e?Jw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const iS=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)rS.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&tS)for(var n of tS(e))t.indexOf(n)<0&&nS.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return gt().createElement(Kw,(t=((e,t)=>{for(var r in t||(t={}))rS.call(t,r)&&aS(e,r,t[r]);if(tS)for(var r of tS(t))nS.call(t,r)&&aS(e,r,t[r]);return e})({},a),Zw(t,eS({kind:"section"}))),n)};var oS=Object.defineProperty,sS=Object.defineProperties,lS=Object.getOwnPropertyDescriptors,cS=Object.getOwnPropertySymbols,uS=Object.prototype.hasOwnProperty,dS=Object.prototype.propertyIsEnumerable,pS=(e,t,r)=>t in e?oS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const hS=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)uS.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&cS)for(var n of cS(e))t.indexOf(n)<0&&dS.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return gt().createElement(Kw,(t=((e,t)=>{for(var r in t||(t={}))uS.call(t,r)&&pS(e,r,t[r]);if(cS)for(var r of cS(t))dS.call(t,r)&&pS(e,r,t[r]);return e})({},a),sS(t,lS({kind:"sub-section"}))),n)},mS=["cloudwatch","grafana-athena-datasource"],fS=e=>({value:e,label:e}),gS=e=>"string"==typeof e&&qw.some((t=>t.value===e)),bS=t=>{var r,n,a,i,o,s,l,c,u;const[d,p]=(0,mt.useState)(!1),[h,m]=(0,mt.useState)((t.standardRegions||Fw).map(fS)),{loadRegions:f,onOptionsChange:g,skipHeader:b=!1,skipEndpoint:v=!1,options:y}=t;let x=y.jsonData.profile;void 0===x&&(x=y.database);const O=j.config.featureToggles.awsDatasourcesTempCredentials&&mS.includes(y.type),w=null==(r=j.config.awsAssumeRoleEnabled)||r,S=(0,mt.useMemo)((()=>j.config.awsAllowedAuthProviders.filter((e=>e!==Bw.GrafanaAssumeRole||O)).filter(gS)),[O]),_=qw.find((e=>e.value===y.jsonData.authType));return(0,mt.useEffect)((()=>{!_&&S.length&&g({...y,jsonData:{...y.jsonData,authType:S[0]}})}),[_,y,g,S]),(0,mt.useEffect)((()=>{f&&f().then((e=>m(e.map(fS))))}),[f]),gt().createElement("div",{"data-testid":"connection-config"},gt().createElement(iS,{title:b?"":"Connection Details","data-testid":"connection-config"},gt().createElement(hS,{title:"Authentication"},gt().createElement(bt.Field,{label:"Authentication Provider",description:"Specify which AWS credentials chain to use.",htmlFor:"authProvider"},gt().createElement(bt.Select,{"aria-label":"Authentication Provider",inputId:"authProvider",value:_,options:qw.filter((e=>S.includes(e.value))),defaultValue:y.jsonData.authType,onChange:r=>{(0,e.onUpdateDatasourceJsonDataOptionSelect)(t,"authType")(r)},menuShouldPortal:!0})),"credentials"===y.jsonData.authType&&gt().createElement(bt.Field,{label:"Credentials Profile Name",description:"Credentials profile name, as specified in ~/.aws/credentials, leave blank for default.",htmlFor:"credentialsProfileName"},gt().createElement(bt.Input,{id:"credentialsProfileName",placeholder:"default",value:y.jsonData.profile,onChange:(0,e.onUpdateDatasourceJsonDataOption)(t,"profile")})),"keys"===y.jsonData.authType&&gt().createElement(gt().Fragment,null,gt().createElement(bt.Field,{label:"Access Key ID",htmlFor:"accessKeyId"},(null==(n=t.options.secureJsonFields)?void 0:n.accessKey)?gt().createElement(bt.ButtonGroup,null,gt().createElement(bt.Input,{disabled:!0,placeholder:"Configured",id:"accessKeyId"}),gt().createElement(bt.ToolbarButton,{icon:"edit",tooltip:"Edit Access Key ID",type:"button",onClick:(0,e.onUpdateDatasourceResetOption)(t,"accessKey")})):gt().createElement(bt.Input,{id:"accessKeyId",value:null!=(i=null==(a=y.secureJsonData)?void 0:a.accessKey)?i:"",onChange:(0,e.onUpdateDatasourceSecureJsonDataOption)(t,"accessKey")})),gt().createElement(bt.Field,{label:"Secret Access Key",htmlFor:"secretKey"},(null==(o=t.options.secureJsonFields)?void 0:o.secretKey)?gt().createElement(bt.ButtonGroup,null,gt().createElement(bt.Input,{disabled:!0,placeholder:"Configured"}),gt().createElement(bt.ToolbarButton,{id:"secretKey",icon:"edit",type:"button",tooltip:"Edit Secret Access Key",onClick:(0,e.onUpdateDatasourceResetOption)(t,"secretKey")})):gt().createElement(bt.Input,{id:"secretKey",value:null!=(l=null==(s=y.secureJsonData)?void 0:s.secretKey)?l:"",onChange:(0,e.onUpdateDatasourceSecureJsonDataOption)(t,"secretKey")})))),gt().createElement(hS,{title:"Assume Role"},y.jsonData.authType===Bw.GrafanaAssumeRole&&gt().createElement("div",{className:Qw},gt().createElement(bt.Collapse,{label:"How to create an IAM role for grafana to assume:",collapsible:!0,isOpen:d,onToggle:()=>p(!d)},gt().createElement("ol",null,gt().createElement("li",null,gt().createElement("p",null,"1. Create a new IAM role in the AWS console, and select ",gt().createElement("code",null,"Another AWS account")," as the"," ",gt().createElement("code",null,"Trusted entity"),".")),gt().createElement("li",null,gt().createElement("p",null,"2. Enter the account ID of the Grafana account that has permission to assume this role:",gt().createElement("code",null," 008923505280 ")," and check the ",gt().createElement("code",null,"Require external ID")," box.")),gt().createElement("li",null,gt().createElement("p",null,"3. Enter the following external ID:"," ",gt().createElement("code",null,t.externalId||"External Id is currently unavailable")," and click"," ",gt().createElement("code",null,"Next"),".")),gt().createElement("li",null,gt().createElement("p",null,"4. Add any required permissions you would like Grafana to be able to access on your behalf. For more details on our permissions please"," ",gt().createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/aws-cloudwatch/",target:"_blank",rel:"noreferrer"},"read through our documentation"),".")),gt().createElement("li",null,gt().createElement("p",null,"5. Give the role a name and description, and click ",gt().createElement("code",null,"Create role"),".")),gt().createElement("li",null,gt().createElement("p",null,"6. Copy the ARN of the role you just created and paste it into the ",gt().createElement("code",null,"Assume Role ARN")," ","field below."))))),w&&gt().createElement(gt().Fragment,null,gt().createElement(bt.Field,{htmlFor:"assumeRoleArn",label:"Assume Role ARN",description:"Optional. Specifying the ARN of a role will ensure that the\n                     selected authentication provider is used to assume the role rather than the\n                     credentials directly."},gt().createElement(bt.Input,{id:"assumeRoleArn",placeholder:"arn:aws:iam:*",value:y.jsonData.assumeRoleArn||"",onChange:(0,e.onUpdateDatasourceJsonDataOption)(t,"assumeRoleArn")})),y.jsonData.authType!==Bw.GrafanaAssumeRole&&gt().createElement(bt.Field,{htmlFor:"externalId",label:"External ID",description:"If you are assuming a role in another account, that has been created with an external ID, specify the external ID here."},gt().createElement(bt.Input,{id:"externalId",placeholder:"External ID",value:y.jsonData.externalId||"",onChange:(0,e.onUpdateDatasourceJsonDataOption)(t,"externalId")})))),gt().createElement(hS,{title:"Additional Settings"},!v&&y.jsonData.authType!==Bw.GrafanaAssumeRole&&gt().createElement(bt.Field,{label:"Endpoint",description:"Optionally, specify a custom endpoint for the service",htmlFor:"endpoint"},gt().createElement(bt.Input,{id:"endpoint",placeholder:null!=(c=t.defaultEndpoint)?c:"https://{service}.{region}.amazonaws.com",value:y.jsonData.endpoint||"",onChange:(0,e.onUpdateDatasourceJsonDataOption)(t,"endpoint")})),gt().createElement(bt.Field,{label:"Default Region",description:"Specify the region, such as for US West (Oregon) use ` us-west-2 ` as the region.",htmlFor:"defaultRegion"},gt().createElement(bt.Select,{inputId:"defaultRegion",value:null!=(u=h.find((e=>e.value===y.jsonData.defaultRegion)))?u:y.jsonData.defaultRegion?{label:y.jsonData.defaultRegion,value:y.jsonData.defaultRegion}:void 0,options:h,defaultValue:y.jsonData.defaultRegion,allowCustomValue:!0,onChange:(0,e.onUpdateDatasourceJsonDataOptionSelect)(t,"defaultRegion"),formatCreateLabel:e=>`Use region: ${e}`,menuShouldPortal:!0}))),t.children))},vS=e=>{var t,r,n,a;const{onOptionsChange:i,options:o}=e,s={onOptionsChange:e=>{var t,r,n,a;const s={...o,jsonData:{...o.jsonData,sigV4AuthType:e.jsonData.authType,sigV4Profile:e.jsonData.profile,sigV4AssumeRoleArn:e.jsonData.assumeRoleArn,sigV4ExternalId:e.jsonData.externalId,sigV4Region:e.jsonData.defaultRegion,sigV4Endpoint:e.jsonData.endpoint},secureJsonFields:{sigV4AccessKey:null==(t=e.secureJsonFields)?void 0:t.accessKey,sigV4SecretKey:null==(r=e.secureJsonFields)?void 0:r.secretKey},secureJsonData:{sigV4AccessKey:null==(n=e.secureJsonData)?void 0:n.accessKey,sigV4SecretKey:null==(a=e.secureJsonData)?void 0:a.secretKey}};i(s)},options:{...o,jsonData:{...o.jsonData,authType:o.jsonData.sigV4AuthType,profile:o.jsonData.sigV4Profile,assumeRoleArn:o.jsonData.sigV4AssumeRoleArn,externalId:o.jsonData.sigV4ExternalId,defaultRegion:o.jsonData.sigV4Region,endpoint:o.jsonData.sigV4Endpoint},secureJsonFields:{accessKey:null==(t=o.secureJsonFields)?void 0:t.sigV4AccessKey,secretKey:null==(r=o.secureJsonFields)?void 0:r.sigV4SecretKey},secureJsonData:{accessKey:null==(n=o.secureJsonData)?void 0:n.sigV4AccessKey,secretKey:null==(a=o.secureJsonData)?void 0:a.sigV4SecretKey}},inExperimentalAuthComponent:e.inExperimentalAuthComponent};return gt().createElement(gt().Fragment,null,gt().createElement("div",{className:"gf-form"},gt().createElement("h6",null,"SigV4 Auth Details")),gt().createElement(bS,{...s,skipHeader:!0,skipEndpoint:!0}))};b(8331);var yS=Object.defineProperty,xS=Object.defineProperties,OS=Object.getOwnPropertyDescriptors,wS=Object.getOwnPropertySymbols,SS=Object.prototype.hasOwnProperty,_S=Object.prototype.propertyIsEnumerable,PS=(e,t,r)=>t in e?yS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ES=(e,t)=>{for(var r in t||(t={}))SS.call(t,r)&&PS(e,r,t[r]);if(wS)for(var r of wS(t))_S.call(t,r)&&PS(e,r,t[r]);return e};const TS=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:n})=>{const a=(0,bt.useTheme2)(),i={container:(0,Nr.css)({p:{margin:0},"p + p":{marginTop:a.spacing(2)}}),text:(0,Nr.css)((o=ES({},a.typography.body),s={color:a.colors.text.secondary,a:(0,Nr.css)({color:a.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},xS(o,OS(s))))};var o,s;return gt().createElement("div",{className:(0,Nr.cx)(i.container,n)},gt().createElement("p",{className:i.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",gt().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&gt().createElement("p",{className:i.text},gt().createElement("i",null,"Fields marked with * are required")))};var CS=Object.defineProperty,IS=Object.defineProperties,jS=Object.getOwnPropertyDescriptors,$S=Object.getOwnPropertySymbols,DS=Object.prototype.hasOwnProperty,kS=Object.prototype.propertyIsEnumerable,RS=(e,t,r)=>t in e?CS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,AS=(e,t)=>{for(var r in t||(t={}))DS.call(t,r)&&RS(e,r,t[r]);if($S)for(var r of $S(t))kS.call(t,r)&&RS(e,r,t[r]);return e};const NS=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:a=!0,kind:i="section",className:o})=>{const{colors:s,typography:l,spacing:c}=(0,bt.useTheme2)(),[u,d]=(0,mt.useState)(!n||a),p=u?"angle-up":"angle-down",h="sub-section"===i,m=`${u?"Collapse":"Expand"} section ${t}`,f={header:(0,Nr.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,Nr.css)({margin:0}),subtitle:(0,Nr.css)({margin:0,fontWeight:l.fontWeightRegular}),descriptionText:(0,Nr.css)((g=AS({marginTop:c(h?.25:.5),marginBottom:0},l.bodySmall),b={color:s.text.secondary},IS(g,jS(b)))),content:(0,Nr.css)({marginTop:c(2)})};var g,b;return gt().createElement("div",{className:o},gt().createElement("div",{className:f.header},"section"===i?gt().createElement("h3",{className:f.title},t):gt().createElement("h6",{className:f.subtitle},t),n&&gt().createElement(bt.IconButton,{name:p,onClick:()=>d(!u),type:"button",size:"xl","aria-label":m})),r&&gt().createElement("p",{className:f.descriptionText},r),u&&gt().createElement("div",{className:f.content},e))};var LS=Object.defineProperty,MS=Object.defineProperties,FS=Object.getOwnPropertyDescriptors,BS=Object.getOwnPropertySymbols,qS=Object.prototype.hasOwnProperty,QS=Object.prototype.propertyIsEnumerable,VS=(e,t,r)=>t in e?LS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const WS=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)qS.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&BS)for(var n of BS(e))t.indexOf(n)<0&&QS.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return gt().createElement(NS,(t=((e,t)=>{for(var r in t||(t={}))qS.call(t,r)&&VS(e,r,t[r]);if(BS)for(var r of BS(t))QS.call(t,r)&&VS(e,r,t[r]);return e})({},a),MS(t,FS({kind:"section"}))),n)};var zS=Object.defineProperty,US=Object.defineProperties,GS=Object.getOwnPropertyDescriptors,HS=Object.getOwnPropertySymbols,XS=Object.prototype.hasOwnProperty,YS=Object.prototype.propertyIsEnumerable,KS=(e,t,r)=>t in e?zS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const JS=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)XS.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&HS)for(var n of HS(e))t.indexOf(n)<0&&YS.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return gt().createElement(NS,(t=((e,t)=>{for(var r in t||(t={}))XS.call(t,r)&&KS(e,r,t[r]);if(HS)for(var r of HS(t))YS.call(t,r)&&KS(e,r,t[r]);return e})({},a),US(t,GS({kind:"sub-section"}))),n)};var ZS=Object.defineProperty,e_=Object.defineProperties,t_=Object.getOwnPropertyDescriptors,r_=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,a_=Object.prototype.propertyIsEnumerable,i_=(e,t,r)=>t in e?ZS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o_=(e,t)=>{for(var r in t||(t={}))n_.call(t,r)&&i_(e,r,t[r]);if(r_)for(var r of r_(t))a_.call(t,r)&&i_(e,r,t[r]);return e},s_=(e,t)=>e_(e,t_(t));const l_=({config:e,onChange:t,className:r})=>{const n={container:(0,Nr.css)({maxWidth:578})};return gt().createElement(JS,{title:"Advanced HTTP settings",className:(0,Nr.cx)(n.container,r)},gt().createElement(bt.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},gt().createElement(bt.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:r=>{t(s_(o_({},e),{jsonData:s_(o_({},e.jsonData),{keepCookies:r})}))}})),gt().createElement(bt.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},gt().createElement(bt.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:r=>{t(s_(o_({},e),{jsonData:s_(o_({},e.jsonData),{timeout:parseInt(r.currentTarget.value,10)})}))}})))};var c_=Object.defineProperty,u_=Object.defineProperties,d_=Object.getOwnPropertyDescriptors,p_=Object.getOwnPropertySymbols,h_=Object.prototype.hasOwnProperty,m_=Object.prototype.propertyIsEnumerable,f_=(e,t,r)=>t in e?c_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g_=(e,t)=>{for(var r in t||(t={}))h_.call(t,r)&&f_(e,r,t[r]);if(p_)for(var r of p_(t))m_.call(t,r)&&f_(e,r,t[r]);return e};const b_=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:a=!0,kind:i="section",className:o})=>{const{colors:s,typography:l,spacing:c}=(0,bt.useTheme2)(),[u,d]=(0,mt.useState)(!n||a),p=u?"angle-up":"angle-down",h="sub-section"===i,m=`${u?"Collapse":"Expand"} section ${t}`,f={header:(0,Nr.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,Nr.css)({margin:0}),subtitle:(0,Nr.css)({margin:0,fontWeight:l.fontWeightRegular}),descriptionText:(0,Nr.css)((g=g_({marginTop:c(h?.25:.5),marginBottom:0},l.bodySmall),b={color:s.text.secondary},u_(g,d_(b)))),content:(0,Nr.css)({marginTop:c(2)})};var g,b;return gt().createElement("div",{className:o},gt().createElement("div",{className:f.header},"section"===i?gt().createElement("h3",{className:f.title},t):gt().createElement("h6",{className:f.subtitle},t),n&&gt().createElement(bt.IconButton,{name:p,onClick:()=>d(!u),type:"button",size:"xl","aria-label":m})),r&&gt().createElement("p",{className:f.descriptionText},r),u&&gt().createElement("div",{className:f.content},e))};var v_=Object.defineProperty,y_=Object.defineProperties,x_=Object.getOwnPropertyDescriptors,O_=Object.getOwnPropertySymbols,w_=Object.prototype.hasOwnProperty,S_=Object.prototype.propertyIsEnumerable,__=(e,t,r)=>t in e?v_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const P_=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)w_.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&O_)for(var n of O_(e))t.indexOf(n)<0&&S_.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return gt().createElement(b_,(t=((e,t)=>{for(var r in t||(t={}))w_.call(t,r)&&__(e,r,t[r]);if(O_)for(var r of O_(t))S_.call(t,r)&&__(e,r,t[r]);return e})({},a),y_(t,x_({kind:"sub-section"}))),n)};var E_=Object.defineProperty,T_=Object.defineProperties,C_=Object.getOwnPropertyDescriptors,I_=Object.getOwnPropertySymbols,j_=Object.prototype.hasOwnProperty,$_=Object.prototype.propertyIsEnumerable,D_=(e,t,r)=>t in e?E_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k_=(e,t)=>{for(var r in t||(t={}))j_.call(t,r)&&D_(e,r,t[r]);if(I_)for(var r of I_(t))$_.call(t,r)&&D_(e,r,t[r]);return e},R_=(e,t)=>T_(e,C_(t));function A_({options:e,onOptionsChange:t}){const r=ki((0,bt.useTheme2)());return(0,ht.jsx)(P_,{title:"Alerting",className:(0,Nr.cx)(r.container,r.alertingTop),children:(0,ht.jsx)("div",{className:"gf-form-group",children:(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{labelWidth:30,label:"Manage alerts via Alerting UI",disabled:e.readOnly,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Manage alert rules for this data source. To manage other alerting resources, add an Alertmanager data source. ",$i()]}),interactive:!0,className:r.switchField,children:(0,ht.jsx)(bt.Switch,{value:!1!==e.jsonData.manageAlerts,onChange:r=>t(R_(k_({},e),{jsonData:R_(k_({},e.jsonData),{manageAlerts:r.currentTarget.checked})})),id:Tn.components.DataSource.Prometheus.configPage.manageAlerts})})})})})})}var N_=Object.defineProperty,L_=Object.defineProperties,M_=Object.getOwnPropertyDescriptors,F_=Object.getOwnPropertySymbols,B_=Object.prototype.hasOwnProperty,q_=Object.prototype.propertyIsEnumerable,Q_=(e,t,r)=>t in e?N_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,V_=(e,t)=>{for(var r in t||(t={}))B_.call(t,r)&&Q_(e,r,t[r]);if(F_)for(var r of F_(t))q_.call(t,r)&&Q_(e,r,t[r]);return e},W_=(e,t)=>L_(e,M_(t));function z_({value:e,onChange:t,onDelete:r,disabled:n}){const[a,i]=(0,mt.useState)(Boolean(e.datasourceUid)),o=ki((0,bt.useTheme2)());return(0,ht.jsxs)("div",{className:"gf-form-group",children:[(0,ht.jsx)(bt.InlineField,{label:"Internal link",labelWidth:ji,disabled:n,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Enable this option if you have an internal link. When enabled, this reveals the data source selector. Select the backend tracing data store for your exemplar data. ",$i()]}),interactive:!0,className:o.switchField,children:(0,ht.jsx)(ht.Fragment,{children:(0,ht.jsx)(bt.Switch,{value:a,"data-testid":Tn.components.DataSource.Prometheus.configPage.internalLinkSwitch,onChange:e=>i(e.currentTarget.checked)})})}),a?(0,ht.jsx)(bt.InlineField,{label:"Data source",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["The data source the exemplar is going to navigate to. ",$i()]}),disabled:n,interactive:!0,children:(0,ht.jsx)(j.DataSourcePicker,{filter:j.config.featureToggles.azureMonitorPrometheusExemplars?void 0:e=>"grafana-azure-monitor-datasource"!==e.type,tracing:!0,current:e.datasourceUid,noDefault:!0,width:40,onChange:r=>t(W_(V_({},e),{datasourceUid:r.uid,url:void 0}))})}):(0,ht.jsx)(bt.InlineField,{label:"URL",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["The URL of the trace backend the user would go to see its trace. ",$i()]}),disabled:n,interactive:!0,children:(0,ht.jsx)(bt.Input,{placeholder:"https://example.com/${__value.raw}",spellCheck:!1,width:40,value:e.url,onChange:r=>t(W_(V_({},e),{datasourceUid:void 0,url:r.currentTarget.value}))})}),(0,ht.jsx)(bt.InlineField,{label:"URL Label",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Use to override the button label on the exemplar traceID field. ",$i()]}),disabled:n,interactive:!0,children:(0,ht.jsx)(bt.Input,{placeholder:"Go to example.com",spellCheck:!1,width:40,value:e.urlDisplayLabel,onChange:r=>t(W_(V_({},e),{urlDisplayLabel:r.currentTarget.value}))})}),(0,ht.jsx)(bt.InlineField,{label:"Label name",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["The name of the field in the labels object that should be used to get the traceID. ",$i()]}),disabled:n,interactive:!0,children:(0,ht.jsx)(bt.Input,{placeholder:"traceID",spellCheck:!1,width:40,value:e.name,onChange:r=>t(W_(V_({},e),{name:r.currentTarget.value}))})}),!n&&(0,ht.jsx)(bt.InlineField,{label:"Remove exemplar link",labelWidth:ji,disabled:n,children:(0,ht.jsx)(bt.Button,{variant:"destructive",title:"Remove exemplar link",icon:"times",onClick:e=>{e.preventDefault(),r()}})})]})}function U_({options:e,onChange:t,disabled:r}){const n=ki((0,bt.useTheme2)());return(0,ht.jsx)("div",{className:n.sectionBottomPadding,children:(0,ht.jsxs)(P_,{title:"Exemplars",className:n.container,children:[e&&e.map(((n,a)=>(0,ht.jsx)(z_,{value:n,onChange:r=>{const n=[...e];n.splice(a,1,r),t(n)},onDelete:()=>{const r=[...e];r.splice(a,1),t(r)},disabled:r},a))),!r&&(0,ht.jsx)(bt.Button,{variant:"secondary","data-testid":Tn.components.DataSource.Prometheus.configPage.exemplarsAddButton,className:(0,Nr.css)({marginBottom:"10px"}),icon:"plus",onClick:r=>{r.preventDefault();const n=[...e||[],{name:"traceID"}];t(n)},children:"Add"}),r&&!e&&(0,ht.jsx)("i",{children:"No exemplars configurations"})]})})}const G_={Prometheus:[{value:void 0,label:"Please select"},{value:"2.0.0",label:"< 2.14.x"},{value:"2.14.0",label:"2.14.x"},{value:"2.15.0",label:"2.15.x"},{value:"2.16.0",label:"2.16.x"},{value:"2.17.0",label:"2.17.x"},{value:"2.18.0",label:"2.18.x"},{value:"2.19.0",label:"2.19.x"},{value:"2.20.0",label:"2.20.x"},{value:"2.21.0",label:"2.21.x"},{value:"2.22.0",label:"2.22.x"},{value:"2.23.0",label:"2.23.x"},{value:"2.24.0",label:"2.24.x"},{value:"2.25.0",label:"2.25.x"},{value:"2.26.0",label:"2.26.x"},{value:"2.27.0",label:"2.27.x"},{value:"2.28.0",label:"2.28.x"},{value:"2.29.0",label:"2.29.x"},{value:"2.30.0",label:"2.30.x"},{value:"2.31.0",label:"2.31.x"},{value:"2.32.0",label:"2.32.x"},{value:"2.33.0",label:"2.33.x"},{value:"2.34.0",label:"2.34.x"},{value:"2.35.0",label:"2.35.x"},{value:"2.36.0",label:"2.36.x"},{value:"2.37.0",label:"2.37.x"},{value:"2.38.0",label:"2.38.x"},{value:"2.39.0",label:"2.39.x"},{value:"2.40.0",label:"2.40.x"},{value:"2.41.0",label:"2.41.x"},{value:"2.42.0",label:"2.42.x"},{value:"2.43.0",label:"2.43.x"},{value:"2.44.0",label:"2.44.x"},{value:"2.45.0",label:"2.45.x"},{value:"2.46.0",label:"2.46.x"},{value:"2.47.0",label:"2.47.x"},{value:"2.48.0",label:"2.48.x"},{value:"2.49.0",label:"2.49.x"},{value:"2.50.0",label:"2.50.x"},{value:"2.50.1",label:"> 2.50.x"}],Mimir:[{value:void 0,label:"Please select"},{value:"2.0.0",label:"2.0.x"},{value:"2.1.0",label:"2.1.x"},{value:"2.2.0",label:"2.2.x"},{value:"2.3.0",label:"2.3.x"},{value:"2.4.0",label:"2.4.x"},{value:"2.5.0",label:"2.5.x"},{value:"2.6.0",label:"2.6.x"},{value:"2.7.0",label:"2.7.x"},{value:"2.8.0",label:"2.8.x"},{value:"2.9.0",label:"2.9.x"},{value:"2.9.1",label:"> 2.9.x"}],Thanos:[{value:void 0,label:"Please select"},{value:"0.0.0",label:"< 0.16.x"},{value:"0.16.0",label:"0.16.x"},{value:"0.17.0",label:"0.17.x"},{value:"0.18.0",label:"0.18.x"},{value:"0.19.0",label:"0.19.x"},{value:"0.20.0",label:"0.20.x"},{value:"0.21.0",label:"0.21.x"},{value:"0.22.0",label:"0.22.x"},{value:"0.23.0",label:"0.23.x"},{value:"0.24.0",label:"0.24.x"},{value:"0.25.0",label:"0.25.x"},{value:"0.26.0",label:"0.26.x"},{value:"0.27.0",label:"0.27.x"},{value:"0.28.0",label:"0.28.x"},{value:"0.29.0",label:"0.29.x"},{value:"0.30.0",label:"0.30.x"},{value:"0.31.0",label:"0.31.x"},{value:"0.31.1",label:"> 0.31.x"}],Cortex:[{value:void 0,label:"Please select"},{value:"0.0.0",label:"< 1.0.0"},{value:"1.0.0",label:"1.0.0"},{value:"1.1.0",label:"1.1.x"},{value:"1.2.0",label:"1.2.x"},{value:"1.3.0",label:"1.3.x"},{value:"1.4.0",label:"1.4.x"},{value:"1.5.0",label:"1.5.x"},{value:"1.6.0",label:"1.6.x"},{value:"1.7.0",label:"1.7.x"},{value:"1.8.0",label:"1.8.x"},{value:"1.9.0",label:"1.9.x"},{value:"1.10.0",label:"1.10.x"},{value:"1.11.0",label:"1.11.x"},{value:"1.13.0",label:"1.13.x"},{value:"1.14.0",label:"> 1.13.x"}]};var H_=Object.defineProperty,X_=Object.defineProperties,Y_=Object.getOwnPropertyDescriptors,K_=Object.getOwnPropertySymbols,J_=Object.prototype.hasOwnProperty,Z_=Object.prototype.propertyIsEnumerable,eP=(e,t,r)=>t in e?H_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tP=(e,t)=>{for(var r in t||(t={}))J_.call(t,r)&&eP(e,r,t[r]);if(K_)for(var r of K_(t))Z_.call(t,r)&&eP(e,r,t[r]);return e},rP=(e,t)=>X_(e,Y_(t));const nP=[{value:"POST",label:"POST"},{value:"GET",label:"GET"}],aP=[{value:Wd.Builder,label:"Builder"},{value:Wd.Code,label:"Code"}],iP=[{value:Un.Low,label:"Low"},{value:Un.Medium,label:"Medium"},{value:Un.High,label:"High"},{value:Un.None,label:"None"}],oP=[{value:Gn.Prometheus,label:Gn.Prometheus},{value:Gn.Cortex,label:Gn.Cortex},{value:Gn.Mimir,label:Gn.Mimir},{value:Gn.Thanos,label:Gn.Thanos}],sP=/^$|^\d+(ms|[Mwdhmsy])$/,lP=/(\d+)(.+)/,cP=/^(0|[1-9]\d*)(\.\d+)?(e\+?\d+)?$/,uP="Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s",dP=t=>{var r,n,a,i,o,s,l;const{options:c,onOptionsChange:u}=t;c.jsonData.httpMethod||(c.jsonData.httpMethod="POST");const d=ki((0,bt.useTheme2)()),[p,h]=(0,mt.useState)({timeInterval:"",queryTimeout:"",incrementalQueryOverlapWindow:""}),[m,f]=(0,mt.useState)({codeModeMetricNamesSuggestionLimit:""});return(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(P_,{title:"Interval behaviour",className:d.container,children:(0,ht.jsxs)("div",{className:"gf-form-group",children:[(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{label:"Scrape interval",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["This interval is how frequently Prometheus scrapes targets. Set this to the typical scrape and evaluation interval configured in your Prometheus config file. If you set this to a greater value than your Prometheus config file interval, Grafana will evaluate the data according to this interval and you will see less data points. Defaults to 15s. ",$i()]}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.Input,{className:"width-20",value:c.jsonData.timeInterval,spellCheck:!1,placeholder:"15s",onChange:hP("timeInterval",c,u),onBlur:e=>h(rP(tP({},p),{timeInterval:e.currentTarget.value})),"data-testid":Tn.components.DataSource.Prometheus.configPage.scrapeInterval}),Di(p.timeInterval,sP,uP)]})})})}),(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{label:"Query timeout",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Set the Prometheus query timeout. ",$i()]}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.Input,{className:"width-20",value:c.jsonData.queryTimeout,onChange:hP("queryTimeout",c,u),spellCheck:!1,placeholder:"60s",onBlur:e=>h(rP(tP({},p),{queryTimeout:e.currentTarget.value})),"data-testid":Tn.components.DataSource.Prometheus.configPage.queryTimeout}),Di(p.queryTimeout,sP,uP)]})})})})]})}),(0,ht.jsx)(P_,{title:"Query editor",className:d.container,children:(0,ht.jsxs)("div",{className:"gf-form-group",children:[(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{label:"Default editor",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Set default editor option for all users of this data source. ",$i()]}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsx)(bt.Select,{"aria-label":"Default Editor (Code or Builder)",options:aP,value:null!=(r=aP.find((e=>e.value===c.jsonData.defaultEditor)))?r:aP.find((e=>e.value===Wd.Builder)),onChange:hP("defaultEditor",c,u),width:40,"data-testid":Tn.components.DataSource.Prometheus.configPage.defaultEditor})})}),(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{labelWidth:ji,label:"Disable metrics lookup",tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Checking this option will disable the metrics chooser and metric/label support in the query field's autocomplete. This helps if you have performance issues with bigger Prometheus instances."," ",$i()]}),interactive:!0,disabled:c.readOnly,className:d.switchField,children:(0,ht.jsx)(bt.Switch,{value:null!=(n=c.jsonData.disableMetricsLookup)&&n,onChange:(0,e.onUpdateDatasourceJsonDataOptionChecked)(t,"disableMetricsLookup"),id:Tn.components.DataSource.Prometheus.configPage.disableMetricLookup})})})]})}),(0,ht.jsxs)(P_,{title:"Performance",className:d.container,children:[!c.jsonData.prometheusType&&!c.jsonData.prometheusVersion&&c.readOnly&&(0,ht.jsxs)("div",{className:d.versionMargin,children:["For more information on configuring prometheus type and version in data sources, see the"," ",(0,ht.jsx)("a",{className:d.textUnderline,href:"https://grafana.com/docs/grafana/latest/administration/provisioning/",children:"provisioning documentation"}),"."]}),(0,ht.jsxs)("div",{className:"gf-form-group",children:[(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{label:"Prometheus type",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Set this to the type of your prometheus database, e.g. Prometheus, Cortex, Mimir or Thanos. Changing this field will save your current settings. Certain types of Prometheus supports or does not support various APIs. For example, some types support regex matching for label queries to improve performance. Some types have an API for metadata. If you set this incorrectly you may experience odd behavior when querying metrics and labels. Please check your Prometheus documentation to ensure you enter the correct type. ",$i()]}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsx)(bt.Select,{"aria-label":"Prometheus type",options:oP,value:oP.find((e=>e.value===c.jsonData.prometheusType)),onChange:hP("prometheusType",c,u),width:40,"data-testid":Tn.components.DataSource.Prometheus.configPage.prometheusType})})})}),(0,ht.jsx)("div",{className:"gf-form-inline",children:c.jsonData.prometheusType&&(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{label:`${c.jsonData.prometheusType} version`,labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Use this to set the version of your ",c.jsonData.prometheusType," instance if it is not automatically configured. ",$i()]}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsx)(bt.Select,{"aria-label":`${c.jsonData.prometheusType} type`,options:G_[c.jsonData.prometheusType],value:null==(a=G_[c.jsonData.prometheusType])?void 0:a.find((e=>e.value===c.jsonData.prometheusVersion)),onChange:hP("prometheusVersion",c,u),width:40,"data-testid":Tn.components.DataSource.Prometheus.configPage.prometheusVersion})})})}),(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form max-width-30",children:(0,ht.jsx)(bt.InlineField,{label:"Cache level",labelWidth:ji,tooltip:(0,ht.jsx)(ht.Fragment,{children:"Sets the browser caching level for editor queries. Higher cache settings are recommended for high cardinality data sources."}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsx)(bt.Select,{width:40,onChange:hP("cacheLevel",c,u),options:iP,value:null!=(i=iP.find((e=>e.value===c.jsonData.cacheLevel)))?i:Un.Low,"data-testid":Tn.components.DataSource.Prometheus.configPage.cacheLevel})})})}),j.config.featureToggles.prometheusCodeModeMetricNamesSearch&&(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{label:"Metric names suggestion limit",labelWidth:ji,tooltip:(0,ht.jsx)(ht.Fragment,{children:"The maximum number of metric names that may appear as autocomplete suggestions in the query editor's Code mode."}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.Input,{className:"width-20",value:c.jsonData.codeModeMetricNamesSuggestionLimit,onChange:hP("codeModeMetricNamesSuggestionLimit",c,u),spellCheck:!1,placeholder:sa.toString(),onBlur:e=>f(rP(tP({},m),{codeModeMetricNamesSuggestionLimit:e.currentTarget.value})),"data-testid":Tn.components.DataSource.Prometheus.configPage.codeModeMetricNamesSuggestionLimit}),Di(m.codeModeMetricNamesSuggestionLimit,cP,"Value is not valid, you can use non-negative integers, including scientific notation")]})})})}),(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form max-width-30",children:(0,ht.jsx)(bt.InlineField,{label:"Incremental querying (beta)",labelWidth:ji,tooltip:(0,ht.jsx)(ht.Fragment,{children:"This feature will change the default behavior of relative queries to always request fresh data from the prometheus instance, instead query results will be cached, and only new records are requested. Turn this on to decrease database and network load."}),interactive:!0,className:d.switchField,disabled:c.readOnly,children:(0,ht.jsx)(bt.Switch,{value:null!=(o=c.jsonData.incrementalQuerying)&&o,onChange:(0,e.onUpdateDatasourceJsonDataOptionChecked)(t,"incrementalQuerying"),id:Tn.components.DataSource.Prometheus.configPage.incrementalQuerying})})})}),(0,ht.jsx)("div",{className:"gf-form-inline",children:c.jsonData.incrementalQuerying&&(0,ht.jsx)(bt.InlineField,{label:"Query overlap window",labelWidth:ji,tooltip:(0,ht.jsx)(ht.Fragment,{children:"Set a duration like 10m or 120s or 0s. Default of 10 minutes. This duration will be added to the duration of each incremental request."}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsxs)(ht.Fragment,{children:[(0,ht.jsx)(bt.Input,{onBlur:e=>h(rP(tP({},p),{incrementalQueryOverlapWindow:e.currentTarget.value})),className:"width-20",value:null!=(s=c.jsonData.incrementalQueryOverlapWindow)?s:Yc,onChange:hP("incrementalQueryOverlapWindow",c,u),spellCheck:!1,"data-testid":Tn.components.DataSource.Prometheus.configPage.queryOverlapWindow}),Di(p.incrementalQueryOverlapWindow,lP,uP)]})})}),(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form max-width-30",children:(0,ht.jsx)(bt.InlineField,{label:"Disable recording rules (beta)",labelWidth:ji,tooltip:(0,ht.jsx)(ht.Fragment,{children:"This feature will disable recording rules Turn this on to improve dashboard performance"}),interactive:!0,className:d.switchField,disabled:c.readOnly,children:(0,ht.jsx)(bt.Switch,{value:null!=(l=c.jsonData.disableRecordingRules)&&l,onChange:(0,e.onUpdateDatasourceJsonDataOptionChecked)(t,"disableRecordingRules"),id:Tn.components.DataSource.Prometheus.configPage.disableRecordingRules})})})})]})]}),(0,ht.jsx)(P_,{title:"Other",className:d.container,children:(0,ht.jsxs)("div",{className:"gf-form-group",children:[(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form max-width-30",children:(0,ht.jsx)(bt.InlineField,{label:"Custom query parameters",labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["Add custom parameters to the Prometheus query URL. For example timeout, partial_response, dedup, or max_source_resolution. Multiple parameters should be concatenated together with an â&â. ",$i()]}),interactive:!0,disabled:c.readOnly,children:(0,ht.jsx)(bt.Input,{className:"width-20",value:c.jsonData.customQueryParameters,onChange:hP("customQueryParameters",c,u),spellCheck:!1,placeholder:"Example: max_source_resolution=5m&timeout=10","data-testid":Tn.components.DataSource.Prometheus.configPage.customQueryParameters})})})}),(0,ht.jsx)("div",{className:"gf-form-inline",children:(0,ht.jsx)("div",{className:"gf-form",children:(0,ht.jsx)(bt.InlineField,{labelWidth:ji,tooltip:(0,ht.jsxs)(ht.Fragment,{children:["You can use either POST or GET HTTP method to query your Prometheus data source. POST is the recommended method as it allows bigger queries. Change this to GET if you have a Prometheus version older than 2.1 or if POST requests are restricted in your network. ",$i()]}),interactive:!0,label:"HTTP method",disabled:c.readOnly,children:(0,ht.jsx)(bt.Select,{width:40,"aria-label":"Select HTTP method",options:nP,value:nP.find((e=>e.value===c.jsonData.httpMethod)),onChange:hP("httpMethod",c,u),"data-testid":Tn.components.DataSource.Prometheus.configPage.httpMethod})})})})]})}),(0,ht.jsx)(U_,{options:c.jsonData.exemplarTraceIdDestinations,onChange:t=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:u,options:c},"exemplarTraceIdDestinations",t),disabled:c.readOnly})]})},pP=e=>e?"currentTarget"in e?e.currentTarget.value:e.value:"",hP=(e,t,r)=>n=>{r(rP(tP({},t),{jsonData:rP(tP({},t.jsonData),{[e]:pP(n)})}))};var mP=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(mP||{}),fP=Object.defineProperty,gP=Object.defineProperties,bP=Object.getOwnPropertyDescriptors,vP=Object.getOwnPropertySymbols,yP=Object.prototype.hasOwnProperty,xP=Object.prototype.propertyIsEnumerable,OP=(e,t,r)=>t in e?fP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wP=(e,t)=>{for(var r in t||(t={}))yP.call(t,r)&&OP(e,r,t[r]);if(vP)for(var r of vP(t))xP.call(t,r)&&OP(e,r,t[r]);return e},SP=(e,t)=>gP(e,bP(t));const _P="httpHeaderName",PP="httpHeaderValue";function EP(e){return e.basicAuth?mP.BasicAuth:e.withCredentials?mP.CrossSiteCredentials:e.jsonData.oauthPassThru?mP.OAuthForward:mP.NoAuth}function TP(e,t){return r=>{t(SP(wP({},e),{basicAuth:r===mP.BasicAuth,withCredentials:r===mP.CrossSiteCredentials,jsonData:SP(wP({},e.jsonData),{oauthPassThru:r===mP.OAuthForward})}))}}function CP(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:r=>t(SP(wP({},e),{basicAuthUser:r})),onPasswordChange:r=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{basicAuthPassword:r})})),onPasswordReset:()=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{basicAuthPassword:""}),secureJsonFields:SP(wP({},e.secureJsonFields),{basicAuthPassword:!1})}))}}function IP(e,t){return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:e.secureJsonFields.tlsCACert,onToggle:r=>t(SP(wP({},e),r?{jsonData:SP(wP({},e.jsonData),{tlsAuthWithCACert:r})}:{jsonData:SP(wP({},e.jsonData),{tlsAuthWithCACert:r}),secureJsonData:SP(wP({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:SP(wP({},e.secureJsonFields),{tlsCACert:!1})})),onCertificateChange:r=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{tlsCACert:r})})),onCertificateReset:()=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:SP(wP({},e.secureJsonFields),{tlsCACert:!1})}))},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:e.secureJsonFields.tlsClientCert,clientKeyConfigured:e.secureJsonFields.tlsClientKey,onToggle:r=>t(SP(wP({},e),r?{jsonData:SP(wP({},e.jsonData),{tlsAuth:r})}:{jsonData:SP(wP({},e.jsonData),{tlsAuth:r,serverName:""}),secureJsonData:SP(wP({},e.secureJsonData),{tlsClientCert:"",tlsClientKey:""}),secureJsonFields:SP(wP({},e.secureJsonFields),{tlsClientCert:!1,tlsClientKey:!1})})),onServerNameChange:r=>t(SP(wP({},e),{jsonData:SP(wP({},e.jsonData),{serverName:r})})),onClientCertificateChange:r=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{tlsClientCert:r})})),onClientCertificateReset:()=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{tlsClientCert:""}),secureJsonFields:SP(wP({},e.secureJsonFields),{tlsClientCert:!1})})),onClientKeyChange:r=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{tlsClientKey:r})})),onClientKeyReset:()=>t(SP(wP({},e),{secureJsonData:SP(wP({},e.secureJsonData),{tlsClientKey:""}),secureJsonFields:SP(wP({},e.secureJsonFields),{tlsClientKey:!1})}))},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:r=>t(SP(wP({},e),{jsonData:SP(wP({},e.jsonData),{tlsSkipVerify:r})}))}}}function jP(e,t){const r=Object.keys(e.jsonData).filter((e=>e.startsWith(_P))).sort().map((t=>{var r;const n=t.slice(14);return{name:e.jsonData[t],configured:null!=(r=e.secureJsonFields[`${PP}${n}`])&&r}}));return{headers:r,onChange:r=>{const n=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(_P)))),a=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(PP)))),i=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(PP))));r.forEach(((e,t)=>{n[`${_P}${t+1}`]=e.name,e.configured?i[`${PP}${t+1}`]=!0:a[`${PP}${t+1}`]=e.value})),t(SP(wP({},e),{jsonData:n,secureJsonData:a,secureJsonFields:i}))}}}var $P=Object.defineProperty,DP=Object.defineProperties,kP=Object.getOwnPropertyDescriptors,RP=Object.getOwnPropertySymbols,AP=Object.prototype.hasOwnProperty,NP=Object.prototype.propertyIsEnumerable,LP=(e,t,r)=>t in e?$P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const MP=({config:e,onChange:t,description:r,urlPlaceholder:n,urlTooltip:a,urlLabel:i,className:o})=>{const s=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),l={container:(0,Nr.css)({maxWidth:578})};return gt().createElement(gt().Fragment,null,gt().createElement(WS,{title:"Connection",description:r,className:(0,Nr.cx)(l.container,o)},gt().createElement(bt.InlineField,{htmlFor:"connection-url",label:i||"URL",labelWidth:24,tooltip:a||gt().createElement(gt().Fragment,null,"Specify a complete HTTP URL",gt().createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!s&&!e.readOnly,error:s?"":"Please enter a valid URL",interactive:!0},gt().createElement(bt.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:r=>{return t((n=((e,t)=>{for(var r in t||(t={}))AP.call(t,r)&&LP(e,r,t[r]);if(RP)for(var r of RP(t))NP.call(t,r)&&LP(e,r,t[r]);return e})({},e),a={url:r.currentTarget.value},DP(n,kP(a))));var n,a},value:e.url||"",placeholder:n||"URL"}))))},FP=()=>({inlineFieldNoMarginRight:(0,Nr.css)({marginRight:0}),inlineFieldWithSecret:(0,Nr.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),BP=({user:e,passwordConfigured:t,userLabel:r="User",userTooltip:n="The username of the data source account",userPlaceholder:a="User",passwordLabel:i="Password",passwordTooltip:o="The password of the data source account",passwordPlaceholder:s="Password",onUserChange:l,onPasswordChange:c,onPasswordReset:u,readOnly:d})=>{const p=FP(),h={lastInlineField:(0,Nr.css)({marginBottom:0})};return gt().createElement(gt().Fragment,null,gt().createElement(bt.InlineField,{className:p.inlineFieldNoMarginRight,label:r,labelWidth:24,tooltip:n,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:d},gt().createElement(bt.Input,{id:"basic-auth-user-input",placeholder:a,value:e,onChange:e=>l(e.currentTarget.value),required:!0})),gt().createElement(bt.InlineField,{className:(0,Nr.cx)(p.inlineFieldNoMarginRight,p.inlineFieldWithSecret,h.lastInlineField),label:i,labelWidth:24,tooltip:o,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:d},gt().createElement(bt.SecretInput,{id:"basic-auth-password-input",isConfigured:t,onReset:d?()=>{}:u,placeholder:s,onChange:e=>c(e.currentTarget.value),required:!0})))};var qP=Object.defineProperty,QP=Object.defineProperties,VP=Object.getOwnPropertyDescriptors,WP=Object.getOwnPropertySymbols,zP=Object.prototype.hasOwnProperty,UP=Object.prototype.propertyIsEnumerable,GP=(e,t,r)=>t in e?qP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,HP=(e,t)=>{for(var r in t||(t={}))zP.call(t,r)&&GP(e,r,t[r]);if(WP)for(var r of WP(t))UP.call(t,r)&&GP(e,r,t[r]);return e},XP=(e,t)=>QP(e,VP(t));const YP={[mP.BasicAuth]:{label:"Basic authentication",value:mP.BasicAuth,description:"Authenticate with your data source username and password"},[mP.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:mP.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[mP.OAuthForward]:{label:"Forward OAuth Identity",value:mP.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[mP.NoAuth]:{label:"No Authentication",value:mP.NoAuth,description:"Data source is available without authentication"}},KP=({selectedMethod:e,mostCommonMethod:t,visibleMethods:r,defaultOptionsOverrides:n,customMethods:a,onAuthMethodSelect:i,basicAuth:o,readOnly:s})=>{var l,c,u,d;const[p,h]=(0,mt.useState)(!1),{colors:m,spacing:f}=(0,bt.useTheme2)(),g=(0,mt.useMemo)((()=>{var e;return null!=r?r:[mP.BasicAuth,mP.OAuthForward,mP.NoAuth,...null!=(e=null==a?void 0:a.map((e=>e.id)))?e:[]]}),[a,r]),b=g.length>1,v=(0,mt.useMemo)((()=>{var e;const r=null!=(e=null==a?void 0:a.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},i={};let o;for(o in YP)i[o]=HP(HP({},YP[o]),null==n?void 0:n[o]);const s=HP(HP({},r),i);return g.filter((e=>Boolean(s[e]))).map((e=>{const r=s[e];return e===t&&b?XP(HP({},r),{label:`${r.label} (most common)`}):r}))}),[g,a,n,t,b]);let y=e;b?e===mP.NoAuth&&t&&!p&&(y=t):y=g[0];let x=null;y===mP.BasicAuth&&o?x=gt().createElement(BP,XP(HP({},o),{readOnly:s})):y.startsWith("custom-")&&(x=null!=(c=null==(l=null==a?void 0:a.find((e=>e.id===y)))?void 0:l.component)?c:null);const O=b?"Authentication methods":null!=(u=v[0].label)?u:"",w=b?"Choose an authentication method to access the data source":null!=(d=v[0].description)?d:"",S={authMethods:(0,Nr.css)(HP({marginTop:f(2.5)},b&&{padding:f(2),border:`1px solid ${m.border.weak}`})),selectedMethodFields:(0,Nr.css)({marginTop:f(1.5)})};return gt().createElement(JS,{title:O,description:w},gt().createElement("div",{className:S.authMethods},b&&gt().createElement(bt.Select,{options:v,value:y,onChange:e=>{h(!0),i(e.value)},disabled:s}),x&&gt().createElement("div",{className:S.selectedMethodFields},x)))},JP=({children:e,enabled:t,label:r,tooltipText:n,onToggle:a,readOnly:i})=>{const{colors:o,spacing:s}=(0,bt.useTheme2)(),l={container:(0,Nr.css)({marginTop:3}),checkboxContainer:(0,Nr.css)({display:"flex",alignItems:"center"}),infoIcon:(0,Nr.css)({marginTop:-2,marginLeft:5,color:o.text.secondary}),content:(0,Nr.css)({margin:s(1,0,2,3)})};return gt().createElement("div",{className:l.container},gt().createElement("div",{className:l.checkboxContainer},gt().createElement(bt.Checkbox,{value:t,label:r,onChange:()=>a(!t),disabled:i}),gt().createElement(bt.Tooltip,{placement:"top",content:n,interactive:!0},gt().createElement(bt.Icon,{name:"info-circle",className:l.infoIcon,size:"sm"}))),t&&e&&gt().createElement("div",{className:l.content},e))},ZP=({enabled:e,certificateConfigured:t,onToggle:r,onCertificateChange:n,onCertificateReset:a,tooltips:i,readOnly:o})=>{var s;const l=FP();return gt().createElement(JP,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>r(e),readOnly:o},gt().createElement(bt.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(s=null==i?void 0:i.certificateLabel)?s:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,Nr.cx)(l.inlineFieldNoMarginRight,l.inlineFieldWithSecret),disabled:o},gt().createElement(bt.SecretTextArea,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>n(e.currentTarget.value),onReset:o?()=>{}:a,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},eE=({enabled:e,serverName:t,clientCertificateConfigured:r,clientKeyConfigured:n,onToggle:a,onServerNameChange:i,onClientCertificateChange:o,onClientKeyChange:s,onClientCertificateReset:l,onClientKeyReset:c,tooltips:u,readOnly:d})=>{var p,h,m;const f=FP();return gt().createElement(JP,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>a(e),readOnly:d},gt().createElement(bt.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(p=null==u?void 0:u.serverNameLabel)?p:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:f.inlineFieldNoMarginRight,disabled:d},gt().createElement(bt.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>i(e.currentTarget.value),required:!0})),gt().createElement(bt.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(h=null==u?void 0:u.certificateLabel)?h:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,Nr.cx)(f.inlineFieldNoMarginRight,f.inlineFieldWithSecret),disabled:d},gt().createElement(bt.SecretTextArea,{id:"client-auth-client-certificate-input",isConfigured:r,onChange:e=>o(e.currentTarget.value),onReset:d?()=>{}:l,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),gt().createElement(bt.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(m=null==u?void 0:u.keyLabel)?m:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,Nr.cx)(f.inlineFieldNoMarginRight,f.inlineFieldWithSecret),disabled:d},gt().createElement(bt.SecretTextArea,{id:"client-auth-client-key-input",isConfigured:n,onChange:e=>s(e.currentTarget.value),onReset:d?()=>{}:c,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},tE=({enabled:e,onToggle:t,readOnly:r})=>gt().createElement(JP,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:r});var rE=Object.defineProperty,nE=Object.defineProperties,aE=Object.getOwnPropertyDescriptors,iE=Object.getOwnPropertySymbols,oE=Object.prototype.hasOwnProperty,sE=Object.prototype.propertyIsEnumerable,lE=(e,t,r)=>t in e?rE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cE=(e,t)=>{for(var r in t||(t={}))oE.call(t,r)&&lE(e,r,t[r]);if(iE)for(var r of iE(t))sE.call(t,r)&&lE(e,r,t[r]);return e},uE=(e,t)=>nE(e,aE(t));const dE=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:r,readOnly:n})=>{const{spacing:a}=(0,bt.useTheme2)(),i={container:(0,Nr.css)({marginTop:a(3)})};return gt().createElement(JS,{className:i.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},gt().createElement(ZP,uE(cE({},e),{readOnly:n})),gt().createElement(eE,uE(cE({},t),{readOnly:n})),gt().createElement(tE,uE(cE({},r),{readOnly:n})))};var pE=Object.defineProperty,hE=Object.defineProperties,mE=Object.getOwnPropertyDescriptors,fE=Object.getOwnPropertySymbols,gE=Object.prototype.hasOwnProperty,bE=Object.prototype.propertyIsEnumerable,vE=(e,t,r)=>t in e?pE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,yE=(e,t)=>{for(var r in t||(t={}))gE.call(t,r)&&vE(e,r,t[r]);if(fE)for(var r of fE(t))bE.call(t,r)&&vE(e,r,t[r]);return e},xE=(e,t)=>hE(e,mE(t));const OE=({header:e,onChange:t,onBlur:r,onDelete:n,readOnly:a})=>{const{spacing:i}=(0,bt.useTheme2)(),o=FP(),s={container:(0,Nr.css)({alignItems:"center"}),input:(0,Nr.css)({minWidth:"100%"}),headerNameField:(0,Nr.css)({width:"40%",marginRight:0,paddingRight:i(1)}),headerValueField:(0,Nr.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,Nr.css)({margin:"0 0 3px 10px"})};return gt().createElement(gt().Fragment,null,gt().createElement(bt.InlineFieldRow,{className:s.container},gt().createElement(bt.InlineField,{label:"Header",labelWidth:9,grow:!0,className:s.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:a},gt().createElement(bt.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:r=>t(xE(yE({},e),{name:r.currentTarget.value})),onBlur:r,className:s.input})),gt().createElement(bt.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,Nr.cx)(o.inlineFieldWithSecret,s.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:a},gt().createElement(bt.SecretInput,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:r=>t(xE(yE({},e),{value:r.currentTarget.value})),onReset:a?()=>{}:()=>t(xE(yE({},e),{configured:!1,value:""})),onBlur:r,className:s.input})),gt().createElement(bt.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:s.removeHeaderBtn,onClick:n,type:"button",disabled:a})))};var wE=Object.defineProperty,SE=Object.defineProperties,_E=Object.getOwnPropertyDescriptors,PE=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,TE=Object.prototype.propertyIsEnumerable,CE=(e,t,r)=>t in e?wE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,IE=(e,t)=>{for(var r in t||(t={}))EE.call(t,r)&&CE(e,r,t[r]);if(PE)for(var r of PE(t))TE.call(t,r)&&CE(e,r,t[r]);return e},jE=(e,t)=>SE(e,_E(t));const $E=({headers:e,onChange:t,readOnly:r})=>{const{spacing:n}=(0,bt.useTheme2)(),[a,i]=(0,mt.useState)(e.map((e=>jE(IE({},e),{id:DE(),value:""}))));(0,mt.useEffect)((()=>{i((t=>{let r=!1;const n=t.map((t=>{var n;const a=null==(n=e.find((e=>e.name===t.name)))?void 0:n.configured;return void 0!==a&&t.configured!==a?(r=!0,jE(IE({},t),{configured:a})):t}));return r?n:t}))}),[e]);const o=()=>{t(a.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))},s={container:(0,Nr.css)({marginTop:n(3)}),addHeaderButton:(0,Nr.css)({marginTop:n(1.5)})};return gt().createElement("div",{className:s.container},gt().createElement(JS,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:a.length>0},gt().createElement("div",null,a.map((e=>gt().createElement(OE,{key:e.id,header:e,onChange:e=>((e,t)=>{i(a.map((r=>r.id===e?IE({},t):r)))})(e.id,e),onDelete:()=>(e=>{const r=a.findIndex((t=>t.id===e));if(-1===r)return;const n=[...a];n.splice(r,1),i(n),t(n.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))})(e.id),onBlur:o,readOnly:r})))),gt().createElement("div",{className:s.addHeaderButton},gt().createElement(bt.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{i([...a,{id:DE(),name:"",value:"",configured:!1}])},disabled:r},0===a.length?"Add header":"Add another header"))))};function DE(){return Math.random().toString(16).slice(2)}var kE=Object.defineProperty,RE=Object.defineProperties,AE=Object.getOwnPropertyDescriptors,NE=Object.getOwnPropertySymbols,LE=Object.prototype.hasOwnProperty,ME=Object.prototype.propertyIsEnumerable,FE=(e,t,r)=>t in e?kE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,BE=(e,t)=>{for(var r in t||(t={}))LE.call(t,r)&&FE(e,r,t[r]);if(NE)for(var r of NE(t))ME.call(t,r)&&FE(e,r,t[r]);return e},qE=(e,t)=>RE(e,AE(t));const QE=({selectedMethod:e,mostCommonMethod:t,visibleMethods:r,defaultOptionsOverrides:n,customMethods:a,onAuthMethodSelect:i,basicAuth:o,TLS:s,customHeaders:l,readOnly:c=!1})=>{const u={container:(0,Nr.css)({maxWidth:578})};return gt().createElement("div",{className:u.container},gt().createElement(WS,{title:"Authentication"},gt().createElement(KP,{selectedMethod:e,mostCommonMethod:t,customMethods:a,visibleMethods:r,defaultOptionsOverrides:n,onAuthMethodSelect:i,basicAuth:o,readOnly:c}),s&&gt().createElement(dE,qE(BE({},s),{readOnly:c})),l&&gt().createElement($E,qE(BE({},l),{readOnly:c}))))};function VE(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WE(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){VE(e,t,r[t])}))}return e}function zE(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const UE=e=>{const{options:t,onOptionsChange:r,renderSigV4Editor:n,secureSocksDSProxyEnabled:a}=e,i=function({config:e,onChange:t}){return{selectedMethod:EP(e),onAuthMethodSelect:TP(e,t),basicAuth:CP(e,t),TLS:IP(e,t),customHeaders:jP(e,t),readOnly:e.readOnly}}({config:t,onChange:r});var o;o=()=>{u(!0),r(zE(WE({},t),{jsonData:zE(WE({},t.jsonData),{sigV4Auth:!0})}))},(0,mt.useEffect)(o,[]);const s=ki((0,bt.useTheme2)());let l=[];const[c,u]=(0,mt.useState)(t.jsonData.sigV4Auth||!1),d="custom-sigV4Id",p={id:d,label:"SigV4 auth",description:"Use SigV4 authentication to connect to your Amazon Managed Service for Prometheus workspace",component:gt().createElement(gt().Fragment,null,n)};let h;switch(l.push(p),t.access){case"direct":h=gt().createElement(gt().Fragment,null,"Your access method is ",gt().createElement("em",null,"Browser"),", this means the URL needs to be accessible from the browser.",$i());break;case"proxy":h=gt().createElement(gt().Fragment,null,"Your access method is ",gt().createElement("em",null,"Server"),", this means the URL needs to be accessible from the grafana backend/server.",$i());break;default:h=gt().createElement(gt().Fragment,null,"Specify a complete HTTP URL (for example http://your_server:8080) ",$i())}return gt().createElement(gt().Fragment,null,gt().createElement(MP,{urlPlaceholder:"http://localhost:9090",config:t,onChange:r,urlLabel:"Prometheus server URL",urlTooltip:h}),gt().createElement("hr",{className:`${s.hrTopSpace} ${s.hrBottomSpace}`}),gt().createElement(QE,zE(WE({},i),{customMethods:l,onAuthMethodSelect:e=>{u(e===d),r(zE(WE({},t),{basicAuth:e===mP.BasicAuth,withCredentials:e===mP.CrossSiteCredentials,jsonData:zE(WE({},t.jsonData),{sigV4Auth:e===d,oauthPassThru:e===mP.OAuthForward})}))},selectedMethod:c?d:i.selectedMethod,visibleMethods:[d]})),gt().createElement("div",{className:s.sectionBottomPadding}),a&&gt().createElement(gt().Fragment,null,gt().createElement(bt.SecureSocksProxySettings,{options:t,onOptionsChange:r}),gt().createElement("div",{className:s.sectionBottomPadding})))};function GE(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HE(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){GE(e,t,r[t])}))}return e}const XE=new e.DataSourcePlugin(Pd).setQueryEditor(Nw).setConfigEditor((e=>{const{options:t,onOptionsChange:r}=e,n=(a=(0,bt.useTheme2)(),{additionalSettings:Nr.css`
      margin-bottom: 25px;
    `,secondaryGrey:Nr.css`
      color: ${a.colors.secondary.text};
      opacity: 65%;
    `,inlineError:Nr.css`
      margin: 0px 0px 4px 245px;
    `,switchField:Nr.css`
      align-items: center;
    `,sectionHeaderPadding:Nr.css`
      padding-top: 32px;
    `,sectionBottomPadding:Nr.css`
      padding-bottom: 28px;
    `,subsectionText:Nr.css`
      font-size: 12px;
    `,hrBottomSpace:Nr.css`
      margin-bottom: 56px;
    `,hrTopSpace:Nr.css`
      margin-top: 50px;
    `,textUnderline:Nr.css`
      text-decoration: underline;
    `,versionMargin:Nr.css`
      margin-bottom: 12px;
    `,advancedHTTPSettingsMargin:Nr.css`
      margin: 24px 0 8px 0;
    `,advancedSettings:Nr.css`
      padding-top: 32px;
    `,alertingTop:Nr.css`
      margin-top: 40px !important;
    `,overhaulPageHeading:Nr.css`
      font-weight: 400;
    `,container:Nr.css`
      maxWidth: 578;
    `});var a;return gt().createElement(gt().Fragment,null,"direct"===t.access&&gt().createElement(bt.Alert,{title:"Error",severity:"error"},"Browser access mode in the Amazon Managed Service for Prometheus data source is no longer available. Switch to server access mode."),gt().createElement(TS,{dataSourceName:"Amazon Managed Service for Prometheus",docsLink:"https://grafana.com/grafana/plugins/grafana-amazonprometheus-datasource/"}),gt().createElement("hr",{className:`${n.hrTopSpace} ${n.hrBottomSpace}`}),gt().createElement(UE,{options:t,onOptionsChange:r,renderSigV4Editor:gt().createElement(vS,HE({inExperimentalAuthComponent:!0},e)),secureSocksDSProxyEnabled:j.config.secureSocksDSProxyEnabled}),gt().createElement("hr",null),gt().createElement(WS,{className:n.advancedSettings,title:"Advanced settings",description:"Additional settings are optional settings that can be configured for more control over your data source."},gt().createElement(l_,{className:n.advancedHTTPSettingsMargin,config:t,onChange:r}),gt().createElement(A_,{options:t,onOptionsChange:r}),gt().createElement(dP,{options:t,onOptionsChange:r})))})).setQueryEditorHelp((e=>{const t=(0,bt.useStyles2)(Mw);return(0,ht.jsxs)("div",{children:[(0,ht.jsx)("h2",{children:"PromQL Cheat Sheet"}),Lw.map(((r,n)=>(0,ht.jsxs)("div",{className:t.cheatSheetItem,children:[(0,ht.jsx)("div",{className:t.cheatSheetItemTitle,children:r.title}),r.expression?(0,ht.jsx)("button",{type:"button",className:t.cheatSheetExample,onClick:t=>e.onClickExample({refId:"A",expr:r.expression}),children:(0,ht.jsx)("code",{children:r.expression})}):null,r.label]},n)))]})}))})(),v})()));
//# sourceMappingURL=module.js.map